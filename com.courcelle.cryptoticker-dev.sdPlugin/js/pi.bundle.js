"use strict";(()=>{var Or=Object.create;var tt=Object.defineProperty;var Rr=Object.getOwnPropertyDescriptor;var Mr=Object.getOwnPropertyNames;var Ir=Object.getPrototypeOf,Dr=Object.prototype.hasOwnProperty;var rt=(n=>typeof require!="undefined"?require:typeof Proxy!="undefined"?new Proxy(n,{get:(r,s)=>(typeof require!="undefined"?require:r)[s]}):n)(function(n){if(typeof require!="undefined")return require.apply(this,arguments);throw Error('Dynamic require of "'+n+'" is not supported')});var K=(n,r)=>()=>(r||n((r={exports:{}}).exports,r),r.exports);var Vr=(n,r,s,i)=>{if(r&&typeof r=="object"||typeof r=="function")for(let o of Mr(r))!Dr.call(n,o)&&o!==s&&tt(n,o,{get:()=>r[o],enumerable:!(i=Rr(r,o))||i.enumerable});return n};var Q=(n,r,s)=>(s=n!=null?Or(Ir(n)):{},Vr(r||!n||!n.__esModule?tt(s,"default",{value:n,enumerable:!0}):s,n));var st=K((nt,ue)=>{"use strict";(function(n,r){if(typeof ue=="object"&&ue.exports)ue.exports=r();else{let s=r();n.CryptoTickerConfig=Object.assign({},n.CryptoTickerConfig||{},s)}})(typeof self!="undefined"?self:nt,function(){return{tProxyBase:"https://tproxyv8.opendle.com",fallbackPollIntervalMs:6e4,staleTickerTimeoutMs:5*60*1e3,binanceRestBaseUrl:"https://api.binance.com",binanceWsBaseUrl:"wss://stream.binance.com:9443/ws",binanceSymbolOverrides:{},bitfinexRestBaseUrl:"https://api-pub.bitfinex.com",bitfinexWsBaseUrl:"wss://api-pub.bitfinex.com/ws/2",bitfinexSymbolOverrides:{},messages:{loading:"LOADING...",stale:"STALE",noData:"NO DATA",misconfigured:"INVALID PAIR",conversionError:"CONVERT ERROR"}}})});var at=K((it,ce)=>{"use strict";var Nr={LIVE:"live",DETACHED:"detached",BACKUP:"backup",BROKEN:"broken"};(function(n,r){let s=typeof globalThis!="undefined"?globalThis:n,i=r();typeof ce=="object"&&ce.exports&&(ce.exports=i),s&&(s.CryptoTickerConnectionStates=i)})(typeof self!="undefined"?self:it,function(){return Nr})});var lt=K((ot,pe)=>{"use strict";(function(r,s){let i=s();typeof pe=="object"&&pe.exports&&(pe.exports=i),r&&typeof r=="object"&&(r.CryptoTickerDefaults=i)})(typeof self!="undefined"?self:ot,function(){function r(c){if(c===null||typeof c!="object")return c;if(Array.isArray(c))return c.map(E=>r(E));let w={};for(let E in c)Object.prototype.hasOwnProperty.call(c,E)&&(w[E]=r(c[E]));return w}function s(c){let w=c==null?void 0:c.case,E=(c==null?void 0:c.allowEmptyString)===!0,C=(c==null?void 0:c.allowNull)===!0,y=Object.prototype.hasOwnProperty.call(c||{},"trim")?!!(c!=null&&c.trim):!0,A=Array.isArray(c==null?void 0:c.allowedValues)?c==null?void 0:c.allowedValues:null;return function(j){if(j===void 0)return null;if(j===null)return C?null:"";let F=String(j);if(y&&(F=F.trim()),!F&&!E)return null;if(w==="upper"?F=F.toUpperCase():w==="lower"&&(F=F.toLowerCase()),A&&A.length>0){let $=w==="lower"?F.toLowerCase():w==="upper"?F.toUpperCase():F;return A.some(te=>w==="lower"?te.toLowerCase()===$:w==="upper"?te.toUpperCase()===$:te===$)?w==="lower"||w==="upper"?$:F:null}return F}}function i(c){let w=typeof(c==null?void 0:c.min)=="number"?c.min:null,E=typeof(c==null?void 0:c.max)=="number"?c.max:null,C=(c==null?void 0:c.integer)===!0;return function(A){if(A==null||A==="")return null;let P=typeof A=="number"?A:parseFloat(String(A));return Number.isNaN(P)?null:(C&&(P=Math.round(P)),w!==null&&P<w&&(P=w),E!==null&&P>E&&(P=E),P)}}function o(c){let w=Array.isArray(c.allowed)?c.allowed.slice(0):[],E=c.trim!==!1;return function(y){if(y==null)return null;let A=String(y);return E&&(A=A.trim()),A&&w.indexOf(A)>=0?A:null}}let f={title:{type:"string",default:"",normalize:s({allowEmptyString:!0,allowNull:!0,trim:!0})},exchange:{type:"string",default:"BINANCE",normalize:s({trim:!0,allowEmptyString:!1,case:"upper"})},pair:{type:"string",default:"BTCUSD",normalize:s({trim:!0,allowEmptyString:!1,case:"upper"})},fromCurrency:{type:"string",default:"USD",normalize:s({trim:!0,allowEmptyString:!1,case:"upper"})},currency:{type:"string",default:"",normalize:s({trim:!0,allowEmptyString:!0,case:"upper",allowNull:!0})},candlesInterval:{type:"string",default:"1h",normalize:s({trim:!0,allowEmptyString:!1})},candlesDisplayed:{type:"number",default:20,normalize:i({min:5,max:60,integer:!0})},multiplier:{type:"number",default:1,normalize:i({min:0})},digits:{type:"number",default:2,normalize:i({min:0,max:10,integer:!0})},highLowDigits:{type:"string",default:"",normalize:s({trim:!0,allowEmptyString:!0})},font:{type:"string",default:"Lato,'Roboto Condensed',Helvetica,Calibri,sans-serif",normalize:s({trim:!0,allowEmptyString:!1})},fontSizeBase:{type:"number",default:25,normalize:i({min:1,max:200,integer:!0})},fontSizePrice:{type:"number",default:35,normalize:i({min:1,max:200,integer:!0})},fontSizeHighLow:{type:"string",default:"",normalize:s({trim:!0,allowEmptyString:!0})},fontSizeChange:{type:"number",default:19,normalize:i({min:1,max:200,integer:!0})},priceFormat:{type:"string",default:"auto",normalize:function(c){let E=s({trim:!0,allowEmptyString:!1,case:"lower"})(c);return E?E==="compact"?"auto":E==="plain"?"full":E==="auto"||E==="full"?E:null:null}},thousandsSeparator:{type:"string",default:",",normalize:o({allowed:[",","."," ","'"],trim:!1})},decimalSeparator:{type:"string",default:".",normalize:o({allowed:[".",","]})},backgroundColor:{type:"string",default:"#000000",normalize:s({trim:!0,allowEmptyString:!1})},textColor:{type:"string",default:"#ffffff",normalize:s({trim:!0,allowEmptyString:!1})},displayHighLow:{type:"string",default:"on",normalize:s({trim:!0,allowEmptyString:!1,case:"lower",allowedValues:["on","off"]})},displayHighLowBar:{type:"string",default:"on",normalize:s({trim:!0,allowEmptyString:!1,case:"lower",allowedValues:["on","off"]})},displayDailyChange:{type:"string",default:"on",normalize:s({trim:!0,allowEmptyString:!1,case:"lower",allowedValues:["on","off"]})},displayConnectionStatusIcon:{type:"string",default:"OFF",normalize:s({trim:!0,allowEmptyString:!1,case:"upper",allowedValues:["OFF","TOP_RIGHT","BOTTOM_LEFT"]})},alertRule:{type:"string",default:"",normalize:s({trim:!0,allowEmptyString:!0})},backgroundColorRule:{type:"string",default:"",normalize:s({trim:!0,allowEmptyString:!0})},textColorRule:{type:"string",default:"",normalize:s({trim:!0,allowEmptyString:!0})},mode:{type:"string",default:"ticker",normalize:s({trim:!0,allowEmptyString:!1,case:"lower",allowedValues:["ticker","candles"]})}};function u(c,w,E){if(!c||typeof c!="object")return{value:w,error:null};let C=c.normalize,y=c.default;if(typeof C!="function")return{value:w===void 0?r(y):w,error:null};let A=C(w);if(A==null){let P=C(y);return{value:P==null?r(y):P,error:E?"Invalid "+c.type:null}}return{value:A,error:null}}function p(c){let w=c&&typeof c=="object"?c:{},E={},C=[];for(let y in f){if(!Object.prototype.hasOwnProperty.call(f,y))continue;let A=f[y],P=Object.prototype.hasOwnProperty.call(w,y),j=P?w[y]:void 0,F=u(A,j,P);E[y]=F.value,F.error&&C.push({key:y,message:F.error})}for(let y in w)!Object.prototype.hasOwnProperty.call(f,y)&&Object.prototype.hasOwnProperty.call(w,y)&&(E[y]=w[y]);return{settings:E,errors:C}}function d(c){return p(c).settings}let g=d(null);return{settingsSchema:f,defaultSettings:g,getDefaultSettings:function(){return r(g)},validateSettings:function(c){let w=p(c);return{settings:w.settings,errors:w.errors.slice(0)}},applyDefaults:d}})});var ct=K((fe,ut)=>{(function(n,r){typeof fe=="object"&&typeof ut!="undefined"?r(fe):typeof define=="function"&&define.amd?define(["exports"],r):(n=n||self,r(n.exprEval={}))})(fe,function(n){"use strict";var r="INUMBER",s="IOP1",i="IOP2",o="IOP3",f="IVAR",u="IVARNAME",p="IFUNCALL",d="IFUNDEF",g="IEXPR",c="IEXPREVAL",w="IMEMBER",E="IENDSTATEMENT",C="IARRAY";function y(e,t){this.type=e,this.value=t!=null?t:0}y.prototype.toString=function(){switch(this.type){case r:case s:case i:case o:case f:case u:case E:return this.value;case p:return"CALL "+this.value;case d:return"DEF "+this.value;case C:return"ARRAY "+this.value;case w:return"."+this.value;default:return"Invalid Instruction"}};function A(e){return new y(s,e)}function P(e){return new y(i,e)}function j(e){return new y(o,e)}function F(e,t,a,l,h){for(var v=[],m=[],k,T,V,D,L=0;L<e.length;L++){var b=e[L],z=b.type;if(z===r||z===u)Array.isArray(b.value)?v.push.apply(v,F(b.value.map(function(oe){return new y(r,oe)}).concat(new y(C,b.value.length)),t,a,l,h)):v.push(b);else if(z===f&&h.hasOwnProperty(b.value))b=new y(r,h[b.value]),v.push(b);else if(z===i&&v.length>1)T=v.pop(),k=v.pop(),D=a[b.value],b=new y(r,D(k.value,T.value)),v.push(b);else if(z===o&&v.length>2)V=v.pop(),T=v.pop(),k=v.pop(),b.value==="?"?v.push(k.value?T.value:V.value):(D=l[b.value],b=new y(r,D(k.value,T.value,V.value)),v.push(b));else if(z===s&&v.length>0)k=v.pop(),D=t[b.value],b=new y(r,D(k.value)),v.push(b);else if(z===g){for(;v.length>0;)m.push(v.shift());m.push(new y(g,F(b.value,t,a,l,h)))}else if(z===w&&v.length>0)k=v.pop(),v.push(new y(r,k.value[b.value]));else{for(;v.length>0;)m.push(v.shift());m.push(b)}}for(;v.length>0;)m.push(v.shift());return m}function $(e,t,a){for(var l=[],h=0;h<e.length;h++){var v=e[h],m=v.type;if(m===f&&v.value===t)for(var k=0;k<a.tokens.length;k++){var T=a.tokens[k],V;T.type===s?V=A(T.value):T.type===i?V=P(T.value):T.type===o?V=j(T.value):V=new y(T.type,T.value),l.push(V)}else m===g?l.push(new y(g,$(v.value,t,a))):l.push(v)}return l}function q(e,t,a){var l=[],h,v,m,k,T,V;if(ke(e))return H(e,a);for(var D=e.length,L=0;L<D;L++){var b=e[L],z=b.type;if(z===r||z===u)l.push(b.value);else if(z===i)v=l.pop(),h=l.pop(),b.value==="and"?l.push(h?!!q(v,t,a):!1):b.value==="or"?l.push(h?!0:!!q(v,t,a)):b.value==="="?(k=t.binaryOps[b.value],l.push(k(h,q(v,t,a),a))):(k=t.binaryOps[b.value],l.push(k(H(h,a),H(v,a))));else if(z===o)m=l.pop(),v=l.pop(),h=l.pop(),b.value==="?"?l.push(q(h?v:m,t,a)):(k=t.ternaryOps[b.value],l.push(k(H(h,a),H(v,a),H(m,a))));else if(z===f)if(b.value in t.functions)l.push(t.functions[b.value]);else if(b.value in t.unaryOps&&t.parser.isOperatorEnabled(b.value))l.push(t.unaryOps[b.value]);else{var oe=a[b.value];if(oe!==void 0)l.push(oe);else throw new Error("undefined variable: "+b.value)}else if(z===s)h=l.pop(),k=t.unaryOps[b.value],l.push(k(H(h,a)));else if(z===p){for(V=b.value,T=[];V-- >0;)T.unshift(H(l.pop(),a));if(k=l.pop(),k.apply&&k.call)l.push(k.apply(void 0,T));else throw new Error(k+" is not a function")}else if(z===d)l.push(function(){for(var Pr=l.pop(),Re=[],Ar=b.value;Ar-- >0;)Re.unshift(l.pop());var Ze=l.pop(),Me=function(){for(var et=Object.assign({},a),le=0,Tr=Re.length;le<Tr;le++)et[Re[le]]=arguments[le];return q(Pr,t,et)};return Object.defineProperty(Me,"name",{value:Ze,writable:!1}),a[Ze]=Me,Me}());else if(z===g)l.push(te(b,t));else if(z===c)l.push(b);else if(z===w)h=l.pop(),l.push(h[b.value]);else if(z===E)l.pop();else if(z===C){for(V=b.value,T=[];V-- >0;)T.unshift(l.pop());l.push(T)}else throw new Error("invalid Expression")}if(l.length>1)throw new Error("invalid Expression (parity)");return l[0]===0?0:H(l[0],a)}function te(e,t,a){return ke(e)?e:{type:c,value:function(l){return q(e.value,t,l)}}}function ke(e){return e&&e.type===c}function H(e,t){return ke(e)?e.value(t):e}function Se(e,t){for(var a=[],l,h,v,m,k,T,V=0;V<e.length;V++){var D=e[V],L=D.type;if(L===r)typeof D.value=="number"&&D.value<0?a.push("("+D.value+")"):Array.isArray(D.value)?a.push("["+D.value.map(He).join(", ")+"]"):a.push(He(D.value));else if(L===i)h=a.pop(),l=a.pop(),m=D.value,t?m==="^"?a.push("Math.pow("+l+", "+h+")"):m==="and"?a.push("(!!"+l+" && !!"+h+")"):m==="or"?a.push("(!!"+l+" || !!"+h+")"):m==="||"?a.push("(function(a,b){ return Array.isArray(a) && Array.isArray(b) ? a.concat(b) : String(a) + String(b); }(("+l+"),("+h+")))"):m==="=="?a.push("("+l+" === "+h+")"):m==="!="?a.push("("+l+" !== "+h+")"):m==="["?a.push(l+"[("+h+") | 0]"):a.push("("+l+" "+m+" "+h+")"):m==="["?a.push(l+"["+h+"]"):a.push("("+l+" "+m+" "+h+")");else if(L===o)if(v=a.pop(),h=a.pop(),l=a.pop(),m=D.value,m==="?")a.push("("+l+" ? "+h+" : "+v+")");else throw new Error("invalid Expression");else if(L===f||L===u)a.push(D.value);else if(L===s)l=a.pop(),m=D.value,m==="-"||m==="+"?a.push("("+m+l+")"):t?m==="not"?a.push("(!"+l+")"):m==="!"?a.push("fac("+l+")"):a.push(m+"("+l+")"):m==="!"?a.push("("+l+"!)"):a.push("("+m+" "+l+")");else if(L===p){for(T=D.value,k=[];T-- >0;)k.unshift(a.pop());m=a.pop(),a.push(m+"("+k.join(", ")+")")}else if(L===d){for(h=a.pop(),T=D.value,k=[];T-- >0;)k.unshift(a.pop());l=a.pop(),t?a.push("("+l+" = function("+k.join(", ")+") { return "+h+" })"):a.push("("+l+"("+k.join(", ")+") = "+h+")")}else if(L===w)l=a.pop(),a.push(l+"."+D.value);else if(L===C){for(T=D.value,k=[];T-- >0;)k.unshift(a.pop());a.push("["+k.join(", ")+"]")}else if(L===g)a.push("("+Se(D.value,t)+")");else if(L!==E)throw new Error("invalid Expression")}return a.length>1&&(t?a=[a.join(",")]:a=[a.join(";")]),String(a[0])}function He(e){return typeof e=="string"?JSON.stringify(e).replace(/\u2028/g,"\\u2028").replace(/\u2029/g,"\\u2029"):e}function Z(e,t){for(var a=0;a<e.length;a++)if(e[a]===t)return!0;return!1}function Ce(e,t,a){a=a||{};for(var l=!!a.withMembers,h=null,v=0;v<e.length;v++){var m=e[v];m.type===f||m.type===u?!l&&!Z(t,m.value)?t.push(m.value):(h!==null&&(Z(t,h)||t.push(h)),h=m.value):m.type===w&&l&&h!==null?h+="."+m.value:m.type===g?Ce(m.value,t,a):h!==null&&(Z(t,h)||t.push(h),h=null)}h!==null&&!Z(t,h)&&t.push(h)}function _(e,t){this.tokens=e,this.parser=t,this.unaryOps=t.unaryOps,this.binaryOps=t.binaryOps,this.ternaryOps=t.ternaryOps,this.functions=t.functions}_.prototype.simplify=function(e){return e=e||{},new _(F(this.tokens,this.unaryOps,this.binaryOps,this.ternaryOps,e),this.parser)},_.prototype.substitute=function(e,t){return t instanceof _||(t=this.parser.parse(String(t))),new _($(this.tokens,e,t),this.parser)},_.prototype.evaluate=function(e){return e=e||{},q(this.tokens,this,e)},_.prototype.toString=function(){return Se(this.tokens,!1)},_.prototype.symbols=function(e){e=e||{};var t=[];return Ce(this.tokens,t,e),t},_.prototype.variables=function(e){e=e||{};var t=[];Ce(this.tokens,t,e);var a=this.functions;return t.filter(function(l){return!(l in a)})},_.prototype.toJSFunction=function(e,t){var a=this,l=new Function(e,"with(this.functions) with (this.ternaryOps) with (this.binaryOps) with (this.unaryOps) { return "+Se(this.simplify(t).tokens,!0)+"; }");return function(){return l.apply(a,arguments)}};var re="TEOF",M="TOP",ie="TNUMBER",We="TSTRING",W="TPAREN",ee="TBRACKET",ae="TCOMMA",Pe="TNAME",Ae="TSEMICOLON";function Ge(e,t,a){this.type=e,this.value=t,this.index=a}Ge.prototype.toString=function(){return this.type+": "+this.value};function N(e,t){this.pos=0,this.current=null,this.unaryOps=e.unaryOps,this.binaryOps=e.binaryOps,this.ternaryOps=e.ternaryOps,this.consts=e.consts,this.expression=t,this.savedPosition=0,this.savedCurrent=null,this.options=e.options,this.parser=e}N.prototype.newToken=function(e,t,a){return new Ge(e,t,a!=null?a:this.pos)},N.prototype.save=function(){this.savedPosition=this.pos,this.savedCurrent=this.current},N.prototype.restore=function(){this.pos=this.savedPosition,this.current=this.savedCurrent},N.prototype.next=function(){if(this.pos>=this.expression.length)return this.newToken(re,"EOF");if(this.isWhitespace()||this.isComment())return this.next();if(this.isRadixInteger()||this.isNumber()||this.isOperator()||this.isString()||this.isParen()||this.isBracket()||this.isComma()||this.isSemicolon()||this.isNamedOp()||this.isConst()||this.isName())return this.current;this.parseError('Unknown character "'+this.expression.charAt(this.pos)+'"')},N.prototype.isString=function(){var e=!1,t=this.pos,a=this.expression.charAt(t);if(a==="'"||a==='"')for(var l=this.expression.indexOf(a,t+1);l>=0&&this.pos<this.expression.length;){if(this.pos=l+1,this.expression.charAt(l-1)!=="\\"){var h=this.expression.substring(t+1,l);this.current=this.newToken(We,this.unescape(h),t),e=!0;break}l=this.expression.indexOf(a,l+1)}return e},N.prototype.isParen=function(){var e=this.expression.charAt(this.pos);return e==="("||e===")"?(this.current=this.newToken(W,e),this.pos++,!0):!1},N.prototype.isBracket=function(){var e=this.expression.charAt(this.pos);return(e==="["||e==="]")&&this.isOperatorEnabled("[")?(this.current=this.newToken(ee,e),this.pos++,!0):!1},N.prototype.isComma=function(){var e=this.expression.charAt(this.pos);return e===","?(this.current=this.newToken(ae,","),this.pos++,!0):!1},N.prototype.isSemicolon=function(){var e=this.expression.charAt(this.pos);return e===";"?(this.current=this.newToken(Ae,";"),this.pos++,!0):!1},N.prototype.isConst=function(){for(var e=this.pos,t=e;t<this.expression.length;t++){var a=this.expression.charAt(t);if(a.toUpperCase()===a.toLowerCase()&&(t===this.pos||a!=="_"&&a!=="."&&(a<"0"||a>"9")))break}if(t>e){var l=this.expression.substring(e,t);if(l in this.consts)return this.current=this.newToken(ie,this.consts[l]),this.pos+=l.length,!0}return!1},N.prototype.isNamedOp=function(){for(var e=this.pos,t=e;t<this.expression.length;t++){var a=this.expression.charAt(t);if(a.toUpperCase()===a.toLowerCase()&&(t===this.pos||a!=="_"&&(a<"0"||a>"9")))break}if(t>e){var l=this.expression.substring(e,t);if(this.isOperatorEnabled(l)&&(l in this.binaryOps||l in this.unaryOps||l in this.ternaryOps))return this.current=this.newToken(M,l),this.pos+=l.length,!0}return!1},N.prototype.isName=function(){for(var e=this.pos,t=e,a=!1;t<this.expression.length;t++){var l=this.expression.charAt(t);if(l.toUpperCase()===l.toLowerCase()){if(t===this.pos&&(l==="$"||l==="_")){l==="_"&&(a=!0);continue}else if(t===this.pos||!a||l!=="_"&&(l<"0"||l>"9"))break}else a=!0}if(a){var h=this.expression.substring(e,t);return this.current=this.newToken(Pe,h),this.pos+=h.length,!0}return!1},N.prototype.isWhitespace=function(){for(var e=!1,t=this.expression.charAt(this.pos);(t===" "||t==="	"||t===`
`||t==="\r")&&(e=!0,this.pos++,!(this.pos>=this.expression.length));)t=this.expression.charAt(this.pos);return e};var Mt=/^[0-9a-f]{4}$/i;N.prototype.unescape=function(e){var t=e.indexOf("\\");if(t<0)return e;for(var a=e.substring(0,t);t>=0;){var l=e.charAt(++t);switch(l){case"'":a+="'";break;case'"':a+='"';break;case"\\":a+="\\";break;case"/":a+="/";break;case"b":a+="\b";break;case"f":a+="\f";break;case"n":a+=`
`;break;case"r":a+="\r";break;case"t":a+="	";break;case"u":var h=e.substring(t+1,t+5);Mt.test(h)||this.parseError("Illegal escape sequence: \\u"+h),a+=String.fromCharCode(parseInt(h,16)),t+=4;break;default:throw this.parseError('Illegal escape sequence: "\\'+l+'"')}++t;var v=e.indexOf("\\",t);a+=e.substring(t,v<0?e.length:v),t=v}return a},N.prototype.isComment=function(){var e=this.expression.charAt(this.pos);return e==="/"&&this.expression.charAt(this.pos+1)==="*"?(this.pos=this.expression.indexOf("*/",this.pos)+2,this.pos===1&&(this.pos=this.expression.length),!0):!1},N.prototype.isRadixInteger=function(){var e=this.pos;if(e>=this.expression.length-2||this.expression.charAt(e)!=="0")return!1;++e;var t,a;if(this.expression.charAt(e)==="x")t=16,a=/^[0-9a-f]$/i,++e;else if(this.expression.charAt(e)==="b")t=2,a=/^[01]$/i,++e;else return!1;for(var l=!1,h=e;e<this.expression.length;){var v=this.expression.charAt(e);if(a.test(v))e++,l=!0;else break}return l&&(this.current=this.newToken(ie,parseInt(this.expression.substring(h,e),t)),this.pos=e),l},N.prototype.isNumber=function(){for(var e=!1,t=this.pos,a=t,l=t,h=!1,v=!1,m;t<this.expression.length&&(m=this.expression.charAt(t),m>="0"&&m<="9"||!h&&m===".");)m==="."?h=!0:v=!0,t++,e=v;if(e&&(l=t),m==="e"||m==="E"){t++;for(var k=!0,T=!1;t<this.expression.length;){if(m=this.expression.charAt(t),k&&(m==="+"||m==="-"))k=!1;else if(m>="0"&&m<="9")T=!0,k=!1;else break;t++}T||(t=l)}return e?(this.current=this.newToken(ie,parseFloat(this.expression.substring(a,t))),this.pos=t):this.pos=l,e},N.prototype.isOperator=function(){var e=this.pos,t=this.expression.charAt(this.pos);if(t==="+"||t==="-"||t==="*"||t==="/"||t==="%"||t==="^"||t==="?"||t===":"||t===".")this.current=this.newToken(M,t);else if(t==="\u2219"||t==="\u2022")this.current=this.newToken(M,"*");else if(t===">")this.expression.charAt(this.pos+1)==="="?(this.current=this.newToken(M,">="),this.pos++):this.current=this.newToken(M,">");else if(t==="<")this.expression.charAt(this.pos+1)==="="?(this.current=this.newToken(M,"<="),this.pos++):this.current=this.newToken(M,"<");else if(t==="|")if(this.expression.charAt(this.pos+1)==="|")this.current=this.newToken(M,"||"),this.pos++;else return!1;else if(t==="=")this.expression.charAt(this.pos+1)==="="?(this.current=this.newToken(M,"=="),this.pos++):this.current=this.newToken(M,t);else if(t==="!")this.expression.charAt(this.pos+1)==="="?(this.current=this.newToken(M,"!="),this.pos++):this.current=this.newToken(M,t);else return!1;return this.pos++,this.isOperatorEnabled(this.current.value)?!0:(this.pos=e,!1)},N.prototype.isOperatorEnabled=function(e){return this.parser.isOperatorEnabled(e)},N.prototype.getCoordinates=function(){var e=0,t,a=-1;do e++,t=this.pos-a,a=this.expression.indexOf(`
`,a+1);while(a>=0&&a<this.pos);return{line:e,column:t}},N.prototype.parseError=function(e){var t=this.getCoordinates();throw new Error("parse error ["+t.line+":"+t.column+"]: "+e)};function I(e,t,a){this.parser=e,this.tokens=t,this.current=null,this.nextToken=null,this.next(),this.savedCurrent=null,this.savedNextToken=null,this.allowMemberAccess=a.allowMemberAccess!==!1}I.prototype.next=function(){return this.current=this.nextToken,this.nextToken=this.tokens.next()},I.prototype.tokenMatches=function(e,t){return typeof t=="undefined"?!0:Array.isArray(t)?Z(t,e.value):typeof t=="function"?t(e):e.value===t},I.prototype.save=function(){this.savedCurrent=this.current,this.savedNextToken=this.nextToken,this.tokens.save()},I.prototype.restore=function(){this.tokens.restore(),this.current=this.savedCurrent,this.nextToken=this.savedNextToken},I.prototype.accept=function(e,t){return this.nextToken.type===e&&this.tokenMatches(this.nextToken,t)?(this.next(),!0):!1},I.prototype.expect=function(e,t){if(!this.accept(e,t)){var a=this.tokens.getCoordinates();throw new Error("parse error ["+a.line+":"+a.column+"]: Expected "+(t||e))}},I.prototype.parseAtom=function(e){var t=this.tokens.unaryOps;function a(h){return h.value in t}if(this.accept(Pe)||this.accept(M,a))e.push(new y(f,this.current.value));else if(this.accept(ie))e.push(new y(r,this.current.value));else if(this.accept(We))e.push(new y(r,this.current.value));else if(this.accept(W,"("))this.parseExpression(e),this.expect(W,")");else if(this.accept(ee,"["))if(this.accept(ee,"]"))e.push(new y(C,0));else{var l=this.parseArrayList(e);e.push(new y(C,l))}else throw new Error("unexpected "+this.nextToken)},I.prototype.parseExpression=function(e){var t=[];this.parseUntilEndStatement(e,t)||(this.parseVariableAssignmentExpression(t),!this.parseUntilEndStatement(e,t)&&this.pushExpression(e,t))},I.prototype.pushExpression=function(e,t){for(var a=0,l=t.length;a<l;a++)e.push(t[a])},I.prototype.parseUntilEndStatement=function(e,t){return this.accept(Ae)?(this.nextToken&&this.nextToken.type!==re&&!(this.nextToken.type===W&&this.nextToken.value===")")&&t.push(new y(E)),this.nextToken.type!==re&&this.parseExpression(t),e.push(new y(g,t)),!0):!1},I.prototype.parseArrayList=function(e){for(var t=0;!this.accept(ee,"]");)for(this.parseExpression(e),++t;this.accept(ae);)this.parseExpression(e),++t;return t},I.prototype.parseVariableAssignmentExpression=function(e){for(this.parseConditionalExpression(e);this.accept(M,"=");){var t=e.pop(),a=[],l=e.length-1;if(t.type===p){if(!this.tokens.isOperatorEnabled("()="))throw new Error("function definition is not permitted");for(var h=0,v=t.value+1;h<v;h++){var m=l-h;e[m].type===f&&(e[m]=new y(u,e[m].value))}this.parseVariableAssignmentExpression(a),e.push(new y(g,a)),e.push(new y(d,t.value));continue}if(t.type!==f&&t.type!==w)throw new Error("expected variable for assignment");this.parseVariableAssignmentExpression(a),e.push(new y(u,t.value)),e.push(new y(g,a)),e.push(P("="))}},I.prototype.parseConditionalExpression=function(e){for(this.parseOrExpression(e);this.accept(M,"?");){var t=[],a=[];this.parseConditionalExpression(t),this.expect(M,":"),this.parseConditionalExpression(a),e.push(new y(g,t)),e.push(new y(g,a)),e.push(j("?"))}},I.prototype.parseOrExpression=function(e){for(this.parseAndExpression(e);this.accept(M,"or");){var t=[];this.parseAndExpression(t),e.push(new y(g,t)),e.push(P("or"))}},I.prototype.parseAndExpression=function(e){for(this.parseComparison(e);this.accept(M,"and");){var t=[];this.parseComparison(t),e.push(new y(g,t)),e.push(P("and"))}};var It=["==","!=","<","<=",">=",">","in"];I.prototype.parseComparison=function(e){for(this.parseAddSub(e);this.accept(M,It);){var t=this.current;this.parseAddSub(e),e.push(P(t.value))}};var Dt=["+","-","||"];I.prototype.parseAddSub=function(e){for(this.parseTerm(e);this.accept(M,Dt);){var t=this.current;this.parseTerm(e),e.push(P(t.value))}};var Vt=["*","/","%"];I.prototype.parseTerm=function(e){for(this.parseFactor(e);this.accept(M,Vt);){var t=this.current;this.parseFactor(e),e.push(P(t.value))}},I.prototype.parseFactor=function(e){var t=this.tokens.unaryOps;function a(h){return h.value in t}if(this.save(),this.accept(M,a)){if(this.current.value!=="-"&&this.current.value!=="+"){if(this.nextToken.type===W&&this.nextToken.value==="("){this.restore(),this.parseExponential(e);return}else if(this.nextToken.type===Ae||this.nextToken.type===ae||this.nextToken.type===re||this.nextToken.type===W&&this.nextToken.value===")"){this.restore(),this.parseAtom(e);return}}var l=this.current;this.parseFactor(e),e.push(A(l.value))}else this.parseExponential(e)},I.prototype.parseExponential=function(e){for(this.parsePostfixExpression(e);this.accept(M,"^");)this.parseFactor(e),e.push(P("^"))},I.prototype.parsePostfixExpression=function(e){for(this.parseFunctionCall(e);this.accept(M,"!");)e.push(A("!"))},I.prototype.parseFunctionCall=function(e){var t=this.tokens.unaryOps;function a(v){return v.value in t}if(this.accept(M,a)){var l=this.current;this.parseAtom(e),e.push(A(l.value))}else for(this.parseMemberExpression(e);this.accept(W,"(");)if(this.accept(W,")"))e.push(new y(p,0));else{var h=this.parseArgumentList(e);e.push(new y(p,h))}},I.prototype.parseArgumentList=function(e){for(var t=0;!this.accept(W,")");)for(this.parseExpression(e),++t;this.accept(ae);)this.parseExpression(e),++t;return t},I.prototype.parseMemberExpression=function(e){for(this.parseAtom(e);this.accept(M,".")||this.accept(ee,"[");){var t=this.current;if(t.value==="."){if(!this.allowMemberAccess)throw new Error('unexpected ".", member access is not permitted');this.expect(Pe),e.push(new y(w,this.current.value))}else if(t.value==="["){if(!this.tokens.isOperatorEnabled("["))throw new Error('unexpected "[]", arrays are disabled');this.parseExpression(e),this.expect(ee,"]"),e.push(P("["))}else throw new Error("unexpected symbol: "+t.value)}};function Nt(e,t){return Number(e)+Number(t)}function zt(e,t){return e-t}function Bt(e,t){return e*t}function Ft(e,t){return e/t}function Lt(e,t){return e%t}function Ut(e,t){return Array.isArray(e)&&Array.isArray(t)?e.concat(t):""+e+t}function jt(e,t){return e===t}function _t(e,t){return e!==t}function Ht(e,t){return e>t}function Wt(e,t){return e<t}function Gt(e,t){return e>=t}function qt(e,t){return e<=t}function Jt(e,t){return!!(e&&t)}function Kt(e,t){return!!(e||t)}function Xt(e,t){return Z(t,e)}function Yt(e){return(Math.exp(e)-Math.exp(-e))/2}function $t(e){return(Math.exp(e)+Math.exp(-e))/2}function Qt(e){return e===1/0?1:e===-1/0?-1:(Math.exp(e)-Math.exp(-e))/(Math.exp(e)+Math.exp(-e))}function Zt(e){return e===-1/0?e:Math.log(e+Math.sqrt(e*e+1))}function er(e){return Math.log(e+Math.sqrt(e*e-1))}function tr(e){return Math.log((1+e)/(1-e))/2}function qe(e){return Math.log(e)*Math.LOG10E}function rr(e){return-e}function nr(e){return!e}function sr(e){return e<0?Math.ceil(e):Math.floor(e)}function ir(e){return Math.random()*(e||1)}function Je(e){return Oe(e+1)}function ar(e){return isFinite(e)&&e===Math.round(e)}var or=4.7421875,Te=[.9999999999999971,57.15623566586292,-59.59796035547549,14.136097974741746,-.4919138160976202,3399464998481189e-20,4652362892704858e-20,-9837447530487956e-20,.0001580887032249125,-.00021026444172410488,.00021743961811521265,-.0001643181065367639,8441822398385275e-20,-26190838401581408e-21,36899182659531625e-22];function Oe(e){var t,a;if(ar(e)){if(e<=0)return isFinite(e)?1/0:NaN;if(e>171)return 1/0;for(var l=e-2,h=e-1;l>1;)h*=l,l--;return h===0&&(h=1),h}if(e<.5)return Math.PI/(Math.sin(Math.PI*e)*Oe(1-e));if(e>=171.35)return 1/0;if(e>85){var v=e*e,m=v*e,k=m*e,T=k*e;return Math.sqrt(2*Math.PI/e)*Math.pow(e/Math.E,e)*(1+1/(12*e)+1/(288*v)-139/(51840*m)-571/(2488320*k)+163879/(209018880*T)+5246819/(75246796800*T*e))}--e,a=Te[0];for(var V=1;V<Te.length;++V)a+=Te[V]/(e+V);return t=e+or+.5,Math.sqrt(2*Math.PI)*Math.pow(t,e+.5)*Math.exp(-t)*a}function lr(e){return Array.isArray(e)?e.length:String(e).length}function Ke(){for(var e=0,t=0,a=0;a<arguments.length;a++){var l=Math.abs(arguments[a]),h;t<l?(h=t/l,e=e*h*h+1,t=l):l>0?(h=l/t,e+=h*h):e+=l}return t===1/0?1/0:t*Math.sqrt(e)}function Xe(e,t,a){return e?t:a}function ur(e,t){return typeof t=="undefined"||+t==0?Math.round(e):(e=+e,t=-+t,isNaN(e)||!(typeof t=="number"&&t%1===0)?NaN:(e=e.toString().split("e"),e=Math.round(+(e[0]+"e"+(e[1]?+e[1]-t:-t))),e=e.toString().split("e"),+(e[0]+"e"+(e[1]?+e[1]+t:t))))}function cr(e,t,a){return a&&(a[e]=t),t}function pr(e,t){return e[t|0]}function fr(e){return arguments.length===1&&Array.isArray(e)?Math.max.apply(Math,e):Math.max.apply(Math,arguments)}function hr(e){return arguments.length===1&&Array.isArray(e)?Math.min.apply(Math,e):Math.min.apply(Math,arguments)}function dr(e,t){if(typeof e!="function")throw new Error("First argument to map is not a function");if(!Array.isArray(t))throw new Error("Second argument to map is not an array");return t.map(function(a,l){return e(a,l)})}function gr(e,t,a){if(typeof e!="function")throw new Error("First argument to fold is not a function");if(!Array.isArray(a))throw new Error("Second argument to fold is not an array");return a.reduce(function(l,h,v){return e(l,h,v)},t)}function yr(e,t){if(typeof e!="function")throw new Error("First argument to filter is not a function");if(!Array.isArray(t))throw new Error("Second argument to filter is not an array");return t.filter(function(a,l){return e(a,l)})}function mr(e,t){if(!(Array.isArray(t)||typeof t=="string"))throw new Error("Second argument to indexOf is not a string or array");return t.indexOf(e)}function vr(e,t){if(!Array.isArray(t))throw new Error("Second argument to join is not an array");return t.join(e)}function wr(e){return(e>0)-(e<0)||+e}var Ye=1/3;function Er(e){return e<0?-Math.pow(-e,Ye):Math.pow(e,Ye)}function br(e){return Math.exp(e)-1}function xr(e){return Math.log(1+e)}function kr(e){return Math.log(e)/Math.LN2}function J(e){this.options=e||{},this.unaryOps={sin:Math.sin,cos:Math.cos,tan:Math.tan,asin:Math.asin,acos:Math.acos,atan:Math.atan,sinh:Math.sinh||Yt,cosh:Math.cosh||$t,tanh:Math.tanh||Qt,asinh:Math.asinh||Zt,acosh:Math.acosh||er,atanh:Math.atanh||tr,sqrt:Math.sqrt,cbrt:Math.cbrt||Er,log:Math.log,log2:Math.log2||kr,ln:Math.log,lg:Math.log10||qe,log10:Math.log10||qe,expm1:Math.expm1||br,log1p:Math.log1p||xr,abs:Math.abs,ceil:Math.ceil,floor:Math.floor,round:Math.round,trunc:Math.trunc||sr,"-":rr,"+":Number,exp:Math.exp,not:nr,length:lr,"!":Je,sign:Math.sign||wr},this.binaryOps={"+":Nt,"-":zt,"*":Bt,"/":Ft,"%":Lt,"^":Math.pow,"||":Ut,"==":jt,"!=":_t,">":Ht,"<":Wt,">=":Gt,"<=":qt,and:Jt,or:Kt,in:Xt,"=":cr,"[":pr},this.ternaryOps={"?":Xe},this.functions={random:ir,fac:Je,min:hr,max:fr,hypot:Math.hypot||Ke,pyt:Math.hypot||Ke,pow:Math.pow,atan2:Math.atan2,if:Xe,gamma:Oe,roundTo:ur,map:dr,fold:gr,filter:yr,indexOf:mr,join:vr},this.consts={E:Math.E,PI:Math.PI,true:!0,false:!1}}J.prototype.parse=function(e){var t=[],a=new I(this,new N(this,e),{allowMemberAccess:this.options.allowMemberAccess});return a.parseExpression(t),a.expect(re,"EOF"),new _(t,this)},J.prototype.evaluate=function(e,t){return this.parse(e).evaluate(t)};var $e=new J;J.parse=function(e){return $e.parse(e)},J.evaluate=function(e,t){return $e.parse(e).evaluate(t)};var Qe={"+":"add","-":"subtract","*":"multiply","/":"divide","%":"remainder","^":"power","!":"factorial","<":"comparison",">":"comparison","<=":"comparison",">=":"comparison","==":"comparison","!=":"comparison","||":"concatenate",and:"logical",or:"logical",not:"logical","?":"conditional",":":"conditional","=":"assignment","[":"array","()=":"fndef"};function Sr(e){return Qe.hasOwnProperty(e)?Qe[e]:e}J.prototype.isOperatorEnabled=function(e){var t=Sr(e),a=this.options.operators||{};return!(t in a)||!!a[t]};var Cr={Parser:J,Expression:_};n.Expression=_,n.Parser=J,n.default=Cr,Object.defineProperty(n,"__esModule",{value:!0})})});var dt=K((ht,he)=>{"use strict";var de=class{constructor(r,s){let i=r||{},o=Array.isArray(i.allowedVariables)&&i.allowedVariables.length>0?i.allowedVariables.slice():Ie.slice();this.allowedVariables=o;let f=s||ft();this.parser=new f({operators:{add:!0,subtract:!0,multiply:!0,divide:!0,remainder:!0,power:!1,factorial:!1,comparison:!0,logical:!0,conditional:!0,concatenate:!1,assignment:!1,array:!1,fndef:!1},allowMemberAccess:!1}),this.cache={}}validate(r){let s;try{s=this.getCacheEntry(r)}catch(i){return{ok:!1,error:i instanceof Error?i.message:"Invalid expression"}}return s?s.disallowedVariables.length>0?{ok:!1,error:"Unknown variables: "+s.disallowedVariables.join(", ")+". Allowed variables: "+this.allowedVariables.join(", ")}:{ok:!0,variables:s.variables.slice()}:{ok:!1,error:"Expression cannot be empty"}}evaluate(r,s){let i=this.getCacheEntry(r);if(!i)throw new Error("Expression cannot be empty");if(i.disallowedVariables.length>0)throw new Error("Unknown variables: "+i.disallowedVariables.join(", ")+". Allowed variables: "+this.allowedVariables.join(", "));let o={},f=s||{};for(let u of this.allowedVariables){let p=Object.prototype.hasOwnProperty.call(f,u)?f[u]:void 0;if(Ie.indexOf(u)!==-1){o[u]=X(p);continue}typeof p=="number"?o[u]=Number.isFinite(p)?p:0:typeof p=="boolean"||typeof p=="string"?o[u]=p:p==null?o[u]=0:o[u]=p}return i.compiled.evaluate(o)}clearCache(){this.cache={}}getCacheEntry(r){let s=this.normalizeExpression(r);if(!s)return null;if(this.cache[s])return this.cache[s];let i;try{i=this.parser.parse(s)}catch(p){throw this.wrapParseError(p)}let o=i.variables({withMembers:!1})||[],f=o.filter(p=>this.allowedVariables.indexOf(p)===-1),u={expression:s,compiled:i,variables:o.slice(),disallowedVariables:f.slice()};return this.cache[s]=u,u}normalizeExpression(r){return typeof r!="string"?"":r.trim()}wrapParseError(r){let s=r&&typeof r=="object"&&r instanceof Error&&r.message?Fr(r.message):"Invalid expression",i=new Error(s);return r&&typeof r=="object"&&(i.originalError=r),i}},Ie=["value","high","low","changeDaily","changeDailyPercent","volume"];function zr(n){return n?n.slice():[]}function X(n){if(n==null)return 0;if(typeof n=="number")return Number.isFinite(n)?n:0;if(typeof n=="string"&&n.trim()!==""){let r=Number(n);if(!Number.isNaN(r)&&Number.isFinite(r))return r}return 0}function pt(n){let r=n||{};return{value:X(r.last),high:X(r.high),low:X(r.low),changeDaily:X(r.changeDaily),changeDailyPercent:X(r.changeDailyPercent),volume:X(r.volume)}}function Br(n,r){let s=pt(n);if(r&&typeof r=="object")for(let i in r)Object.prototype.hasOwnProperty.call(r,i)&&(s[i]=r[i]);return s}function Fr(n){return n?n.indexOf("member access is not permitted")>=0?n+'. Remove object-style prefixes (for example use "value" instead of "values.last").':n:"Invalid expression"}function ft(){if(typeof rt=="function")try{let s=ct();if(s&&s.Parser)return s.Parser}catch{}let n=typeof globalThis!="undefined"?globalThis:{},r=n.exprEval&&n.exprEval.Parser;if(r)return r;throw new Error("expr-eval dependency is missing")}(function(r,s){let i=ft(),o=s(i);typeof he=="object"&&he.exports&&(he.exports=o),r&&typeof r=="object"&&(r.CryptoTickerExpressionEvaluator=o)})(typeof self!="undefined"?self:ht,function(r){return{createEvaluator:s=>new de(s,r),ExpressionEvaluator:de,normalizeNumericValue:X,buildBaseContext:pt,buildContext:Br,allowedVariables:zr(Ie)}})});var yt=K(gt=>{"use strict";(function(n){let r=n.CryptoTickerPIProviders=n.CryptoTickerPIProviders||{},s=r._providers=r._providers||{};r.registerProvider=function(i){!i||typeof i.id!="string"||(s[i.id.toUpperCase()]=i)},r.getProvider=function(i){return typeof i!="string"?null:s[i.toUpperCase()]||null},r.listProviders=function(){return Object.keys(s)}})(typeof self!="undefined"?self:gt)});var vt=K((mt,ge)=>{"use strict";(function(n,r){let s=typeof globalThis!="undefined"?globalThis:n,i=s&&s.CryptoTickerPIProviders?s.CryptoTickerPIProviders:null,o=r();typeof ge=="object"&&ge.exports&&(ge.exports=o),i&&typeof i.registerProvider=="function"&&i.registerProvider(o)})(typeof self!="undefined"?self:mt,function(){let n="https://api.binance.com/api/v3/exchangeInfo";async function r(){let i=await(await fetch(n)).json();return(Array.isArray(i.symbols)?i.symbols:[]).filter(function(f){return!f||f.status&&f.status!=="TRADING"?!1:(f.symbol||"").length>0}).map(function(f){let u=(f.symbol||"").toUpperCase();return{value:u,display:u,symbol:u}})}return{id:"BINANCE",getPairs:r}})});var Et=K((wt,ye)=>{"use strict";(function(n,r){let s=typeof globalThis!="undefined"?globalThis:n,i=s&&s.CryptoTickerPIProviders?s.CryptoTickerPIProviders:null,o=r();typeof ye=="object"&&ye.exports&&(ye.exports=o),i&&typeof i.registerProvider=="function"&&i.registerProvider(o)})(typeof self!="undefined"?self:wt,function(){let n="https://api-pub.bitfinex.com/v2/conf/pub:list:pair:exchange";async function r(){let i=await(await fetch(n)).json();return(Array.isArray(i)&&Array.isArray(i[0])?i[0]:[]).map(function(f){let u=(f||"").toUpperCase(),p=u.replace(/[:/]/g,"");return{value:u,display:u,symbol:p}})}return{id:"BITFINEX",getPairs:r}})});var rn=Q(st()),nn=Q(at()),sn=Q(lt()),an=Q(dt()),on=Q(yt()),ln=Q(vt()),un=Q(Et());var Y=null,Ue=null,je={},G=typeof CryptoTickerExpressionEvaluator!="undefined"?CryptoTickerExpressionEvaluator:null,Lr=typeof CryptoTickerConnectionStates!="undefined"?CryptoTickerConnectionStates:{LIVE:"live",DETACHED:"detached",BACKUP:"backup",BROKEN:"broken"},De=typeof CryptoTickerConnectionStatusIcons!="undefined"?CryptoTickerConnectionStatusIcons:null,Ve=function(){if(!G)return{alert:null,color:null};let r=(G.allowedVariables?G.allowedVariables.slice(0):[]).slice(0),s=["alert","backgroundColor","textColor","defaultBackgroundColor","defaultTextColor"];for(let i=0;i<s.length;i++)r.indexOf(s[i])===-1&&r.push(s[i]);return{alert:G.createEvaluator(),color:G.createEvaluator({allowedVariables:r})}}(),At={last:100,high:120,low:80,changeDaily:2,changeDailyPercent:.02,volume:1e5},Ur={alert:!1,backgroundColor:"#000000",textColor:"#ffffff",defaultBackgroundColor:"#000000",defaultTextColor:"#ffffff"};function jr(){return G?G.buildBaseContext(At):{}}function bt(){return G?G.buildContext(At,Object.assign({},Ur)):{}}var me=[{key:"alertRule",evaluator:Ve.alert,contextBuilder:jr},{key:"backgroundColorRule",evaluator:Ve.color,contextBuilder:bt},{key:"textColorRule",evaluator:Ve.color,contextBuilder:bt}],se="https://tproxyv8.opendle.com",xt=typeof se=="string"?se.replace(/\/$/,""):"",kt="_ctBust";function _r(n){if(!n||typeof n!="string")return n;try{let r=new URL(n);return r.searchParams.set(kt,Date.now().toString()),r.toString()}catch{let s=n.indexOf("?")===-1?"?":"&";return n+s+kt+"="+Date.now()}}function Hr(n,r){if(!n||typeof n!="string")return{url:n,options:r};let s=n.replace(/\/$/,"");if(!xt||s.indexOf(xt)!==0)return{url:n,options:r};let i=Object.assign({},r||{});i.cache="no-store";let o=Object.assign({},i.headers||{});return o["cache-control"]="no-cache",o.pragma="no-cache",i.headers=o,{url:_r(n),options:i}}var Wr=!1,S=document.getElementById("select-pair-dropdown"),U=document.getElementById("select-pair-search"),ne=document.getElementById("pair-search-feedback"),Ee=1e4,be=3,xe=600,Gr=5e3;function qr(n){return new Promise(function(r){setTimeout(r,n)})}function Ne(n,r,s){if(typeof n=="function")try{n(r)}catch(i){console.error("fetchJsonWithRetry "+s+" failed",i)}}function Jr(n){if(typeof AbortController=="undefined")return{controller:null,timerId:null};let r=new AbortController,s=setTimeout(function(){r.abort()},n);return{controller:r,timerId:s}}function St(n){n&&clearTimeout(n)}async function Kr(n,r,s){let i=Object.assign({},s||{});r&&(i.signal=r.signal);let o=Hr(n,i),f=await fetch(o.url,o.options);if(!f.ok)throw new Error("Request failed with status "+f.status);let u=await f.text();if(!u||u.trim().length===0)return[];try{return JSON.parse(u)}catch(p){let d=p instanceof Error?p:new Error(String(p));throw d.message="Failed to parse JSON response from "+n+": "+d.message,d}}function Xr(n){if(!n)return"";try{return new Date(n).toLocaleString()}catch{return new Date(n).toString()}}function ve(n){let r=Xr(n);return r?"Showing cached data from "+r+". Data may be outdated.":"Showing cached data. Data may be outdated."}var x=function(){let n={providers:{selectId:"select-provider",loadingMessage:"Loading providers...",retryMessage:"Failed to load providers. Retrying..."},pairs:{selectId:"select-pair-dropdown",extraDisableIds:["select-pair-search"],loadingMessage:"Loading pairs...",retryMessage:"Failed to load pairs. Retrying..."},currencies:{selectId:"select-currency",loadingMessage:"Loading currencies...",retryMessage:"Failed to load currencies. Retrying..."}},r={};function s(u){if(r[u])return r[u];let p=n[u];if(!p)return null;let d=document.getElementById(p.selectId);if(!d||!d.parentNode)return null;let g=[];Array.isArray(p.extraDisableIds)&&p.extraDisableIds.forEach(function(A){let P=document.getElementById(A);P&&g.push(P)});let c=document.createElement("div");c.className="pi-network-status",c.setAttribute("role","status"),c.style.display="none";let w=document.createElement("span");w.className="pi-network-status__spinner",c.appendChild(w);let E=document.createElement("span");E.className="pi-network-status__text",c.appendChild(E);let C=document.createElement("button");C.type="button",C.className="pi-network-status__retry",C.textContent="Retry",C.style.display="none",c.appendChild(C),d.parentNode.appendChild(c);let y=document.createElement("div");return y.className="pi-network-status__warning",y.style.display="none",d.parentNode.appendChild(y),r[u]={select:d,status:c,spinner:w,text:E,retry:C,warning:y,extraDisableElements:g},r[u]}function i(u,p){let d=s(u);if(!d)return;let g=p||{};if(d.status.style.display=g.message?"":"none",d.text.textContent=g.message||"",d.spinner.style.display=g.spinner?"":"none",d.retry.style.display=g.showRetry?"":"none",d.retry.onclick=typeof g.onRetry=="function"?g.onRetry:null,d.status.classList.remove("is-error","is-warning","is-success"),g.tone==="error"?d.status.classList.add("is-error"):g.tone==="warning"?d.status.classList.add("is-warning"):g.tone==="success"&&d.status.classList.add("is-success"),d.select&&(d.select.disabled=!!g.disableSelect),d.extraDisableElements&&d.extraDisableElements.length)for(let c=0;c<d.extraDisableElements.length;c++){let w=d.extraDisableElements[c];w&&(w.disabled=!!g.disableSelect)}}function o(u,p){let d=s(u);if(!d)return;let g=p||"";d.warning.style.display=g?"":"none",d.warning.textContent=g}function f(u){i(u,{}),o(u,"");let p=r[u];p&&p.select&&(p.select.disabled=!1)}return{ensure:s,setState:i,showWarning:o,clear:f,config:n}}();async function ze(n,r){let s=r||{},i=Math.max(1,s.attempts||be),o=s.timeout||Ee,f=null;for(let u=1;u<=i;u++){Ne(s.onAttemptStart,{attempt:u,maxAttempts:i},"onAttemptStart");let p=Jr(o);try{let d=s.fetchOptions||{},g=await Kr(n,p.controller,d);return St(p.timerId),g}catch(d){if(f=d,St(p.timerId),Ne(s.onAttemptError,{attempt:u,maxAttempts:i,error:d},"onAttemptError"),u<i){let g=s.retryBaseDelay||xe,c=Math.min(Gr,g*Math.pow(2,u-1));await qr(c)}}}throw Ne(s.onFinalFailure,{error:f},"onFinalFailure"),f||new Error("Request failed")}function Yr(n){return(n||[]).map(function(r){if(!r)return null;if(typeof r=="string"){let u=r.toUpperCase();return{value:u,symbol:u.replace(/[:/]/g,""),display:u}}let i=((r.value!==void 0?r.value:r.display||r.symbol||"")||"").toUpperCase();if(!i)return null;let o=(r.symbol||i.replace(/[:/]/g,"")).toUpperCase(),f=(r.display||i).toUpperCase();return{value:i,symbol:o,display:f}}).filter(function(r){return r!==null})}var Ct=typeof CryptoTickerDefaults!="undefined"?CryptoTickerDefaults:null;function Tt(){if(!Ct)throw new Error("Default settings module is not available");return Ct}function Ot(n){let r=Tt();return typeof r.applyDefaults=="function"?r.applyDefaults(n):r.defaultSettings?Object.assign({},r.defaultSettings,n||{}):Object.assign({},n||{})}function $r(){let n=Tt();return typeof n.getDefaultSettings=="function"?n.getDefaultSettings():n.defaultSettings?JSON.parse(JSON.stringify(n.defaultSettings)):{}}var O=$r(),R={title:{default:O.title,value:document.getElementById("input-title")},exchange:{default:O.exchange,value:document.getElementById("select-provider")},pair:{default:O.pair,value:document.getElementById("select-pair"),setValue:function(n){this.value.value=n,S.value=n}},fromCurrency:{default:O.fromCurrency},currency:{default:O.currency,value:document.getElementById("select-currency")},candlesInterval:{default:O.candlesInterval,value:document.getElementById("candlesInterval")},candlesDisplayed:{default:O.candlesDisplayed,value:document.getElementById("candlesDisplayed")},multiplier:{default:O.multiplier,value:document.getElementById("multiplier")},digits:{default:O.digits,value:document.getElementById("digits")},highLowDigits:{default:O.highLowDigits,value:document.getElementById("highLowDigits")},priceFormat:{default:O.priceFormat,value:document.getElementById("priceFormat")},thousandsSeparator:{default:O.thousandsSeparator,value:document.getElementById("thousandsSeparator")},decimalSeparator:{default:O.decimalSeparator,value:document.getElementById("decimalSeparator")},font:{default:O.font,value:document.getElementById("font")},fontSizeBase:{default:O.fontSizeBase,value:document.getElementById("fontSizeBase")},fontSizePrice:{default:O.fontSizePrice,value:document.getElementById("fontSizePrice")},fontSizeHighLow:{default:O.fontSizeHighLow,value:document.getElementById("fontSizeHighLow")},fontSizeChange:{default:O.fontSizeChange,value:document.getElementById("fontSizeChange")},backgroundColor:{default:O.backgroundColor,value:document.getElementById("backgroundColor")},textColor:{default:O.textColor,value:document.getElementById("textColor")},displayHighLow:{default:O.displayHighLow,value:document.getElementById("displayHighLow"),getValue:function(){return this.value.checked?"on":"off"},setValue:function(n){this.value.checked=n!=="off"}},displayHighLowBar:{default:O.displayHighLowBar,value:document.getElementById("displayHighLowBar"),getValue:function(){return this.value.checked?"on":"off"},setValue:function(n){this.value.checked=n!=="off"}},displayDailyChange:{default:O.displayDailyChange,value:document.getElementById("displayDailyChange"),getValue:function(){return this.value.checked?"on":"off"},setValue:function(n){this.value.checked=n!=="off"}},displayConnectionStatusIcon:{default:O.displayConnectionStatusIcon,value:document.getElementById("displayConnectionStatusIcon"),getValue:function(){return(this.value.value||O.displayConnectionStatusIcon).toUpperCase()},setValue:function(n){let r=(n||O.displayConnectionStatusIcon).toUpperCase();this.value.value=r}},alertRule:{default:O.alertRule,value:document.getElementById("alertRule"),errorElement:document.getElementById("alertRuleError")},backgroundColorRule:{default:O.backgroundColorRule,value:document.getElementById("backgroundColorRule"),errorElement:document.getElementById("backgroundColorRuleError")},textColorRule:{default:O.textColorRule,value:document.getElementById("textColorRule"),errorElement:document.getElementById("textColorRuleError")},mode:{default:O.mode}},B=Ot({}),_e={};function Be(n){let r=_e[n];return!r||typeof r!="object"||!Object.prototype.hasOwnProperty.call(r,"data")?null:r}function Fe(n,r){return _e[n]={data:r,timestamp:Date.now()},_e[n]}var we=null,Pt=document.getElementsByClassName("currencyRelated");function Le(n){let r=Ot(n||{});for(let s in B)Object.prototype.hasOwnProperty.call(B,s)&&delete B[s];return Object.assign(B,r),B}var Rt={pairDropdownState:{allPairs:[],filteredPairs:[],filterTerm:"",provider:""},log:function(...n){Wr&&console.log(...n)},displayExpressionErrors:function(n){let r=n||{};for(let s=0;s<me.length;s++){let i=me[s],o=R[i.key];if(!o||!o.errorElement)continue;let f=r[i.key]||"";o.errorElement.textContent=f,f?o.errorElement.classList.add("is-visible"):o.errorElement.classList.remove("is-visible")}},validateRuleExpressions:function(n){let r={hasErrors:!1,errors:{}};for(let s=0;s<me.length;s++){let i=me[s],o=(n[i.key]||"").trim();if(!o){r.errors[i.key]="";continue}if(!i.evaluator||typeof i.contextBuilder!="function"){r.errors[i.key]="";continue}let f=i.evaluator.validate(o);if(!f.ok){r.errors[i.key]=f.error,r.hasErrors=!0;continue}try{let u=i.contextBuilder()||{},p=i.evaluator.evaluate(o,u);typeof p=="number"&&!isFinite(p)?(r.errors[i.key]="Expression resulted in an invalid number. Check for division by zero.",r.hasErrors=!0):typeof p=="number"&&isNaN(p)?(r.errors[i.key]="Expression resulted in NaN. Verify the operators and inputs.",r.hasErrors=!0):r.errors[i.key]=""}catch(u){let p=u&&u.message?u.message:"Invalid expression";r.errors[i.key]=p,r.hasErrors=!0}}return r},setPairUIVisibility:function(n){let r=n?"":"none",s=document.getElementById("select-pair-dropdown-group"),i=document.getElementById("pair-search-group");s&&(s.style.display=r),i&&(i.style.display=r)},resetPairDropdown:function(){if(this.pairDropdownState.allPairs=[],this.pairDropdownState.filteredPairs=[],this.pairDropdownState.filterTerm="",this.pairDropdownState.provider="",S){this.removeAllOptions(S);let n=document.createElement("option");n.text="",n.value="",S.add(n),S.disabled=!0}U&&(U.value="",U.disabled=!0),this.updatePairSearchFeedback(0,""),this.setPairUIVisibility(!1)},findMatchingPairValue:function(n,r){if(!r)return null;let s=r.toUpperCase(),o=(Array.isArray(n)?n:[]).find(function(f){if(!f)return!1;let u=(f.value||"").toUpperCase(),p=(f.symbol||"").toUpperCase(),d=(f.display||"").toUpperCase();return u===s||p===s||d===s});return o?o.value||o.symbol||"":null},renderPairDropdownOptions:function(n,r){if(!S)return;let s=r||{},i=Array.isArray(n)?n:[],o=typeof s.previousValue=="string"?s.previousValue:S.value||"",f=typeof s.preferredValue=="string"?s.preferredValue:"",u=typeof s.fallbackValue=="string"?s.fallbackValue:"",p=R&&R.pair?R.pair:null,d=p&&p.value?p.value.value:"";this.removeAllOptions(S);let g=document.createElement("option");g.text="",g.value="",S.add(g);for(let A=0;A<i.length;A++){let P=i[A],j=document.createElement("option");j.value=P.value,j.text=P.display||P.value,S.add(j)}let c=this.findMatchingPairValue(i,f),w=this.findMatchingPairValue(i,o),E=this.findMatchingPairValue(i,d),C=this.findMatchingPairValue(i,u),y=c||w||E||C||"";y?S.value=y:S.value=""},updatePairSearchFeedback:function(n,r){if(!ne)return;!!(r&&r.trim())&&n===0?(ne.textContent='No matches for "'+r.trim()+'"',ne.style.display=""):(ne.textContent="",ne.style.display="none")},applyPairFilter:function(n,r){let s=(n||"").trim(),i=s.toUpperCase(),o=this.pairDropdownState;o.filterTerm=s;let f=Array.isArray(o.allPairs)?o.allPairs:[],u=f;i&&(u=f.filter(function(w){let E=(w.value||"").toUpperCase(),C=(w.symbol||"").toUpperCase(),y=(w.display||"").toUpperCase();return E.indexOf(i)!==-1||C.indexOf(i)!==-1||y.indexOf(i)!==-1})),o.filteredPairs=u;let p=r||{},d=typeof p.previousValue=="string"?p.previousValue:S?S.value:"",g=typeof p.preferredValue=="string"?p.preferredValue:"",c=typeof p.fallbackValue=="string"?p.fallbackValue:u[0]?u[0].value:"";this.renderPairDropdownOptions(u,{previousValue:d,preferredValue:g,fallbackValue:c}),this.updatePairSearchFeedback(u.length,s)},setPairDropdownData:function(n,r,s){let i=Array.isArray(r)?r.slice(0):[];this.pairDropdownState.allPairs=i,this.pairDropdownState.provider=(n||"").toUpperCase();let o=s||{},f=o.resetFilter!==!1;U&&(f&&(U.value=""),U.disabled=i.length===0);let u=f?"":this.pairDropdownState.filterTerm;this.applyPairFilter(u,{previousValue:o.previousValue,preferredValue:o.preferredValue,fallbackValue:o.savedValue})},handlePairSearchInput:function(n){this.applyPairFilter(n,{previousValue:S?S.value:""})},handlePairSearchKeydown:function(n){if(n){if(n.key==="ArrowDown"||n.key==="Down")n.preventDefault(),this.focusPairDropdown(),this.movePairSelection(1);else if(n.key==="ArrowUp"||n.key==="Up")n.preventDefault(),this.focusPairDropdown(),this.movePairSelection(-1);else if(n.key==="Enter")n.preventDefault(),this.selectPairFromSearch();else if(n.key==="Escape"&&U&&U.value){n.preventDefault(),U.value="";let r=R&&R.pair?R.pair:null,s=r&&r.value?r.value.value:"";this.applyPairFilter("",{previousValue:s})}}},focusPairDropdown:function(){S&&(S.focus(),S.options.length>1&&S.selectedIndex<1&&(S.selectedIndex=1))},movePairSelection:function(n){if(!S)return;let r=S.options.length;if(r<=1)return;let s=S.selectedIndex;s<1?s=n>0?1:r-1:(s=s+n,s<1?s=r-1:s>=r&&(s=1)),S.selectedIndex=s},selectPairFromSearch:function(){if(!S)return;let n=S.value;!n&&this.pairDropdownState.filteredPairs.length>0&&(n=this.pairDropdownState.filteredPairs[0].value),n&&this.applyPairSelection(n)},applyPairSelection:function(n){S&&(S.value=n||"",typeof S.onchange=="function"&&S.onchange())},syncPairSelectionDisplay:function(){if(!S)return;let n=R&&R.pair?R.pair:null,r=n&&n.value?n.value.value:"";if(!r){S.value="";return}let s=this.pairDropdownState.filteredPairs.length>0?this.pairDropdownState.filteredPairs:this.pairDropdownState.allPairs,i=this.findMatchingPairValue(s,r)||r;S.value=i},setupNetworkStatusElements:function(){if(this.networkStatusInitialized)return;x.ensure("providers"),x.ensure("pairs"),x.ensure("currencies");let n=this;this.retryCallbacks={providers:async function(){await n.populateProvidersDropdown(!0);let r=R.exchange.value,s=r?r.value:"";s&&await n.populatePairsDropdown(s,{forceRefresh:!0})},pairs:async function(){let r=R.exchange.value,s=r?r.value:"";s&&await n.populatePairsDropdown(s,{forceRefresh:!0})},currencies:async function(){await n.populateCurrenciesDropdown(!0)}},this.networkStatusInitialized=!0},populateProvidersDropdown:async function(n){let r=R.exchange.value;if(!r)return[];let s=r.value,i=await this.getProviders({forceRefresh:!!n}),o=Array.isArray(i)?i.slice(0):[];this.removeAllOptions(r),o.sort(),o.forEach(function(p){let d=document.createElement("option");d.text=p,d.value=p,r.add(d)});let f=B.exchange||R.exchange.default||"",u=s||f;return u&&o.indexOf(u)!==-1?r.value=u:f&&o.indexOf(f)!==-1?r.value=f:o.length>0?r.value=o[0]:r.value="",r.disabled=o.length===0,o},populatePairsDropdown:async function(n,r){let s=r||{},i=R.exchange.value,o=n||(i?i.value:"");if(!o)return this.resetPairDropdown(),[];let f=o.toUpperCase(),u=await this.getPairs(o,{forceRefresh:!!s.forceRefresh}),p=i?(i.value||"").toUpperCase():"";if(p&&p!==f)return u;let d=Array.isArray(u)?u.slice(0):[];d.sort(function(C,y){let A=C.display||C.symbol,P=y.display||y.symbol;return A>P?1:A<P?-1:0});let g=(B.pair||"").toUpperCase(),c=S?S.value:"",w=(c||g||"").toUpperCase();this.setPairDropdownData(o,d,{previousValue:c,preferredValue:w,savedValue:g,resetFilter:!s.preserveFilter});let E=d.length>0;return this.setPairUIVisibility(E),S&&(S.disabled=!E),U&&(U.disabled=!E),E||this.updatePairSearchFeedback(0,U?U.value:""),d},populateCurrenciesDropdown:async function(n){let r=R.currency.value;if(!r)return[];let s=r.value,i=await this.getCurrencies({forceRefresh:!!n}),o=Array.isArray(i)?i.slice(0):[];this.removeAllOptions(r);let f=document.createElement("option");f.text="",f.value="",r.add(f),o.sort(),o.forEach(function(d){let g=document.createElement("option");g.text=d,g.value=d,r.add(g)});let u=B.currency||R.currency.default||"",p=s||u;return p&&o.indexOf(p)!==-1?r.value=p:u&&o.indexOf(u)!==-1?r.value=u:r.value="",r.disabled=o.length===0,o},handleExchangeChange:async function(n){let r=n||{},s=R.exchange.value,i=s?s.value:"";if(!i){this.resetPairDropdown(),we=i;return}await this.populatePairsDropdown(i,{forceRefresh:!!r.forceRefresh}),we=i},initDom:function(){this.setupNetworkStatusElements(),this.initPairsDropDown(),this.initCurrenciesDropDown(),this.renderConnectionStateHelp();let n=this,r=function(){n.checkNewSettings(),n.refreshMenus()};for(let s in R){let i=R[s];i.value&&(i.value.onchange=r,i.value.onkeyup=r)}},renderConnectionStateHelp:function(){if(!De||typeof De.renderConnectionStatusIcon!="function")return;let n=document.querySelectorAll("canvas.connection-state-icon");if(!n||n.length===0)return;let s=Lr||{LIVE:"live",DETACHED:"detached",BACKUP:"backup",BROKEN:"broken"};for(let i=0;i<n.length;i++){let o=n[i];if(!o)continue;let f=(o.getAttribute("data-connection-state")||"").toUpperCase(),u=s&&s[f]?s[f]:f.toLowerCase(),p=o.getContext("2d");if(!p||!u)continue;p.clearRect(0,0,o.width,o.height);let d=Math.min(o.width||0,o.height||0),g=Math.max(d>0?d/32:1,.6);De.renderConnectionStatusIcon({canvas:o,canvasContext:p,state:u,color:"#ffffff",sizeMultiplier:g,position:"TOP_RIGHT",connectionStates:s})}},initPairsDropDown:async function(){let n=R.exchange.value;if(!n)return;if(this.setupNetworkStatusElements(),!this.exchangeDropdownInitialized){let i=this,o=typeof n.onchange=="function"?n.onchange:function(){};n.onchange=function(){typeof o=="function"&&o.call(this),i.handleExchangeChange(),i.checkNewSettings()},S.onchange=function(){let f=R.pair.value;f.value=S.value,typeof f.onchange=="function"&&f.onchange()},U&&(U.addEventListener("input",function(f){i.handlePairSearchInput(f.target.value)}),U.addEventListener("keydown",function(f){i.handlePairSearchKeydown(f)})),this.exchangeDropdownInitialized=!0}await this.populateProvidersDropdown();let r=B.exchange||R.exchange.default||"";r&&Array.from(n.options).some(function(o){return(o.value||"").toUpperCase()===r.toUpperCase()})&&(n.value=r);let s=n.value||r;we=s,await this.populatePairsDropdown(s,{initial:!0}),this.refreshValues()},getProviders:async function(n){this.setupNetworkStatusElements();let r=n||{},s="getProviders",i=Be(s),o=i?i.data:null,u=!!r.forceRefresh||!i,p=this.retryCallbacks&&typeof this.retryCallbacks.providers=="function"?this.retryCallbacks.providers:null;if(u){x.setState("providers",{message:x.config.providers.loadingMessage,spinner:!0,disableSelect:!0});try{let g=await ze(se+"/api/Ticker/json/providers",{attempts:be,timeout:Ee,retryBaseDelay:xe,onAttemptStart:function(c){c.attempt===1?x.setState("providers",{message:x.config.providers.loadingMessage,spinner:!0,disableSelect:!0}):x.setState("providers",{message:x.config.providers.retryMessage,spinner:!0,disableSelect:!0,tone:"warning"})},onAttemptError:function(c){console.error("Provider fetch attempt "+c.attempt+" failed",c.error)}});o=Array.isArray(g)?g.slice(0):[],Fe(s,o),x.clear("providers")}catch(g){return console.error("Failed to load providers",g),this.log("getProviders error",g),i&&Array.isArray(i.data)&&i.data.length>0?(x.setState("providers",{message:"Using cached providers. Connection issue detected.",spinner:!1,disableSelect:!1,tone:"warning",showRetry:!!p,onRetry:p}),x.showWarning("providers",ve(i.timestamp)),i.data):(x.setState("providers",{message:"Network error. Please check connection and try again.",spinner:!1,disableSelect:!0,tone:"error",showRetry:!!p,onRetry:p}),x.showWarning("providers",""),[])}}else i&&(o=i.data,x.clear("providers"));let d=Array.isArray(o)?o:[];return this.log("getProviders",d),x.showWarning("providers",""),d},getPairs:async function(n,r){this.setupNetworkStatusElements();let s=r||{};if(!n)return[];let i="getPairs_"+n,o=Be(i),f=!!s.forceRefresh,u=this.retryCallbacks&&typeof this.retryCallbacks.pairs=="function"?this.retryCallbacks.pairs:null,p=o?o.data:null,d=f||!o;if(d){x.setState("pairs",{message:x.config.pairs.loadingMessage,spinner:!0,disableSelect:!0});let c=this.resolveProviderModule(n);if(c&&typeof c.getPairs=="function")try{p=await c.getPairs()}catch(w){console.error("Error fetching direct pairs for provider "+n,w),this.log("Error fetching direct pairs",w),p=null}if(!Array.isArray(p)||p.length===0){let w=se+"/api/Ticker/json/symbols?provider="+encodeURIComponent(n);try{p=await ze(w,{attempts:be,timeout:Ee,retryBaseDelay:xe,onAttemptStart:function(C){C.attempt===1?x.setState("pairs",{message:x.config.pairs.loadingMessage,spinner:!0,disableSelect:!0}):x.setState("pairs",{message:x.config.pairs.retryMessage,spinner:!0,disableSelect:!0,tone:"warning"})},onAttemptError:function(C){console.error("Pairs fetch attempt "+C.attempt+" failed",C.error)}})}catch(E){return console.error("Error fetching pairs from proxy for provider "+n,E),this.log("Error fetching pairs from proxy",E),o&&Array.isArray(o.data)&&o.data.length>0?(x.setState("pairs",{message:"Using cached pairs. Connection issue detected.",spinner:!1,disableSelect:!1,tone:"warning",showRetry:!!u,onRetry:u}),x.showWarning("pairs",ve(o.timestamp)),o.data):(x.setState("pairs",{message:"Network error. Please check connection and try again.",spinner:!1,disableSelect:!0,tone:"error",showRetry:!!u,onRetry:u}),x.showWarning("pairs",""),[])}}}else if(o)return x.clear("pairs"),x.showWarning("pairs",""),o.data;let g=Yr(p);if(g.length>0)Fe(i,g);else if(o&&Array.isArray(o.data)&&o.data.length>0&&d)return x.setState("pairs",{message:"Using cached pairs. Connection issue detected.",spinner:!1,disableSelect:!1,tone:"warning",showRetry:!!u,onRetry:u}),x.showWarning("pairs",ve(o.timestamp)),o.data;return this.log("getPairs",g),x.clear("pairs"),x.showWarning("pairs",""),g},resolveProviderModule:function(n){return typeof n!="string"?null:typeof CryptoTickerPIProviders!="undefined"&&CryptoTickerPIProviders.getProvider?CryptoTickerPIProviders.getProvider(n):null},initCurrenciesDropDown:async function(){this.setupNetworkStatusElements(),await this.populateCurrenciesDropdown(),this.refreshValues()},getCurrencies:async function(n){this.setupNetworkStatusElements();let r=n||{},s="getCurrencies",i=Be(s),o=i?i.data:null,u=!!r.forceRefresh||!i,p=this.retryCallbacks&&typeof this.retryCallbacks.currencies=="function"?this.retryCallbacks.currencies:null;if(u){x.setState("currencies",{message:x.config.currencies.loadingMessage,spinner:!0,disableSelect:!0});try{let g=await ze(se+"/api/Ticker/json/currencies",{attempts:be,timeout:Ee,retryBaseDelay:xe,onAttemptStart:function(c){c.attempt===1?x.setState("currencies",{message:x.config.currencies.loadingMessage,spinner:!0,disableSelect:!0}):x.setState("currencies",{message:x.config.currencies.retryMessage,spinner:!0,disableSelect:!0,tone:"warning"})},onAttemptError:function(c){console.error("Currencies fetch attempt "+c.attempt+" failed",c.error)}});o=Array.isArray(g)?g.slice(0):[],Fe(s,o),x.clear("currencies")}catch(g){return console.error("Failed to load currencies",g),this.log("getCurrencies error",g),i&&Array.isArray(i.data)&&i.data.length>0?(x.setState("currencies",{message:"Using cached currencies. Connection issue detected.",spinner:!1,disableSelect:!1,tone:"warning",showRetry:!!p,onRetry:p}),x.showWarning("currencies",ve(i.timestamp)),i.data):(x.setState("currencies",{message:"Network error. Please check connection and try again.",spinner:!1,disableSelect:!0,tone:"error",showRetry:!!p,onRetry:p}),x.showWarning("currencies",""),[])}}else if(i)return x.clear("currencies"),x.showWarning("currencies",""),i.data;let d=Array.isArray(o)?o:[];return this.log("getCurrencies",d),x.showWarning("currencies",""),d},removeAllOptions:function(n){var r,s=n.options.length-1;for(r=s;r>=0;r--)n.remove(r)},extractSettings:function(n){this.log("extractSettings",n);let r=n?Object.assign({},n):{},s=this.splitPairValue(r.pair);if(s)for(let i in s)Object.prototype.hasOwnProperty.call(s,i)&&(r[i]=s[i]);Le(r),this.refreshValues(),this.displayExpressionErrors({})},checkNewSettings:function(){this.log("checkNewSettings");for(let s in R){let i=R[s];i.getValue?B[s]=i.getValue()||i.default:i.value&&(B[s]=i.value.value||i.default)}let n=Le(B),r=this.validateRuleExpressions(n);if(this.displayExpressionErrors(r.errors),r.hasErrors){this.log("Expression validation failed",r.errors);return}this.saveSettings()},refreshValues:function(){if(this.log("refreshValues"),we!==B.exchange){this.initPairsDropDown();return}for(let n in R){let r=R[n];r.setValue?r.setValue(B[n]):r.value&&(r.value.value=B[n])}this.syncPairSelectionDisplay(),this.refreshMenus()},refreshMenus:function(){B&&B.pair&&B.pair.indexOf("USD")>=0?this.applyDisplay(Pt,"block"):(this.applyDisplay(Pt,"none"),R.currency.value.value="USD")},applyDisplay:function(n,r){if(n)for(let s=0;s<n.length;s++)n[s].style.display=r},splitPairValue:function(n){if(n&&n.indexOf("|")>=0){let r=n.split("|");return{pair:r[1],exchange:r[0].toUpperCase()}}return null},saveSettings:function(){if(this.log("saveSettings",B),Le(B),Y&&Y.readyState===1){let n={event:"setSettings",context:Ue,payload:B};Y.send(JSON.stringify(n));let r={action:je.action,event:"sendToPlugin",context:Ue,payload:B};Y.send(JSON.stringify(r))}}};Rt.initDom();function Qr(n,r,s,i,o){Ue=r,je=JSON.parse(o);let f=JSON.parse(i);Y=new WebSocket("ws://127.0.0.1:"+n),Rt.extractSettings(je.payload.settings),Y.onopen=function(){let u={event:s,uuid:r,info:f};Y.send(JSON.stringify(u))},Y.onmessage=function(u){JSON.parse(u.data)}}typeof window!="undefined"&&(window.connectElgatoStreamDeckSocket=Qr);})();
