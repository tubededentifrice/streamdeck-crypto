"use strict";(()=>{var Or=Object.create;var et=Object.defineProperty;var Rr=Object.getOwnPropertyDescriptor;var Mr=Object.getOwnPropertyNames;var Ir=Object.getPrototypeOf,Dr=Object.prototype.hasOwnProperty;var tt=(n=>typeof require!="undefined"?require:typeof Proxy!="undefined"?new Proxy(n,{get:(r,s)=>(typeof require!="undefined"?require:r)[s]}):n)(function(n){if(typeof require!="undefined")return require.apply(this,arguments);throw Error('Dynamic require of "'+n+'" is not supported')});var K=(n,r)=>()=>(r||n((r={exports:{}}).exports,r),r.exports);var Vr=(n,r,s,i)=>{if(r&&typeof r=="object"||typeof r=="function")for(let a of Mr(r))!Dr.call(n,a)&&a!==s&&et(n,a,{get:()=>r[a],enumerable:!(i=Rr(r,a))||i.enumerable});return n};var $=(n,r,s)=>(s=n!=null?Or(Ir(n)):{},Vr(r||!n||!n.__esModule?et(s,"default",{value:n,enumerable:!0}):s,n));var nt=K((rt,ae)=>{"use strict";(function(n,r){if(typeof ae=="object"&&ae.exports)ae.exports=r();else{let s=r();n.CryptoTickerConfig=Object.assign({},n.CryptoTickerConfig||{},s)}})(typeof self!="undefined"?self:rt,function(){return{tProxyBase:"https://tproxyv8.opendle.com",fallbackPollIntervalMs:6e4,staleTickerTimeoutMs:5*60*1e3,binanceRestBaseUrl:"https://api.binance.com",binanceWsBaseUrl:"wss://stream.binance.com:9443/ws",binanceSymbolOverrides:{},bitfinexRestBaseUrl:"https://api-pub.bitfinex.com",bitfinexWsBaseUrl:"wss://api-pub.bitfinex.com/ws/2",bitfinexSymbolOverrides:{},messages:{loading:"LOADING...",stale:"STALE",noData:"NO DATA",misconfigured:"INVALID PAIR",conversionError:"CONVERT ERROR"}}})});var it=K((st,le)=>{"use strict";var Nr={LIVE:"live",DETACHED:"detached",BACKUP:"backup",BROKEN:"broken"};(function(n,r){let s=typeof globalThis!="undefined"?globalThis:n,i=r();typeof le=="object"&&le.exports&&(le.exports=i),s&&(s.CryptoTickerConnectionStates=i)})(typeof self!="undefined"?self:st,function(){return Nr})});var at=K((ot,ue)=>{"use strict";(function(r,s){let i=s();typeof ue=="object"&&ue.exports&&(ue.exports=i),r&&typeof r=="object"&&(r.CryptoTickerDefaults=i)})(typeof self!="undefined"?self:ot,function(){function r(u){if(u===null||typeof u!="object")return u;if(Array.isArray(u))return u.map(b=>r(b));let g={};for(let b in u)Object.prototype.hasOwnProperty.call(u,b)&&(g[b]=r(u[b]));return g}function s(u){let g=u==null?void 0:u.case,b=(u==null?void 0:u.allowEmptyString)===!0,P=(u==null?void 0:u.allowNull)===!0,k=Object.prototype.hasOwnProperty.call(u||{},"trim")?!!(u!=null&&u.trim):!0,m=Array.isArray(u==null?void 0:u.allowedValues)?u==null?void 0:u.allowedValues:null;return function(R){if(R===void 0)return null;if(R===null)return P?null:"";let V=String(R);if(k&&(V=V.trim()),!V&&!b)return null;if(g==="upper"?V=V.toUpperCase():g==="lower"&&(V=V.toLowerCase()),m&&m.length>0){let q=g==="lower"?V.toLowerCase():g==="upper"?V.toUpperCase():V;return m.some(_=>g==="lower"?_.toLowerCase()===q:g==="upper"?_.toUpperCase()===q:_===q)?g==="lower"||g==="upper"?q:V:null}return V}}function i(u){let g=typeof(u==null?void 0:u.min)=="number"?u.min:null,b=typeof(u==null?void 0:u.max)=="number"?u.max:null,P=(u==null?void 0:u.integer)===!0;return function(m){if(m==null||m==="")return null;let A=typeof m=="number"?m:parseFloat(String(m));return Number.isNaN(A)?null:(P&&(A=Math.round(A)),g!==null&&A<g&&(A=g),b!==null&&A>b&&(A=b),A)}}let a={title:{type:"string",default:"",normalize:s({allowEmptyString:!0,allowNull:!0,trim:!0})},exchange:{type:"string",default:"BINANCE",normalize:s({trim:!0,allowEmptyString:!1,case:"upper"})},pair:{type:"string",default:"BTCUSD",normalize:s({trim:!0,allowEmptyString:!1,case:"upper"})},fromCurrency:{type:"string",default:"USD",normalize:s({trim:!0,allowEmptyString:!1,case:"upper"})},currency:{type:"string",default:"",normalize:s({trim:!0,allowEmptyString:!0,case:"upper",allowNull:!0})},candlesInterval:{type:"string",default:"1h",normalize:s({trim:!0,allowEmptyString:!1})},candlesDisplayed:{type:"number",default:20,normalize:i({min:5,max:60,integer:!0})},multiplier:{type:"number",default:1,normalize:i({min:0})},digits:{type:"number",default:2,normalize:i({min:0,max:10,integer:!0})},highLowDigits:{type:"string",default:"",normalize:s({trim:!0,allowEmptyString:!0})},font:{type:"string",default:"Lato,'Roboto Condensed',Helvetica,Calibri,sans-serif",normalize:s({trim:!0,allowEmptyString:!1})},fontSizeBase:{type:"number",default:25,normalize:i({min:1,max:200,integer:!0})},fontSizePrice:{type:"number",default:35,normalize:i({min:1,max:200,integer:!0})},fontSizeHighLow:{type:"string",default:"",normalize:s({trim:!0,allowEmptyString:!0})},fontSizeChange:{type:"number",default:19,normalize:i({min:1,max:200,integer:!0})},priceFormat:{type:"string",default:"compact",normalize:s({trim:!0,allowEmptyString:!1,case:"lower"})},backgroundColor:{type:"string",default:"#000000",normalize:s({trim:!0,allowEmptyString:!1})},textColor:{type:"string",default:"#ffffff",normalize:s({trim:!0,allowEmptyString:!1})},displayHighLow:{type:"string",default:"on",normalize:s({trim:!0,allowEmptyString:!1,case:"lower",allowedValues:["on","off"]})},displayHighLowBar:{type:"string",default:"on",normalize:s({trim:!0,allowEmptyString:!1,case:"lower",allowedValues:["on","off"]})},displayDailyChange:{type:"string",default:"on",normalize:s({trim:!0,allowEmptyString:!1,case:"lower",allowedValues:["on","off"]})},displayConnectionStatusIcon:{type:"string",default:"OFF",normalize:s({trim:!0,allowEmptyString:!1,case:"upper",allowedValues:["OFF","TOP_RIGHT","BOTTOM_LEFT"]})},alertRule:{type:"string",default:"",normalize:s({trim:!0,allowEmptyString:!0})},backgroundColorRule:{type:"string",default:"",normalize:s({trim:!0,allowEmptyString:!0})},textColorRule:{type:"string",default:"",normalize:s({trim:!0,allowEmptyString:!0})},mode:{type:"string",default:"ticker",normalize:s({trim:!0,allowEmptyString:!1,case:"lower",allowedValues:["ticker","candles"]})}};function h(u,g,b){if(!u||typeof u!="object")return{value:g,error:null};let P=u.normalize,k=u.default;if(typeof P!="function")return{value:g===void 0?r(k):g,error:null};let m=P(g);if(m==null){let A=P(k);return{value:A==null?r(k):A,error:b?"Invalid "+u.type:null}}return{value:m,error:null}}function c(u){let g=u&&typeof u=="object"?u:{},b={},P=[];for(let k in a){if(!Object.prototype.hasOwnProperty.call(a,k))continue;let m=a[k],A=Object.prototype.hasOwnProperty.call(g,k),R=A?g[k]:void 0,V=h(m,R,A);b[k]=V.value,V.error&&P.push({key:k,message:V.error})}for(let k in g)!Object.prototype.hasOwnProperty.call(a,k)&&Object.prototype.hasOwnProperty.call(g,k)&&(b[k]=g[k]);return{settings:b,errors:P}}function p(u){return c(u).settings}let d=p(null);return{settingsSchema:a,defaultSettings:d,getDefaultSettings:function(){return r(d)},validateSettings:function(u){let g=c(u);return{settings:g.settings,errors:g.errors.slice(0)}},applyDefaults:p}})});var ut=K((ce,lt)=>{(function(n,r){typeof ce=="object"&&typeof lt!="undefined"?r(ce):typeof define=="function"&&define.amd?define(["exports"],r):(n=n||self,r(n.exprEval={}))})(ce,function(n){"use strict";var r="INUMBER",s="IOP1",i="IOP2",a="IOP3",h="IVAR",c="IVARNAME",p="IFUNCALL",d="IFUNDEF",u="IEXPR",g="IEXPREVAL",b="IMEMBER",P="IENDSTATEMENT",k="IARRAY";function m(e,t){this.type=e,this.value=t!=null?t:0}m.prototype.toString=function(){switch(this.type){case r:case s:case i:case a:case h:case c:case P:return this.value;case p:return"CALL "+this.value;case d:return"DEF "+this.value;case k:return"ARRAY "+this.value;case b:return"."+this.value;default:return"Invalid Instruction"}};function A(e){return new m(s,e)}function R(e){return new m(i,e)}function V(e){return new m(a,e)}function q(e,t,o,l,f){for(var v=[],y=[],x,C,N,D,L=0;L<e.length;L++){var w=e[L],B=w.type;if(B===r||B===c)Array.isArray(w.value)?v.push.apply(v,q(w.value.map(function(ie){return new m(r,ie)}).concat(new m(k,w.value.length)),t,o,l,f)):v.push(w);else if(B===h&&f.hasOwnProperty(w.value))w=new m(r,f[w.value]),v.push(w);else if(B===i&&v.length>1)C=v.pop(),x=v.pop(),D=o[w.value],w=new m(r,D(x.value,C.value)),v.push(w);else if(B===a&&v.length>2)N=v.pop(),C=v.pop(),x=v.pop(),w.value==="?"?v.push(x.value?C.value:N.value):(D=l[w.value],w=new m(r,D(x.value,C.value,N.value)),v.push(w));else if(B===s&&v.length>0)x=v.pop(),D=t[w.value],w=new m(r,D(x.value)),v.push(w);else if(B===u){for(;v.length>0;)y.push(v.shift());y.push(new m(u,q(w.value,t,o,l,f)))}else if(B===b&&v.length>0)x=v.pop(),v.push(new m(r,x.value[w.value]));else{for(;v.length>0;)y.push(v.shift());y.push(w)}}for(;v.length>0;)y.push(v.shift());return y}function be(e,t,o){for(var l=[],f=0;f<e.length;f++){var v=e[f],y=v.type;if(y===h&&v.value===t)for(var x=0;x<o.tokens.length;x++){var C=o.tokens[x],N;C.type===s?N=A(C.value):C.type===i?N=R(C.value):C.type===a?N=V(C.value):N=new m(C.type,C.value),l.push(N)}else y===u?l.push(new m(u,be(v.value,t,o))):l.push(v)}return l}function _(e,t,o){var l=[],f,v,y,x,C,N;if(xe(e))return H(e,o);for(var D=e.length,L=0;L<D;L++){var w=e[L],B=w.type;if(B===r||B===c)l.push(w.value);else if(B===i)v=l.pop(),f=l.pop(),w.value==="and"?l.push(f?!!_(v,t,o):!1):w.value==="or"?l.push(f?!0:!!_(v,t,o)):w.value==="="?(x=t.binaryOps[w.value],l.push(x(f,_(v,t,o),o))):(x=t.binaryOps[w.value],l.push(x(H(f,o),H(v,o))));else if(B===a)y=l.pop(),v=l.pop(),f=l.pop(),w.value==="?"?l.push(_(f?v:y,t,o)):(x=t.ternaryOps[w.value],l.push(x(H(f,o),H(v,o),H(y,o))));else if(B===h)if(w.value in t.functions)l.push(t.functions[w.value]);else if(w.value in t.unaryOps&&t.parser.isOperatorEnabled(w.value))l.push(t.unaryOps[w.value]);else{var ie=o[w.value];if(ie!==void 0)l.push(ie);else throw new Error("undefined variable: "+w.value)}else if(B===s)f=l.pop(),x=t.unaryOps[w.value],l.push(x(H(f,o)));else if(B===p){for(N=w.value,C=[];N-- >0;)C.unshift(H(l.pop(),o));if(x=l.pop(),x.apply&&x.call)l.push(x.apply(void 0,C));else throw new Error(x+" is not a function")}else if(B===d)l.push(function(){for(var Pr=l.pop(),Oe=[],Ar=w.value;Ar-- >0;)Oe.unshift(l.pop());var Qe=l.pop(),Re=function(){for(var Ze=Object.assign({},o),oe=0,Tr=Oe.length;oe<Tr;oe++)Ze[Oe[oe]]=arguments[oe];return _(Pr,t,Ze)};return Object.defineProperty(Re,"name",{value:Qe,writable:!1}),o[Qe]=Re,Re}());else if(B===u)l.push(Rt(w,t));else if(B===g)l.push(w);else if(B===b)f=l.pop(),l.push(f[w.value]);else if(B===P)l.pop();else if(B===k){for(N=w.value,C=[];N-- >0;)C.unshift(l.pop());l.push(C)}else throw new Error("invalid Expression")}if(l.length>1)throw new Error("invalid Expression (parity)");return l[0]===0?0:H(l[0],o)}function Rt(e,t,o){return xe(e)?e:{type:g,value:function(l){return _(e.value,t,l)}}}function xe(e){return e&&e.type===g}function H(e,t){return xe(e)?e.value(t):e}function ke(e,t){for(var o=[],l,f,v,y,x,C,N=0;N<e.length;N++){var D=e[N],L=D.type;if(L===r)typeof D.value=="number"&&D.value<0?o.push("("+D.value+")"):Array.isArray(D.value)?o.push("["+D.value.map(_e).join(", ")+"]"):o.push(_e(D.value));else if(L===i)f=o.pop(),l=o.pop(),y=D.value,t?y==="^"?o.push("Math.pow("+l+", "+f+")"):y==="and"?o.push("(!!"+l+" && !!"+f+")"):y==="or"?o.push("(!!"+l+" || !!"+f+")"):y==="||"?o.push("(function(a,b){ return Array.isArray(a) && Array.isArray(b) ? a.concat(b) : String(a) + String(b); }(("+l+"),("+f+")))"):y==="=="?o.push("("+l+" === "+f+")"):y==="!="?o.push("("+l+" !== "+f+")"):y==="["?o.push(l+"[("+f+") | 0]"):o.push("("+l+" "+y+" "+f+")"):y==="["?o.push(l+"["+f+"]"):o.push("("+l+" "+y+" "+f+")");else if(L===a)if(v=o.pop(),f=o.pop(),l=o.pop(),y=D.value,y==="?")o.push("("+l+" ? "+f+" : "+v+")");else throw new Error("invalid Expression");else if(L===h||L===c)o.push(D.value);else if(L===s)l=o.pop(),y=D.value,y==="-"||y==="+"?o.push("("+y+l+")"):t?y==="not"?o.push("(!"+l+")"):y==="!"?o.push("fac("+l+")"):o.push(y+"("+l+")"):y==="!"?o.push("("+l+"!)"):o.push("("+y+" "+l+")");else if(L===p){for(C=D.value,x=[];C-- >0;)x.unshift(o.pop());y=o.pop(),o.push(y+"("+x.join(", ")+")")}else if(L===d){for(f=o.pop(),C=D.value,x=[];C-- >0;)x.unshift(o.pop());l=o.pop(),t?o.push("("+l+" = function("+x.join(", ")+") { return "+f+" })"):o.push("("+l+"("+x.join(", ")+") = "+f+")")}else if(L===b)l=o.pop(),o.push(l+"."+D.value);else if(L===k){for(C=D.value,x=[];C-- >0;)x.unshift(o.pop());o.push("["+x.join(", ")+"]")}else if(L===u)o.push("("+ke(D.value,t)+")");else if(L!==P)throw new Error("invalid Expression")}return o.length>1&&(t?o=[o.join(",")]:o=[o.join(";")]),String(o[0])}function _e(e){return typeof e=="string"?JSON.stringify(e).replace(/\u2028/g,"\\u2028").replace(/\u2029/g,"\\u2029"):e}function Q(e,t){for(var o=0;o<e.length;o++)if(e[o]===t)return!0;return!1}function Se(e,t,o){o=o||{};for(var l=!!o.withMembers,f=null,v=0;v<e.length;v++){var y=e[v];y.type===h||y.type===c?!l&&!Q(t,y.value)?t.push(y.value):(f!==null&&(Q(t,f)||t.push(f)),f=y.value):y.type===b&&l&&f!==null?f+="."+y.value:y.type===u?Se(y.value,t,o):f!==null&&(Q(t,f)||t.push(f),f=null)}f!==null&&!Q(t,f)&&t.push(f)}function j(e,t){this.tokens=e,this.parser=t,this.unaryOps=t.unaryOps,this.binaryOps=t.binaryOps,this.ternaryOps=t.ternaryOps,this.functions=t.functions}j.prototype.simplify=function(e){return e=e||{},new j(q(this.tokens,this.unaryOps,this.binaryOps,this.ternaryOps,e),this.parser)},j.prototype.substitute=function(e,t){return t instanceof j||(t=this.parser.parse(String(t))),new j(be(this.tokens,e,t),this.parser)},j.prototype.evaluate=function(e){return e=e||{},_(this.tokens,this,e)},j.prototype.toString=function(){return ke(this.tokens,!1)},j.prototype.symbols=function(e){e=e||{};var t=[];return Se(this.tokens,t,e),t},j.prototype.variables=function(e){e=e||{};var t=[];Se(this.tokens,t,e);var o=this.functions;return t.filter(function(l){return!(l in o)})},j.prototype.toJSFunction=function(e,t){var o=this,l=new Function(e,"with(this.functions) with (this.ternaryOps) with (this.binaryOps) with (this.unaryOps) { return "+ke(this.simplify(t).tokens,!0)+"; }");return function(){return l.apply(o,arguments)}};var ee="TEOF",M="TOP",ne="TNUMBER",He="TSTRING",W="TPAREN",Z="TBRACKET",se="TCOMMA",Ce="TNAME",Pe="TSEMICOLON";function We(e,t,o){this.type=e,this.value=t,this.index=o}We.prototype.toString=function(){return this.type+": "+this.value};function z(e,t){this.pos=0,this.current=null,this.unaryOps=e.unaryOps,this.binaryOps=e.binaryOps,this.ternaryOps=e.ternaryOps,this.consts=e.consts,this.expression=t,this.savedPosition=0,this.savedCurrent=null,this.options=e.options,this.parser=e}z.prototype.newToken=function(e,t,o){return new We(e,t,o!=null?o:this.pos)},z.prototype.save=function(){this.savedPosition=this.pos,this.savedCurrent=this.current},z.prototype.restore=function(){this.pos=this.savedPosition,this.current=this.savedCurrent},z.prototype.next=function(){if(this.pos>=this.expression.length)return this.newToken(ee,"EOF");if(this.isWhitespace()||this.isComment())return this.next();if(this.isRadixInteger()||this.isNumber()||this.isOperator()||this.isString()||this.isParen()||this.isBracket()||this.isComma()||this.isSemicolon()||this.isNamedOp()||this.isConst()||this.isName())return this.current;this.parseError('Unknown character "'+this.expression.charAt(this.pos)+'"')},z.prototype.isString=function(){var e=!1,t=this.pos,o=this.expression.charAt(t);if(o==="'"||o==='"')for(var l=this.expression.indexOf(o,t+1);l>=0&&this.pos<this.expression.length;){if(this.pos=l+1,this.expression.charAt(l-1)!=="\\"){var f=this.expression.substring(t+1,l);this.current=this.newToken(He,this.unescape(f),t),e=!0;break}l=this.expression.indexOf(o,l+1)}return e},z.prototype.isParen=function(){var e=this.expression.charAt(this.pos);return e==="("||e===")"?(this.current=this.newToken(W,e),this.pos++,!0):!1},z.prototype.isBracket=function(){var e=this.expression.charAt(this.pos);return(e==="["||e==="]")&&this.isOperatorEnabled("[")?(this.current=this.newToken(Z,e),this.pos++,!0):!1},z.prototype.isComma=function(){var e=this.expression.charAt(this.pos);return e===","?(this.current=this.newToken(se,","),this.pos++,!0):!1},z.prototype.isSemicolon=function(){var e=this.expression.charAt(this.pos);return e===";"?(this.current=this.newToken(Pe,";"),this.pos++,!0):!1},z.prototype.isConst=function(){for(var e=this.pos,t=e;t<this.expression.length;t++){var o=this.expression.charAt(t);if(o.toUpperCase()===o.toLowerCase()&&(t===this.pos||o!=="_"&&o!=="."&&(o<"0"||o>"9")))break}if(t>e){var l=this.expression.substring(e,t);if(l in this.consts)return this.current=this.newToken(ne,this.consts[l]),this.pos+=l.length,!0}return!1},z.prototype.isNamedOp=function(){for(var e=this.pos,t=e;t<this.expression.length;t++){var o=this.expression.charAt(t);if(o.toUpperCase()===o.toLowerCase()&&(t===this.pos||o!=="_"&&(o<"0"||o>"9")))break}if(t>e){var l=this.expression.substring(e,t);if(this.isOperatorEnabled(l)&&(l in this.binaryOps||l in this.unaryOps||l in this.ternaryOps))return this.current=this.newToken(M,l),this.pos+=l.length,!0}return!1},z.prototype.isName=function(){for(var e=this.pos,t=e,o=!1;t<this.expression.length;t++){var l=this.expression.charAt(t);if(l.toUpperCase()===l.toLowerCase()){if(t===this.pos&&(l==="$"||l==="_")){l==="_"&&(o=!0);continue}else if(t===this.pos||!o||l!=="_"&&(l<"0"||l>"9"))break}else o=!0}if(o){var f=this.expression.substring(e,t);return this.current=this.newToken(Ce,f),this.pos+=f.length,!0}return!1},z.prototype.isWhitespace=function(){for(var e=!1,t=this.expression.charAt(this.pos);(t===" "||t==="	"||t===`
`||t==="\r")&&(e=!0,this.pos++,!(this.pos>=this.expression.length));)t=this.expression.charAt(this.pos);return e};var Mt=/^[0-9a-f]{4}$/i;z.prototype.unescape=function(e){var t=e.indexOf("\\");if(t<0)return e;for(var o=e.substring(0,t);t>=0;){var l=e.charAt(++t);switch(l){case"'":o+="'";break;case'"':o+='"';break;case"\\":o+="\\";break;case"/":o+="/";break;case"b":o+="\b";break;case"f":o+="\f";break;case"n":o+=`
`;break;case"r":o+="\r";break;case"t":o+="	";break;case"u":var f=e.substring(t+1,t+5);Mt.test(f)||this.parseError("Illegal escape sequence: \\u"+f),o+=String.fromCharCode(parseInt(f,16)),t+=4;break;default:throw this.parseError('Illegal escape sequence: "\\'+l+'"')}++t;var v=e.indexOf("\\",t);o+=e.substring(t,v<0?e.length:v),t=v}return o},z.prototype.isComment=function(){var e=this.expression.charAt(this.pos);return e==="/"&&this.expression.charAt(this.pos+1)==="*"?(this.pos=this.expression.indexOf("*/",this.pos)+2,this.pos===1&&(this.pos=this.expression.length),!0):!1},z.prototype.isRadixInteger=function(){var e=this.pos;if(e>=this.expression.length-2||this.expression.charAt(e)!=="0")return!1;++e;var t,o;if(this.expression.charAt(e)==="x")t=16,o=/^[0-9a-f]$/i,++e;else if(this.expression.charAt(e)==="b")t=2,o=/^[01]$/i,++e;else return!1;for(var l=!1,f=e;e<this.expression.length;){var v=this.expression.charAt(e);if(o.test(v))e++,l=!0;else break}return l&&(this.current=this.newToken(ne,parseInt(this.expression.substring(f,e),t)),this.pos=e),l},z.prototype.isNumber=function(){for(var e=!1,t=this.pos,o=t,l=t,f=!1,v=!1,y;t<this.expression.length&&(y=this.expression.charAt(t),y>="0"&&y<="9"||!f&&y===".");)y==="."?f=!0:v=!0,t++,e=v;if(e&&(l=t),y==="e"||y==="E"){t++;for(var x=!0,C=!1;t<this.expression.length;){if(y=this.expression.charAt(t),x&&(y==="+"||y==="-"))x=!1;else if(y>="0"&&y<="9")C=!0,x=!1;else break;t++}C||(t=l)}return e?(this.current=this.newToken(ne,parseFloat(this.expression.substring(o,t))),this.pos=t):this.pos=l,e},z.prototype.isOperator=function(){var e=this.pos,t=this.expression.charAt(this.pos);if(t==="+"||t==="-"||t==="*"||t==="/"||t==="%"||t==="^"||t==="?"||t===":"||t===".")this.current=this.newToken(M,t);else if(t==="\u2219"||t==="\u2022")this.current=this.newToken(M,"*");else if(t===">")this.expression.charAt(this.pos+1)==="="?(this.current=this.newToken(M,">="),this.pos++):this.current=this.newToken(M,">");else if(t==="<")this.expression.charAt(this.pos+1)==="="?(this.current=this.newToken(M,"<="),this.pos++):this.current=this.newToken(M,"<");else if(t==="|")if(this.expression.charAt(this.pos+1)==="|")this.current=this.newToken(M,"||"),this.pos++;else return!1;else if(t==="=")this.expression.charAt(this.pos+1)==="="?(this.current=this.newToken(M,"=="),this.pos++):this.current=this.newToken(M,t);else if(t==="!")this.expression.charAt(this.pos+1)==="="?(this.current=this.newToken(M,"!="),this.pos++):this.current=this.newToken(M,t);else return!1;return this.pos++,this.isOperatorEnabled(this.current.value)?!0:(this.pos=e,!1)},z.prototype.isOperatorEnabled=function(e){return this.parser.isOperatorEnabled(e)},z.prototype.getCoordinates=function(){var e=0,t,o=-1;do e++,t=this.pos-o,o=this.expression.indexOf(`
`,o+1);while(o>=0&&o<this.pos);return{line:e,column:t}},z.prototype.parseError=function(e){var t=this.getCoordinates();throw new Error("parse error ["+t.line+":"+t.column+"]: "+e)};function I(e,t,o){this.parser=e,this.tokens=t,this.current=null,this.nextToken=null,this.next(),this.savedCurrent=null,this.savedNextToken=null,this.allowMemberAccess=o.allowMemberAccess!==!1}I.prototype.next=function(){return this.current=this.nextToken,this.nextToken=this.tokens.next()},I.prototype.tokenMatches=function(e,t){return typeof t=="undefined"?!0:Array.isArray(t)?Q(t,e.value):typeof t=="function"?t(e):e.value===t},I.prototype.save=function(){this.savedCurrent=this.current,this.savedNextToken=this.nextToken,this.tokens.save()},I.prototype.restore=function(){this.tokens.restore(),this.current=this.savedCurrent,this.nextToken=this.savedNextToken},I.prototype.accept=function(e,t){return this.nextToken.type===e&&this.tokenMatches(this.nextToken,t)?(this.next(),!0):!1},I.prototype.expect=function(e,t){if(!this.accept(e,t)){var o=this.tokens.getCoordinates();throw new Error("parse error ["+o.line+":"+o.column+"]: Expected "+(t||e))}},I.prototype.parseAtom=function(e){var t=this.tokens.unaryOps;function o(f){return f.value in t}if(this.accept(Ce)||this.accept(M,o))e.push(new m(h,this.current.value));else if(this.accept(ne))e.push(new m(r,this.current.value));else if(this.accept(He))e.push(new m(r,this.current.value));else if(this.accept(W,"("))this.parseExpression(e),this.expect(W,")");else if(this.accept(Z,"["))if(this.accept(Z,"]"))e.push(new m(k,0));else{var l=this.parseArrayList(e);e.push(new m(k,l))}else throw new Error("unexpected "+this.nextToken)},I.prototype.parseExpression=function(e){var t=[];this.parseUntilEndStatement(e,t)||(this.parseVariableAssignmentExpression(t),!this.parseUntilEndStatement(e,t)&&this.pushExpression(e,t))},I.prototype.pushExpression=function(e,t){for(var o=0,l=t.length;o<l;o++)e.push(t[o])},I.prototype.parseUntilEndStatement=function(e,t){return this.accept(Pe)?(this.nextToken&&this.nextToken.type!==ee&&!(this.nextToken.type===W&&this.nextToken.value===")")&&t.push(new m(P)),this.nextToken.type!==ee&&this.parseExpression(t),e.push(new m(u,t)),!0):!1},I.prototype.parseArrayList=function(e){for(var t=0;!this.accept(Z,"]");)for(this.parseExpression(e),++t;this.accept(se);)this.parseExpression(e),++t;return t},I.prototype.parseVariableAssignmentExpression=function(e){for(this.parseConditionalExpression(e);this.accept(M,"=");){var t=e.pop(),o=[],l=e.length-1;if(t.type===p){if(!this.tokens.isOperatorEnabled("()="))throw new Error("function definition is not permitted");for(var f=0,v=t.value+1;f<v;f++){var y=l-f;e[y].type===h&&(e[y]=new m(c,e[y].value))}this.parseVariableAssignmentExpression(o),e.push(new m(u,o)),e.push(new m(d,t.value));continue}if(t.type!==h&&t.type!==b)throw new Error("expected variable for assignment");this.parseVariableAssignmentExpression(o),e.push(new m(c,t.value)),e.push(new m(u,o)),e.push(R("="))}},I.prototype.parseConditionalExpression=function(e){for(this.parseOrExpression(e);this.accept(M,"?");){var t=[],o=[];this.parseConditionalExpression(t),this.expect(M,":"),this.parseConditionalExpression(o),e.push(new m(u,t)),e.push(new m(u,o)),e.push(V("?"))}},I.prototype.parseOrExpression=function(e){for(this.parseAndExpression(e);this.accept(M,"or");){var t=[];this.parseAndExpression(t),e.push(new m(u,t)),e.push(R("or"))}},I.prototype.parseAndExpression=function(e){for(this.parseComparison(e);this.accept(M,"and");){var t=[];this.parseComparison(t),e.push(new m(u,t)),e.push(R("and"))}};var It=["==","!=","<","<=",">=",">","in"];I.prototype.parseComparison=function(e){for(this.parseAddSub(e);this.accept(M,It);){var t=this.current;this.parseAddSub(e),e.push(R(t.value))}};var Dt=["+","-","||"];I.prototype.parseAddSub=function(e){for(this.parseTerm(e);this.accept(M,Dt);){var t=this.current;this.parseTerm(e),e.push(R(t.value))}};var Vt=["*","/","%"];I.prototype.parseTerm=function(e){for(this.parseFactor(e);this.accept(M,Vt);){var t=this.current;this.parseFactor(e),e.push(R(t.value))}},I.prototype.parseFactor=function(e){var t=this.tokens.unaryOps;function o(f){return f.value in t}if(this.save(),this.accept(M,o)){if(this.current.value!=="-"&&this.current.value!=="+"){if(this.nextToken.type===W&&this.nextToken.value==="("){this.restore(),this.parseExponential(e);return}else if(this.nextToken.type===Pe||this.nextToken.type===se||this.nextToken.type===ee||this.nextToken.type===W&&this.nextToken.value===")"){this.restore(),this.parseAtom(e);return}}var l=this.current;this.parseFactor(e),e.push(A(l.value))}else this.parseExponential(e)},I.prototype.parseExponential=function(e){for(this.parsePostfixExpression(e);this.accept(M,"^");)this.parseFactor(e),e.push(R("^"))},I.prototype.parsePostfixExpression=function(e){for(this.parseFunctionCall(e);this.accept(M,"!");)e.push(A("!"))},I.prototype.parseFunctionCall=function(e){var t=this.tokens.unaryOps;function o(v){return v.value in t}if(this.accept(M,o)){var l=this.current;this.parseAtom(e),e.push(A(l.value))}else for(this.parseMemberExpression(e);this.accept(W,"(");)if(this.accept(W,")"))e.push(new m(p,0));else{var f=this.parseArgumentList(e);e.push(new m(p,f))}},I.prototype.parseArgumentList=function(e){for(var t=0;!this.accept(W,")");)for(this.parseExpression(e),++t;this.accept(se);)this.parseExpression(e),++t;return t},I.prototype.parseMemberExpression=function(e){for(this.parseAtom(e);this.accept(M,".")||this.accept(Z,"[");){var t=this.current;if(t.value==="."){if(!this.allowMemberAccess)throw new Error('unexpected ".", member access is not permitted');this.expect(Ce),e.push(new m(b,this.current.value))}else if(t.value==="["){if(!this.tokens.isOperatorEnabled("["))throw new Error('unexpected "[]", arrays are disabled');this.parseExpression(e),this.expect(Z,"]"),e.push(R("["))}else throw new Error("unexpected symbol: "+t.value)}};function Nt(e,t){return Number(e)+Number(t)}function zt(e,t){return e-t}function Bt(e,t){return e*t}function Ft(e,t){return e/t}function Lt(e,t){return e%t}function Ut(e,t){return Array.isArray(e)&&Array.isArray(t)?e.concat(t):""+e+t}function jt(e,t){return e===t}function _t(e,t){return e!==t}function Ht(e,t){return e>t}function Wt(e,t){return e<t}function Gt(e,t){return e>=t}function qt(e,t){return e<=t}function Jt(e,t){return!!(e&&t)}function Kt(e,t){return!!(e||t)}function Xt(e,t){return Q(t,e)}function Yt(e){return(Math.exp(e)-Math.exp(-e))/2}function $t(e){return(Math.exp(e)+Math.exp(-e))/2}function Qt(e){return e===1/0?1:e===-1/0?-1:(Math.exp(e)-Math.exp(-e))/(Math.exp(e)+Math.exp(-e))}function Zt(e){return e===-1/0?e:Math.log(e+Math.sqrt(e*e+1))}function er(e){return Math.log(e+Math.sqrt(e*e-1))}function tr(e){return Math.log((1+e)/(1-e))/2}function Ge(e){return Math.log(e)*Math.LOG10E}function rr(e){return-e}function nr(e){return!e}function sr(e){return e<0?Math.ceil(e):Math.floor(e)}function ir(e){return Math.random()*(e||1)}function qe(e){return Te(e+1)}function or(e){return isFinite(e)&&e===Math.round(e)}var ar=4.7421875,Ae=[.9999999999999971,57.15623566586292,-59.59796035547549,14.136097974741746,-.4919138160976202,3399464998481189e-20,4652362892704858e-20,-9837447530487956e-20,.0001580887032249125,-.00021026444172410488,.00021743961811521265,-.0001643181065367639,8441822398385275e-20,-26190838401581408e-21,36899182659531625e-22];function Te(e){var t,o;if(or(e)){if(e<=0)return isFinite(e)?1/0:NaN;if(e>171)return 1/0;for(var l=e-2,f=e-1;l>1;)f*=l,l--;return f===0&&(f=1),f}if(e<.5)return Math.PI/(Math.sin(Math.PI*e)*Te(1-e));if(e>=171.35)return 1/0;if(e>85){var v=e*e,y=v*e,x=y*e,C=x*e;return Math.sqrt(2*Math.PI/e)*Math.pow(e/Math.E,e)*(1+1/(12*e)+1/(288*v)-139/(51840*y)-571/(2488320*x)+163879/(209018880*C)+5246819/(75246796800*C*e))}--e,o=Ae[0];for(var N=1;N<Ae.length;++N)o+=Ae[N]/(e+N);return t=e+ar+.5,Math.sqrt(2*Math.PI)*Math.pow(t,e+.5)*Math.exp(-t)*o}function lr(e){return Array.isArray(e)?e.length:String(e).length}function Je(){for(var e=0,t=0,o=0;o<arguments.length;o++){var l=Math.abs(arguments[o]),f;t<l?(f=t/l,e=e*f*f+1,t=l):l>0?(f=l/t,e+=f*f):e+=l}return t===1/0?1/0:t*Math.sqrt(e)}function Ke(e,t,o){return e?t:o}function ur(e,t){return typeof t=="undefined"||+t==0?Math.round(e):(e=+e,t=-+t,isNaN(e)||!(typeof t=="number"&&t%1===0)?NaN:(e=e.toString().split("e"),e=Math.round(+(e[0]+"e"+(e[1]?+e[1]-t:-t))),e=e.toString().split("e"),+(e[0]+"e"+(e[1]?+e[1]+t:t))))}function cr(e,t,o){return o&&(o[e]=t),t}function pr(e,t){return e[t|0]}function fr(e){return arguments.length===1&&Array.isArray(e)?Math.max.apply(Math,e):Math.max.apply(Math,arguments)}function hr(e){return arguments.length===1&&Array.isArray(e)?Math.min.apply(Math,e):Math.min.apply(Math,arguments)}function dr(e,t){if(typeof e!="function")throw new Error("First argument to map is not a function");if(!Array.isArray(t))throw new Error("Second argument to map is not an array");return t.map(function(o,l){return e(o,l)})}function gr(e,t,o){if(typeof e!="function")throw new Error("First argument to fold is not a function");if(!Array.isArray(o))throw new Error("Second argument to fold is not an array");return o.reduce(function(l,f,v){return e(l,f,v)},t)}function yr(e,t){if(typeof e!="function")throw new Error("First argument to filter is not a function");if(!Array.isArray(t))throw new Error("Second argument to filter is not an array");return t.filter(function(o,l){return e(o,l)})}function vr(e,t){if(!(Array.isArray(t)||typeof t=="string"))throw new Error("Second argument to indexOf is not a string or array");return t.indexOf(e)}function mr(e,t){if(!Array.isArray(t))throw new Error("Second argument to join is not an array");return t.join(e)}function wr(e){return(e>0)-(e<0)||+e}var Xe=1/3;function Er(e){return e<0?-Math.pow(-e,Xe):Math.pow(e,Xe)}function br(e){return Math.exp(e)-1}function xr(e){return Math.log(1+e)}function kr(e){return Math.log(e)/Math.LN2}function J(e){this.options=e||{},this.unaryOps={sin:Math.sin,cos:Math.cos,tan:Math.tan,asin:Math.asin,acos:Math.acos,atan:Math.atan,sinh:Math.sinh||Yt,cosh:Math.cosh||$t,tanh:Math.tanh||Qt,asinh:Math.asinh||Zt,acosh:Math.acosh||er,atanh:Math.atanh||tr,sqrt:Math.sqrt,cbrt:Math.cbrt||Er,log:Math.log,log2:Math.log2||kr,ln:Math.log,lg:Math.log10||Ge,log10:Math.log10||Ge,expm1:Math.expm1||br,log1p:Math.log1p||xr,abs:Math.abs,ceil:Math.ceil,floor:Math.floor,round:Math.round,trunc:Math.trunc||sr,"-":rr,"+":Number,exp:Math.exp,not:nr,length:lr,"!":qe,sign:Math.sign||wr},this.binaryOps={"+":Nt,"-":zt,"*":Bt,"/":Ft,"%":Lt,"^":Math.pow,"||":Ut,"==":jt,"!=":_t,">":Ht,"<":Wt,">=":Gt,"<=":qt,and:Jt,or:Kt,in:Xt,"=":cr,"[":pr},this.ternaryOps={"?":Ke},this.functions={random:ir,fac:qe,min:hr,max:fr,hypot:Math.hypot||Je,pyt:Math.hypot||Je,pow:Math.pow,atan2:Math.atan2,if:Ke,gamma:Te,roundTo:ur,map:dr,fold:gr,filter:yr,indexOf:vr,join:mr},this.consts={E:Math.E,PI:Math.PI,true:!0,false:!1}}J.prototype.parse=function(e){var t=[],o=new I(this,new z(this,e),{allowMemberAccess:this.options.allowMemberAccess});return o.parseExpression(t),o.expect(ee,"EOF"),new j(t,this)},J.prototype.evaluate=function(e,t){return this.parse(e).evaluate(t)};var Ye=new J;J.parse=function(e){return Ye.parse(e)},J.evaluate=function(e,t){return Ye.parse(e).evaluate(t)};var $e={"+":"add","-":"subtract","*":"multiply","/":"divide","%":"remainder","^":"power","!":"factorial","<":"comparison",">":"comparison","<=":"comparison",">=":"comparison","==":"comparison","!=":"comparison","||":"concatenate",and:"logical",or:"logical",not:"logical","?":"conditional",":":"conditional","=":"assignment","[":"array","()=":"fndef"};function Sr(e){return $e.hasOwnProperty(e)?$e[e]:e}J.prototype.isOperatorEnabled=function(e){var t=Sr(e),o=this.options.operators||{};return!(t in o)||!!o[t]};var Cr={Parser:J,Expression:j};n.Expression=j,n.Parser=J,n.default=Cr,Object.defineProperty(n,"__esModule",{value:!0})})});var ht=K((ft,pe)=>{"use strict";var fe=class{constructor(r,s){let i=r||{},a=Array.isArray(i.allowedVariables)&&i.allowedVariables.length>0?i.allowedVariables.slice():Me.slice();this.allowedVariables=a;let h=s||pt();this.parser=new h({operators:{add:!0,subtract:!0,multiply:!0,divide:!0,remainder:!0,power:!1,factorial:!1,comparison:!0,logical:!0,conditional:!0,concatenate:!1,assignment:!1,array:!1,fndef:!1},allowMemberAccess:!1}),this.cache={}}validate(r){let s;try{s=this.getCacheEntry(r)}catch(i){return{ok:!1,error:i instanceof Error?i.message:"Invalid expression"}}return s?s.disallowedVariables.length>0?{ok:!1,error:"Unknown variables: "+s.disallowedVariables.join(", ")+". Allowed variables: "+this.allowedVariables.join(", ")}:{ok:!0,variables:s.variables.slice()}:{ok:!1,error:"Expression cannot be empty"}}evaluate(r,s){let i=this.getCacheEntry(r);if(!i)throw new Error("Expression cannot be empty");if(i.disallowedVariables.length>0)throw new Error("Unknown variables: "+i.disallowedVariables.join(", ")+". Allowed variables: "+this.allowedVariables.join(", "));let a={},h=s||{};for(let c of this.allowedVariables){let p=Object.prototype.hasOwnProperty.call(h,c)?h[c]:void 0;if(Me.indexOf(c)!==-1){a[c]=X(p);continue}typeof p=="number"?a[c]=Number.isFinite(p)?p:0:typeof p=="boolean"||typeof p=="string"?a[c]=p:p==null?a[c]=0:a[c]=p}return i.compiled.evaluate(a)}clearCache(){this.cache={}}getCacheEntry(r){let s=this.normalizeExpression(r);if(!s)return null;if(this.cache[s])return this.cache[s];let i;try{i=this.parser.parse(s)}catch(p){throw this.wrapParseError(p)}let a=i.variables({withMembers:!1})||[],h=a.filter(p=>this.allowedVariables.indexOf(p)===-1),c={expression:s,compiled:i,variables:a.slice(),disallowedVariables:h.slice()};return this.cache[s]=c,c}normalizeExpression(r){return typeof r!="string"?"":r.trim()}wrapParseError(r){let s=r&&typeof r=="object"&&r instanceof Error&&r.message?Fr(r.message):"Invalid expression",i=new Error(s);return r&&typeof r=="object"&&(i.originalError=r),i}},Me=["value","high","low","changeDaily","changeDailyPercent","volume"];function zr(n){return n?n.slice():[]}function X(n){if(n==null)return 0;if(typeof n=="number")return Number.isFinite(n)?n:0;if(typeof n=="string"&&n.trim()!==""){let r=Number(n);if(!Number.isNaN(r)&&Number.isFinite(r))return r}return 0}function ct(n){let r=n||{};return{value:X(r.last),high:X(r.high),low:X(r.low),changeDaily:X(r.changeDaily),changeDailyPercent:X(r.changeDailyPercent),volume:X(r.volume)}}function Br(n,r){let s=ct(n);if(r&&typeof r=="object")for(let i in r)Object.prototype.hasOwnProperty.call(r,i)&&(s[i]=r[i]);return s}function Fr(n){return n?n.indexOf("member access is not permitted")>=0?n+'. Remove object-style prefixes (for example use "value" instead of "values.last").':n:"Invalid expression"}function pt(){if(typeof tt=="function")try{let s=ut();if(s&&s.Parser)return s.Parser}catch{}let n=typeof globalThis!="undefined"?globalThis:{},r=n.exprEval&&n.exprEval.Parser;if(r)return r;throw new Error("expr-eval dependency is missing")}(function(r,s){let i=pt(),a=s(i);typeof pe=="object"&&pe.exports&&(pe.exports=a),r&&typeof r=="object"&&(r.CryptoTickerExpressionEvaluator=a)})(typeof self!="undefined"?self:ft,function(r){return{createEvaluator:s=>new fe(s,r),ExpressionEvaluator:fe,normalizeNumericValue:X,buildBaseContext:ct,buildContext:Br,allowedVariables:zr(Me)}})});var gt=K(dt=>{"use strict";(function(n){let r=n.CryptoTickerPIProviders=n.CryptoTickerPIProviders||{},s=r._providers=r._providers||{};r.registerProvider=function(i){!i||typeof i.id!="string"||(s[i.id.toUpperCase()]=i)},r.getProvider=function(i){return typeof i!="string"?null:s[i.toUpperCase()]||null},r.listProviders=function(){return Object.keys(s)}})(typeof self!="undefined"?self:dt)});var vt=K((yt,he)=>{"use strict";(function(n,r){let s=typeof globalThis!="undefined"?globalThis:n,i=s&&s.CryptoTickerPIProviders?s.CryptoTickerPIProviders:null,a=r();typeof he=="object"&&he.exports&&(he.exports=a),i&&typeof i.registerProvider=="function"&&i.registerProvider(a)})(typeof self!="undefined"?self:yt,function(){let n="https://api.binance.com/api/v3/exchangeInfo";async function r(){let i=await(await fetch(n)).json();return(Array.isArray(i.symbols)?i.symbols:[]).filter(function(h){return!h||h.status&&h.status!=="TRADING"?!1:(h.symbol||"").length>0}).map(function(h){let c=(h.symbol||"").toUpperCase();return{value:c,display:c,symbol:c}})}return{id:"BINANCE",getPairs:r}})});var wt=K((mt,de)=>{"use strict";(function(n,r){let s=typeof globalThis!="undefined"?globalThis:n,i=s&&s.CryptoTickerPIProviders?s.CryptoTickerPIProviders:null,a=r();typeof de=="object"&&de.exports&&(de.exports=a),i&&typeof i.registerProvider=="function"&&i.registerProvider(a)})(typeof self!="undefined"?self:mt,function(){let n="https://api-pub.bitfinex.com/v2/conf/pub:list:pair:exchange";async function r(){let i=await(await fetch(n)).json();return(Array.isArray(i)&&Array.isArray(i[0])?i[0]:[]).map(function(h){let c=(h||"").toUpperCase(),p=c.replace(/[:/]/g,"");return{value:c,display:c,symbol:p}})}return{id:"BITFINEX",getPairs:r}})});var rn=$(nt()),nn=$(it()),sn=$(at()),on=$(ht()),an=$(gt()),ln=$(vt()),un=$(wt());var Y=null,Le=null,Ue={},G=typeof CryptoTickerExpressionEvaluator!="undefined"?CryptoTickerExpressionEvaluator:null,Lr=typeof CryptoTickerConnectionStates!="undefined"?CryptoTickerConnectionStates:{LIVE:"live",DETACHED:"detached",BACKUP:"backup",BROKEN:"broken"},Ie=typeof CryptoTickerConnectionStatusIcons!="undefined"?CryptoTickerConnectionStatusIcons:null,De=function(){if(!G)return{alert:null,color:null};let r=(G.allowedVariables?G.allowedVariables.slice(0):[]).slice(0),s=["alert","backgroundColor","textColor","defaultBackgroundColor","defaultTextColor"];for(let i=0;i<s.length;i++)r.indexOf(s[i])===-1&&r.push(s[i]);return{alert:G.createEvaluator(),color:G.createEvaluator({allowedVariables:r})}}(),Pt={last:100,high:120,low:80,changeDaily:2,changeDailyPercent:.02,volume:1e5},Ur={alert:!1,backgroundColor:"#000000",textColor:"#ffffff",defaultBackgroundColor:"#000000",defaultTextColor:"#ffffff"};function jr(){return G?G.buildBaseContext(Pt):{}}function Et(){return G?G.buildContext(Pt,Object.assign({},Ur)):{}}var ge=[{key:"alertRule",evaluator:De.alert,contextBuilder:jr},{key:"backgroundColorRule",evaluator:De.color,contextBuilder:Et},{key:"textColorRule",evaluator:De.color,contextBuilder:Et}],re="https://tproxyv8.opendle.com",bt=typeof re=="string"?re.replace(/\/$/,""):"",xt="_ctBust";function _r(n){if(!n||typeof n!="string")return n;try{let r=new URL(n);return r.searchParams.set(xt,Date.now().toString()),r.toString()}catch{let s=n.indexOf("?")===-1?"?":"&";return n+s+xt+"="+Date.now()}}function Hr(n,r){if(!n||typeof n!="string")return{url:n,options:r};let s=n.replace(/\/$/,"");if(!bt||s.indexOf(bt)!==0)return{url:n,options:r};let i=Object.assign({},r||{});i.cache="no-store";let a=Object.assign({},i.headers||{});return a["cache-control"]="no-cache",a.pragma="no-cache",i.headers=a,{url:_r(n),options:i}}var Wr=!1,S=document.getElementById("select-pair-dropdown"),U=document.getElementById("select-pair-search"),te=document.getElementById("pair-search-feedback"),me=1e4,we=3,Ee=600,Gr=5e3;function qr(n){return new Promise(function(r){setTimeout(r,n)})}function Ve(n,r,s){if(typeof n=="function")try{n(r)}catch(i){console.error("fetchJsonWithRetry "+s+" failed",i)}}function Jr(n){if(typeof AbortController=="undefined")return{controller:null,timerId:null};let r=new AbortController,s=setTimeout(function(){r.abort()},n);return{controller:r,timerId:s}}function kt(n){n&&clearTimeout(n)}async function Kr(n,r,s){let i=Object.assign({},s||{});r&&(i.signal=r.signal);let a=Hr(n,i),h=await fetch(a.url,a.options);if(!h.ok)throw new Error("Request failed with status "+h.status);let c=await h.text();if(!c||c.trim().length===0)return[];try{return JSON.parse(c)}catch(p){let d=p instanceof Error?p:new Error(String(p));throw d.message="Failed to parse JSON response from "+n+": "+d.message,d}}function Xr(n){if(!n)return"";try{return new Date(n).toLocaleString()}catch{return new Date(n).toString()}}function ye(n){let r=Xr(n);return r?"Showing cached data from "+r+". Data may be outdated.":"Showing cached data. Data may be outdated."}var E=function(){let n={providers:{selectId:"select-provider",loadingMessage:"Loading providers...",retryMessage:"Failed to load providers. Retrying..."},pairs:{selectId:"select-pair-dropdown",extraDisableIds:["select-pair-search"],loadingMessage:"Loading pairs...",retryMessage:"Failed to load pairs. Retrying..."},currencies:{selectId:"select-currency",loadingMessage:"Loading currencies...",retryMessage:"Failed to load currencies. Retrying..."}},r={};function s(c){if(r[c])return r[c];let p=n[c];if(!p)return null;let d=document.getElementById(p.selectId);if(!d||!d.parentNode)return null;let u=[];Array.isArray(p.extraDisableIds)&&p.extraDisableIds.forEach(function(A){let R=document.getElementById(A);R&&u.push(R)});let g=document.createElement("div");g.className="pi-network-status",g.setAttribute("role","status"),g.style.display="none";let b=document.createElement("span");b.className="pi-network-status__spinner",g.appendChild(b);let P=document.createElement("span");P.className="pi-network-status__text",g.appendChild(P);let k=document.createElement("button");k.type="button",k.className="pi-network-status__retry",k.textContent="Retry",k.style.display="none",g.appendChild(k),d.parentNode.appendChild(g);let m=document.createElement("div");return m.className="pi-network-status__warning",m.style.display="none",d.parentNode.appendChild(m),r[c]={select:d,status:g,spinner:b,text:P,retry:k,warning:m,extraDisableElements:u},r[c]}function i(c,p){let d=s(c);if(!d)return;let u=p||{};if(d.status.style.display=u.message?"":"none",d.text.textContent=u.message||"",d.spinner.style.display=u.spinner?"":"none",d.retry.style.display=u.showRetry?"":"none",d.retry.onclick=typeof u.onRetry=="function"?u.onRetry:null,d.status.classList.remove("is-error","is-warning","is-success"),u.tone==="error"?d.status.classList.add("is-error"):u.tone==="warning"?d.status.classList.add("is-warning"):u.tone==="success"&&d.status.classList.add("is-success"),d.select&&(d.select.disabled=!!u.disableSelect),d.extraDisableElements&&d.extraDisableElements.length)for(let g=0;g<d.extraDisableElements.length;g++){let b=d.extraDisableElements[g];b&&(b.disabled=!!u.disableSelect)}}function a(c,p){let d=s(c);if(!d)return;let u=p||"";d.warning.style.display=u?"":"none",d.warning.textContent=u}function h(c){i(c,{}),a(c,"");let p=r[c];p&&p.select&&(p.select.disabled=!1)}return{ensure:s,setState:i,showWarning:a,clear:h,config:n}}();async function Ne(n,r){let s=r||{},i=Math.max(1,s.attempts||we),a=s.timeout||me,h=null;for(let c=1;c<=i;c++){Ve(s.onAttemptStart,{attempt:c,maxAttempts:i},"onAttemptStart");let p=Jr(a);try{let d=s.fetchOptions||{},u=await Kr(n,p.controller,d);return kt(p.timerId),u}catch(d){if(h=d,kt(p.timerId),Ve(s.onAttemptError,{attempt:c,maxAttempts:i,error:d},"onAttemptError"),c<i){let u=s.retryBaseDelay||Ee,g=Math.min(Gr,u*Math.pow(2,c-1));await qr(g)}}}throw Ve(s.onFinalFailure,{error:h},"onFinalFailure"),h||new Error("Request failed")}function Yr(n){return(n||[]).map(function(r){if(!r)return null;if(typeof r=="string"){let c=r.toUpperCase();return{value:c,symbol:c.replace(/[:/]/g,""),display:c}}let i=((r.value!==void 0?r.value:r.display||r.symbol||"")||"").toUpperCase();if(!i)return null;let a=(r.symbol||i.replace(/[:/]/g,"")).toUpperCase(),h=(r.display||i).toUpperCase();return{value:i,symbol:a,display:h}}).filter(function(r){return r!==null})}var St=typeof CryptoTickerDefaults!="undefined"?CryptoTickerDefaults:null;function At(){if(!St)throw new Error("Default settings module is not available");return St}function Tt(n){let r=At();return typeof r.applyDefaults=="function"?r.applyDefaults(n):r.defaultSettings?Object.assign({},r.defaultSettings,n||{}):Object.assign({},n||{})}function $r(){let n=At();return typeof n.getDefaultSettings=="function"?n.getDefaultSettings():n.defaultSettings?JSON.parse(JSON.stringify(n.defaultSettings)):{}}var T=$r(),O={title:{default:T.title,value:document.getElementById("input-title")},exchange:{default:T.exchange,value:document.getElementById("select-provider")},pair:{default:T.pair,value:document.getElementById("select-pair"),setValue:function(n){this.value.value=n,S.value=n}},fromCurrency:{default:T.fromCurrency},currency:{default:T.currency,value:document.getElementById("select-currency")},candlesInterval:{default:T.candlesInterval,value:document.getElementById("candlesInterval")},candlesDisplayed:{default:T.candlesDisplayed,value:document.getElementById("candlesDisplayed")},multiplier:{default:T.multiplier,value:document.getElementById("multiplier")},digits:{default:T.digits,value:document.getElementById("digits")},highLowDigits:{default:T.highLowDigits,value:document.getElementById("highLowDigits")},priceFormat:{default:T.priceFormat,value:document.getElementById("priceFormat")},font:{default:T.font,value:document.getElementById("font")},fontSizeBase:{default:T.fontSizeBase,value:document.getElementById("fontSizeBase")},fontSizePrice:{default:T.fontSizePrice,value:document.getElementById("fontSizePrice")},fontSizeHighLow:{default:T.fontSizeHighLow,value:document.getElementById("fontSizeHighLow")},fontSizeChange:{default:T.fontSizeChange,value:document.getElementById("fontSizeChange")},backgroundColor:{default:T.backgroundColor,value:document.getElementById("backgroundColor")},textColor:{default:T.textColor,value:document.getElementById("textColor")},displayHighLow:{default:T.displayHighLow,value:document.getElementById("displayHighLow"),getValue:function(){return this.value.checked?"on":"off"},setValue:function(n){this.value.checked=n!=="off"}},displayHighLowBar:{default:T.displayHighLowBar,value:document.getElementById("displayHighLowBar"),getValue:function(){return this.value.checked?"on":"off"},setValue:function(n){this.value.checked=n!=="off"}},displayDailyChange:{default:T.displayDailyChange,value:document.getElementById("displayDailyChange"),getValue:function(){return this.value.checked?"on":"off"},setValue:function(n){this.value.checked=n!=="off"}},displayConnectionStatusIcon:{default:T.displayConnectionStatusIcon,value:document.getElementById("displayConnectionStatusIcon"),getValue:function(){return(this.value.value||T.displayConnectionStatusIcon).toUpperCase()},setValue:function(n){let r=(n||T.displayConnectionStatusIcon).toUpperCase();this.value.value=r}},alertRule:{default:T.alertRule,value:document.getElementById("alertRule"),errorElement:document.getElementById("alertRuleError")},backgroundColorRule:{default:T.backgroundColorRule,value:document.getElementById("backgroundColorRule"),errorElement:document.getElementById("backgroundColorRuleError")},textColorRule:{default:T.textColorRule,value:document.getElementById("textColorRule"),errorElement:document.getElementById("textColorRuleError")},mode:{default:T.mode}},F=Tt({}),je={};function ze(n){let r=je[n];return!r||typeof r!="object"||!Object.prototype.hasOwnProperty.call(r,"data")?null:r}function Be(n,r){return je[n]={data:r,timestamp:Date.now()},je[n]}var ve=null,Ct=document.getElementsByClassName("currencyRelated");function Fe(n){let r=Tt(n||{});for(let s in F)Object.prototype.hasOwnProperty.call(F,s)&&delete F[s];return Object.assign(F,r),F}var Ot={pairDropdownState:{allPairs:[],filteredPairs:[],filterTerm:"",provider:""},log:function(...n){Wr&&console.log(...n)},displayExpressionErrors:function(n){let r=n||{};for(let s=0;s<ge.length;s++){let i=ge[s],a=O[i.key];if(!a||!a.errorElement)continue;let h=r[i.key]||"";a.errorElement.textContent=h,h?a.errorElement.classList.add("is-visible"):a.errorElement.classList.remove("is-visible")}},validateRuleExpressions:function(n){let r={hasErrors:!1,errors:{}};for(let s=0;s<ge.length;s++){let i=ge[s],a=(n[i.key]||"").trim();if(!a){r.errors[i.key]="";continue}if(!i.evaluator||typeof i.contextBuilder!="function"){r.errors[i.key]="";continue}let h=i.evaluator.validate(a);if(!h.ok){r.errors[i.key]=h.error,r.hasErrors=!0;continue}try{let c=i.contextBuilder()||{},p=i.evaluator.evaluate(a,c);typeof p=="number"&&!isFinite(p)?(r.errors[i.key]="Expression resulted in an invalid number. Check for division by zero.",r.hasErrors=!0):typeof p=="number"&&isNaN(p)?(r.errors[i.key]="Expression resulted in NaN. Verify the operators and inputs.",r.hasErrors=!0):r.errors[i.key]=""}catch(c){let p=c&&c.message?c.message:"Invalid expression";r.errors[i.key]=p,r.hasErrors=!0}}return r},setPairUIVisibility:function(n){let r=n?"":"none",s=document.getElementById("select-pair-dropdown-group"),i=document.getElementById("pair-search-group");s&&(s.style.display=r),i&&(i.style.display=r)},resetPairDropdown:function(){if(this.pairDropdownState.allPairs=[],this.pairDropdownState.filteredPairs=[],this.pairDropdownState.filterTerm="",this.pairDropdownState.provider="",S){this.removeAllOptions(S);let n=document.createElement("option");n.text="",n.value="",S.add(n),S.disabled=!0}U&&(U.value="",U.disabled=!0),this.updatePairSearchFeedback(0,""),this.setPairUIVisibility(!1)},findMatchingPairValue:function(n,r){if(!r)return null;let s=r.toUpperCase(),a=(Array.isArray(n)?n:[]).find(function(h){if(!h)return!1;let c=(h.value||"").toUpperCase(),p=(h.symbol||"").toUpperCase(),d=(h.display||"").toUpperCase();return c===s||p===s||d===s});return a?a.value||a.symbol||"":null},renderPairDropdownOptions:function(n,r){if(!S)return;let s=r||{},i=Array.isArray(n)?n:[],a=typeof s.previousValue=="string"?s.previousValue:S.value||"",h=typeof s.preferredValue=="string"?s.preferredValue:"",c=typeof s.fallbackValue=="string"?s.fallbackValue:"",p=O&&O.pair?O.pair:null,d=p&&p.value?p.value.value:"";this.removeAllOptions(S);let u=document.createElement("option");u.text="",u.value="",S.add(u);for(let A=0;A<i.length;A++){let R=i[A],V=document.createElement("option");V.value=R.value,V.text=R.display||R.value,S.add(V)}let g=this.findMatchingPairValue(i,h),b=this.findMatchingPairValue(i,a),P=this.findMatchingPairValue(i,d),k=this.findMatchingPairValue(i,c),m=g||b||P||k||"";m?S.value=m:S.value=""},updatePairSearchFeedback:function(n,r){if(!te)return;!!(r&&r.trim())&&n===0?(te.textContent='No matches for "'+r.trim()+'"',te.style.display=""):(te.textContent="",te.style.display="none")},applyPairFilter:function(n,r){let s=(n||"").trim(),i=s.toUpperCase(),a=this.pairDropdownState;a.filterTerm=s;let h=Array.isArray(a.allPairs)?a.allPairs:[],c=h;i&&(c=h.filter(function(b){let P=(b.value||"").toUpperCase(),k=(b.symbol||"").toUpperCase(),m=(b.display||"").toUpperCase();return P.indexOf(i)!==-1||k.indexOf(i)!==-1||m.indexOf(i)!==-1})),a.filteredPairs=c;let p=r||{},d=typeof p.previousValue=="string"?p.previousValue:S?S.value:"",u=typeof p.preferredValue=="string"?p.preferredValue:"",g=typeof p.fallbackValue=="string"?p.fallbackValue:c[0]?c[0].value:"";this.renderPairDropdownOptions(c,{previousValue:d,preferredValue:u,fallbackValue:g}),this.updatePairSearchFeedback(c.length,s)},setPairDropdownData:function(n,r,s){let i=Array.isArray(r)?r.slice(0):[];this.pairDropdownState.allPairs=i,this.pairDropdownState.provider=(n||"").toUpperCase();let a=s||{},h=a.resetFilter!==!1;U&&(h&&(U.value=""),U.disabled=i.length===0);let c=h?"":this.pairDropdownState.filterTerm;this.applyPairFilter(c,{previousValue:a.previousValue,preferredValue:a.preferredValue,fallbackValue:a.savedValue})},handlePairSearchInput:function(n){this.applyPairFilter(n,{previousValue:S?S.value:""})},handlePairSearchKeydown:function(n){if(n){if(n.key==="ArrowDown"||n.key==="Down")n.preventDefault(),this.focusPairDropdown(),this.movePairSelection(1);else if(n.key==="ArrowUp"||n.key==="Up")n.preventDefault(),this.focusPairDropdown(),this.movePairSelection(-1);else if(n.key==="Enter")n.preventDefault(),this.selectPairFromSearch();else if(n.key==="Escape"&&U&&U.value){n.preventDefault(),U.value="";let r=O&&O.pair?O.pair:null,s=r&&r.value?r.value.value:"";this.applyPairFilter("",{previousValue:s})}}},focusPairDropdown:function(){S&&(S.focus(),S.options.length>1&&S.selectedIndex<1&&(S.selectedIndex=1))},movePairSelection:function(n){if(!S)return;let r=S.options.length;if(r<=1)return;let s=S.selectedIndex;s<1?s=n>0?1:r-1:(s=s+n,s<1?s=r-1:s>=r&&(s=1)),S.selectedIndex=s},selectPairFromSearch:function(){if(!S)return;let n=S.value;!n&&this.pairDropdownState.filteredPairs.length>0&&(n=this.pairDropdownState.filteredPairs[0].value),n&&this.applyPairSelection(n)},applyPairSelection:function(n){S&&(S.value=n||"",typeof S.onchange=="function"&&S.onchange())},syncPairSelectionDisplay:function(){if(!S)return;let n=O&&O.pair?O.pair:null,r=n&&n.value?n.value.value:"";if(!r){S.value="";return}let s=this.pairDropdownState.filteredPairs.length>0?this.pairDropdownState.filteredPairs:this.pairDropdownState.allPairs,i=this.findMatchingPairValue(s,r)||r;S.value=i},setupNetworkStatusElements:function(){if(this.networkStatusInitialized)return;E.ensure("providers"),E.ensure("pairs"),E.ensure("currencies");let n=this;this.retryCallbacks={providers:async function(){await n.populateProvidersDropdown(!0);let r=O.exchange.value,s=r?r.value:"";s&&await n.populatePairsDropdown(s,{forceRefresh:!0})},pairs:async function(){let r=O.exchange.value,s=r?r.value:"";s&&await n.populatePairsDropdown(s,{forceRefresh:!0})},currencies:async function(){await n.populateCurrenciesDropdown(!0)}},this.networkStatusInitialized=!0},populateProvidersDropdown:async function(n){let r=O.exchange.value;if(!r)return[];let s=r.value,i=await this.getProviders({forceRefresh:!!n}),a=Array.isArray(i)?i.slice(0):[];this.removeAllOptions(r),a.sort(),a.forEach(function(p){let d=document.createElement("option");d.text=p,d.value=p,r.add(d)});let h=F.exchange||O.exchange.default||"",c=s||h;return c&&a.indexOf(c)!==-1?r.value=c:h&&a.indexOf(h)!==-1?r.value=h:a.length>0?r.value=a[0]:r.value="",r.disabled=a.length===0,a},populatePairsDropdown:async function(n,r){let s=r||{},i=O.exchange.value,a=n||(i?i.value:"");if(!a)return this.resetPairDropdown(),[];let h=a.toUpperCase(),c=await this.getPairs(a,{forceRefresh:!!s.forceRefresh}),p=i?(i.value||"").toUpperCase():"";if(p&&p!==h)return c;let d=Array.isArray(c)?c.slice(0):[];d.sort(function(k,m){let A=k.display||k.symbol,R=m.display||m.symbol;return A>R?1:A<R?-1:0});let u=(F.pair||"").toUpperCase(),g=S?S.value:"",b=(g||u||"").toUpperCase();this.setPairDropdownData(a,d,{previousValue:g,preferredValue:b,savedValue:u,resetFilter:!s.preserveFilter});let P=d.length>0;return this.setPairUIVisibility(P),S&&(S.disabled=!P),U&&(U.disabled=!P),P||this.updatePairSearchFeedback(0,U?U.value:""),d},populateCurrenciesDropdown:async function(n){let r=O.currency.value;if(!r)return[];let s=r.value,i=await this.getCurrencies({forceRefresh:!!n}),a=Array.isArray(i)?i.slice(0):[];this.removeAllOptions(r);let h=document.createElement("option");h.text="",h.value="",r.add(h),a.sort(),a.forEach(function(d){let u=document.createElement("option");u.text=d,u.value=d,r.add(u)});let c=F.currency||O.currency.default||"",p=s||c;return p&&a.indexOf(p)!==-1?r.value=p:c&&a.indexOf(c)!==-1?r.value=c:r.value="",r.disabled=a.length===0,a},handleExchangeChange:async function(n){let r=n||{},s=O.exchange.value,i=s?s.value:"";if(!i){this.resetPairDropdown(),ve=i;return}await this.populatePairsDropdown(i,{forceRefresh:!!r.forceRefresh}),ve=i},initDom:function(){this.setupNetworkStatusElements(),this.initPairsDropDown(),this.initCurrenciesDropDown(),this.renderConnectionStateHelp();let n=this,r=function(){n.checkNewSettings(),n.refreshMenus()};for(let s in O){let i=O[s];i.value&&(i.value.onchange=r,i.value.onkeyup=r)}},renderConnectionStateHelp:function(){if(!Ie||typeof Ie.renderConnectionStatusIcon!="function")return;let n=document.querySelectorAll("canvas.connection-state-icon");if(!n||n.length===0)return;let s=Lr||{LIVE:"live",DETACHED:"detached",BACKUP:"backup",BROKEN:"broken"};for(let i=0;i<n.length;i++){let a=n[i];if(!a)continue;let h=(a.getAttribute("data-connection-state")||"").toUpperCase(),c=s&&s[h]?s[h]:h.toLowerCase(),p=a.getContext("2d");if(!p||!c)continue;p.clearRect(0,0,a.width,a.height);let d=Math.min(a.width||0,a.height||0),u=Math.max(d>0?d/32:1,.6);Ie.renderConnectionStatusIcon({canvas:a,canvasContext:p,state:c,color:"#ffffff",sizeMultiplier:u,position:"TOP_RIGHT",connectionStates:s})}},initPairsDropDown:async function(){let n=O.exchange.value;if(!n)return;if(this.setupNetworkStatusElements(),!this.exchangeDropdownInitialized){let i=this,a=typeof n.onchange=="function"?n.onchange:function(){};n.onchange=function(){typeof a=="function"&&a.call(this),i.handleExchangeChange(),i.checkNewSettings()},S.onchange=function(){let h=O.pair.value;h.value=S.value,typeof h.onchange=="function"&&h.onchange()},U&&(U.addEventListener("input",function(h){i.handlePairSearchInput(h.target.value)}),U.addEventListener("keydown",function(h){i.handlePairSearchKeydown(h)})),this.exchangeDropdownInitialized=!0}await this.populateProvidersDropdown();let r=F.exchange||O.exchange.default||"";r&&Array.from(n.options).some(function(a){return(a.value||"").toUpperCase()===r.toUpperCase()})&&(n.value=r);let s=n.value||r;ve=s,await this.populatePairsDropdown(s,{initial:!0}),this.refreshValues()},getProviders:async function(n){this.setupNetworkStatusElements();let r=n||{},s="getProviders",i=ze(s),a=i?i.data:null,c=!!r.forceRefresh||!i,p=this.retryCallbacks&&typeof this.retryCallbacks.providers=="function"?this.retryCallbacks.providers:null;if(c){E.setState("providers",{message:E.config.providers.loadingMessage,spinner:!0,disableSelect:!0});try{let u=await Ne(re+"/api/Ticker/json/providers",{attempts:we,timeout:me,retryBaseDelay:Ee,onAttemptStart:function(g){g.attempt===1?E.setState("providers",{message:E.config.providers.loadingMessage,spinner:!0,disableSelect:!0}):E.setState("providers",{message:E.config.providers.retryMessage,spinner:!0,disableSelect:!0,tone:"warning"})},onAttemptError:function(g){console.error("Provider fetch attempt "+g.attempt+" failed",g.error)}});a=Array.isArray(u)?u.slice(0):[],Be(s,a),E.clear("providers")}catch(u){return console.error("Failed to load providers",u),this.log("getProviders error",u),i&&Array.isArray(i.data)&&i.data.length>0?(E.setState("providers",{message:"Using cached providers. Connection issue detected.",spinner:!1,disableSelect:!1,tone:"warning",showRetry:!!p,onRetry:p}),E.showWarning("providers",ye(i.timestamp)),i.data):(E.setState("providers",{message:"Network error. Please check connection and try again.",spinner:!1,disableSelect:!0,tone:"error",showRetry:!!p,onRetry:p}),E.showWarning("providers",""),[])}}else i&&(a=i.data,E.clear("providers"));let d=Array.isArray(a)?a:[];return this.log("getProviders",d),E.showWarning("providers",""),d},getPairs:async function(n,r){this.setupNetworkStatusElements();let s=r||{};if(!n)return[];let i="getPairs_"+n,a=ze(i),h=!!s.forceRefresh,c=this.retryCallbacks&&typeof this.retryCallbacks.pairs=="function"?this.retryCallbacks.pairs:null,p=a?a.data:null,d=h||!a;if(d){E.setState("pairs",{message:E.config.pairs.loadingMessage,spinner:!0,disableSelect:!0});let g=this.resolveProviderModule(n);if(g&&typeof g.getPairs=="function")try{p=await g.getPairs()}catch(b){console.error("Error fetching direct pairs for provider "+n,b),this.log("Error fetching direct pairs",b),p=null}if(!Array.isArray(p)||p.length===0){let b=re+"/api/Ticker/json/symbols?provider="+encodeURIComponent(n);try{p=await Ne(b,{attempts:we,timeout:me,retryBaseDelay:Ee,onAttemptStart:function(k){k.attempt===1?E.setState("pairs",{message:E.config.pairs.loadingMessage,spinner:!0,disableSelect:!0}):E.setState("pairs",{message:E.config.pairs.retryMessage,spinner:!0,disableSelect:!0,tone:"warning"})},onAttemptError:function(k){console.error("Pairs fetch attempt "+k.attempt+" failed",k.error)}})}catch(P){return console.error("Error fetching pairs from proxy for provider "+n,P),this.log("Error fetching pairs from proxy",P),a&&Array.isArray(a.data)&&a.data.length>0?(E.setState("pairs",{message:"Using cached pairs. Connection issue detected.",spinner:!1,disableSelect:!1,tone:"warning",showRetry:!!c,onRetry:c}),E.showWarning("pairs",ye(a.timestamp)),a.data):(E.setState("pairs",{message:"Network error. Please check connection and try again.",spinner:!1,disableSelect:!0,tone:"error",showRetry:!!c,onRetry:c}),E.showWarning("pairs",""),[])}}}else if(a)return E.clear("pairs"),E.showWarning("pairs",""),a.data;let u=Yr(p);if(u.length>0)Be(i,u);else if(a&&Array.isArray(a.data)&&a.data.length>0&&d)return E.setState("pairs",{message:"Using cached pairs. Connection issue detected.",spinner:!1,disableSelect:!1,tone:"warning",showRetry:!!c,onRetry:c}),E.showWarning("pairs",ye(a.timestamp)),a.data;return this.log("getPairs",u),E.clear("pairs"),E.showWarning("pairs",""),u},resolveProviderModule:function(n){return typeof n!="string"?null:typeof CryptoTickerPIProviders!="undefined"&&CryptoTickerPIProviders.getProvider?CryptoTickerPIProviders.getProvider(n):null},initCurrenciesDropDown:async function(){this.setupNetworkStatusElements(),await this.populateCurrenciesDropdown(),this.refreshValues()},getCurrencies:async function(n){this.setupNetworkStatusElements();let r=n||{},s="getCurrencies",i=ze(s),a=i?i.data:null,c=!!r.forceRefresh||!i,p=this.retryCallbacks&&typeof this.retryCallbacks.currencies=="function"?this.retryCallbacks.currencies:null;if(c){E.setState("currencies",{message:E.config.currencies.loadingMessage,spinner:!0,disableSelect:!0});try{let u=await Ne(re+"/api/Ticker/json/currencies",{attempts:we,timeout:me,retryBaseDelay:Ee,onAttemptStart:function(g){g.attempt===1?E.setState("currencies",{message:E.config.currencies.loadingMessage,spinner:!0,disableSelect:!0}):E.setState("currencies",{message:E.config.currencies.retryMessage,spinner:!0,disableSelect:!0,tone:"warning"})},onAttemptError:function(g){console.error("Currencies fetch attempt "+g.attempt+" failed",g.error)}});a=Array.isArray(u)?u.slice(0):[],Be(s,a),E.clear("currencies")}catch(u){return console.error("Failed to load currencies",u),this.log("getCurrencies error",u),i&&Array.isArray(i.data)&&i.data.length>0?(E.setState("currencies",{message:"Using cached currencies. Connection issue detected.",spinner:!1,disableSelect:!1,tone:"warning",showRetry:!!p,onRetry:p}),E.showWarning("currencies",ye(i.timestamp)),i.data):(E.setState("currencies",{message:"Network error. Please check connection and try again.",spinner:!1,disableSelect:!0,tone:"error",showRetry:!!p,onRetry:p}),E.showWarning("currencies",""),[])}}else if(i)return E.clear("currencies"),E.showWarning("currencies",""),i.data;let d=Array.isArray(a)?a:[];return this.log("getCurrencies",d),E.showWarning("currencies",""),d},removeAllOptions:function(n){var r,s=n.options.length-1;for(r=s;r>=0;r--)n.remove(r)},extractSettings:function(n){this.log("extractSettings",n);let r=n?Object.assign({},n):{},s=this.splitPairValue(r.pair);if(s)for(let i in s)Object.prototype.hasOwnProperty.call(s,i)&&(r[i]=s[i]);Fe(r),this.refreshValues(),this.displayExpressionErrors({})},checkNewSettings:function(){this.log("checkNewSettings");for(let s in O){let i=O[s];i.getValue?F[s]=i.getValue()||i.default:i.value&&(F[s]=i.value.value||i.default)}let n=Fe(F),r=this.validateRuleExpressions(n);if(this.displayExpressionErrors(r.errors),r.hasErrors){this.log("Expression validation failed",r.errors);return}this.saveSettings()},refreshValues:function(){if(this.log("refreshValues"),ve!==F.exchange){this.initPairsDropDown();return}for(let n in O){let r=O[n];r.setValue?r.setValue(F[n]):r.value&&(r.value.value=F[n])}this.syncPairSelectionDisplay(),this.refreshMenus()},refreshMenus:function(){F&&F.pair&&F.pair.indexOf("USD")>=0?this.applyDisplay(Ct,"block"):(this.applyDisplay(Ct,"none"),O.currency.value.value="USD")},applyDisplay:function(n,r){if(n)for(let s=0;s<n.length;s++)n[s].style.display=r},splitPairValue:function(n){if(n&&n.indexOf("|")>=0){let r=n.split("|");return{pair:r[1],exchange:r[0].toUpperCase()}}return null},saveSettings:function(){if(this.log("saveSettings",F),Fe(F),Y&&Y.readyState===1){let n={event:"setSettings",context:Le,payload:F};Y.send(JSON.stringify(n));let r={action:Ue.action,event:"sendToPlugin",context:Le,payload:F};Y.send(JSON.stringify(r))}}};Ot.initDom();function Qr(n,r,s,i,a){Le=r,Ue=JSON.parse(a);let h=JSON.parse(i);Y=new WebSocket("ws://127.0.0.1:"+n),Ot.extractSettings(Ue.payload.settings),Y.onopen=function(){let c={event:s,uuid:r,info:h};Y.send(JSON.stringify(c))},Y.onmessage=function(c){JSON.parse(c.data)}}typeof window!="undefined"&&(window.connectElgatoStreamDeckSocket=Qr);})();
