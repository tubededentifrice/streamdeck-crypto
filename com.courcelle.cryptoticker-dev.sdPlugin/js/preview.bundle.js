"use strict";(()=>{var br=Object.create;var ln=Object.defineProperty;var yr=Object.getOwnPropertyDescriptor;var mr=Object.getOwnPropertyNames;var vr=Object.getPrototypeOf,Cr=Object.prototype.hasOwnProperty;var ze=(n=>typeof require!="undefined"?require:typeof Proxy!="undefined"?new Proxy(n,{get:(t,a)=>(typeof require!="undefined"?require:t)[a]}):n)(function(n){if(typeof require!="undefined")return require.apply(this,arguments);throw Error('Dynamic require of "'+n+'" is not supported')});var ue=(n,t)=>()=>(t||n((t={exports:{}}).exports,t),t.exports);var wr=(n,t,a,h)=>{if(t&&typeof t=="object"||typeof t=="function")for(let c of mr(t))!Cr.call(n,c)&&c!==a&&ln(n,c,{get:()=>t[c],enumerable:!(h=yr(t,c))||h.enumerable});return n};var be=(n,t,a)=>(a=n!=null?br(vr(n)):{},wr(t||!n||!n.__esModule?ln(a,"default",{value:n,enumerable:!0}):a,n));var hn=ue((St,zt)=>{"use strict";var un,bt;un=self,bt=()=>(()=>{var n={d:(A,e)=>{for(var o in e)n.o(e,o)&&!n.o(A,o)&&Object.defineProperty(A,o,{enumerable:!0,get:e[o]})}};n.g=function(){if(typeof globalThis=="object")return globalThis;try{return this||new Function("return this")()}catch{if(typeof window=="object")return window}}(),n.o=(A,e)=>Object.prototype.hasOwnProperty.call(A,e),n.r=A=>{typeof Symbol!="undefined"&&Symbol.toStringTag&&Object.defineProperty(A,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(A,"t",{value:!0})};var t,a={};n.r(a),n.d(a,{AbortError:()=>i,DefaultHttpClient:()=>$,HttpClient:()=>f,HttpError:()=>h,HttpResponse:()=>u,HttpTransportType:()=>Z,HubConnection:()=>fe,HubConnectionBuilder:()=>_e,HubConnectionState:()=>q,JsonHubProtocol:()=>pe,LogLevel:()=>t,MessageType:()=>F,NullLogger:()=>k,Subject:()=>ve,TimeoutError:()=>c,TransferFormat:()=>ne,VERSION:()=>d});class h extends Error{constructor(e,o){let b=new.target.prototype;super(`${e}: Status code '${o}'`),this.statusCode=o,this.__proto__=b}}class c extends Error{constructor(e="A timeout occurred."){let o=new.target.prototype;super(e),this.__proto__=o}}class i extends Error{constructor(e="An abort occurred."){let o=new.target.prototype;super(e),this.__proto__=o}}class p extends Error{constructor(e,o){let b=new.target.prototype;super(e),this.transport=o,this.errorType="UnsupportedTransportError",this.__proto__=b}}class v extends Error{constructor(e,o){let b=new.target.prototype;super(e),this.transport=o,this.errorType="DisabledTransportError",this.__proto__=b}}class T extends Error{constructor(e,o){let b=new.target.prototype;super(e),this.transport=o,this.errorType="FailedToStartTransportError",this.__proto__=b}}class x extends Error{constructor(e){let o=new.target.prototype;super(e),this.errorType="FailedToNegotiateWithServerError",this.__proto__=o}}class y extends Error{constructor(e,o){let b=new.target.prototype;super(e),this.innerErrors=o,this.__proto__=b}}class u{constructor(e,o,b){this.statusCode=e,this.statusText=o,this.content=b}}class f{get(e,o){return this.send({...o,method:"GET",url:e})}post(e,o){return this.send({...o,method:"POST",url:e})}delete(e,o){return this.send({...o,method:"DELETE",url:e})}getCookieString(e){return""}}(function(A){A[A.Trace=0]="Trace",A[A.Debug=1]="Debug",A[A.Information=2]="Information",A[A.Warning=3]="Warning",A[A.Error=4]="Error",A[A.Critical=5]="Critical",A[A.None=6]="None"})(t||(t={}));class k{constructor(){}log(e,o){}}k.instance=new k;let d="8.0.0";class P{static isRequired(e,o){if(e==null)throw new Error(`The '${o}' argument is required.`)}static isNotEmpty(e,o){if(!e||e.match(/^\s*$/))throw new Error(`The '${o}' argument should not be empty.`)}static isIn(e,o,b){if(!(e in o))throw new Error(`Unknown ${b} value: ${e}.`)}}class l{static get isBrowser(){return!l.isNode&&typeof window=="object"&&typeof window.document=="object"}static get isWebWorker(){return!l.isNode&&typeof self=="object"&&"importScripts"in self}static get isReactNative(){return!l.isNode&&typeof window=="object"&&window.document===void 0}static get isNode(){return typeof process!="undefined"&&process.release&&process.release.name==="node"}}function g(A,e){let o="";return S(A)?(o=`Binary data of length ${A.byteLength}`,e&&(o+=`. Content: '${function(b){let w=new Uint8Array(b),M="";return w.forEach(D=>{M+=`0x${D<16?"0":""}${D.toString(16)} `}),M.substr(0,M.length-1)}(A)}'`)):typeof A=="string"&&(o=`String data of length ${A.length}`,e&&(o+=`. Content: '${A}'`)),o}function S(A){return A&&typeof ArrayBuffer!="undefined"&&(A instanceof ArrayBuffer||A.constructor&&A.constructor.name==="ArrayBuffer")}async function I(A,e,o,b,w,M){let D={},[j,L]=E();D[j]=L,A.log(t.Trace,`(${e} transport) sending data. ${g(w,M.logMessageContent)}.`);let K=S(w)?"arraybuffer":"text",se=await o.post(b,{content:w,headers:{...D,...M.headers},responseType:K,timeout:M.timeout,withCredentials:M.withCredentials});A.log(t.Trace,`(${e} transport) request complete. Response status: ${se.statusCode}.`)}class C{constructor(e,o){this.i=e,this.h=o}dispose(){let e=this.i.observers.indexOf(this.h);e>-1&&this.i.observers.splice(e,1),this.i.observers.length===0&&this.i.cancelCallback&&this.i.cancelCallback().catch(o=>{})}}class N{constructor(e){this.l=e,this.out=console}log(e,o){if(e>=this.l){let b=`[${new Date().toISOString()}] ${t[e]}: ${o}`;switch(e){case t.Critical:case t.Error:this.out.error(b);break;case t.Warning:this.out.warn(b);break;case t.Information:this.out.info(b);break;default:this.out.log(b)}}}}function E(){let A="X-SignalR-User-Agent";return l.isNode&&(A="User-Agent"),[A,B(d,z(),l.isNode?"NodeJS":"Browser",O())]}function B(A,e,o,b){let w="Microsoft SignalR/",M=A.split(".");return w+=`${M[0]}.${M[1]}`,w+=` (${A}; `,w+=e&&e!==""?`${e}; `:"Unknown OS; ",w+=`${o}`,w+=b?`; ${b}`:"; Unknown Runtime Version",w+=")",w}function z(){if(!l.isNode)return"";switch(process.platform){case"win32":return"Windows NT";case"darwin":return"macOS";case"linux":return"Linux";default:return process.platform}}function O(){if(l.isNode)return process.versions.node}function G(A){return A.stack?A.stack:A.message?A.message:`${A}`}class X extends f{constructor(e){super(),this.u=e,this.p=fetch.bind(function(){if(typeof globalThis!="undefined")return globalThis;if(typeof self!="undefined")return self;if(typeof window!="undefined")return window;if(n.g!==void 0)return n.g;throw new Error("could not find global")}()),this.m=AbortController,this.m}async send(e){if(e.abortSignal&&e.abortSignal.aborted)throw new i;if(!e.method)throw new Error("No method defined.");if(!e.url)throw new Error("No url defined.");let o=new this.m,b;e.abortSignal&&(e.abortSignal.onabort=()=>{o.abort(),b=new i});let w,M=null;if(e.timeout){let L=e.timeout;M=setTimeout(()=>{o.abort(),this.u.log(t.Warning,"Timeout from HTTP request."),b=new c},L)}e.content===""&&(e.content=void 0),e.content&&(e.headers=e.headers||{},S(e.content)?e.headers["Content-Type"]="application/octet-stream":e.headers["Content-Type"]="text/plain;charset=UTF-8");try{w=await this.p(e.url,{body:e.content,cache:"no-cache",credentials:e.withCredentials===!0?"include":"same-origin",headers:{"X-Requested-With":"XMLHttpRequest",...e.headers},method:e.method,mode:"cors",redirect:"follow",signal:o.signal})}catch(L){throw b||(this.u.log(t.Warning,`Error from HTTP request. ${L}.`),L)}finally{M&&clearTimeout(M),e.abortSignal&&(e.abortSignal.onabort=null)}if(!w.ok){let L=await V(w,"text");throw new h(L||w.statusText,w.status)}let D=V(w,e.responseType),j=await D;return new u(w.status,w.statusText,j)}getCookieString(e){let o="";return l.isNode&&this.v&&this.v.getCookies(e,(b,w)=>o=w.join("; ")),o}}function V(A,e){let o;switch(e){case"arraybuffer":o=A.arrayBuffer();break;case"text":default:o=A.text();break;case"blob":case"document":case"json":throw new Error(`${e} is not supported.`)}return o}class ee extends f{constructor(e){super(),this.u=e}send(e){return e.abortSignal&&e.abortSignal.aborted?Promise.reject(new i):e.method?e.url?new Promise((o,b)=>{let w=new XMLHttpRequest;w.open(e.method,e.url,!0),w.withCredentials=e.withCredentials===void 0||e.withCredentials,w.setRequestHeader("X-Requested-With","XMLHttpRequest"),e.content===""&&(e.content=void 0),e.content&&(S(e.content)?w.setRequestHeader("Content-Type","application/octet-stream"):w.setRequestHeader("Content-Type","text/plain;charset=UTF-8"));let M=e.headers;M&&Object.keys(M).forEach(D=>{w.setRequestHeader(D,M[D])}),e.responseType&&(w.responseType=e.responseType),e.abortSignal&&(e.abortSignal.onabort=()=>{w.abort(),b(new i)}),e.timeout&&(w.timeout=e.timeout),w.onload=()=>{e.abortSignal&&(e.abortSignal.onabort=null),w.status>=200&&w.status<300?o(new u(w.status,w.statusText,w.response||w.responseText)):b(new h(w.response||w.responseText||w.statusText,w.status))},w.onerror=()=>{this.u.log(t.Warning,`Error from HTTP request. ${w.status}: ${w.statusText}.`),b(new h(w.statusText,w.status))},w.ontimeout=()=>{this.u.log(t.Warning,"Timeout from HTTP request."),b(new c)},w.send(e.content)}):Promise.reject(new Error("No url defined.")):Promise.reject(new Error("No method defined."))}}class $ extends f{constructor(e){if(super(),typeof fetch!="undefined"||l.isNode)this.$=new X(e);else{if(typeof XMLHttpRequest=="undefined")throw new Error("No usable HttpClient found.");this.$=new ee(e)}}send(e){return e.abortSignal&&e.abortSignal.aborted?Promise.reject(new i):e.method?e.url?this.$.send(e):Promise.reject(new Error("No url defined.")):Promise.reject(new Error("No method defined."))}getCookieString(e){return this.$.getCookieString(e)}}class H{static write(e){return`${e}${H.RecordSeparator}`}static parse(e){if(e[e.length-1]!==H.RecordSeparator)throw new Error("Message is incomplete.");let o=e.split(H.RecordSeparator);return o.pop(),o}}H.RecordSeparatorCode=30,H.RecordSeparator=String.fromCharCode(H.RecordSeparatorCode);class he{writeHandshakeRequest(e){return H.write(JSON.stringify(e))}parseHandshakeResponse(e){let o,b;if(S(e)){let D=new Uint8Array(e),j=D.indexOf(H.RecordSeparatorCode);if(j===-1)throw new Error("Message is incomplete.");let L=j+1;o=String.fromCharCode.apply(null,Array.prototype.slice.call(D.slice(0,L))),b=D.byteLength>L?D.slice(L).buffer:null}else{let D=e,j=D.indexOf(H.RecordSeparator);if(j===-1)throw new Error("Message is incomplete.");let L=j+1;o=D.substring(0,L),b=D.length>L?D.substring(L):null}let w=H.parse(o),M=JSON.parse(w[0]);if(M.type)throw new Error("Expected a handshake response from the server.");return[b,M]}}var F,q;(function(A){A[A.Invocation=1]="Invocation",A[A.StreamItem=2]="StreamItem",A[A.Completion=3]="Completion",A[A.StreamInvocation=4]="StreamInvocation",A[A.CancelInvocation=5]="CancelInvocation",A[A.Ping=6]="Ping",A[A.Close=7]="Close",A[A.Ack=8]="Ack",A[A.Sequence=9]="Sequence"})(F||(F={}));class ve{constructor(){this.observers=[]}next(e){for(let o of this.observers)o.next(e)}error(e){for(let o of this.observers)o.error&&o.error(e)}complete(){for(let e of this.observers)e.complete&&e.complete()}subscribe(e){return this.observers.push(e),new C(this,e)}}class Se{constructor(e,o,b){this.C=1e5,this.S=[],this.k=0,this.P=!1,this.T=1,this.I=0,this._=0,this.H=!1,this.D=e,this.R=o,this.C=b}async A(e){let o=this.D.writeMessage(e),b=Promise.resolve();if(this.U(e)){this.k++;let w=()=>{},M=()=>{};S(o)?this._+=o.byteLength:this._+=o.length,this._>=this.C&&(b=new Promise((D,j)=>{w=D,M=j})),this.S.push(new ye(o,this.k,w,M))}try{this.H||await this.R.send(o)}catch{this.L()}await b}N(e){let o=-1;for(let b=0;b<this.S.length;b++){let w=this.S[b];if(w.q<=e.sequenceId)o=b,S(w.M)?this._-=w.M.byteLength:this._-=w.M.length,w.j();else{if(!(this._<this.C))break;w.j()}}o!==-1&&(this.S=this.S.slice(o+1))}W(e){if(this.P)return e.type===F.Sequence&&(this.P=!1,!0);if(!this.U(e))return!0;let o=this.T;return this.T++,o<=this.I?(o===this.I&&this.O(),!1):(this.I=o,this.O(),!0)}F(e){e.sequenceId>this.T?this.R.stop(new Error("Sequence ID greater than amount of messages we've received.")):this.T=e.sequenceId}L(){this.H=!0,this.P=!0}async B(){let e=this.S.length!==0?this.S[0].q:this.k+1;await this.R.send(this.D.writeMessage({type:F.Sequence,sequenceId:e}));let o=this.S;for(let b of o)await this.R.send(b.M);this.H=!1}X(e){e!=null||(e=new Error("Unable to reconnect to server."));for(let o of this.S)o.J(e)}U(e){switch(e.type){case F.Invocation:case F.StreamItem:case F.Completion:case F.StreamInvocation:case F.CancelInvocation:return!0;case F.Close:case F.Sequence:case F.Ping:case F.Ack:return!1}}O(){this.V===void 0&&(this.V=setTimeout(async()=>{try{this.H||await this.R.send(this.D.writeMessage({type:F.Ack,sequenceId:this.I}))}catch{}clearTimeout(this.V),this.V=void 0},1e3))}}class ye{constructor(e,o,b,w){this.M=e,this.q=o,this.j=b,this.J=w}}(function(A){A.Disconnected="Disconnected",A.Connecting="Connecting",A.Connected="Connected",A.Disconnecting="Disconnecting",A.Reconnecting="Reconnecting"})(q||(q={}));class fe{static create(e,o,b,w,M,D,j){return new fe(e,o,b,w,M,D,j)}constructor(e,o,b,w,M,D,j){this.K=0,this.G=()=>{this.u.log(t.Warning,"The page is being frozen, this will likely lead to the connection being closed and messages being lost. For more information see the docs at https://learn.microsoft.com/aspnet/core/signalr/javascript-client#bsleep")},P.isRequired(e,"connection"),P.isRequired(o,"logger"),P.isRequired(b,"protocol"),this.serverTimeoutInMilliseconds=M!=null?M:3e4,this.keepAliveIntervalInMilliseconds=D!=null?D:15e3,this.Y=j!=null?j:1e5,this.u=o,this.D=b,this.connection=e,this.Z=w,this.tt=new he,this.connection.onreceive=L=>this.et(L),this.connection.onclose=L=>this.st(L),this.it={},this.nt={},this.rt=[],this.ot=[],this.ht=[],this.ct=0,this.lt=!1,this.ut=q.Disconnected,this.dt=!1,this.ft=this.D.writeMessage({type:F.Ping})}get state(){return this.ut}get connectionId(){return this.connection&&this.connection.connectionId||null}get baseUrl(){return this.connection.baseUrl||""}set baseUrl(e){if(this.ut!==q.Disconnected&&this.ut!==q.Reconnecting)throw new Error("The HubConnection must be in the Disconnected or Reconnecting state to change the url.");if(!e)throw new Error("The HubConnection url must be a valid url.");this.connection.baseUrl=e}start(){return this.wt=this.gt(),this.wt}async gt(){if(this.ut!==q.Disconnected)return Promise.reject(new Error("Cannot start a HubConnection that is not in the 'Disconnected' state."));this.ut=q.Connecting,this.u.log(t.Debug,"Starting HubConnection.");try{await this.yt(),l.isBrowser&&window.document.addEventListener("freeze",this.G),this.ut=q.Connected,this.dt=!0,this.u.log(t.Debug,"HubConnection connected successfully.")}catch(e){return this.ut=q.Disconnected,this.u.log(t.Debug,`HubConnection failed to start successfully because of error '${e}'.`),Promise.reject(e)}}async yt(){this.bt=void 0,this.lt=!1;let e=new Promise((o,b)=>{this.vt=o,this.Et=b});await this.connection.start(this.D.transferFormat);try{let o=this.D.version;this.connection.features.reconnect||(o=1);let b={protocol:this.D.name,version:o};if(this.u.log(t.Debug,"Sending handshake request."),await this.$t(this.tt.writeHandshakeRequest(b)),this.u.log(t.Information,`Using HubProtocol '${this.D.name}'.`),this.Ct(),this.St(),this.kt(),await e,this.bt)throw this.bt;this.connection.features.reconnect&&(this.Pt=new Se(this.D,this.connection,this.Y),this.connection.features.disconnected=this.Pt.L.bind(this.Pt),this.connection.features.resend=()=>{if(this.Pt)return this.Pt.B()}),this.connection.features.inherentKeepAlive||await this.$t(this.ft)}catch(o){throw this.u.log(t.Debug,`Hub handshake failed with error '${o}' during start(). Stopping HubConnection.`),this.Ct(),this.Tt(),await this.connection.stop(o),o}}async stop(){let e=this.wt;this.connection.features.reconnect=!1,this.It=this._t(),await this.It;try{await e}catch{}}_t(e){if(this.ut===q.Disconnected)return this.u.log(t.Debug,`Call to HubConnection.stop(${e}) ignored because it is already in the disconnected state.`),Promise.resolve();if(this.ut===q.Disconnecting)return this.u.log(t.Debug,`Call to HttpConnection.stop(${e}) ignored because the connection is already in the disconnecting state.`),this.It;let o=this.ut;return this.ut=q.Disconnecting,this.u.log(t.Debug,"Stopping HubConnection."),this.Ht?(this.u.log(t.Debug,"Connection stopped during reconnect delay. Done reconnecting."),clearTimeout(this.Ht),this.Ht=void 0,this.Dt(),Promise.resolve()):(o===q.Connected&&this.Rt(),this.Ct(),this.Tt(),this.bt=e||new i("The connection was stopped before the hub handshake could complete."),this.connection.stop(e))}async Rt(){try{await this.xt(this.At())}catch{}}stream(e,...o){let[b,w]=this.Ut(o),M=this.Lt(e,o,w),D,j=new ve;return j.cancelCallback=()=>{let L=this.Nt(M.invocationId);return delete this.it[M.invocationId],D.then(()=>this.xt(L))},this.it[M.invocationId]=(L,K)=>{K?j.error(K):L&&(L.type===F.Completion?L.error?j.error(new Error(L.error)):j.complete():j.next(L.item))},D=this.xt(M).catch(L=>{j.error(L),delete this.it[M.invocationId]}),this.qt(b,D),j}$t(e){return this.kt(),this.connection.send(e)}xt(e){return this.Pt?this.Pt.A(e):this.$t(this.D.writeMessage(e))}send(e,...o){let[b,w]=this.Ut(o),M=this.xt(this.Mt(e,o,!0,w));return this.qt(b,M),M}invoke(e,...o){let[b,w]=this.Ut(o),M=this.Mt(e,o,!1,w);return new Promise((D,j)=>{this.it[M.invocationId]=(K,se)=>{se?j(se):K&&(K.type===F.Completion?K.error?j(new Error(K.error)):D(K.result):j(new Error(`Unexpected message type: ${K.type}`)))};let L=this.xt(M).catch(K=>{j(K),delete this.it[M.invocationId]});this.qt(b,L)})}on(e,o){e&&o&&(e=e.toLowerCase(),this.nt[e]||(this.nt[e]=[]),this.nt[e].indexOf(o)===-1&&this.nt[e].push(o))}off(e,o){if(!e)return;e=e.toLowerCase();let b=this.nt[e];if(b)if(o){let w=b.indexOf(o);w!==-1&&(b.splice(w,1),b.length===0&&delete this.nt[e])}else delete this.nt[e]}onclose(e){e&&this.rt.push(e)}onreconnecting(e){e&&this.ot.push(e)}onreconnected(e){e&&this.ht.push(e)}et(e){if(this.Ct(),this.lt||(e=this.jt(e),this.lt=!0),e){let o=this.D.parseMessages(e,this.u);for(let b of o)if(!this.Pt||this.Pt.W(b))switch(b.type){case F.Invocation:this.Wt(b);break;case F.StreamItem:case F.Completion:{let w=this.it[b.invocationId];if(w){b.type===F.Completion&&delete this.it[b.invocationId];try{w(b)}catch(M){this.u.log(t.Error,`Stream callback threw error: ${G(M)}`)}}break}case F.Ping:break;case F.Close:{this.u.log(t.Information,"Close message received from server.");let w=b.error?new Error("Server returned an error on close: "+b.error):void 0;b.allowReconnect===!0?this.connection.stop(w):this.It=this._t(w);break}case F.Ack:this.Pt&&this.Pt.N(b);break;case F.Sequence:this.Pt&&this.Pt.F(b);break;default:this.u.log(t.Warning,`Invalid message type: ${b.type}.`)}}this.St()}jt(e){let o,b;try{[b,o]=this.tt.parseHandshakeResponse(e)}catch(w){let M="Error parsing handshake response: "+w;this.u.log(t.Error,M);let D=new Error(M);throw this.Et(D),D}if(o.error){let w="Server returned handshake error: "+o.error;this.u.log(t.Error,w);let M=new Error(w);throw this.Et(M),M}return this.u.log(t.Debug,"Server handshake complete."),this.vt(),b}kt(){this.connection.features.inherentKeepAlive||(this.K=new Date().getTime()+this.keepAliveIntervalInMilliseconds,this.Tt())}St(){if(!(this.connection.features&&this.connection.features.inherentKeepAlive||(this.Ot=setTimeout(()=>this.serverTimeout(),this.serverTimeoutInMilliseconds),this.Ft!==void 0))){let e=this.K-new Date().getTime();e<0&&(e=0),this.Ft=setTimeout(async()=>{if(this.ut===q.Connected)try{await this.$t(this.ft)}catch{this.Tt()}},e)}}serverTimeout(){this.connection.stop(new Error("Server timeout elapsed without receiving a message from the server."))}async Wt(e){let o=e.target.toLowerCase(),b=this.nt[o];if(!b)return this.u.log(t.Warning,`No client method with the name '${o}' found.`),void(e.invocationId&&(this.u.log(t.Warning,`No result given for '${o}' method and invocation ID '${e.invocationId}'.`),await this.xt(this.Bt(e.invocationId,"Client didn't provide a result.",null))));let w=b.slice(),M=!!e.invocationId,D,j,L;for(let K of w)try{let se=D;D=await K.apply(this,e.arguments),M&&D&&se&&(this.u.log(t.Error,`Multiple results provided for '${o}'. Sending error to server.`),L=this.Bt(e.invocationId,"Client provided multiple results.",null)),j=void 0}catch(se){j=se,this.u.log(t.Error,`A callback for the method '${o}' threw error '${se}'.`)}L?await this.xt(L):M?(j?L=this.Bt(e.invocationId,`${j}`,null):D!==void 0?L=this.Bt(e.invocationId,null,D):(this.u.log(t.Warning,`No result given for '${o}' method and invocation ID '${e.invocationId}'.`),L=this.Bt(e.invocationId,"Client didn't provide a result.",null)),await this.xt(L)):D&&this.u.log(t.Error,`Result given for '${o}' method but server is not expecting a result.`)}st(e){this.u.log(t.Debug,`HubConnection.connectionClosed(${e}) called while in state ${this.ut}.`),this.bt=this.bt||e||new i("The underlying connection was closed before the hub handshake could complete."),this.vt&&this.vt(),this.Xt(e||new Error("Invocation canceled due to the underlying connection being closed.")),this.Ct(),this.Tt(),this.ut===q.Disconnecting?this.Dt(e):this.ut===q.Connected&&this.Z?this.Jt(e):this.ut===q.Connected&&this.Dt(e)}Dt(e){if(this.dt){this.ut=q.Disconnected,this.dt=!1,this.Pt&&(this.Pt.X(e!=null?e:new Error("Connection closed.")),this.Pt=void 0),l.isBrowser&&window.document.removeEventListener("freeze",this.G);try{this.rt.forEach(o=>o.apply(this,[e]))}catch(o){this.u.log(t.Error,`An onclose callback called with error '${e}' threw error '${o}'.`)}}}async Jt(e){let o=Date.now(),b=0,w=e!==void 0?e:new Error("Attempting to reconnect due to a unknown error."),M=this.zt(b++,0,w);if(M===null)return this.u.log(t.Debug,"Connection not reconnecting because the IRetryPolicy returned null on the first reconnect attempt."),void this.Dt(e);if(this.ut=q.Reconnecting,e?this.u.log(t.Information,`Connection reconnecting because of error '${e}'.`):this.u.log(t.Information,"Connection reconnecting."),this.ot.length!==0){try{this.ot.forEach(D=>D.apply(this,[e]))}catch(D){this.u.log(t.Error,`An onreconnecting callback called with error '${e}' threw error '${D}'.`)}if(this.ut!==q.Reconnecting)return void this.u.log(t.Debug,"Connection left the reconnecting state in onreconnecting callback. Done reconnecting.")}for(;M!==null;){if(this.u.log(t.Information,`Reconnect attempt number ${b} will start in ${M} ms.`),await new Promise(D=>{this.Ht=setTimeout(D,M)}),this.Ht=void 0,this.ut!==q.Reconnecting)return void this.u.log(t.Debug,"Connection left the reconnecting state during reconnect delay. Done reconnecting.");try{if(await this.yt(),this.ut=q.Connected,this.u.log(t.Information,"HubConnection reconnected successfully."),this.ht.length!==0)try{this.ht.forEach(D=>D.apply(this,[this.connection.connectionId]))}catch(D){this.u.log(t.Error,`An onreconnected callback called with connectionId '${this.connection.connectionId}; threw error '${D}'.`)}return}catch(D){if(this.u.log(t.Information,`Reconnect attempt failed because of error '${D}'.`),this.ut!==q.Reconnecting)return this.u.log(t.Debug,`Connection moved to the '${this.ut}' from the reconnecting state during reconnect attempt. Done reconnecting.`),void(this.ut===q.Disconnecting&&this.Dt());w=D instanceof Error?D:new Error(D.toString()),M=this.zt(b++,Date.now()-o,w)}}this.u.log(t.Information,`Reconnect retries have been exhausted after ${Date.now()-o} ms and ${b} failed attempts. Connection disconnecting.`),this.Dt()}zt(e,o,b){try{return this.Z.nextRetryDelayInMilliseconds({elapsedMilliseconds:o,previousRetryCount:e,retryReason:b})}catch(w){return this.u.log(t.Error,`IRetryPolicy.nextRetryDelayInMilliseconds(${e}, ${o}) threw error '${w}'.`),null}}Xt(e){let o=this.it;this.it={},Object.keys(o).forEach(b=>{let w=o[b];try{w(null,e)}catch(M){this.u.log(t.Error,`Stream 'error' callback called with '${e}' threw error: ${G(M)}`)}})}Tt(){this.Ft&&(clearTimeout(this.Ft),this.Ft=void 0)}Ct(){this.Ot&&clearTimeout(this.Ot)}Mt(e,o,b,w){if(b)return w.length!==0?{arguments:o,streamIds:w,target:e,type:F.Invocation}:{arguments:o,target:e,type:F.Invocation};{let M=this.ct;return this.ct++,w.length!==0?{arguments:o,invocationId:M.toString(),streamIds:w,target:e,type:F.Invocation}:{arguments:o,invocationId:M.toString(),target:e,type:F.Invocation}}}qt(e,o){if(e.length!==0){o||(o=Promise.resolve());for(let b in e)e[b].subscribe({complete:()=>{o=o.then(()=>this.xt(this.Bt(b)))},error:w=>{let M;M=w instanceof Error?w.message:w&&w.toString?w.toString():"Unknown error",o=o.then(()=>this.xt(this.Bt(b,M)))},next:w=>{o=o.then(()=>this.xt(this.Vt(b,w)))}})}}Ut(e){let o=[],b=[];for(let w=0;w<e.length;w++){let M=e[w];if(this.Kt(M)){let D=this.ct;this.ct++,o[D]=M,b.push(D.toString()),e.splice(w,1)}}return[o,b]}Kt(e){return e&&e.subscribe&&typeof e.subscribe=="function"}Lt(e,o,b){let w=this.ct;return this.ct++,b.length!==0?{arguments:o,invocationId:w.toString(),streamIds:b,target:e,type:F.StreamInvocation}:{arguments:o,invocationId:w.toString(),target:e,type:F.StreamInvocation}}Nt(e){return{invocationId:e,type:F.CancelInvocation}}Vt(e,o){return{invocationId:e,item:o,type:F.StreamItem}}Bt(e,o,b){return o?{error:o,invocationId:e,type:F.Completion}:{invocationId:e,result:b,type:F.Completion}}At(){return{type:F.Close}}}let te=[0,2e3,1e4,3e4,null];class Ee{constructor(e){this.Gt=e!==void 0?[...e,null]:te}nextRetryDelayInMilliseconds(e){return this.Gt[e.previousRetryCount]}}class Q{}Q.Authorization="Authorization",Q.Cookie="Cookie";class xe extends f{constructor(e,o){super(),this.Qt=e,this.Yt=o}async send(e){let o=!0;this.Yt&&(!this.Zt||e.url&&e.url.indexOf("/negotiate?")>0)&&(o=!1,this.Zt=await this.Yt()),this.te(e);let b=await this.Qt.send(e);return o&&b.statusCode===401&&this.Yt?(this.Zt=await this.Yt(),this.te(e),await this.Qt.send(e)):b}te(e){e.headers||(e.headers={}),this.Zt?e.headers[Q.Authorization]=`Bearer ${this.Zt}`:this.Yt&&e.headers[Q.Authorization]&&delete e.headers[Q.Authorization]}getCookieString(e){return this.Qt.getCookieString(e)}}var Z,ne;(function(A){A[A.None=0]="None",A[A.WebSockets=1]="WebSockets",A[A.ServerSentEvents=2]="ServerSentEvents",A[A.LongPolling=4]="LongPolling"})(Z||(Z={})),function(A){A[A.Text=1]="Text",A[A.Binary=2]="Binary"}(ne||(ne={}));class Ue{constructor(){this.ee=!1,this.onabort=null}abort(){this.ee||(this.ee=!0,this.onabort&&this.onabort())}get signal(){return this}get aborted(){return this.ee}}class Be{get pollAborted(){return this.se.aborted}constructor(e,o,b){this.$=e,this.u=o,this.se=new Ue,this.ie=b,this.ne=!1,this.onreceive=null,this.onclose=null}async connect(e,o){if(P.isRequired(e,"url"),P.isRequired(o,"transferFormat"),P.isIn(o,ne,"transferFormat"),this.re=e,this.u.log(t.Trace,"(LongPolling transport) Connecting."),o===ne.Binary&&typeof XMLHttpRequest!="undefined"&&typeof new XMLHttpRequest().responseType!="string")throw new Error("Binary protocols over XmlHttpRequest not implementing advanced features are not supported.");let[b,w]=E(),M={[b]:w,...this.ie.headers},D={abortSignal:this.se.signal,headers:M,timeout:1e5,withCredentials:this.ie.withCredentials};o===ne.Binary&&(D.responseType="arraybuffer");let j=`${e}&_=${Date.now()}`;this.u.log(t.Trace,`(LongPolling transport) polling: ${j}.`);let L=await this.$.get(j,D);L.statusCode!==200?(this.u.log(t.Error,`(LongPolling transport) Unexpected response code: ${L.statusCode}.`),this.oe=new h(L.statusText||"",L.statusCode),this.ne=!1):this.ne=!0,this.he=this.ce(this.re,D)}async ce(e,o){try{for(;this.ne;)try{let b=`${e}&_=${Date.now()}`;this.u.log(t.Trace,`(LongPolling transport) polling: ${b}.`);let w=await this.$.get(b,o);w.statusCode===204?(this.u.log(t.Information,"(LongPolling transport) Poll terminated by server."),this.ne=!1):w.statusCode!==200?(this.u.log(t.Error,`(LongPolling transport) Unexpected response code: ${w.statusCode}.`),this.oe=new h(w.statusText||"",w.statusCode),this.ne=!1):w.content?(this.u.log(t.Trace,`(LongPolling transport) data received. ${g(w.content,this.ie.logMessageContent)}.`),this.onreceive&&this.onreceive(w.content)):this.u.log(t.Trace,"(LongPolling transport) Poll timed out, reissuing.")}catch(b){this.ne?b instanceof c?this.u.log(t.Trace,"(LongPolling transport) Poll timed out, reissuing."):(this.oe=b,this.ne=!1):this.u.log(t.Trace,`(LongPolling transport) Poll errored after shutdown: ${b.message}`)}}finally{this.u.log(t.Trace,"(LongPolling transport) Polling complete."),this.pollAborted||this.ae()}}async send(e){return this.ne?I(this.u,"LongPolling",this.$,this.re,e,this.ie):Promise.reject(new Error("Cannot send until the transport is connected"))}async stop(){this.u.log(t.Trace,"(LongPolling transport) Stopping polling."),this.ne=!1,this.se.abort();try{await this.he,this.u.log(t.Trace,`(LongPolling transport) sending DELETE request to ${this.re}.`);let e={},[o,b]=E();e[o]=b;let w={headers:{...e,...this.ie.headers},timeout:this.ie.timeout,withCredentials:this.ie.withCredentials},M;try{await this.$.delete(this.re,w)}catch(D){M=D}M?M instanceof h&&(M.statusCode===404?this.u.log(t.Trace,"(LongPolling transport) A 404 response was returned from sending a DELETE request."):this.u.log(t.Trace,`(LongPolling transport) Error sending a DELETE request: ${M}`)):this.u.log(t.Trace,"(LongPolling transport) DELETE request accepted.")}finally{this.u.log(t.Trace,"(LongPolling transport) Stop finished."),this.ae()}}ae(){if(this.onclose){let e="(LongPolling transport) Firing onclose event.";this.oe&&(e+=" Error: "+this.oe),this.u.log(t.Trace,e),this.onclose(this.oe)}}}class Le{constructor(e,o,b,w){this.$=e,this.Zt=o,this.u=b,this.ie=w,this.onreceive=null,this.onclose=null}async connect(e,o){return P.isRequired(e,"url"),P.isRequired(o,"transferFormat"),P.isIn(o,ne,"transferFormat"),this.u.log(t.Trace,"(SSE transport) Connecting."),this.re=e,this.Zt&&(e+=(e.indexOf("?")<0?"?":"&")+`access_token=${encodeURIComponent(this.Zt)}`),new Promise((b,w)=>{let M,D=!1;if(o===ne.Text){if(l.isBrowser||l.isWebWorker)M=new this.ie.EventSource(e,{withCredentials:this.ie.withCredentials});else{let j=this.$.getCookieString(e),L={};L.Cookie=j;let[K,se]=E();L[K]=se,M=new this.ie.EventSource(e,{withCredentials:this.ie.withCredentials,headers:{...L,...this.ie.headers}})}try{M.onmessage=j=>{if(this.onreceive)try{this.u.log(t.Trace,`(SSE transport) data received. ${g(j.data,this.ie.logMessageContent)}.`),this.onreceive(j.data)}catch(L){return void this.le(L)}},M.onerror=j=>{D?this.le():w(new Error("EventSource failed to connect. The connection could not be found on the server, either the connection ID is not present on the server, or a proxy is refusing/buffering the connection. If you have multiple servers check that sticky sessions are enabled."))},M.onopen=()=>{this.u.log(t.Information,`SSE connected to ${this.re}`),this.ue=M,D=!0,b()}}catch(j){return void w(j)}}else w(new Error("The Server-Sent Events transport only supports the 'Text' transfer format"))})}async send(e){return this.ue?I(this.u,"SSE",this.$,this.re,e,this.ie):Promise.reject(new Error("Cannot send until the transport is connected"))}stop(){return this.le(),Promise.resolve()}le(e){this.ue&&(this.ue.close(),this.ue=void 0,this.onclose&&this.onclose(e))}}class Re{constructor(e,o,b,w,M,D){this.u=b,this.Yt=o,this.de=w,this.fe=M,this.$=e,this.onreceive=null,this.onclose=null,this.pe=D}async connect(e,o){let b;return P.isRequired(e,"url"),P.isRequired(o,"transferFormat"),P.isIn(o,ne,"transferFormat"),this.u.log(t.Trace,"(WebSockets transport) Connecting."),this.Yt&&(b=await this.Yt()),new Promise((w,M)=>{let D;e=e.replace(/^http/,"ws");let j=this.$.getCookieString(e),L=!1;if(l.isNode||l.isReactNative){let K={},[se,ke]=E();K[se]=ke,b&&(K[Q.Authorization]=`Bearer ${b}`),j&&(K[Q.Cookie]=j),D=new this.fe(e,void 0,{headers:{...K,...this.pe}})}else b&&(e+=(e.indexOf("?")<0?"?":"&")+`access_token=${encodeURIComponent(b)}`);D||(D=new this.fe(e)),o===ne.Binary&&(D.binaryType="arraybuffer"),D.onopen=K=>{this.u.log(t.Information,`WebSocket connected to ${e}.`),this.we=D,L=!0,w()},D.onerror=K=>{let se=null;se=typeof ErrorEvent!="undefined"&&K instanceof ErrorEvent?K.error:"There was an error with the transport",this.u.log(t.Information,`(WebSockets transport) ${se}.`)},D.onmessage=K=>{if(this.u.log(t.Trace,`(WebSockets transport) data received. ${g(K.data,this.de)}.`),this.onreceive)try{this.onreceive(K.data)}catch(se){return void this.le(se)}},D.onclose=K=>{if(L)this.le(K);else{let se=null;se=typeof ErrorEvent!="undefined"&&K instanceof ErrorEvent?K.error:"WebSocket failed to connect. The connection could not be found on the server, either the endpoint may not be a SignalR endpoint, the connection ID is not present on the server, or there is a proxy blocking WebSockets. If you have multiple servers check that sticky sessions are enabled.",M(new Error(se))}}})}send(e){return this.we&&this.we.readyState===this.fe.OPEN?(this.u.log(t.Trace,`(WebSockets transport) sending data. ${g(e,this.de)}.`),this.we.send(e),Promise.resolve()):Promise.reject("WebSocket is not in the OPEN state")}stop(){return this.we&&this.le(void 0),Promise.resolve()}le(e){this.we&&(this.we.onclose=()=>{},this.we.onmessage=()=>{},this.we.onerror=()=>{},this.we.close(),this.we=void 0),this.u.log(t.Trace,"(WebSockets transport) socket closed."),this.onclose&&(!this.ge(e)||e.wasClean!==!1&&e.code===1e3?e instanceof Error?this.onclose(e):this.onclose():this.onclose(new Error(`WebSocket closed with status code: ${e.code} (${e.reason||"no reason given"}).`)))}ge(e){return e&&typeof e.wasClean=="boolean"&&typeof e.code=="number"}}class Fe{constructor(e,o={}){var b;if(this.me=()=>{},this.features={},this.ye=1,P.isRequired(e,"url"),this.u=(b=o.logger)===void 0?new N(t.Information):b===null?k.instance:b.log!==void 0?b:new N(b),this.baseUrl=this.be(e),(o=o||{}).logMessageContent=o.logMessageContent!==void 0&&o.logMessageContent,typeof o.withCredentials!="boolean"&&o.withCredentials!==void 0)throw new Error("withCredentials option was not a 'boolean' or 'undefined' value");o.withCredentials=o.withCredentials===void 0||o.withCredentials,o.timeout=o.timeout===void 0?1e5:o.timeout;let w=null,M=null;l.isNode&&(w=function(){throw new Error("Trying to import 'ws' in the browser.")}(),M=function(){throw new Error("Trying to import 'eventsource' in the browser.")}()),l.isNode||typeof WebSocket=="undefined"||o.WebSocket?l.isNode&&!o.WebSocket&&w&&(o.WebSocket=w):o.WebSocket=WebSocket,l.isNode||typeof EventSource=="undefined"||o.EventSource?l.isNode&&!o.EventSource&&M!==void 0&&(o.EventSource=M):o.EventSource=EventSource,this.$=new xe(o.httpClient||new $(this.u),o.accessTokenFactory),this.ut="Disconnected",this.dt=!1,this.ie=o,this.onreceive=null,this.onclose=null}async start(e){if(e=e||ne.Binary,P.isIn(e,ne,"transferFormat"),this.u.log(t.Debug,`Starting connection with transfer format '${ne[e]}'.`),this.ut!=="Disconnected")return Promise.reject(new Error("Cannot start an HttpConnection that is not in the 'Disconnected' state."));if(this.ut="Connecting",this.ve=this.yt(e),await this.ve,this.ut==="Disconnecting"){let o="Failed to start the HttpConnection before stop() was called.";return this.u.log(t.Error,o),await this.It,Promise.reject(new i(o))}if(this.ut!=="Connected"){let o="HttpConnection.startInternal completed gracefully but didn't enter the connection into the connected state!";return this.u.log(t.Error,o),Promise.reject(new i(o))}this.dt=!0}send(e){return this.ut!=="Connected"?Promise.reject(new Error("Cannot send data if the connection is not in the 'Connected' State.")):(this.Ee||(this.Ee=new Me(this.transport)),this.Ee.send(e))}async stop(e){return this.ut==="Disconnected"?(this.u.log(t.Debug,`Call to HttpConnection.stop(${e}) ignored because the connection is already in the disconnected state.`),Promise.resolve()):this.ut==="Disconnecting"?(this.u.log(t.Debug,`Call to HttpConnection.stop(${e}) ignored because the connection is already in the disconnecting state.`),this.It):(this.ut="Disconnecting",this.It=new Promise(o=>{this.me=o}),await this._t(e),void await this.It)}async _t(e){this.$e=e;try{await this.ve}catch{}if(this.transport){try{await this.transport.stop()}catch(o){this.u.log(t.Error,`HttpConnection.transport.stop() threw error '${o}'.`),this.Ce()}this.transport=void 0}else this.u.log(t.Debug,"HttpConnection.transport is undefined in HttpConnection.stop() because start() failed.")}async yt(e){let o=this.baseUrl;this.Yt=this.ie.accessTokenFactory,this.$.Yt=this.Yt;try{if(this.ie.skipNegotiation){if(this.ie.transport!==Z.WebSockets)throw new Error("Negotiation can only be skipped when using the WebSocket transport directly.");this.transport=this.Se(Z.WebSockets),await this.ke(o,e)}else{let b=null,w=0;do{if(b=await this.Pe(o),this.ut==="Disconnecting"||this.ut==="Disconnected")throw new i("The connection was stopped during negotiation.");if(b.error)throw new Error(b.error);if(b.ProtocolVersion)throw new Error("Detected a connection attempt to an ASP.NET SignalR Server. This client only supports connecting to an ASP.NET Core SignalR Server. See https://aka.ms/signalr-core-differences for details.");if(b.url&&(o=b.url),b.accessToken){let M=b.accessToken;this.Yt=()=>M,this.$.Zt=M,this.$.Yt=void 0}w++}while(b.url&&w<100);if(w===100&&b.url)throw new Error("Negotiate redirection limit exceeded.");await this.Te(o,this.ie.transport,b,e)}this.transport instanceof Be&&(this.features.inherentKeepAlive=!0),this.ut==="Connecting"&&(this.u.log(t.Debug,"The HttpConnection connected successfully."),this.ut="Connected")}catch(b){return this.u.log(t.Error,"Failed to start the connection: "+b),this.ut="Disconnected",this.transport=void 0,this.me(),Promise.reject(b)}}async Pe(e){let o={},[b,w]=E();o[b]=w;let M=this.Ie(e);this.u.log(t.Debug,`Sending negotiation request: ${M}.`);try{let D=await this.$.post(M,{content:"",headers:{...o,...this.ie.headers},timeout:this.ie.timeout,withCredentials:this.ie.withCredentials});if(D.statusCode!==200)return Promise.reject(new Error(`Unexpected status code returned from negotiate '${D.statusCode}'`));let j=JSON.parse(D.content);return(!j.negotiateVersion||j.negotiateVersion<1)&&(j.connectionToken=j.connectionId),j.useStatefulReconnect&&this.ie._e!==!0?Promise.reject(new x("Client didn't negotiate Stateful Reconnect but the server did.")):j}catch(D){let j="Failed to complete negotiation with the server: "+D;return D instanceof h&&D.statusCode===404&&(j+=" Either this is not a SignalR endpoint or there is a proxy blocking the connection."),this.u.log(t.Error,j),Promise.reject(new x(j))}}He(e,o){return o?e+(e.indexOf("?")===-1?"?":"&")+`id=${o}`:e}async Te(e,o,b,w){let M=this.He(e,b.connectionToken);if(this.De(o))return this.u.log(t.Debug,"Connection was provided an instance of ITransport, using that directly."),this.transport=o,await this.ke(M,w),void(this.connectionId=b.connectionId);let D=[],j=b.availableTransports||[],L=b;for(let K of j){let se=this.Re(K,o,w,(L==null?void 0:L.useStatefulReconnect)===!0);if(se instanceof Error)D.push(`${K.transport} failed:`),D.push(se);else if(this.De(se)){if(this.transport=se,!L){try{L=await this.Pe(e)}catch(ke){return Promise.reject(ke)}M=this.He(e,L.connectionToken)}try{return await this.ke(M,w),void(this.connectionId=L.connectionId)}catch(ke){if(this.u.log(t.Error,`Failed to start the transport '${K.transport}': ${ke}`),L=void 0,D.push(new T(`${K.transport} failed: ${ke}`,Z[K.transport])),this.ut!=="Connecting"){let je="Failed to select transport before stop() was called.";return this.u.log(t.Debug,je),Promise.reject(new i(je))}}}}return D.length>0?Promise.reject(new y(`Unable to connect to the server with any of the available transports. ${D.join(" ")}`,D)):Promise.reject(new Error("None of the transports supported by the client are supported by the server."))}Se(e){switch(e){case Z.WebSockets:if(!this.ie.WebSocket)throw new Error("'WebSocket' is not supported in your environment.");return new Re(this.$,this.Yt,this.u,this.ie.logMessageContent,this.ie.WebSocket,this.ie.headers||{});case Z.ServerSentEvents:if(!this.ie.EventSource)throw new Error("'EventSource' is not supported in your environment.");return new Le(this.$,this.$.Zt,this.u,this.ie);case Z.LongPolling:return new Be(this.$,this.u,this.ie);default:throw new Error(`Unknown transport: ${e}.`)}}ke(e,o){return this.transport.onreceive=this.onreceive,this.features.reconnect?this.transport.onclose=async b=>{let w=!1;if(this.features.reconnect){try{this.features.disconnected(),await this.transport.connect(e,o),await this.features.resend()}catch{w=!0}w&&this.Ce(b)}else this.Ce(b)}:this.transport.onclose=b=>this.Ce(b),this.transport.connect(e,o)}Re(e,o,b,w){let M=Z[e.transport];if(M==null)return this.u.log(t.Debug,`Skipping transport '${e.transport}' because it is not supported by this client.`),new Error(`Skipping transport '${e.transport}' because it is not supported by this client.`);if(!function(D,j){return!D||(j&D)!=0}(o,M))return this.u.log(t.Debug,`Skipping transport '${Z[M]}' because it was disabled by the client.`),new v(`'${Z[M]}' is disabled by the client.`,M);if(!(e.transferFormats.map(D=>ne[D]).indexOf(b)>=0))return this.u.log(t.Debug,`Skipping transport '${Z[M]}' because it does not support the requested transfer format '${ne[b]}'.`),new Error(`'${Z[M]}' does not support ${ne[b]}.`);if(M===Z.WebSockets&&!this.ie.WebSocket||M===Z.ServerSentEvents&&!this.ie.EventSource)return this.u.log(t.Debug,`Skipping transport '${Z[M]}' because it is not supported in your environment.'`),new p(`'${Z[M]}' is not supported in your environment.`,M);this.u.log(t.Debug,`Selecting transport '${Z[M]}'.`);try{return this.features.reconnect=M===Z.WebSockets?w:void 0,this.Se(M)}catch(D){return D}}De(e){return e&&typeof e=="object"&&"connect"in e}Ce(e){if(this.u.log(t.Debug,`HttpConnection.stopConnection(${e}) called while in state ${this.ut}.`),this.transport=void 0,e=this.$e||e,this.$e=void 0,this.ut!=="Disconnected"){if(this.ut==="Connecting")throw this.u.log(t.Warning,`Call to HttpConnection.stopConnection(${e}) was ignored because the connection is still in the connecting state.`),new Error(`HttpConnection.stopConnection(${e}) was called while the connection is still in the connecting state.`);if(this.ut==="Disconnecting"&&this.me(),e?this.u.log(t.Error,`Connection disconnected with error '${e}'.`):this.u.log(t.Information,"Connection disconnected."),this.Ee&&(this.Ee.stop().catch(o=>{this.u.log(t.Error,`TransportSendQueue.stop() threw error '${o}'.`)}),this.Ee=void 0),this.connectionId=void 0,this.ut="Disconnected",this.dt){this.dt=!1;try{this.onclose&&this.onclose(e)}catch(o){this.u.log(t.Error,`HttpConnection.onclose(${e}) threw error '${o}'.`)}}}else this.u.log(t.Debug,`Call to HttpConnection.stopConnection(${e}) was ignored because the connection is already in the disconnected state.`)}be(e){if(e.lastIndexOf("https://",0)===0||e.lastIndexOf("http://",0)===0)return e;if(!l.isBrowser)throw new Error(`Cannot resolve '${e}'.`);let o=window.document.createElement("a");return o.href=e,this.u.log(t.Information,`Normalizing '${e}' to '${o.href}'.`),o.href}Ie(e){let o=new URL(e);o.pathname.endsWith("/")?o.pathname+="negotiate":o.pathname+="/negotiate";let b=new URLSearchParams(o.searchParams);return b.has("negotiateVersion")||b.append("negotiateVersion",this.ye.toString()),b.has("useStatefulReconnect")?b.get("useStatefulReconnect")==="true"&&(this.ie._e=!0):this.ie._e===!0&&b.append("useStatefulReconnect","true"),o.search=b.toString(),o.toString()}}class Me{constructor(e){this.xe=e,this.Ae=[],this.Ue=!0,this.Le=new Ce,this.Ne=new Ce,this.qe=this.Me()}send(e){return this.je(e),this.Ne||(this.Ne=new Ce),this.Ne.promise}stop(){return this.Ue=!1,this.Le.resolve(),this.qe}je(e){if(this.Ae.length&&typeof this.Ae[0]!=typeof e)throw new Error(`Expected data to be of type ${typeof this.Ae} but was of type ${typeof e}`);this.Ae.push(e),this.Le.resolve()}async Me(){for(;;){if(await this.Le.promise,!this.Ue){this.Ne&&this.Ne.reject("Connection stopped.");break}this.Le=new Ce;let e=this.Ne;this.Ne=void 0;let o=typeof this.Ae[0]=="string"?this.Ae.join(""):Me.We(this.Ae);this.Ae.length=0;try{await this.xe.send(o),e.resolve()}catch(b){e.reject(b)}}}static We(e){let o=e.map(M=>M.byteLength).reduce((M,D)=>M+D),b=new Uint8Array(o),w=0;for(let M of e)b.set(new Uint8Array(M),w),w+=M.byteLength;return b.buffer}}class Ce{constructor(){this.promise=new Promise((e,o)=>[this.j,this.Oe]=[e,o])}resolve(){this.j()}reject(e){this.Oe(e)}}class pe{constructor(){this.name="json",this.version=2,this.transferFormat=ne.Text}parseMessages(e,o){if(typeof e!="string")throw new Error("Invalid input for JSON hub protocol. Expected a string.");if(!e)return[];o===null&&(o=k.instance);let b=H.parse(e),w=[];for(let M of b){let D=JSON.parse(M);if(typeof D.type!="number")throw new Error("Invalid payload.");switch(D.type){case F.Invocation:this.U(D);break;case F.StreamItem:this.Fe(D);break;case F.Completion:this.Be(D);break;case F.Ping:case F.Close:break;case F.Ack:this.Xe(D);break;case F.Sequence:this.Je(D);break;default:o.log(t.Information,"Unknown message type '"+D.type+"' ignored.");continue}w.push(D)}return w}writeMessage(e){return H.write(JSON.stringify(e))}U(e){this.ze(e.target,"Invalid payload for Invocation message."),e.invocationId!==void 0&&this.ze(e.invocationId,"Invalid payload for Invocation message.")}Fe(e){if(this.ze(e.invocationId,"Invalid payload for StreamItem message."),e.item===void 0)throw new Error("Invalid payload for StreamItem message.")}Be(e){if(e.result&&e.error)throw new Error("Invalid payload for Completion message.");!e.result&&e.error&&this.ze(e.error,"Invalid payload for Completion message."),this.ze(e.invocationId,"Invalid payload for Completion message.")}Xe(e){if(typeof e.sequenceId!="number")throw new Error("Invalid SequenceId for Ack message.")}Je(e){if(typeof e.sequenceId!="number")throw new Error("Invalid SequenceId for Sequence message.")}ze(e,o){if(typeof e!="string"||e==="")throw new Error(o)}}let gt={trace:t.Trace,debug:t.Debug,info:t.Information,information:t.Information,warn:t.Warning,warning:t.Warning,error:t.Error,critical:t.Critical,none:t.None};class _e{configureLogging(e){if(P.isRequired(e,"logging"),e.log!==void 0)this.logger=e;else if(typeof e=="string"){let o=function(b){let w=gt[b.toLowerCase()];if(w!==void 0)return w;throw new Error(`Unknown log level: ${b}`)}(e);this.logger=new N(o)}else this.logger=new N(e);return this}withUrl(e,o){return P.isRequired(e,"url"),P.isNotEmpty(e,"url"),this.url=e,this.httpConnectionOptions=typeof o=="object"?{...this.httpConnectionOptions,...o}:{...this.httpConnectionOptions,transport:o},this}withHubProtocol(e){return P.isRequired(e,"protocol"),this.protocol=e,this}withAutomaticReconnect(e){if(this.reconnectPolicy)throw new Error("A reconnectPolicy has already been set.");return e?Array.isArray(e)?this.reconnectPolicy=new Ee(e):this.reconnectPolicy=e:this.reconnectPolicy=new Ee,this}withServerTimeout(e){return P.isRequired(e,"milliseconds"),this.Ve=e,this}withKeepAliveInterval(e){return P.isRequired(e,"milliseconds"),this.Ke=e,this}withStatefulReconnect(e){return this.httpConnectionOptions===void 0&&(this.httpConnectionOptions={}),this.httpConnectionOptions._e=!0,this.Y=e==null?void 0:e.bufferSize,this}build(){let e=this.httpConnectionOptions||{};if(e.logger===void 0&&(e.logger=this.logger),!this.url)throw new Error("The 'HubConnectionBuilder.withUrl' method must be called before building the connection.");let o=new Fe(this.url,e);return fe.create(o,this.logger||k.instance,this.protocol||new pe,this.reconnectPolicy,this.Ve,this.Ke,this.Y)}}return Uint8Array.prototype.indexOf||Object.defineProperty(Uint8Array.prototype,"indexOf",{value:Array.prototype.indexOf,writable:!0}),Uint8Array.prototype.slice||Object.defineProperty(Uint8Array.prototype,"slice",{value:function(A,e){return new Uint8Array(Array.prototype.slice.call(this,A,e))},writable:!0}),Uint8Array.prototype.forEach||Object.defineProperty(Uint8Array.prototype,"forEach",{value:Array.prototype.forEach,writable:!0}),a})(),typeof St=="object"&&typeof zt=="object"?zt.exports=bt():typeof define=="function"&&define.amd?define([],bt):typeof St=="object"?St.signalR=bt():un.signalR=bt()});var dn=ue((fn,kt)=>{"use strict";(function(n,t){if(typeof kt=="object"&&kt.exports)kt.exports=t();else{let a=t();n.CryptoTickerConfig=Object.assign({},n.CryptoTickerConfig||{},a)}})(typeof self!="undefined"?self:fn,function(){return{tProxyBase:"https://tproxyv8.opendle.com",fallbackPollIntervalMs:6e4,staleTickerTimeoutMs:5*60*1e3,binanceRestBaseUrl:"https://api.binance.com",binanceWsBaseUrl:"wss://stream.binance.com:9443/ws",binanceSymbolOverrides:{},bitfinexRestBaseUrl:"https://api-pub.bitfinex.com",bitfinexWsBaseUrl:"wss://api-pub.bitfinex.com/ws/2",bitfinexSymbolOverrides:{},messages:{loading:"LOADING...",stale:"STALE",noData:"NO DATA",misconfigured:"INVALID PAIR",conversionError:"CONVERT ERROR"}}})});var Ye=ue((pn,Tt)=>{"use strict";var Sr={LIVE:"live",DETACHED:"detached",BACKUP:"backup",BROKEN:"broken"};(function(n,t){let a=typeof globalThis!="undefined"?globalThis:n,h=t();typeof Tt=="object"&&Tt.exports&&(Tt.exports=h),a&&(a.CryptoTickerConnectionStates=h)})(typeof self!="undefined"?self:pn,function(){return Sr})});var yt=ue((gn,Et)=>{"use strict";(function(n,t){let a=typeof globalThis!="undefined"?globalThis:n,h=t();typeof Et=="object"&&Et.exports&&(Et.exports=h),a&&(a.CryptoTickerProviders=a.CryptoTickerProviders||{},a.CryptoTickerProviders.buildSubscriptionKey=h.buildSubscriptionKey)})(typeof self!="undefined"?self:gn,function(){function t(a,h,c,i){let p=a||"",v=h||"",T=c||null,x=i||null,y="";return T!==null&&x!==null&&T!==x&&(y="__"+T+"_"+x),p+"__"+v+y}return{buildSubscriptionKey:t}})});var Je=ue((bn,xt)=>{"use strict";(function(n,t){let a=typeof globalThis!="undefined"?globalThis:n,h=t();typeof xt=="object"&&xt.exports&&(xt.exports=h),a&&(a.CryptoTickerProviders=a.CryptoTickerProviders||{},a.CryptoTickerProviders.ProviderInterface=h.ProviderInterface)})(typeof self!="undefined"?self:bn,function(){function t(){}class a{constructor(c){let i=c||{};this.baseUrl=typeof i.baseUrl=="string"?i.baseUrl:"",this.logger=typeof i.logger=="function"?i.logger:t}getId(){throw new Error("Provider must implement getId()")}subscribeTicker(c,i){throw new Error("Provider must implement subscribeTicker()")}async fetchTicker(c){throw new Error("Provider must implement fetchTicker()")}getCachedTicker(c){return null}async fetchCandles(c){throw new Error("Provider must implement fetchCandles()")}ensureConnection(){}async fetchConversionRate(c,i){return 1}}return{ProviderInterface:a}})});var Qe=ue((yn,Xe)=>{"use strict";(function(n,t){let a=typeof globalThis!="undefined"?globalThis:n,h=typeof Xe=="object"&&Xe.exports?[yt(),Ye()]:[n==null?void 0:n.CryptoTickerProviders,n==null?void 0:n.CryptoTickerConnectionStates],c=t(h[0],h[1]);typeof Xe=="object"&&Xe.exports&&(Xe.exports=c),a&&(a.CryptoTickerProviders=a.CryptoTickerProviders||{},a.CryptoTickerProviders.TickerSubscriptionManager=c.TickerSubscriptionManager)})(typeof self!="undefined"?self:yn,function(n,t){let a=n.buildSubscriptionKey||n,h=t||{LIVE:"live",DETACHED:"detached",BACKUP:"backup",BROKEN:"broken"},c=6e4,i=5*60*1e3;function p(){}function v(y){let u=y||{};return{onData:typeof u.onData=="function"?u.onData:null,onError:typeof u.onError=="function"?u.onError:null}}function T(y){let u=y||{},f=u.fromCurrency||null,k=u.toCurrency||null;return{exchange:u.exchange,symbol:u.symbol,fromCurrency:f,toCurrency:k}}class x{constructor(u){let f=u||{};this.logger=typeof f.logger=="function"?f.logger:p,this.fetchTickerFn=typeof f.fetchTicker=="function"?f.fetchTicker:null,this.subscribeStreamingFn=typeof f.subscribeStreaming=="function"?f.subscribeStreaming:null,this.unsubscribeStreamingFn=typeof f.unsubscribeStreaming=="function"?f.unsubscribeStreaming:null,this.ensureConnectionFn=typeof f.ensureConnection=="function"?f.ensureConnection:null,this.subscriptionKeyBuilder=typeof f.buildSubscriptionKey=="function"?f.buildSubscriptionKey:a,this.fallbackPollIntervalMs=typeof f.fallbackPollIntervalMs=="number"?f.fallbackPollIntervalMs:c,this.staleTickerTimeoutMs=typeof f.staleTickerTimeoutMs=="number"?f.staleTickerTimeoutMs:i,this.connectionStates=h,this.entries={},this.cache={}}subscribe(u,f){let k=v(f),d=this.getOrCreateEntry(u);if(d.subscribers.push(k),this.ensureConnectionFn)try{this.ensureConnectionFn()}catch(l){this.logger("TickerSubscriptionManager: ensureConnection error",l)}this.ensureStreaming(d),this.startFallbackPolling(d);let P=this;return this.fetchTickerFn&&this.fetchTickerFn(d.params).then(function(l){P.applyTickerStateFromFetch(d,l),P.cache[d.key]=l,P.notifySubscribers(d,l)}).catch(function(l){if(P.logger("TickerSubscriptionManager: fetchTicker error",l),k.onError)try{k.onError(l)}catch(g){P.logger("TickerSubscriptionManager: onError handler threw",g)}}),{key:d.key,unsubscribe:()=>{this.unsubscribe(d.key,k)}}}unsubscribe(u,f){let k=this.entries[u];if(!k)return;let d=k.subscribers.indexOf(f);d>=0&&k.subscribers.splice(d,1),k.subscribers.length===0&&(this.stopFallbackPolling(k),this.stopStreaming(k),delete this.entries[u])}getCachedTicker(u){return this.cache[u]||null}handleStreamingUpdate(u,f){let k=this.entries[u];k&&(k.lastStreamUpdate=Date.now(),this.setEntryConnectionState(k,this.connectionStates.LIVE,f),this.cache[u]=f,this.notifySubscribers(k,f))}getEntry(u){return this.entries[u]||null}handleStreamingUpdateFromParts(u,f,k,d,P){let l=this.buildKey(u,f,k,d);this.handleStreamingUpdate(l,P)}buildKey(u,f,k,d){return this.subscriptionKeyBuilder(u,f,k,d)}buildKeyFromParams(u){let f=u||{};return this.buildKey(f.exchange,f.symbol,f.fromCurrency,f.toCurrency)}forEachEntry(u){if(typeof u!="function")return;let f=Object.keys(this.entries);for(let k=0;k<f.length;k++){let d=f[k];u(this.entries[d])}}ensureStreaming(u){if(!u||u.streamingActive||!this.subscribeStreamingFn){u&&!u.streamingActive&&(u.streamingActive=!!this.subscribeStreamingFn);return}try{let f=this.subscribeStreamingFn(u);f&&typeof f.then=="function"?f.then(()=>{u.streamingActive=!0}).catch(k=>{u.streamingActive=!1,this.logger("TickerSubscriptionManager: subscribeStreaming promise rejected",k)}):f===!1?u.streamingActive=!1:u.streamingActive=!0}catch(f){u.streamingActive=!1,this.logger("TickerSubscriptionManager: subscribeStreaming error",f)}}stopStreaming(u){if(!(!u||!this.unsubscribeStreamingFn||!u.streamingActive))try{let f=this.unsubscribeStreamingFn(u);f&&typeof f.then=="function"?f.then(()=>{u.streamingActive=!1}).catch(k=>{this.logger("TickerSubscriptionManager: unsubscribeStreaming promise rejected",k)}):u.streamingActive=!1}catch(f){u.streamingActive=!1,this.logger("TickerSubscriptionManager: unsubscribeStreaming error",f)}}notifySubscribers(u,f){if(!u)return;let k=u.subscribers;for(let d=0;d<k.length;d++){let P=k[d];if(P&&P.onData)try{P.onData(f)}catch(l){this.logger("TickerSubscriptionManager: onData handler threw",l)}}}startFallbackPolling(u){if(!u||u.fallbackTimerId||!this.fetchTickerFn)return;let f=this;u.fallbackTimerId=setInterval(function(){f.pollEntryIfNeeded(u)},this.fallbackPollIntervalMs)}stopFallbackPolling(u){!u||!u.fallbackTimerId||(clearInterval(u.fallbackTimerId),u.fallbackTimerId=null)}pollEntryIfNeeded(u){if(!u||!this.fetchTickerFn||!this.shouldPollEntry(u))return;let f=this;this.fetchTickerFn(u.params).then(function(k){f.applyTickerStateFromFetch(u,k),f.cache[u.key]=k,f.notifySubscribers(u,k)}).catch(function(k){f.logger("TickerSubscriptionManager: fallback fetch error",k),f.handleFetchError(u)})}shouldPollEntry(u){if(!u)return!1;if(!u.streamingActive)return!0;let f=u.lastStreamUpdate||0;return f?Date.now()-f>this.staleTickerTimeoutMs:!0}getOrCreateEntry(u){let f=this.buildKeyFromParams(u),k=this.entries[f];return k||(k={key:f,params:T(u),subscribers:[],streamingActive:!1,lastStreamUpdate:0,fallbackTimerId:null,meta:{},connectionState:null},this.entries[f]=k),k}setEntryConnectionState(u,f,k){u&&(u.connectionState=f,k&&typeof k=="object"&&(k.connectionState=f))}applyTickerStateFromFetch(u,f){if(!u||!f)return;let k=f.connectionState||(u.streamingActive?this.connectionStates.LIVE:this.connectionStates.DETACHED);this.setEntryConnectionState(u,k,f)}handleFetchError(u){if(!u)return;this.setEntryConnectionState(u,this.connectionStates.BROKEN);let f=u.key,k=this.cache[f];if(k){k.connectionState=this.connectionStates.BROKEN,this.notifySubscribers(u,k);return}let d={changeDaily:0,changeDailyPercent:0,last:0,volume:0,high:0,low:0,pair:u.params.symbol,pairDisplay:u.params.symbol,connectionState:this.connectionStates.BROKEN};this.cache[f]=d,this.notifySubscribers(u,d)}}return{TickerSubscriptionManager:x}})});var et=ue((mn,Ze)=>{"use strict";(function(n,t){let a=typeof globalThis!="undefined"?globalThis:n,h=typeof Ze=="object"&&Ze.exports?[Je(),yt(),Qe(),Ye()]:[n==null?void 0:n.CryptoTickerProviders,n==null?void 0:n.CryptoTickerProviders,n==null?void 0:n.CryptoTickerProviders,n==null?void 0:n.CryptoTickerConnectionStates],c=t(h[0],h[1],h[2],h[3]);typeof Ze=="object"&&Ze.exports&&(Ze.exports=c),a&&(a.CryptoTickerProviders=a.CryptoTickerProviders||{},a.CryptoTickerProviders.GenericProvider=c.GenericProvider)})(typeof self!="undefined"?self:mn,function(n,t,a,h){let c=n.ProviderInterface||n,i=t.buildSubscriptionKey||t,p=a.TickerSubscriptionManager||a,v=h||{LIVE:"live",DETACHED:"detached",BACKUP:"backup",BROKEN:"broken"},T="Connected",x=5e3,y="_ctBust";function u(k){if(!k||typeof k!="string")return k;try{let d=new URL(k);return d.searchParams.set(y,Date.now().toString()),d.toString()}catch{let P=k.indexOf("?")===-1?"?":"&";return k+P+y+"="+Date.now()}}class f extends c{constructor(d){super(d);let P=d||{};this.retryDelayMs=typeof P.retryDelayMs=="number"?P.retryDelayMs:x,this.connection=null,this.shouldReconnect=!0,this.connectionState="Disconnected",this.startingConnection=!1,this.normalizedBaseUrl=(this.baseUrl||"").replace(/\/$/,"");let l={logger:(...g)=>{this.logger(...g)},fetchTicker:this.rawFetchTicker.bind(this),subscribeStreaming:this.subscribeEntry.bind(this),unsubscribeStreaming:this.unsubscribeEntry.bind(this),ensureConnection:this.ensureConnection.bind(this),buildSubscriptionKey:function(g,S,I,C){return i(g,S,I,C)},fallbackPollIntervalMs:P.fallbackPollIntervalMs,staleTickerTimeoutMs:P.staleTickerTimeoutMs};this.subscriptionManager=new p(l)}getId(){return"GENERIC"}subscribeTicker(d,P){return this.subscriptionManager.subscribe(d,P)}getCachedTicker(d){return this.subscriptionManager.getCachedTicker(d)}ensureConnection(){if(!(this.connection&&(this.connectionState===T||this.startingConnection))){if(typeof signalR=="undefined"||!signalR.HubConnectionBuilder){this.logger("GenericProvider: SignalR not available, skipping WebSocket connection.");return}if(!this.connection){this.connection=new signalR.HubConnectionBuilder().withUrl(this.baseUrl+"/tickerhub").withAutomaticReconnect().configureLogging(signalR.LogLevel.Warning).build();let d=this;this.connection.on("ticker",function(P){d.handleTickerMessage(P)}),this.connection.onreconnected(function(){d.logger("GenericProvider: connection re-established, resubscribing."),d.onConnectionEstablished()}),this.connection.onclose(function(){d.connectionState="Disconnected",d.shouldReconnect&&setTimeout(function(){d.startConnection()},d.retryDelayMs)})}this.startConnection()}}startConnection(){if(!this.connection||this.startingConnection||this.connectionState===T)return;let d=this;this.startingConnection=!0,this.connection.start().then(function(){d.connectionState=T,d.startingConnection=!1,d.onConnectionEstablished()}).catch(function(P){d.connectionState="Disconnected",d.startingConnection=!1,d.logger("GenericProvider: error starting connection",P),setTimeout(function(){d.startConnection()},d.retryDelayMs)})}isConnected(){return this.connection&&this.connectionState===T}onConnectionEstablished(){let d=this;this.subscriptionManager.forEachEntry(function(P){P&&(P.streamingActive=!1,P.meta&&(P.meta.isSubscribed=!1,P.meta.pending=!0),d.subscriptionManager.ensureStreaming(P))})}subscribeEntry(d){if(!d)return!1;if(d.meta=d.meta||{},!this.connection)return this.ensureConnection(),d.meta.pending=!0,d.streamingActive=!1,!1;if(!this.isConnected())return this.startConnection(),d.meta.pending=!0,d.streamingActive=!1,!1;if(d.meta.isSubscribed)return d.meta.pending=!1,!0;d.meta.pending=!0;let P=d.params,l=this;return this.connection.invoke("Subscribe",P.exchange,P.symbol,P.fromCurrency,P.toCurrency).then(function(){return d.meta.isSubscribed=!0,d.meta.pending=!1,d.streamingActive=!0,!0}).catch(function(g){return d.meta.isSubscribed=!1,d.meta.pending=!1,d.streamingActive=!1,l.logger("GenericProvider: error invoking Subscribe",g),!1})}unsubscribeEntry(d){if(!d)return!0;if(d.meta=d.meta||{},!this.connection||!d.meta.isSubscribed)return d.meta.isSubscribed=!1,d.streamingActive=!1,!0;let P=d.params,l=this;return this.connection.invoke("Unsubscribe",P.exchange,P.symbol,P.fromCurrency,P.toCurrency).then(function(){return d.meta.isSubscribed=!1,d.streamingActive=!1,!0}).catch(function(g){return d.meta.isSubscribed=!1,d.streamingActive=!1,l.logger("GenericProvider: error invoking Unsubscribe",g),!1})}fetchTicker(d){return this.rawFetchTicker(d)}rawFetchTicker(d){let P=d.exchange||"",l=d.symbol||"",g=d.fromCurrency||"USD",S=d.toCurrency||null,I=(this.baseUrl||"").replace(/\/$/,""),C=encodeURIComponent(P),N=encodeURIComponent(l),E=I+"/api/Ticker/json/"+C+"/"+N+"?fromCurrency="+encodeURIComponent(g);S!==null&&(E+="&toCurrency="+encodeURIComponent(S));let B=this,z=this.buildProxyRequestConfig(E);return fetch(z.url,z.options).then(function(O){return O.json()}).then(function(O){let G=B.transformTickerResponse(O);return G.connectionState=v.BACKUP,G}).catch(function(O){B.logger("GenericProvider: error fetching ticker",O);let G=B.subscriptionManager.buildKey(P,l,g,S),X=B.subscriptionManager.getCachedTicker(G);if(X)return X.connectionState=X.connectionState||v.BACKUP,X;let V=B.buildEmptyTicker(l);return V.connectionState=v.BROKEN,V})}handleTickerMessage(d){if(!d)return;let P=d.provider||d.provider,l=d.symbol||d.symbol,g=d.conversionFromCurrency||d.conversionFromCurrency||null,S=d.conversionToCurrency||d.conversionToCurrency||null,I=this.subscriptionManager.buildKey(P,l,g,S),C=this.transformTickerResponse(d),N=this.subscriptionManager.getEntry(I);N&&N.meta&&(N.meta.isSubscribed=!0,N.meta.pending=!1,N.streamingActive=!0),this.subscriptionManager.handleStreamingUpdate(I,C)}async fetchCandles(d){let P=d.exchange,l=d.symbol,g=d.interval,S=typeof d.limit=="number"&&d.limit>0?d.limit:24,C=this.baseUrl.replace(/\/$/,"")+"/api/Candles/json/"+encodeURIComponent(P)+"/"+encodeURIComponent(l)+"/"+g+"?limit="+S;try{let N=this.buildProxyRequestConfig(C),E=await fetch(N.url,N.options);if(!E||!E.ok)throw new Error("GenericProvider: candles response not ok");let B=await E.json();return Array.isArray(B.candles)?B.candles:[]}catch(N){throw this.logger("GenericProvider: error fetching candles",N),N}}buildProxyRequestConfig(d,P){if(!d||typeof d!="string")return{url:d,options:P};let l=this.normalizedBaseUrl,g=d.replace(/\/$/,"");if(!l||g.indexOf(l)!==0)return{url:d,options:P};let S=Object.assign({},P||{});S.cache="no-store";let I=Object.assign({},S.headers||{});return I["cache-control"]="no-cache",I.pragma="no-cache",S.headers=I,{url:u(d),options:S}}transformTickerResponse(d){let P=d||{};return{changeDaily:P.dailyChange||0,changeDailyPercent:P.dailyChangeRelative||0,last:P.last||0,volume:P.volume||0,high:P.high24h||0,low:P.low24h||0,pair:P.symbol||P.pair||"",pairDisplay:P.symbolDisplay||P.symbol||P.pair||""}}buildEmptyTicker(d){let P=d||"";return{changeDaily:0,changeDailyPercent:0,last:0,volume:0,high:0,low:0,pair:P,pairDisplay:P,connectionState:v.BROKEN}}}return{GenericProvider:f}})});var Cn=ue((vn,Pt)=>{"use strict";(function(t,a){let h=a();typeof Pt=="object"&&Pt.exports&&(Pt.exports=h),t&&typeof t=="object"&&(t.CryptoTickerDefaults=h)})(typeof self!="undefined"?self:vn,function(){function t(y){if(y===null||typeof y!="object")return y;if(Array.isArray(y))return y.map(f=>t(f));let u={};for(let f in y)Object.prototype.hasOwnProperty.call(y,f)&&(u[f]=t(y[f]));return u}function a(y){let u=y==null?void 0:y.case,f=(y==null?void 0:y.allowEmptyString)===!0,k=(y==null?void 0:y.allowNull)===!0,d=Object.prototype.hasOwnProperty.call(y||{},"trim")?!!(y!=null&&y.trim):!0,P=Array.isArray(y==null?void 0:y.allowedValues)?y==null?void 0:y.allowedValues:null;return function(g){if(g===void 0)return null;if(g===null)return k?null:"";let S=String(g);if(d&&(S=S.trim()),!S&&!f)return null;if(u==="upper"?S=S.toUpperCase():u==="lower"&&(S=S.toLowerCase()),P&&P.length>0){let I=u==="lower"?S.toLowerCase():u==="upper"?S.toUpperCase():S;return P.some(N=>u==="lower"?N.toLowerCase()===I:u==="upper"?N.toUpperCase()===I:N===I)?u==="lower"||u==="upper"?I:S:null}return S}}function h(y){let u=typeof(y==null?void 0:y.min)=="number"?y.min:null,f=typeof(y==null?void 0:y.max)=="number"?y.max:null,k=(y==null?void 0:y.integer)===!0;return function(P){if(P==null||P==="")return null;let l=typeof P=="number"?P:parseFloat(String(P));return Number.isNaN(l)?null:(k&&(l=Math.round(l)),u!==null&&l<u&&(l=u),f!==null&&l>f&&(l=f),l)}}function c(y){let u=Array.isArray(y.allowed)?y.allowed.slice(0):[],f=y.trim!==!1;return function(d){if(d==null)return null;let P=String(d);return f&&(P=P.trim()),P&&u.indexOf(P)>=0?P:null}}let i={title:{type:"string",default:"",normalize:a({allowEmptyString:!0,allowNull:!0,trim:!0})},exchange:{type:"string",default:"BINANCE",normalize:a({trim:!0,allowEmptyString:!1,case:"upper"})},pair:{type:"string",default:"BTCUSD",normalize:a({trim:!0,allowEmptyString:!1,case:"upper"})},fromCurrency:{type:"string",default:"USD",normalize:a({trim:!0,allowEmptyString:!1,case:"upper"})},currency:{type:"string",default:"",normalize:a({trim:!0,allowEmptyString:!0,case:"upper",allowNull:!0})},candlesInterval:{type:"string",default:"1h",normalize:a({trim:!0,allowEmptyString:!1})},candlesDisplayed:{type:"number",default:20,normalize:h({min:5,max:60,integer:!0})},multiplier:{type:"number",default:1,normalize:h({min:0})},digits:{type:"number",default:2,normalize:h({min:0,max:10,integer:!0})},highLowDigits:{type:"string",default:"",normalize:a({trim:!0,allowEmptyString:!0})},font:{type:"string",default:"Lato,'Roboto Condensed',Helvetica,Calibri,sans-serif",normalize:a({trim:!0,allowEmptyString:!1})},fontSizeBase:{type:"number",default:25,normalize:h({min:1,max:200,integer:!0})},fontSizePrice:{type:"number",default:35,normalize:h({min:1,max:200,integer:!0})},fontSizeHighLow:{type:"string",default:"",normalize:a({trim:!0,allowEmptyString:!0})},fontSizeChange:{type:"number",default:19,normalize:h({min:1,max:200,integer:!0})},priceFormat:{type:"string",default:"auto",normalize:function(y){let f=a({trim:!0,allowEmptyString:!1,case:"lower"})(y);return f?f==="compact"?"auto":f==="plain"?"full":f==="auto"||f==="full"?f:null:null}},thousandsSeparator:{type:"string",default:",",normalize:c({allowed:[",","."," ","'"],trim:!1})},decimalSeparator:{type:"string",default:".",normalize:c({allowed:[".",","]})},backgroundColor:{type:"string",default:"#000000",normalize:a({trim:!0,allowEmptyString:!1})},textColor:{type:"string",default:"#ffffff",normalize:a({trim:!0,allowEmptyString:!1})},displayHighLow:{type:"string",default:"on",normalize:a({trim:!0,allowEmptyString:!1,case:"lower",allowedValues:["on","off"]})},displayHighLowBar:{type:"string",default:"on",normalize:a({trim:!0,allowEmptyString:!1,case:"lower",allowedValues:["on","off"]})},displayDailyChange:{type:"string",default:"on",normalize:a({trim:!0,allowEmptyString:!1,case:"lower",allowedValues:["on","off"]})},displayConnectionStatusIcon:{type:"string",default:"OFF",normalize:a({trim:!0,allowEmptyString:!1,case:"upper",allowedValues:["OFF","TOP_RIGHT","BOTTOM_LEFT"]})},alertRule:{type:"string",default:"",normalize:a({trim:!0,allowEmptyString:!0})},backgroundColorRule:{type:"string",default:"",normalize:a({trim:!0,allowEmptyString:!0})},textColorRule:{type:"string",default:"",normalize:a({trim:!0,allowEmptyString:!0})},mode:{type:"string",default:"ticker",normalize:a({trim:!0,allowEmptyString:!1,case:"lower",allowedValues:["ticker","candles"]})}};function p(y,u,f){if(!y||typeof y!="object")return{value:u,error:null};let k=y.normalize,d=y.default;if(typeof k!="function")return{value:u===void 0?t(d):u,error:null};let P=k(u);if(P==null){let l=k(d);return{value:l==null?t(d):l,error:f?"Invalid "+y.type:null}}return{value:P,error:null}}function v(y){let u=y&&typeof y=="object"?y:{},f={},k=[];for(let d in i){if(!Object.prototype.hasOwnProperty.call(i,d))continue;let P=i[d],l=Object.prototype.hasOwnProperty.call(u,d),g=l?u[d]:void 0,S=p(P,g,l);f[d]=S.value,S.error&&k.push({key:d,message:S.error})}for(let d in u)!Object.prototype.hasOwnProperty.call(i,d)&&Object.prototype.hasOwnProperty.call(u,d)&&(f[d]=u[d]);return{settings:f,errors:k}}function T(y){return v(y).settings}let x=T(null);return{settingsSchema:i,defaultSettings:x,getDefaultSettings:function(){return t(x)},validateSettings:function(y){let u=v(y);return{settings:u.settings,errors:u.errors.slice(0)}},applyDefaults:T}})});var Mt=ue((wn,Rt)=>{"use strict";(function(n,t){let a=typeof globalThis!="undefined"?globalThis:n,h=t();typeof Rt=="object"&&Rt.exports&&(Rt.exports=h),a&&(a.CryptoTickerProviders=a.CryptoTickerProviders||{},a.CryptoTickerProviders.WebSocketConnectionPool=h.WebSocketConnectionPool)})(typeof self!="undefined"?self:wn,function(){function n(){}function t(h,c){if(!c||typeof c!="object")return h;let i=Object.keys(c);for(let p=0;p<i.length;p++){let v=i[p];h[v]=c[v]}return h}class a{constructor(c){let i=c||{};this.logger=typeof i.logger=="function"?i.logger:n,this.createWebSocket=typeof i.createWebSocket=="function"?i.createWebSocket:null,this.subscribeHandler=typeof i.subscribe=="function"?i.subscribe:null,this.unsubscribeHandler=typeof i.unsubscribe=="function"?i.unsubscribe:null,this.handleMessageFn=typeof i.handleMessage=="function"?i.handleMessage:null,this.onOpen=typeof i.onOpen=="function"?i.onOpen:null,this.onError=typeof i.onError=="function"?i.onError:null,this.onClose=typeof i.onClose=="function"?i.onClose:null,this.reconnectDelayMs=typeof i.reconnectDelayMs=="number"?i.reconnectDelayMs:5e3,this.autoCloseDelayMs=typeof i.autoCloseDelayMs=="number"?i.autoCloseDelayMs:0,this.shouldResubscribeOnReconnect=i.shouldResubscribeOnReconnect!==!1,this.symbolEntries={},this.ws=null,this.wsClosedByUser=!1,this.reconnectTimer=null,this.closeTimer=null,this.isConnecting=!1}subscribe(c,i){let p=typeof c=="string"?c:"";if(!p)return this.logger("WebSocketConnectionPool: subscribe called without symbol"),null;if(!this.createWebSocket)return this.logger("WebSocketConnectionPool: createWebSocket not configured"),null;let v=this.buildSubscriber(i);if(!v.onData)return this.logger("WebSocketConnectionPool: subscriber missing onData handler for",p),null;let T=this.symbolEntries[p];T||(T={symbol:p,subscribers:[],subscribed:!1,subscriptionRequested:!1,meta:{}},this.symbolEntries[p]=T),T.subscribers.push(v),this.clearCloseTimer(),this.ensureConnection(),this.isSocketOpen()&&!T.subscribed&&!T.subscriptionRequested&&this.requestSubscribe(T);let x=this;return{symbol:p,unsubscribe:function(){x.removeSubscriber(p,v)},updateMetadata:function(y){x.updateSymbolMetadata(p,y)},getMetadata:function(){let y=x.symbolEntries[p];return y?y.meta:null}}}removeSubscriber(c,i){let p=this.symbolEntries[c];if(!p)return;let v=p.subscribers.indexOf(i);if(v>=0&&p.subscribers.splice(v,1),!(p.subscribers.length>0)){if(this.isSocketOpen()&&this.unsubscribeHandler&&(p.subscribed||p.subscriptionRequested))try{this.unsubscribeHandler(this.ws,c,p.meta)}catch(T){this.logger("WebSocketConnectionPool: unsubscribe handler error",T)}delete this.symbolEntries[c],this.maybeCloseConnection()}}ensureConnection(){if(this.ws||this.isConnecting)return;let c=null;try{c=this.createWebSocket()}catch(i){this.logger("WebSocketConnectionPool: failed to create WebSocket",i);return}if(!c){this.logger("WebSocketConnectionPool: createWebSocket returned falsy value"),this.scheduleReconnect();return}this.ws=c,this.wsClosedByUser=!1,this.isConnecting=!0,this.attachSocketHandlers(c)}attachSocketHandlers(c){let i=this;c.onopen=function(){if(i.isConnecting=!1,i.onOpen)try{i.onOpen(i.ws)}catch(p){i.logger("WebSocketConnectionPool: onOpen handler error",p)}i.flushPendingSubscriptions()},c.onmessage=function(p){if(i.handleMessageFn)try{i.handleMessageFn(p,i.buildMessageHelpers())}catch(v){i.logger("WebSocketConnectionPool: handleMessage error",v)}},c.onerror=function(p){if(i.onError)try{i.onError(p)}catch(v){i.logger("WebSocketConnectionPool: onError handler error",v)}},c.onclose=function(p){i.handleSocketClose(p)}}handleSocketClose(c){if(this.onClose)try{this.onClose(c)}catch(p){this.logger("WebSocketConnectionPool: onClose handler error",p)}let i=this.hasSubscribers();if(this.isConnecting=!1,this.ws=null,!this.wsClosedByUser&&i){this.resetSubscriptionState(),this.notifyAllDisconnected(),this.scheduleReconnect();return}this.wsClosedByUser=!1,this.resetSubscriptionState()}resetSubscriptionState(){let c=Object.keys(this.symbolEntries);for(let i=0;i<c.length;i++){let p=this.symbolEntries[c[i]];p.subscribed=!1,p.subscriptionRequested=!1}}scheduleReconnect(){if(this.reconnectTimer||!this.hasSubscribers())return;let c=this;this.reconnectTimer=setTimeout(function(){c.reconnectTimer=null,c.hasSubscribers()&&c.ensureConnection()},this.reconnectDelayMs)}clearReconnectTimer(){this.reconnectTimer&&(clearTimeout(this.reconnectTimer),this.reconnectTimer=null)}flushPendingSubscriptions(){let c=Object.keys(this.symbolEntries);for(let i=0;i<c.length;i++){let p=this.symbolEntries[c[i]];!p.subscribed&&!p.subscriptionRequested&&this.requestSubscribe(p)}}requestSubscribe(c){if(!(!c||!this.isSocketOpen())){if(!this.subscribeHandler){c.subscribed=!0,this.notifySubscribed(c.symbol,null);return}try{c.subscriptionRequested=!0,this.subscribeHandler(this.ws,c.symbol,c.meta)}catch(i){c.subscriptionRequested=!1,this.logger("WebSocketConnectionPool: subscribe handler error",i),this.notifySubscribeError(c.symbol,i)}}}notifySubscribed(c,i){let p=this.symbolEntries[c];if(!p)return;if(p.subscribed){i&&t(p.meta,i);return}p.subscribed=!0,p.subscriptionRequested=!1,i&&t(p.meta,i);let v=p.subscribers;for(let T=0;T<v.length;T++){let x=v[T];if(x.onSubscribed)try{x.onSubscribed(x.context)}catch(y){this.logger("WebSocketConnectionPool: onSubscribed handler error",y)}}}notifySubscribeError(c,i){let p=this.symbolEntries[c];if(!p)return;let v=p.subscribers;for(let T=0;T<v.length;T++){let x=v[T];if(x.onError)try{x.onError(i,x.context)}catch(y){this.logger("WebSocketConnectionPool: onError handler error",y)}}}notifyAllDisconnected(){let c=Object.keys(this.symbolEntries);for(let i=0;i<c.length;i++)this.notifyDisconnected(c[i])}notifyDisconnected(c){let i=this.symbolEntries[c];if(!i)return;let p=i.subscribers;for(let v=0;v<p.length;v++){let T=p[v];if(T.onDisconnected)try{T.onDisconnected(T.context)}catch(x){this.logger("WebSocketConnectionPool: onDisconnected handler error",x)}}}dispatch(c,i,p){let v=this.symbolEntries[c];if(!v)return;let T=v.subscribers;for(let x=0;x<T.length;x++){let y=T[x];if(y.onData)try{y.onData(i,p,y.context)}catch(u){this.logger("WebSocketConnectionPool: subscriber onData error",u)}}}dispatchToAll(c,i){let p=Object.keys(this.symbolEntries);for(let v=0;v<p.length;v++)this.dispatch(p[v],c,i)}markSymbolSubscribed(c,i){this.notifySubscribed(c,i)}markSymbolUnsubscribed(c){let i=this.symbolEntries[c];i&&(i.subscribed=!1,i.subscriptionRequested=!1)}updateSymbolMetadata(c,i){let p=this.symbolEntries[c];p&&t(p.meta,i)}getSymbolMetadata(c){let i=this.symbolEntries[c];return i?i.meta:null}findSymbolByMeta(c){if(typeof c!="function")return null;let i=Object.keys(this.symbolEntries);for(let p=0;p<i.length;p++){let v=this.symbolEntries[i[p]];if(c(v.meta,v.symbol))return v.symbol}return null}hasSubscribers(){let c=Object.keys(this.symbolEntries);for(let i=0;i<c.length;i++)if(this.symbolEntries[c[i]].subscribers.length>0)return!0;return!1}maybeCloseConnection(){this.hasSubscribers()||(this.autoCloseDelayMs>0?this.scheduleCloseTimer():this.closeConnection())}scheduleCloseTimer(){if(this.closeTimer)return;let c=this;this.closeTimer=setTimeout(function(){c.closeTimer=null,c.hasSubscribers()||c.closeConnection()},this.autoCloseDelayMs)}clearCloseTimer(){this.closeTimer&&(clearTimeout(this.closeTimer),this.closeTimer=null)}closeConnection(){if(this.clearReconnectTimer(),!!this.ws){this.wsClosedByUser=!0;try{this.ws.close()}catch(c){this.logger("WebSocketConnectionPool: error closing WebSocket",c)}this.ws=null}}buildSubscriber(c){let i=c||{};return{context:i.context||null,onData:typeof i.onData=="function"?i.onData:null,onError:typeof i.onError=="function"?i.onError:null,onSubscribed:typeof i.onSubscribed=="function"?i.onSubscribed:null,onDisconnected:typeof i.onDisconnected=="function"?i.onDisconnected:null}}buildMessageHelpers(){let c=this;return{dispatch:function(i,p,v){c.dispatch(i,p,v)},dispatchToAll:function(i,p){c.dispatchToAll(i,p)},markSubscribed:function(i,p){c.markSymbolSubscribed(i,p)},markUnsubscribed:function(i){c.markSymbolUnsubscribed(i)},updateMetadata:function(i,p){c.updateSymbolMetadata(i,p)},getMetadata:function(i){return c.getSymbolMetadata(i)},findSymbol:function(i){return c.findSymbolByMeta(i)},getActiveSymbols:function(){return Object.keys(c.symbolEntries)}}}isSocketOpen(){return this.ws&&this.ws.readyState===1}}return{WebSocketConnectionPool:a}})});var Ht=ue((Sn,tt)=>{"use strict";(function(n,t){let a=typeof globalThis!="undefined"?globalThis:n,h=typeof tt=="object"&&tt.exports?[Je(),et(),Qe(),Ye(),Mt()]:[n==null?void 0:n.CryptoTickerProviders,n==null?void 0:n.CryptoTickerProviders,n==null?void 0:n.CryptoTickerProviders,n==null?void 0:n.CryptoTickerConnectionStates,n==null?void 0:n.CryptoTickerProviders],c=t(h[0],h[1],h[2],h[3],h[4]);typeof tt=="object"&&tt.exports&&(tt.exports=c),a&&(a.CryptoTickerProviders=a.CryptoTickerProviders||{},a.CryptoTickerProviders.BinanceProvider=c.BinanceProvider)})(typeof self!="undefined"?self:Sn,function(n,t,a,h,c){let i=n.ProviderInterface||n,p=t.GenericProvider||t,v=a.TickerSubscriptionManager||a,T=h||{LIVE:"live",DETACHED:"detached",BACKUP:"backup",BROKEN:"broken"},x=c.WebSocketConnectionPool||c,y=5e3;function u(){return typeof WebSocket!="undefined"?WebSocket:typeof window!="undefined"&&window.WebSocket?window.WebSocket:typeof global!="undefined"&&global.WebSocket?global.WebSocket:null}function f(l){let g=parseFloat(l);return isNaN(g)?0:g}function k(l){return f(l)/100}function d(l){switch(l){case"MINUTES_1":return"1m";case"MINUTES_5":return"5m";case"MINUTES_15":return"15m";case"HOURS_1":return"1h";case"HOURS_6":return"6h";case"HOURS_12":return"12h";case"DAYS_1":return"1d";case"DAYS_7":return"1w";case"MONTHS_1":return"1M"}return null}class P extends i{constructor(g){super(g);let S=g||{};this.genericFallback=S.genericFallback instanceof p?S.genericFallback:new p(g),this.restBaseUrl=typeof S.binanceRestBaseUrl=="string"&&S.binanceRestBaseUrl.length>0?S.binanceRestBaseUrl:"https://api.binance.com",this.wsBaseUrl=typeof S.binanceWsBaseUrl=="string"&&S.binanceWsBaseUrl.length>0?S.binanceWsBaseUrl:"wss://stream.binance.com:9443/ws",this.symbolOverrides=S.binanceSymbolOverrides||{},this.wsReconnectDelayMs=typeof S.retryDelayMs=="number"?S.retryDelayMs:y;let I={logger:(...C)=>{this.logger(...C)},fetchTicker:this.fetchTickerDirect.bind(this),subscribeStreaming:this.subscribeStream.bind(this),unsubscribeStreaming:this.unsubscribeStream.bind(this),fallbackPollIntervalMs:S.fallbackPollIntervalMs,staleTickerTimeoutMs:S.staleTickerTimeoutMs};this.subscriptionManager=new v(I),this.wsRequestId=0,this.webSocketPool=new x({logger:(...C)=>{this.logger(...C)},reconnectDelayMs:this.wsReconnectDelayMs,createWebSocket:()=>{let C=u();if(!C)return this.logger("BinanceProvider: WebSocket not available in this environment"),null;let N=this.wsBaseUrl.replace(/\/$/,"");try{return new C(N)}catch(E){return this.logger("BinanceProvider: error creating pooled WebSocket",E),null}},subscribe:(C,N)=>{this.sendBinanceSubscription(C,N,!0)},unsubscribe:(C,N)=>{this.sendBinanceSubscription(C,N,!1)},handleMessage:(C,N)=>{this.handlePoolMessage(C,N)},onError:C=>{this.logger("BinanceProvider: pooled WebSocket error",C)},onClose:()=>{this.wsRequestId=0}})}getId(){return"BINANCE"}subscribeTicker(g,S){return this.subscriptionManager.subscribe(g,S)}getCachedTicker(g){let S=this.subscriptionManager.getCachedTicker(g);return S||(this.genericFallback&&typeof this.genericFallback.getCachedTicker=="function"?this.genericFallback.getCachedTicker(g):null)}ensureConnection(){let g=this;this.subscriptionManager.forEachEntry(function(S){g.subscriptionManager.ensureStreaming(S)})}async fetchTicker(g){try{return await this.fetchTickerDirect(g)}catch(S){if(this.logger("BinanceProvider: direct fetch failed, using fallback",S),this.genericFallback&&typeof this.genericFallback.fetchTicker=="function")return this.genericFallback.fetchTicker(g);throw S}}async fetchTickerDirect(g){let S=this.resolveSymbol(g);if(!S)throw new Error("BinanceProvider: unable to resolve symbol for "+(g.symbol||""));let I=this.buildRestUrl(S);try{let C=await fetch(I);if(!C||!C.ok)throw new Error("BinanceProvider: REST response not ok for "+S);let N=await C.json(),E=this.transformRestTicker(N,g,S);return E.connectionState=T.DETACHED,E}catch(C){if(this.logger("BinanceProvider: REST fetch error",C),this.genericFallback&&typeof this.genericFallback.fetchTicker=="function"){let N=await this.genericFallback.fetchTicker(g);return N&&typeof N=="object"&&!N.connectionState&&(N.connectionState=T.BACKUP),N}throw C}}subscribeStream(g){if(!g)return!1;let S=this.ensureEntryMeta(g);if(S.binanceSymbol=this.resolveSymbol(g.params),!S.binanceSymbol)return this.logger("BinanceProvider: cannot subscribe, unresolved symbol",g.params),!1;let I=this.webSocketPool.subscribe(S.binanceSymbol,{context:g,onData:C=>{let N=this.transformStreamTicker(C,g,S.binanceSymbol);this.subscriptionManager.handleStreamingUpdate(g.key,N)},onSubscribed:()=>{g.streamingActive=!0},onDisconnected:()=>{g.streamingActive=!1},onError:C=>{this.logger("BinanceProvider: subscription error",C)}});return I?(S.poolSubscription=I,g.streamingActive=!0,!0):(g.streamingActive=!1,!1)}unsubscribeStream(g){if(!g)return!0;let S=this.ensureEntryMeta(g);return S.poolSubscription&&typeof S.poolSubscription.unsubscribe=="function"&&S.poolSubscription.unsubscribe(),S.poolSubscription=null,g.streamingActive=!1,!0}resolveSymbol(g){if(!g)return null;let S=(g.symbol||"").toUpperCase();return S?this.symbolOverrides&&this.symbolOverrides[S]?(this.symbolOverrides[S]||"").toUpperCase():S.endsWith("USD")?S.slice(0,-3)+"USDT":S:null}buildRestUrl(g){return this.restBaseUrl.replace(/\/$/,"")+"/api/v3/ticker/24hr?symbol="+encodeURIComponent(g)}sendBinanceSubscription(g,S,I){if(!g||!S)return;let C=S.toLowerCase()+"@ticker",N={method:I?"SUBSCRIBE":"UNSUBSCRIBE",params:[C],id:this.nextWsRequestId()};try{g.send(JSON.stringify(N))}catch(E){this.logger("BinanceProvider: error sending subscription message",E)}}nextWsRequestId(){return this.wsRequestId+=1,this.wsRequestId>1e6&&(this.wsRequestId=1),this.wsRequestId}handlePoolMessage(g,S){if(!g)return;let I=g.data;if(!I)return;if(typeof I=="string")try{I=JSON.parse(I)}catch(E){this.logger("BinanceProvider: failed to parse WebSocket message",E);return}if(!I||Array.isArray(I))return;if(I.error){this.logger("BinanceProvider: WebSocket error message",I.error);return}if(typeof I.result!="undefined")return;let C=I;if(I.data&&typeof I.data=="object"&&(C=I.data),!C||typeof C!="object")return;let N=(C.s||C.symbol||"").toUpperCase();N&&(S.markSubscribed(N),S.dispatch(N,C,I))}transformRestTicker(g,S,I){let C=S&&S.symbol?S.symbol:I;return{changeDaily:f(g.priceChange),changeDailyPercent:k(g.priceChangePercent),last:f(g.lastPrice),volume:f(g.volume),high:f(g.highPrice),low:f(g.lowPrice),pair:C,pairDisplay:C}}transformStreamTicker(g,S,I){let C=S?S.params:null,N=C&&C.symbol?C.symbol:I;return{changeDaily:f(g.p||g.priceChange),changeDailyPercent:k(g.P||g.priceChangePercent),last:f(g.c||g.lastPrice),volume:f(g.v||g.volume),high:f(g.h||g.highPrice),low:f(g.l||g.lowPrice),pair:N,pairDisplay:N}}ensureEntryMeta(g){return g.meta=g.meta||{},g.meta}async fetchCandles(g){let S=this.resolveSymbol(g);if(!S)throw new Error("BinanceProvider: unable to resolve symbol for candles");let I=d(g.interval);if(!I)throw new Error("BinanceProvider: unsupported interval "+g.interval);let C=Math.min(Math.max(parseInt(g.limit,10)||24,1),1e3),E=this.restBaseUrl.replace(/\/$/,"")+"/api/v3/klines?symbol="+encodeURIComponent(S)+"&interval="+encodeURIComponent(I)+"&limit="+C;try{let B=await fetch(E);if(!B||!B.ok)throw new Error("BinanceProvider: candles response not ok");let z=await B.json();if(!Array.isArray(z))throw new Error("BinanceProvider: unexpected candles payload");return z.map(function(O){return{ts:Math.floor((O[0]||0)/1e3),open:f(O[1]),high:f(O[2]),low:f(O[3]),close:f(O[4]),volume:f(O[5]),volumeQuote:f(O[7])}})}catch(B){if(this.logger("BinanceProvider: error fetching candles",B),this.genericFallback&&typeof this.genericFallback.fetchCandles=="function")return this.genericFallback.fetchCandles(g);throw B}}}return{BinanceProvider:P}})});var qt=ue((kn,nt)=>{"use strict";(function(n,t){let a=typeof globalThis!="undefined"?globalThis:n,h=typeof nt=="object"&&nt.exports?[Je(),et(),Qe(),Ye(),Mt()]:[n==null?void 0:n.CryptoTickerProviders,n==null?void 0:n.CryptoTickerProviders,n==null?void 0:n.CryptoTickerProviders,n==null?void 0:n.CryptoTickerConnectionStates,n==null?void 0:n.CryptoTickerProviders],c=t(h[0],h[1],h[2],h[3],h[4]);typeof nt=="object"&&nt.exports&&(nt.exports=c),a&&(a.CryptoTickerProviders=a.CryptoTickerProviders||{},a.CryptoTickerProviders.BitfinexProvider=c.BitfinexProvider)})(typeof self!="undefined"?self:kn,function(n,t,a,h,c){let i=n.ProviderInterface||n,p=t.GenericProvider||t,v=a.TickerSubscriptionManager||a,T=h||{LIVE:"live",DETACHED:"detached",BACKUP:"backup",BROKEN:"broken"},x=c.WebSocketConnectionPool||c,y=5e3;function u(){return typeof WebSocket!="undefined"?WebSocket:typeof window!="undefined"&&window.WebSocket?window.WebSocket:typeof global!="undefined"&&global.WebSocket?global.WebSocket:null}function f(P){let l=parseFloat(P);return isNaN(l)?0:l}function k(P){switch(P){case"MINUTES_1":return"1m";case"MINUTES_5":return"5m";case"MINUTES_15":return"15m";case"HOURS_1":return"1h";case"HOURS_6":return"6h";case"HOURS_12":return"12h";case"DAYS_1":return"1D";case"DAYS_7":return"1W";case"MONTHS_1":return"1M"}return null}class d extends i{constructor(l){super(l);let g=l||{};this.genericFallback=g.genericFallback instanceof p?g.genericFallback:new p(l),this.restBaseUrl=typeof g.bitfinexRestBaseUrl=="string"&&g.bitfinexRestBaseUrl.length>0?g.bitfinexRestBaseUrl:"https://api-pub.bitfinex.com",this.wsBaseUrl=typeof g.bitfinexWsBaseUrl=="string"&&g.bitfinexWsBaseUrl.length>0?g.bitfinexWsBaseUrl:"wss://api-pub.bitfinex.com/ws/2",this.symbolOverrides=g.bitfinexSymbolOverrides||{},this.wsReconnectDelayMs=typeof g.retryDelayMs=="number"?g.retryDelayMs:y;let S={logger:(...I)=>{this.logger(...I)},fetchTicker:this.fetchTickerDirect.bind(this),subscribeStreaming:this.subscribeStream.bind(this),unsubscribeStreaming:this.unsubscribeStream.bind(this),fallbackPollIntervalMs:g.fallbackPollIntervalMs,staleTickerTimeoutMs:g.staleTickerTimeoutMs};this.subscriptionManager=new v(S),this.channelIdToSymbol={},this.webSocketPool=new x({logger:(...I)=>{this.logger(...I)},reconnectDelayMs:this.wsReconnectDelayMs,createWebSocket:()=>{let I=u();if(!I)return this.logger("BitfinexProvider: WebSocket not available in this environment"),null;let C=this.wsBaseUrl.replace(/\/$/,"");try{return new I(C)}catch(N){return this.logger("BitfinexProvider: error creating pooled WebSocket",N),null}},subscribe:(I,C)=>{this.sendBitfinexSubscribe(I,C)},unsubscribe:(I,C,N)=>{this.sendBitfinexUnsubscribe(I,C,N)},handleMessage:(I,C)=>{this.handlePoolMessage(I,C)},onError:I=>{this.logger("BitfinexProvider: pooled WebSocket error",I)},onClose:()=>{this.channelIdToSymbol={}}})}getId(){return"BITFINEX"}subscribeTicker(l,g){return this.subscriptionManager.subscribe(l,g)}getCachedTicker(l){let g=this.subscriptionManager.getCachedTicker(l);return g||(this.genericFallback&&typeof this.genericFallback.getCachedTicker=="function"?this.genericFallback.getCachedTicker(l):null)}ensureConnection(){let l=this;this.subscriptionManager.forEachEntry(function(g){l.subscriptionManager.ensureStreaming(g)})}async fetchTicker(l){try{return await this.fetchTickerDirect(l)}catch(g){if(this.logger("BitfinexProvider: direct fetch failed, using fallback",g),this.genericFallback&&typeof this.genericFallback.fetchTicker=="function")return this.genericFallback.fetchTicker(l);throw g}}async fetchTickerDirect(l){let g=this.resolveSymbol(l);if(!g)throw new Error("BitfinexProvider: unable to resolve symbol for "+(l.symbol||""));let S=this.buildRestUrl(g);try{let I=await fetch(S);if(!I||!I.ok)throw new Error("BitfinexProvider: REST response not ok for "+g);let C=await I.json(),N=this.transformRestTicker(C,l,g);return N.connectionState=T.DETACHED,N}catch(I){if(this.logger("BitfinexProvider: REST fetch error",I),this.genericFallback&&typeof this.genericFallback.fetchTicker=="function"){let C=await this.genericFallback.fetchTicker(l);return C&&typeof C=="object"&&!C.connectionState&&(C.connectionState=T.BACKUP),C}throw I}}subscribeStream(l){if(!l)return!1;let g=this.ensureEntryMeta(l);if(g.bitfinexSymbol=this.resolveSymbol(l.params),!g.bitfinexSymbol)return this.logger("BitfinexProvider: cannot subscribe, unresolved symbol",l.params),!1;g.chanId=null;let S=this.webSocketPool.subscribe(g.bitfinexSymbol,{context:l,onData:I=>{let C=this.buildTickerFromArray(I,l);C&&this.subscriptionManager.handleStreamingUpdate(l.key,C)},onSubscribed:()=>{l.streamingActive=!0;let I=S.getMetadata?S.getMetadata():null;I&&I.chanId&&(g.chanId=I.chanId,this.channelIdToSymbol[g.chanId]=g.bitfinexSymbol)},onDisconnected:()=>{l.streamingActive=!1,g.chanId=null},onError:I=>{this.logger("BitfinexProvider: subscription error",I)}});return S?(g.poolSubscription=S,l.streamingActive=!0,!0):(l.streamingActive=!1,!1)}unsubscribeStream(l){if(!l)return!0;let g=this.ensureEntryMeta(l);return g.poolSubscription&&typeof g.poolSubscription.unsubscribe=="function"&&g.poolSubscription.unsubscribe(),g.poolSubscription=null,g.chanId=null,l.streamingActive=!1,!0}resolveSymbol(l){if(!l)return null;let g=(l.symbol||"").toUpperCase();if(!g)return null;if(this.symbolOverrides&&this.symbolOverrides[g])return(this.symbolOverrides[g]||"").toUpperCase();let S=g.replace(/[:/]/g,"");if(!S)return null;let I=S.toUpperCase();return"t"+(I.startsWith("T")?I.substring(1):I)}buildRestUrl(l){return this.restBaseUrl.replace(/\/$/,"")+"/v2/ticker/"+encodeURIComponent(l)}sendBitfinexSubscribe(l,g){if(!l||!g)return;let S={event:"subscribe",channel:"ticker",symbol:g};try{l.send(JSON.stringify(S))}catch(I){this.logger("BitfinexProvider: error sending subscribe",I)}}sendBitfinexUnsubscribe(l,g,S){if(!l)return;let I=S&&S.chanId;if(I)try{l.send(JSON.stringify({event:"unsubscribe",chanId:I}))}catch(C){this.logger("BitfinexProvider: error sending unsubscribe",C)}}handlePoolMessage(l,g){if(!l)return;let S=l.data;if(S){if(typeof S=="string")try{S=JSON.parse(S)}catch(I){this.logger("BitfinexProvider: failed to parse WebSocket message",I);return}if(S){if(Array.isArray(S)){this.handleBitfinexDataArray(S,g);return}S&&typeof S=="object"&&this.handleBitfinexEvent(S,g)}}}handleBitfinexEvent(l,g){if(!l||typeof l!="object")return;let S=l.event;if(S==="subscribed"&&l.channel==="ticker"){let I=typeof l.symbol=="string"?l.symbol:"";if(!I)return;let C=l.chanId;C&&(this.channelIdToSymbol[C]=I),g.markSubscribed(I,{chanId:C||null});return}if(S==="unsubscribed"){let I=l.chanId,C=null;I&&(C=this.channelIdToSymbol[I]||g.findSymbol(function(N){return N&&N.chanId===I}),delete this.channelIdToSymbol[I]),C&&(g.markUnsubscribed(C),g.updateMetadata(C,{chanId:null}));return}S==="error"&&this.logger("BitfinexProvider: subscription error",l)}handleBitfinexDataArray(l,g){if(!Array.isArray(l)||l.length<2)return;let S=l[0],I=l[1];if(I==="hb"||!Array.isArray(I))return;let C=this.channelIdToSymbol[S]||g.findSymbol(function(N){return N&&N.chanId===S});C&&g.dispatch(C,I,l)}buildTickerFromArray(l,g){if(!Array.isArray(l))return null;let S=g?g.params:null,I=S&&S.symbol?S.symbol:this.ensureEntryMeta(g).bitfinexSymbol;return{changeDaily:f(l[4]),changeDailyPercent:f(l[5]),last:f(l[6]),volume:f(l[7]),high:f(l[8]),low:f(l[9]),pair:I,pairDisplay:I}}transformRestTicker(l,g,S){if(!Array.isArray(l))throw new Error("BitfinexProvider: unexpected REST payload for "+S);let I=g&&g.symbol?g.symbol:S;return{changeDaily:f(l[4]),changeDailyPercent:f(l[5]),last:f(l[6]),volume:f(l[7]),high:f(l[8]),low:f(l[9]),pair:I,pairDisplay:I}}ensureEntryMeta(l){return l.meta=l.meta||{},l.meta}async fetchCandles(l){let g=this.resolveSymbol(l);if(!g)throw new Error("BitfinexProvider: unable to resolve symbol for candles");let S=k(l.interval);if(!S)throw new Error("BitfinexProvider: unsupported interval "+l.interval);let I=Math.min(Math.max(parseInt(l.limit,10)||24,1),1e3),N=this.restBaseUrl.replace(/\/$/,"")+"/v2/candles/trade:"+S+":"+encodeURIComponent(g)+"/hist?limit="+I;try{let E=await fetch(N);if(!E||!E.ok)throw new Error("BitfinexProvider: candles response not ok");let B=await E.json();if(!Array.isArray(B))throw new Error("BitfinexProvider: unexpected candles payload");return B.map(function(z){return{ts:Math.floor((z[0]||0)/1e3),open:f(z[1]),close:f(z[2]),high:f(z[3]),low:f(z[4]),volume:f(z[5]),volumeQuote:f(z[5])}})}catch(E){if(this.logger("BitfinexProvider: error fetching candles",E),this.genericFallback&&typeof this.genericFallback.fetchCandles=="function")return this.genericFallback.fetchCandles(l);throw E}}}return{BitfinexProvider:d}})});var Vt=ue((Tn,rt)=>{"use strict";(function(n,t){let a=typeof globalThis!="undefined"?globalThis:n,h=typeof rt=="object"&&rt.exports?[Je(),et(),Qe(),yt()]:[n==null?void 0:n.CryptoTickerProviders,n==null?void 0:n.CryptoTickerProviders,n==null?void 0:n.CryptoTickerProviders,n==null?void 0:n.CryptoTickerProviders],c=t(h[0],h[1],h[2],h[3]);typeof rt=="object"&&rt.exports&&(rt.exports=c),a&&(a.CryptoTickerProviders=a.CryptoTickerProviders||{},a.CryptoTickerProviders.YFinanceProvider=c.YFinanceProvider)})(typeof self!="undefined"?self:Tn,function(n,t,a,h){let c=n.ProviderInterface||n,i=t.GenericProvider||t,p=a.TickerSubscriptionManager||a,v=h.buildSubscriptionKey||h;class T extends c{constructor(y){super(y);let u=y||{};this.genericFallback=u.genericFallback instanceof i?u.genericFallback:new i(y);let f={logger:(...k)=>{this.logger(...k)},fetchTicker:k=>this.genericFallback.fetchTicker(k),subscribeStreaming:null,unsubscribeStreaming:null,ensureConnection:null,buildSubscriptionKey:function(k,d,P,l){return v(k,d,P,l)},fallbackPollIntervalMs:u.fallbackPollIntervalMs,staleTickerTimeoutMs:u.staleTickerTimeoutMs};this.subscriptionManager=new p(f)}getId(){return"YFINANCE"}ensureConnection(){}subscribeTicker(y,u){return this.subscriptionManager.subscribe(y,u)}async fetchTicker(y){return this.genericFallback.fetchTicker(y)}async fetchCandles(y){return this.genericFallback&&typeof this.genericFallback.fetchCandles=="function"?this.genericFallback.fetchCandles(y):c.prototype.fetchCandles.call(this,y)}getCachedTicker(y){let u=this.subscriptionManager.getCachedTicker(y);return u||this.genericFallback.getCachedTicker(y)}}return{YFinanceProvider:T}})});var xn=ue((En,it)=>{"use strict";(function(n,t){let a=typeof globalThis!="undefined"?globalThis:n,h=typeof it=="object"&&it.exports?[et(),Ht(),qt(),Vt()]:[n==null?void 0:n.CryptoTickerProviders,n==null?void 0:n.CryptoTickerProviders,n==null?void 0:n.CryptoTickerProviders,n==null?void 0:n.CryptoTickerProviders],c=t(h[0],h[1],h[2],h[3]);typeof it=="object"&&it.exports&&(it.exports=c),a&&(a.CryptoTickerProviders=a.CryptoTickerProviders||{},a.CryptoTickerProviders.ProviderRegistry=c.ProviderRegistry)})(typeof self!="undefined"?self:En,function(n,t,a,h){let c=n.GenericProvider||n,i=t.BinanceProvider||t,p=a.BitfinexProvider||a,v=h.YFinanceProvider||h;class T{constructor(y){let u=y||{};this.logger=typeof u.logger=="function"?u.logger:function(){},this.baseUrl=u.baseUrl||"",this.providers={},this.fallbackPollIntervalMs=typeof u.fallbackPollIntervalMs=="number"?u.fallbackPollIntervalMs:void 0,this.staleTickerTimeoutMs=typeof u.staleTickerTimeoutMs=="number"?u.staleTickerTimeoutMs:void 0,this.binanceRestBaseUrl=typeof u.binanceRestBaseUrl=="string"&&u.binanceRestBaseUrl.length>0?u.binanceRestBaseUrl:"https://api.binance.com",this.binanceWsBaseUrl=typeof u.binanceWsBaseUrl=="string"&&u.binanceWsBaseUrl.length>0?u.binanceWsBaseUrl:"wss://stream.binance.com:9443/ws",this.binanceSymbolOverrides=u.binanceSymbolOverrides||{},this.bitfinexRestBaseUrl=typeof u.bitfinexRestBaseUrl=="string"&&u.bitfinexRestBaseUrl.length>0?u.bitfinexRestBaseUrl:"https://api-pub.bitfinex.com",this.bitfinexWsBaseUrl=typeof u.bitfinexWsBaseUrl=="string"&&u.bitfinexWsBaseUrl.length>0?u.bitfinexWsBaseUrl:"wss://api-pub.bitfinex.com/ws/2",this.bitfinexSymbolOverrides=u.bitfinexSymbolOverrides||{};let f={baseUrl:this.baseUrl,logger:this.logger,fallbackPollIntervalMs:this.fallbackPollIntervalMs,staleTickerTimeoutMs:this.staleTickerTimeoutMs};this.genericProvider=u.genericProvider instanceof c?u.genericProvider:new c(f),this.register(this.genericProvider),this.register(new i({baseUrl:this.baseUrl,logger:this.logger,fallbackPollIntervalMs:this.fallbackPollIntervalMs,staleTickerTimeoutMs:this.staleTickerTimeoutMs,genericFallback:this.genericProvider,binanceRestBaseUrl:this.binanceRestBaseUrl,binanceWsBaseUrl:this.binanceWsBaseUrl,binanceSymbolOverrides:this.binanceSymbolOverrides})),this.register(new p({baseUrl:this.baseUrl,logger:this.logger,fallbackPollIntervalMs:this.fallbackPollIntervalMs,staleTickerTimeoutMs:this.staleTickerTimeoutMs,genericFallback:this.genericProvider,bitfinexRestBaseUrl:this.bitfinexRestBaseUrl,bitfinexWsBaseUrl:this.bitfinexWsBaseUrl,bitfinexSymbolOverrides:this.bitfinexSymbolOverrides})),this.register(new v({baseUrl:this.baseUrl,logger:this.logger,fallbackPollIntervalMs:this.fallbackPollIntervalMs,staleTickerTimeoutMs:this.staleTickerTimeoutMs,genericFallback:this.genericProvider}))}register(y){if(!y||typeof y.getId!="function")return;let u=y.getId();u&&(this.providers[u.toUpperCase()]=y)}getProvider(y){let u=(y||"").toUpperCase();return this.providers[u]||this.genericProvider}getGenericProvider(){return this.genericProvider}ensureAllConnections(){let y=Object.keys(this.providers);for(let u=0;u<y.length;u++){let f=this.providers[y[u]];f&&typeof f.ensureConnection=="function"&&f.ensureConnection()}}}return{ProviderRegistry:T}})});var Gt=ue((Pn,It)=>{"use strict";(function(n,t){let a=t();typeof It=="object"&&It.exports&&(It.exports=a),n&&typeof n=="object"&&(n.CryptoTickerFormatters=a)})(typeof self!="undefined"?self:Pn,function(){let n=["auto","full","compact","plain"],t=[{value:1e12,suffix:"T"},{value:1e9,suffix:"B"},{value:1e6,suffix:"M"},{value:1e3,suffix:"K"}],a=",",h=".";function c(v){let T=v&&typeof v.thousandsSeparator=="string"?v.thousandsSeparator:null,x=v&&typeof v.decimalSeparator=="string"?v.decimalSeparator:null,y=T&&T.length>0?T:a,u=x&&x.length>0?x:h;return{thousandsSeparator:y,decimalSeparator:u}}function i(v,T,x,y,u){let f=y||"auto",d=typeof T=="number"?T:parseInt(String(T!=null?T:""),10);(Number.isNaN(d)||d<0)&&(d=2);let P=v*(typeof x=="number"?x:1),l=Math.abs(P),g=P<0?"-":"",S=c(u),I=S.thousandsSeparator,C=S.decimalSeparator;function N(O,G){let X=Math.pow(10,G);return Math.round(O*X)/X}function E(O,G){let X=O.toFixed(z),V=X,ee="",$=X.indexOf(".");$>=0&&(V=X.slice(0,$),ee=X.slice($+1));let H=V;return G&&I&&(H=V.replace(/\B(?=(\d{3})+(?!\d))/g,I)),ee&&z>0?H+C+ee:z>0?H+C+"0".repeat(z):H}let B="",z=Math.max(0,d);switch(f){case"full":case"plain":{let O=N(l,z);B=E(O,f==="full");break}case"auto":case"compact":default:{let O="",G=l;for(let V of t){let ee=V.suffix==="K"?V.value*100:V.value;if(l>=ee){O=V.suffix,G=l/V.value;break}}let X=N(G,z);B=E(X,!O)+O;break}}return g+B}function p(v,T,x){return x-T===0?.5:(v-T)/(x-T)}return{getRoundedValue:i,normalizeValue:p}})});var Mn=ue((At,Rn)=>{(function(n,t){typeof At=="object"&&typeof Rn!="undefined"?t(At):typeof define=="function"&&define.amd?define(["exports"],t):(n=n||self,t(n.exprEval={}))})(At,function(n){"use strict";var t="INUMBER",a="IOP1",h="IOP2",c="IOP3",i="IVAR",p="IVARNAME",v="IFUNCALL",T="IFUNDEF",x="IEXPR",y="IEXPREVAL",u="IMEMBER",f="IENDSTATEMENT",k="IARRAY";function d(r,s){this.type=r,this.value=s!=null?s:0}d.prototype.toString=function(){switch(this.type){case t:case a:case h:case c:case i:case p:case f:return this.value;case v:return"CALL "+this.value;case T:return"DEF "+this.value;case k:return"ARRAY "+this.value;case u:return"."+this.value;default:return"Invalid Instruction"}};function P(r){return new d(a,r)}function l(r){return new d(h,r)}function g(r){return new d(c,r)}function S(r,s,m,R,U){for(var W=[],_=[],J,re,le,ce,ge=0;ge<r.length;ge++){var Y=r[ge],de=Y.type;if(de===t||de===p)Array.isArray(Y.value)?W.push.apply(W,S(Y.value.map(function(Ct){return new d(t,Ct)}).concat(new d(k,Y.value.length)),s,m,R,U)):W.push(Y);else if(de===i&&U.hasOwnProperty(Y.value))Y=new d(t,U[Y.value]),W.push(Y);else if(de===h&&W.length>1)re=W.pop(),J=W.pop(),ce=m[Y.value],Y=new d(t,ce(J.value,re.value)),W.push(Y);else if(de===c&&W.length>2)le=W.pop(),re=W.pop(),J=W.pop(),Y.value==="?"?W.push(J.value?re.value:le.value):(ce=R[Y.value],Y=new d(t,ce(J.value,re.value,le.value)),W.push(Y));else if(de===a&&W.length>0)J=W.pop(),ce=s[Y.value],Y=new d(t,ce(J.value)),W.push(Y);else if(de===x){for(;W.length>0;)_.push(W.shift());_.push(new d(x,S(Y.value,s,m,R,U)))}else if(de===u&&W.length>0)J=W.pop(),W.push(new d(t,J.value[Y.value]));else{for(;W.length>0;)_.push(W.shift());_.push(Y)}}for(;W.length>0;)_.push(W.shift());return _}function I(r,s,m){for(var R=[],U=0;U<r.length;U++){var W=r[U],_=W.type;if(_===i&&W.value===s)for(var J=0;J<m.tokens.length;J++){var re=m.tokens[J],le;re.type===a?le=P(re.value):re.type===h?le=l(re.value):re.type===c?le=g(re.value):le=new d(re.type,re.value),R.push(le)}else _===x?R.push(new d(x,I(W.value,s,m))):R.push(W)}return R}function C(r,s,m){var R=[],U,W,_,J,re,le;if(E(r))return B(r,m);for(var ce=r.length,ge=0;ge<ce;ge++){var Y=r[ge],de=Y.type;if(de===t||de===p)R.push(Y.value);else if(de===h)W=R.pop(),U=R.pop(),Y.value==="and"?R.push(U?!!C(W,s,m):!1):Y.value==="or"?R.push(U?!0:!!C(W,s,m)):Y.value==="="?(J=s.binaryOps[Y.value],R.push(J(U,C(W,s,m),m))):(J=s.binaryOps[Y.value],R.push(J(B(U,m),B(W,m))));else if(de===c)_=R.pop(),W=R.pop(),U=R.pop(),Y.value==="?"?R.push(C(U?W:_,s,m)):(J=s.ternaryOps[Y.value],R.push(J(B(U,m),B(W,m),B(_,m))));else if(de===i)if(Y.value in s.functions)R.push(s.functions[Y.value]);else if(Y.value in s.unaryOps&&s.parser.isOperatorEnabled(Y.value))R.push(s.unaryOps[Y.value]);else{var Ct=m[Y.value];if(Ct!==void 0)R.push(Ct);else throw new Error("undefined variable: "+Y.value)}else if(de===a)U=R.pop(),J=s.unaryOps[Y.value],R.push(J(B(U,m)));else if(de===v){for(le=Y.value,re=[];le-- >0;)re.unshift(B(R.pop(),m));if(J=R.pop(),J.apply&&J.call)R.push(J.apply(void 0,re));else throw new Error(J+" is not a function")}else if(de===T)R.push(function(){for(var dr=R.pop(),$t=[],pr=Y.value;pr-- >0;)$t.unshift(R.pop());var an=R.pop(),Wt=function(){for(var cn=Object.assign({},m),wt=0,gr=$t.length;wt<gr;wt++)cn[$t[wt]]=arguments[wt];return C(dr,s,cn)};return Object.defineProperty(Wt,"name",{value:an,writable:!1}),m[an]=Wt,Wt}());else if(de===x)R.push(N(Y,s));else if(de===y)R.push(Y);else if(de===u)U=R.pop(),R.push(U[Y.value]);else if(de===f)R.pop();else if(de===k){for(le=Y.value,re=[];le-- >0;)re.unshift(R.pop());R.push(re)}else throw new Error("invalid Expression")}if(R.length>1)throw new Error("invalid Expression (parity)");return R[0]===0?0:B(R[0],m)}function N(r,s,m){return E(r)?r:{type:y,value:function(R){return C(r.value,s,R)}}}function E(r){return r&&r.type===y}function B(r,s){return E(r)?r.value(s):r}function z(r,s){for(var m=[],R,U,W,_,J,re,le=0;le<r.length;le++){var ce=r[le],ge=ce.type;if(ge===t)typeof ce.value=="number"&&ce.value<0?m.push("("+ce.value+")"):Array.isArray(ce.value)?m.push("["+ce.value.map(O).join(", ")+"]"):m.push(O(ce.value));else if(ge===h)U=m.pop(),R=m.pop(),_=ce.value,s?_==="^"?m.push("Math.pow("+R+", "+U+")"):_==="and"?m.push("(!!"+R+" && !!"+U+")"):_==="or"?m.push("(!!"+R+" || !!"+U+")"):_==="||"?m.push("(function(a,b){ return Array.isArray(a) && Array.isArray(b) ? a.concat(b) : String(a) + String(b); }(("+R+"),("+U+")))"):_==="=="?m.push("("+R+" === "+U+")"):_==="!="?m.push("("+R+" !== "+U+")"):_==="["?m.push(R+"[("+U+") | 0]"):m.push("("+R+" "+_+" "+U+")"):_==="["?m.push(R+"["+U+"]"):m.push("("+R+" "+_+" "+U+")");else if(ge===c)if(W=m.pop(),U=m.pop(),R=m.pop(),_=ce.value,_==="?")m.push("("+R+" ? "+U+" : "+W+")");else throw new Error("invalid Expression");else if(ge===i||ge===p)m.push(ce.value);else if(ge===a)R=m.pop(),_=ce.value,_==="-"||_==="+"?m.push("("+_+R+")"):s?_==="not"?m.push("(!"+R+")"):_==="!"?m.push("fac("+R+")"):m.push(_+"("+R+")"):_==="!"?m.push("("+R+"!)"):m.push("("+_+" "+R+")");else if(ge===v){for(re=ce.value,J=[];re-- >0;)J.unshift(m.pop());_=m.pop(),m.push(_+"("+J.join(", ")+")")}else if(ge===T){for(U=m.pop(),re=ce.value,J=[];re-- >0;)J.unshift(m.pop());R=m.pop(),s?m.push("("+R+" = function("+J.join(", ")+") { return "+U+" })"):m.push("("+R+"("+J.join(", ")+") = "+U+")")}else if(ge===u)R=m.pop(),m.push(R+"."+ce.value);else if(ge===k){for(re=ce.value,J=[];re-- >0;)J.unshift(m.pop());m.push("["+J.join(", ")+"]")}else if(ge===x)m.push("("+z(ce.value,s)+")");else if(ge!==f)throw new Error("invalid Expression")}return m.length>1&&(s?m=[m.join(",")]:m=[m.join(";")]),String(m[0])}function O(r){return typeof r=="string"?JSON.stringify(r).replace(/\u2028/g,"\\u2028").replace(/\u2029/g,"\\u2029"):r}function G(r,s){for(var m=0;m<r.length;m++)if(r[m]===s)return!0;return!1}function X(r,s,m){m=m||{};for(var R=!!m.withMembers,U=null,W=0;W<r.length;W++){var _=r[W];_.type===i||_.type===p?!R&&!G(s,_.value)?s.push(_.value):(U!==null&&(G(s,U)||s.push(U)),U=_.value):_.type===u&&R&&U!==null?U+="."+_.value:_.type===x?X(_.value,s,m):U!==null&&(G(s,U)||s.push(U),U=null)}U!==null&&!G(s,U)&&s.push(U)}function V(r,s){this.tokens=r,this.parser=s,this.unaryOps=s.unaryOps,this.binaryOps=s.binaryOps,this.ternaryOps=s.ternaryOps,this.functions=s.functions}V.prototype.simplify=function(r){return r=r||{},new V(S(this.tokens,this.unaryOps,this.binaryOps,this.ternaryOps,r),this.parser)},V.prototype.substitute=function(r,s){return s instanceof V||(s=this.parser.parse(String(s))),new V(I(this.tokens,r,s),this.parser)},V.prototype.evaluate=function(r){return r=r||{},C(this.tokens,this,r)},V.prototype.toString=function(){return z(this.tokens,!1)},V.prototype.symbols=function(r){r=r||{};var s=[];return X(this.tokens,s,r),s},V.prototype.variables=function(r){r=r||{};var s=[];X(this.tokens,s,r);var m=this.functions;return s.filter(function(R){return!(R in m)})},V.prototype.toJSFunction=function(r,s){var m=this,R=new Function(r,"with(this.functions) with (this.ternaryOps) with (this.binaryOps) with (this.unaryOps) { return "+z(this.simplify(s).tokens,!0)+"; }");return function(){return R.apply(m,arguments)}};var ee="TEOF",$="TOP",H="TNUMBER",he="TSTRING",F="TPAREN",q="TBRACKET",ve="TCOMMA",Se="TNAME",ye="TSEMICOLON";function fe(r,s,m){this.type=r,this.value=s,this.index=m}fe.prototype.toString=function(){return this.type+": "+this.value};function te(r,s){this.pos=0,this.current=null,this.unaryOps=r.unaryOps,this.binaryOps=r.binaryOps,this.ternaryOps=r.ternaryOps,this.consts=r.consts,this.expression=s,this.savedPosition=0,this.savedCurrent=null,this.options=r.options,this.parser=r}te.prototype.newToken=function(r,s,m){return new fe(r,s,m!=null?m:this.pos)},te.prototype.save=function(){this.savedPosition=this.pos,this.savedCurrent=this.current},te.prototype.restore=function(){this.pos=this.savedPosition,this.current=this.savedCurrent},te.prototype.next=function(){if(this.pos>=this.expression.length)return this.newToken(ee,"EOF");if(this.isWhitespace()||this.isComment())return this.next();if(this.isRadixInteger()||this.isNumber()||this.isOperator()||this.isString()||this.isParen()||this.isBracket()||this.isComma()||this.isSemicolon()||this.isNamedOp()||this.isConst()||this.isName())return this.current;this.parseError('Unknown character "'+this.expression.charAt(this.pos)+'"')},te.prototype.isString=function(){var r=!1,s=this.pos,m=this.expression.charAt(s);if(m==="'"||m==='"')for(var R=this.expression.indexOf(m,s+1);R>=0&&this.pos<this.expression.length;){if(this.pos=R+1,this.expression.charAt(R-1)!=="\\"){var U=this.expression.substring(s+1,R);this.current=this.newToken(he,this.unescape(U),s),r=!0;break}R=this.expression.indexOf(m,R+1)}return r},te.prototype.isParen=function(){var r=this.expression.charAt(this.pos);return r==="("||r===")"?(this.current=this.newToken(F,r),this.pos++,!0):!1},te.prototype.isBracket=function(){var r=this.expression.charAt(this.pos);return(r==="["||r==="]")&&this.isOperatorEnabled("[")?(this.current=this.newToken(q,r),this.pos++,!0):!1},te.prototype.isComma=function(){var r=this.expression.charAt(this.pos);return r===","?(this.current=this.newToken(ve,","),this.pos++,!0):!1},te.prototype.isSemicolon=function(){var r=this.expression.charAt(this.pos);return r===";"?(this.current=this.newToken(ye,";"),this.pos++,!0):!1},te.prototype.isConst=function(){for(var r=this.pos,s=r;s<this.expression.length;s++){var m=this.expression.charAt(s);if(m.toUpperCase()===m.toLowerCase()&&(s===this.pos||m!=="_"&&m!=="."&&(m<"0"||m>"9")))break}if(s>r){var R=this.expression.substring(r,s);if(R in this.consts)return this.current=this.newToken(H,this.consts[R]),this.pos+=R.length,!0}return!1},te.prototype.isNamedOp=function(){for(var r=this.pos,s=r;s<this.expression.length;s++){var m=this.expression.charAt(s);if(m.toUpperCase()===m.toLowerCase()&&(s===this.pos||m!=="_"&&(m<"0"||m>"9")))break}if(s>r){var R=this.expression.substring(r,s);if(this.isOperatorEnabled(R)&&(R in this.binaryOps||R in this.unaryOps||R in this.ternaryOps))return this.current=this.newToken($,R),this.pos+=R.length,!0}return!1},te.prototype.isName=function(){for(var r=this.pos,s=r,m=!1;s<this.expression.length;s++){var R=this.expression.charAt(s);if(R.toUpperCase()===R.toLowerCase()){if(s===this.pos&&(R==="$"||R==="_")){R==="_"&&(m=!0);continue}else if(s===this.pos||!m||R!=="_"&&(R<"0"||R>"9"))break}else m=!0}if(m){var U=this.expression.substring(r,s);return this.current=this.newToken(Se,U),this.pos+=U.length,!0}return!1},te.prototype.isWhitespace=function(){for(var r=!1,s=this.expression.charAt(this.pos);(s===" "||s==="	"||s===`
`||s==="\r")&&(r=!0,this.pos++,!(this.pos>=this.expression.length));)s=this.expression.charAt(this.pos);return r};var Ee=/^[0-9a-f]{4}$/i;te.prototype.unescape=function(r){var s=r.indexOf("\\");if(s<0)return r;for(var m=r.substring(0,s);s>=0;){var R=r.charAt(++s);switch(R){case"'":m+="'";break;case'"':m+='"';break;case"\\":m+="\\";break;case"/":m+="/";break;case"b":m+="\b";break;case"f":m+="\f";break;case"n":m+=`
`;break;case"r":m+="\r";break;case"t":m+="	";break;case"u":var U=r.substring(s+1,s+5);Ee.test(U)||this.parseError("Illegal escape sequence: \\u"+U),m+=String.fromCharCode(parseInt(U,16)),s+=4;break;default:throw this.parseError('Illegal escape sequence: "\\'+R+'"')}++s;var W=r.indexOf("\\",s);m+=r.substring(s,W<0?r.length:W),s=W}return m},te.prototype.isComment=function(){var r=this.expression.charAt(this.pos);return r==="/"&&this.expression.charAt(this.pos+1)==="*"?(this.pos=this.expression.indexOf("*/",this.pos)+2,this.pos===1&&(this.pos=this.expression.length),!0):!1},te.prototype.isRadixInteger=function(){var r=this.pos;if(r>=this.expression.length-2||this.expression.charAt(r)!=="0")return!1;++r;var s,m;if(this.expression.charAt(r)==="x")s=16,m=/^[0-9a-f]$/i,++r;else if(this.expression.charAt(r)==="b")s=2,m=/^[01]$/i,++r;else return!1;for(var R=!1,U=r;r<this.expression.length;){var W=this.expression.charAt(r);if(m.test(W))r++,R=!0;else break}return R&&(this.current=this.newToken(H,parseInt(this.expression.substring(U,r),s)),this.pos=r),R},te.prototype.isNumber=function(){for(var r=!1,s=this.pos,m=s,R=s,U=!1,W=!1,_;s<this.expression.length&&(_=this.expression.charAt(s),_>="0"&&_<="9"||!U&&_===".");)_==="."?U=!0:W=!0,s++,r=W;if(r&&(R=s),_==="e"||_==="E"){s++;for(var J=!0,re=!1;s<this.expression.length;){if(_=this.expression.charAt(s),J&&(_==="+"||_==="-"))J=!1;else if(_>="0"&&_<="9")re=!0,J=!1;else break;s++}re||(s=R)}return r?(this.current=this.newToken(H,parseFloat(this.expression.substring(m,s))),this.pos=s):this.pos=R,r},te.prototype.isOperator=function(){var r=this.pos,s=this.expression.charAt(this.pos);if(s==="+"||s==="-"||s==="*"||s==="/"||s==="%"||s==="^"||s==="?"||s===":"||s===".")this.current=this.newToken($,s);else if(s==="\u2219"||s==="\u2022")this.current=this.newToken($,"*");else if(s===">")this.expression.charAt(this.pos+1)==="="?(this.current=this.newToken($,">="),this.pos++):this.current=this.newToken($,">");else if(s==="<")this.expression.charAt(this.pos+1)==="="?(this.current=this.newToken($,"<="),this.pos++):this.current=this.newToken($,"<");else if(s==="|")if(this.expression.charAt(this.pos+1)==="|")this.current=this.newToken($,"||"),this.pos++;else return!1;else if(s==="=")this.expression.charAt(this.pos+1)==="="?(this.current=this.newToken($,"=="),this.pos++):this.current=this.newToken($,s);else if(s==="!")this.expression.charAt(this.pos+1)==="="?(this.current=this.newToken($,"!="),this.pos++):this.current=this.newToken($,s);else return!1;return this.pos++,this.isOperatorEnabled(this.current.value)?!0:(this.pos=r,!1)},te.prototype.isOperatorEnabled=function(r){return this.parser.isOperatorEnabled(r)},te.prototype.getCoordinates=function(){var r=0,s,m=-1;do r++,s=this.pos-m,m=this.expression.indexOf(`
`,m+1);while(m>=0&&m<this.pos);return{line:r,column:s}},te.prototype.parseError=function(r){var s=this.getCoordinates();throw new Error("parse error ["+s.line+":"+s.column+"]: "+r)};function Q(r,s,m){this.parser=r,this.tokens=s,this.current=null,this.nextToken=null,this.next(),this.savedCurrent=null,this.savedNextToken=null,this.allowMemberAccess=m.allowMemberAccess!==!1}Q.prototype.next=function(){return this.current=this.nextToken,this.nextToken=this.tokens.next()},Q.prototype.tokenMatches=function(r,s){return typeof s=="undefined"?!0:Array.isArray(s)?G(s,r.value):typeof s=="function"?s(r):r.value===s},Q.prototype.save=function(){this.savedCurrent=this.current,this.savedNextToken=this.nextToken,this.tokens.save()},Q.prototype.restore=function(){this.tokens.restore(),this.current=this.savedCurrent,this.nextToken=this.savedNextToken},Q.prototype.accept=function(r,s){return this.nextToken.type===r&&this.tokenMatches(this.nextToken,s)?(this.next(),!0):!1},Q.prototype.expect=function(r,s){if(!this.accept(r,s)){var m=this.tokens.getCoordinates();throw new Error("parse error ["+m.line+":"+m.column+"]: Expected "+(s||r))}},Q.prototype.parseAtom=function(r){var s=this.tokens.unaryOps;function m(U){return U.value in s}if(this.accept(Se)||this.accept($,m))r.push(new d(i,this.current.value));else if(this.accept(H))r.push(new d(t,this.current.value));else if(this.accept(he))r.push(new d(t,this.current.value));else if(this.accept(F,"("))this.parseExpression(r),this.expect(F,")");else if(this.accept(q,"["))if(this.accept(q,"]"))r.push(new d(k,0));else{var R=this.parseArrayList(r);r.push(new d(k,R))}else throw new Error("unexpected "+this.nextToken)},Q.prototype.parseExpression=function(r){var s=[];this.parseUntilEndStatement(r,s)||(this.parseVariableAssignmentExpression(s),!this.parseUntilEndStatement(r,s)&&this.pushExpression(r,s))},Q.prototype.pushExpression=function(r,s){for(var m=0,R=s.length;m<R;m++)r.push(s[m])},Q.prototype.parseUntilEndStatement=function(r,s){return this.accept(ye)?(this.nextToken&&this.nextToken.type!==ee&&!(this.nextToken.type===F&&this.nextToken.value===")")&&s.push(new d(f)),this.nextToken.type!==ee&&this.parseExpression(s),r.push(new d(x,s)),!0):!1},Q.prototype.parseArrayList=function(r){for(var s=0;!this.accept(q,"]");)for(this.parseExpression(r),++s;this.accept(ve);)this.parseExpression(r),++s;return s},Q.prototype.parseVariableAssignmentExpression=function(r){for(this.parseConditionalExpression(r);this.accept($,"=");){var s=r.pop(),m=[],R=r.length-1;if(s.type===v){if(!this.tokens.isOperatorEnabled("()="))throw new Error("function definition is not permitted");for(var U=0,W=s.value+1;U<W;U++){var _=R-U;r[_].type===i&&(r[_]=new d(p,r[_].value))}this.parseVariableAssignmentExpression(m),r.push(new d(x,m)),r.push(new d(T,s.value));continue}if(s.type!==i&&s.type!==u)throw new Error("expected variable for assignment");this.parseVariableAssignmentExpression(m),r.push(new d(p,s.value)),r.push(new d(x,m)),r.push(l("="))}},Q.prototype.parseConditionalExpression=function(r){for(this.parseOrExpression(r);this.accept($,"?");){var s=[],m=[];this.parseConditionalExpression(s),this.expect($,":"),this.parseConditionalExpression(m),r.push(new d(x,s)),r.push(new d(x,m)),r.push(g("?"))}},Q.prototype.parseOrExpression=function(r){for(this.parseAndExpression(r);this.accept($,"or");){var s=[];this.parseAndExpression(s),r.push(new d(x,s)),r.push(l("or"))}},Q.prototype.parseAndExpression=function(r){for(this.parseComparison(r);this.accept($,"and");){var s=[];this.parseComparison(s),r.push(new d(x,s)),r.push(l("and"))}};var xe=["==","!=","<","<=",">=",">","in"];Q.prototype.parseComparison=function(r){for(this.parseAddSub(r);this.accept($,xe);){var s=this.current;this.parseAddSub(r),r.push(l(s.value))}};var Z=["+","-","||"];Q.prototype.parseAddSub=function(r){for(this.parseTerm(r);this.accept($,Z);){var s=this.current;this.parseTerm(r),r.push(l(s.value))}};var ne=["*","/","%"];Q.prototype.parseTerm=function(r){for(this.parseFactor(r);this.accept($,ne);){var s=this.current;this.parseFactor(r),r.push(l(s.value))}},Q.prototype.parseFactor=function(r){var s=this.tokens.unaryOps;function m(U){return U.value in s}if(this.save(),this.accept($,m)){if(this.current.value!=="-"&&this.current.value!=="+"){if(this.nextToken.type===F&&this.nextToken.value==="("){this.restore(),this.parseExponential(r);return}else if(this.nextToken.type===ye||this.nextToken.type===ve||this.nextToken.type===ee||this.nextToken.type===F&&this.nextToken.value===")"){this.restore(),this.parseAtom(r);return}}var R=this.current;this.parseFactor(r),r.push(P(R.value))}else this.parseExponential(r)},Q.prototype.parseExponential=function(r){for(this.parsePostfixExpression(r);this.accept($,"^");)this.parseFactor(r),r.push(l("^"))},Q.prototype.parsePostfixExpression=function(r){for(this.parseFunctionCall(r);this.accept($,"!");)r.push(P("!"))},Q.prototype.parseFunctionCall=function(r){var s=this.tokens.unaryOps;function m(W){return W.value in s}if(this.accept($,m)){var R=this.current;this.parseAtom(r),r.push(P(R.value))}else for(this.parseMemberExpression(r);this.accept(F,"(");)if(this.accept(F,")"))r.push(new d(v,0));else{var U=this.parseArgumentList(r);r.push(new d(v,U))}},Q.prototype.parseArgumentList=function(r){for(var s=0;!this.accept(F,")");)for(this.parseExpression(r),++s;this.accept(ve);)this.parseExpression(r),++s;return s},Q.prototype.parseMemberExpression=function(r){for(this.parseAtom(r);this.accept($,".")||this.accept(q,"[");){var s=this.current;if(s.value==="."){if(!this.allowMemberAccess)throw new Error('unexpected ".", member access is not permitted');this.expect(Se),r.push(new d(u,this.current.value))}else if(s.value==="["){if(!this.tokens.isOperatorEnabled("["))throw new Error('unexpected "[]", arrays are disabled');this.parseExpression(r),this.expect(q,"]"),r.push(l("["))}else throw new Error("unexpected symbol: "+s.value)}};function Ue(r,s){return Number(r)+Number(s)}function Be(r,s){return r-s}function Le(r,s){return r*s}function Re(r,s){return r/s}function Fe(r,s){return r%s}function Me(r,s){return Array.isArray(r)&&Array.isArray(s)?r.concat(s):""+r+s}function Ce(r,s){return r===s}function pe(r,s){return r!==s}function gt(r,s){return r>s}function _e(r,s){return r<s}function A(r,s){return r>=s}function e(r,s){return r<=s}function o(r,s){return!!(r&&s)}function b(r,s){return!!(r||s)}function w(r,s){return G(s,r)}function M(r){return(Math.exp(r)-Math.exp(-r))/2}function D(r){return(Math.exp(r)+Math.exp(-r))/2}function j(r){return r===1/0?1:r===-1/0?-1:(Math.exp(r)-Math.exp(-r))/(Math.exp(r)+Math.exp(-r))}function L(r){return r===-1/0?r:Math.log(r+Math.sqrt(r*r+1))}function K(r){return Math.log(r+Math.sqrt(r*r-1))}function se(r){return Math.log((1+r)/(1-r))/2}function ke(r){return Math.log(r)*Math.LOG10E}function je(r){return-r}function nn(r){return!r}function vt(r){return r<0?Math.ceil(r):Math.floor(r)}function oe(r){return Math.random()*(r||1)}function ie(r){return qe(r+1)}function ae(r){return isFinite(r)&&r===Math.round(r)}var Te=4.7421875,$e=[.9999999999999971,57.15623566586292,-59.59796035547549,14.136097974741746,-.4919138160976202,3399464998481189e-20,4652362892704858e-20,-9837447530487956e-20,.0001580887032249125,-.00021026444172410488,.00021743961811521265,-.0001643181065367639,8441822398385275e-20,-26190838401581408e-21,36899182659531625e-22];function qe(r){var s,m;if(ae(r)){if(r<=0)return isFinite(r)?1/0:NaN;if(r>171)return 1/0;for(var R=r-2,U=r-1;R>1;)U*=R,R--;return U===0&&(U=1),U}if(r<.5)return Math.PI/(Math.sin(Math.PI*r)*qe(1-r));if(r>=171.35)return 1/0;if(r>85){var W=r*r,_=W*r,J=_*r,re=J*r;return Math.sqrt(2*Math.PI/r)*Math.pow(r/Math.E,r)*(1+1/(12*r)+1/(288*W)-139/(51840*_)-571/(2488320*J)+163879/(209018880*re)+5246819/(75246796800*re*r))}--r,m=$e[0];for(var le=1;le<$e.length;++le)m+=$e[le]/(r+le);return s=r+Te+.5,Math.sqrt(2*Math.PI)*Math.pow(s,r+.5)*Math.exp(-s)*m}function Ve(r){return Array.isArray(r)?r.length:String(r).length}function Oe(){for(var r=0,s=0,m=0;m<arguments.length;m++){var R=Math.abs(arguments[m]),U;s<R?(U=s/R,r=r*U*U+1,s=R):R>0?(U=R/s,r+=U*U):r+=R}return s===1/0?1/0:s*Math.sqrt(r)}function Ge(r,s,m){return r?s:m}function jt(r,s){return typeof s=="undefined"||+s==0?Math.round(r):(r=+r,s=-+s,isNaN(r)||!(typeof s=="number"&&s%1===0)?NaN:(r=r.toString().split("e"),r=Math.round(+(r[0]+"e"+(r[1]?+r[1]-s:-s))),r=r.toString().split("e"),+(r[0]+"e"+(r[1]?+r[1]+s:s))))}function Ke(r,s,m){return m&&(m[r]=s),s}function Qn(r,s){return r[s|0]}function Zn(r){return arguments.length===1&&Array.isArray(r)?Math.max.apply(Math,r):Math.max.apply(Math,arguments)}function er(r){return arguments.length===1&&Array.isArray(r)?Math.min.apply(Math,r):Math.min.apply(Math,arguments)}function tr(r,s){if(typeof r!="function")throw new Error("First argument to map is not a function");if(!Array.isArray(s))throw new Error("Second argument to map is not an array");return s.map(function(m,R){return r(m,R)})}function nr(r,s,m){if(typeof r!="function")throw new Error("First argument to fold is not a function");if(!Array.isArray(m))throw new Error("Second argument to fold is not an array");return m.reduce(function(R,U,W){return r(R,U,W)},s)}function rr(r,s){if(typeof r!="function")throw new Error("First argument to filter is not a function");if(!Array.isArray(s))throw new Error("Second argument to filter is not an array");return s.filter(function(m,R){return r(m,R)})}function ir(r,s){if(!(Array.isArray(s)||typeof s=="string"))throw new Error("Second argument to indexOf is not a string or array");return s.indexOf(r)}function sr(r,s){if(!Array.isArray(s))throw new Error("Second argument to join is not an array");return s.join(r)}function or(r){return(r>0)-(r<0)||+r}var rn=1/3;function ar(r){return r<0?-Math.pow(-r,rn):Math.pow(r,rn)}function cr(r){return Math.exp(r)-1}function lr(r){return Math.log(1+r)}function ur(r){return Math.log(r)/Math.LN2}function We(r){this.options=r||{},this.unaryOps={sin:Math.sin,cos:Math.cos,tan:Math.tan,asin:Math.asin,acos:Math.acos,atan:Math.atan,sinh:Math.sinh||M,cosh:Math.cosh||D,tanh:Math.tanh||j,asinh:Math.asinh||L,acosh:Math.acosh||K,atanh:Math.atanh||se,sqrt:Math.sqrt,cbrt:Math.cbrt||ar,log:Math.log,log2:Math.log2||ur,ln:Math.log,lg:Math.log10||ke,log10:Math.log10||ke,expm1:Math.expm1||cr,log1p:Math.log1p||lr,abs:Math.abs,ceil:Math.ceil,floor:Math.floor,round:Math.round,trunc:Math.trunc||vt,"-":je,"+":Number,exp:Math.exp,not:nn,length:Ve,"!":ie,sign:Math.sign||or},this.binaryOps={"+":Ue,"-":Be,"*":Le,"/":Re,"%":Fe,"^":Math.pow,"||":Me,"==":Ce,"!=":pe,">":gt,"<":_e,">=":A,"<=":e,and:o,or:b,in:w,"=":Ke,"[":Qn},this.ternaryOps={"?":Ge},this.functions={random:oe,fac:ie,min:er,max:Zn,hypot:Math.hypot||Oe,pyt:Math.hypot||Oe,pow:Math.pow,atan2:Math.atan2,if:Ge,gamma:qe,roundTo:jt,map:tr,fold:nr,filter:rr,indexOf:ir,join:sr},this.consts={E:Math.E,PI:Math.PI,true:!0,false:!1}}We.prototype.parse=function(r){var s=[],m=new Q(this,new te(this,r),{allowMemberAccess:this.options.allowMemberAccess});return m.parseExpression(s),m.expect(ee,"EOF"),new V(s,this)},We.prototype.evaluate=function(r,s){return this.parse(r).evaluate(s)};var sn=new We;We.parse=function(r){return sn.parse(r)},We.evaluate=function(r,s){return sn.parse(r).evaluate(s)};var on={"+":"add","-":"subtract","*":"multiply","/":"divide","%":"remainder","^":"power","!":"factorial","<":"comparison",">":"comparison","<=":"comparison",">=":"comparison","==":"comparison","!=":"comparison","||":"concatenate",and:"logical",or:"logical",not:"logical","?":"conditional",":":"conditional","=":"assignment","[":"array","()=":"fndef"};function hr(r){return on.hasOwnProperty(r)?on[r]:r}We.prototype.isOperatorEnabled=function(r){var s=hr(r),m=this.options.operators||{};return!(s in m)||!!m[s]};var fr={Parser:We,Expression:V};n.Expression=V,n.Parser=We,n.default=fr,Object.defineProperty(n,"__esModule",{value:!0})})});var Nt=ue((Dn,Dt)=>{"use strict";var Ot=class{constructor(t,a){let h=t||{},c=Array.isArray(h.allowedVariables)&&h.allowedVariables.length>0?h.allowedVariables.slice():Kt.slice();this.allowedVariables=c;let i=a||An();this.parser=new i({operators:{add:!0,subtract:!0,multiply:!0,divide:!0,remainder:!0,power:!1,factorial:!1,comparison:!0,logical:!0,conditional:!0,concatenate:!1,assignment:!1,array:!1,fndef:!1},allowMemberAccess:!1}),this.cache={}}validate(t){let a;try{a=this.getCacheEntry(t)}catch(h){return{ok:!1,error:h instanceof Error?h.message:"Invalid expression"}}return a?a.disallowedVariables.length>0?{ok:!1,error:"Unknown variables: "+a.disallowedVariables.join(", ")+". Allowed variables: "+this.allowedVariables.join(", ")}:{ok:!0,variables:a.variables.slice()}:{ok:!1,error:"Expression cannot be empty"}}evaluate(t,a){let h=this.getCacheEntry(t);if(!h)throw new Error("Expression cannot be empty");if(h.disallowedVariables.length>0)throw new Error("Unknown variables: "+h.disallowedVariables.join(", ")+". Allowed variables: "+this.allowedVariables.join(", "));let c={},i=a||{};for(let p of this.allowedVariables){let v=Object.prototype.hasOwnProperty.call(i,p)?i[p]:void 0;if(Kt.indexOf(p)!==-1){c[p]=He(v);continue}typeof v=="number"?c[p]=Number.isFinite(v)?v:0:typeof v=="boolean"||typeof v=="string"?c[p]=v:v==null?c[p]=0:c[p]=v}return h.compiled.evaluate(c)}clearCache(){this.cache={}}getCacheEntry(t){let a=this.normalizeExpression(t);if(!a)return null;if(this.cache[a])return this.cache[a];let h;try{h=this.parser.parse(a)}catch(v){throw this.wrapParseError(v)}let c=h.variables({withMembers:!1})||[],i=c.filter(v=>this.allowedVariables.indexOf(v)===-1),p={expression:a,compiled:h,variables:c.slice(),disallowedVariables:i.slice()};return this.cache[a]=p,p}normalizeExpression(t){return typeof t!="string"?"":t.trim()}wrapParseError(t){let a=t&&typeof t=="object"&&t instanceof Error&&t.message?Er(t.message):"Invalid expression",h=new Error(a);return t&&typeof t=="object"&&(h.originalError=t),h}},Kt=["value","high","low","changeDaily","changeDailyPercent","volume"];function kr(n){return n?n.slice():[]}function He(n){if(n==null)return 0;if(typeof n=="number")return Number.isFinite(n)?n:0;if(typeof n=="string"&&n.trim()!==""){let t=Number(n);if(!Number.isNaN(t)&&Number.isFinite(t))return t}return 0}function In(n){let t=n||{};return{value:He(t.last),high:He(t.high),low:He(t.low),changeDaily:He(t.changeDaily),changeDailyPercent:He(t.changeDailyPercent),volume:He(t.volume)}}function Tr(n,t){let a=In(n);if(t&&typeof t=="object")for(let h in t)Object.prototype.hasOwnProperty.call(t,h)&&(a[h]=t[h]);return a}function Er(n){return n?n.indexOf("member access is not permitted")>=0?n+'. Remove object-style prefixes (for example use "value" instead of "values.last").':n:"Invalid expression"}function An(){if(typeof ze=="function")try{let a=Mn();if(a&&a.Parser)return a.Parser}catch{}let n=typeof globalThis!="undefined"?globalThis:{},t=n.exprEval&&n.exprEval.Parser;if(t)return t;throw new Error("expr-eval dependency is missing")}(function(t,a){let h=An(),c=a(h);typeof Dt=="object"&&Dt.exports&&(Dt.exports=c),t&&typeof t=="object"&&(t.CryptoTickerExpressionEvaluator=c)})(typeof self!="undefined"?self:Dn,function(t){return{createEvaluator:a=>new Ot(a,t),ExpressionEvaluator:Ot,normalizeNumericValue:He,buildBaseContext:In,buildContext:Tr,allowedVariables:kr(Kt)}})});var Yt=ue((On,st)=>{"use strict";(function(n,t){let a=typeof st=="object"&&st.exports?Nt():n==null?void 0:n.CryptoTickerExpressionEvaluator,h=t(a);typeof st=="object"&&st.exports&&(st.exports=h),n&&typeof n=="object"&&(n.CryptoTickerAlertManager=h)})(typeof self!="undefined"?self:On,function(n){if(!n)throw new Error("Expression evaluator dependency is missing");let t=n,a=t.createEvaluator(),h={},c={};function i(f){return h[f]||"off"}function p(f){return c[f]!=="off"}function v(f){c[f]="off"}function T(f){c[f]="on"}function x(f){return p(f)&&i(f)==="on"}function y(f){delete h[f],delete c[f]}function u(f){let k=f.context,d=f.settings||{},P=f.values||{},l=f.backgroundColor,g=f.textColor,S=!1,I=d.alertRule;if(!I)return h[k]="off",{alertMode:S,backgroundColor:l,textColor:g};try{let C=t.buildBaseContext(P);if(a.evaluate(I,C)){if(h[k]="on",p(k)){S=!0;let E=l;l=g,g=E}}else h[k]="off",T(k)}catch(C){h[k]="error",console.error("Error evaluating alertRule",{context:k,settings:d,values:P,error:C instanceof Error?C.message:C})}return{alertMode:S,backgroundColor:l,textColor:g}}return{evaluateAlert:u,shouldDisarmOnKeyPress:x,disarmAlert:v,armAlert:T,clearContext:y,getAlertStatus:i,isAlertArmed:p}})});var Jt=ue((Nn,Ut)=>{"use strict";(function(t,a){let h=a();typeof Ut=="object"&&Ut.exports&&(Ut.exports=h),t&&typeof t=="object"&&(t.CryptoTickerState=h)})(typeof self!="undefined"?self:Nn,function(){let t={},a={},h={},c={},i={},p={};function v(O,G){t[O]={context:O,settings:G}}function T(O){return t[O]||null}function x(O){Object.keys(t).forEach(G=>{O(t[G],G)})}function y(O){delete t[O],delete p[O]}function u(O,G){O&&(a[O]=G||null)}function f(O){return O&&a[O]||null}function k(O){O&&delete a[O]}function d(O,G){O&&G&&(h[O]=G)}function P(O){return O&&h[O]||null}function l(O){O&&(delete h[O],delete p[O])}function g(O){return c[O]||(c[O]={}),c[O]}function S(O,G){c[O]=G}function I(O){return i[O]}function C(O,G){i[O]=G}function N(){Object.keys(t).forEach(O=>{delete t[O]}),Object.keys(a).forEach(O=>{let G=a[O];if(G&&typeof G.unsubscribe=="function")try{G.unsubscribe()}catch{}delete a[O]}),Object.keys(h).forEach(O=>{delete h[O]}),Object.keys(c).forEach(O=>{delete c[O]}),Object.keys(i).forEach(O=>{delete i[O]}),Object.keys(p).forEach(O=>{delete p[O]})}function E(O,G,X){if(!O||!G)return;let V=typeof X=="number"?X:Date.now();p[O]={values:Object.assign({},G),timestamp:V}}function B(O){return O&&p[O]||null}function z(O){O&&delete p[O]}return{setContextDetails:v,getContextDetails:T,forEachContext:x,clearContextDetails:y,setSubscription:u,getSubscription:f,clearSubscription:k,setConnectionState:d,getConnectionState:P,clearConnectionState:l,getOrCreateConversionRateEntry:g,setConversionRateEntry:S,getCandlesCacheEntry:I,setCandlesCacheEntry:C,resetAllState:N,setLastGoodTicker:E,getLastGoodTicker:B,clearLastGoodTicker:z}})});var Fn=ue((Un,ot)=>{"use strict";(function(n,t){let a=typeof globalThis!="undefined"?globalThis:n,h=typeof ot=="object"&&ot.exports?Jt():n==null?void 0:n.CryptoTickerState,c=t(h,a);typeof ot=="object"&&ot.exports&&(ot.exports=c),n&&typeof n=="object"&&(n.CryptoTickerSettingsManager=c)})(typeof self!="undefined"?self:Un,function(t,a){function h(f){if(typeof ze=="function")try{return ze(f)}catch{return null}return null}function c(){return a&&typeof a.CryptoTickerDefaults!="undefined"?a.CryptoTickerDefaults:h("./default-settings")}let i=c();function p(){if(!i)throw new Error("Default settings module is not available");return i}function v(f){let k=p();return typeof k.applyDefaults=="function"?k.applyDefaults(f):k.defaultSettings?Object.assign({},k.defaultSettings,f||{}):Object.assign({},f||{})}function T(){let f=p();return typeof f.getDefaultSettings=="function"?f.getDefaultSettings():f.defaultSettings?JSON.parse(JSON.stringify(f.defaultSettings)):{}}let x=T();function y(f){let k=f.context,d=f.settings,P=f.updateSubscription,l=v(d);return t.setContextDetails(k,l),typeof P=="function"&&P(l),l}let u=i&&i.settingsSchema?i.settingsSchema:null;return{applyDefaultSettings:v,getDefaultSettingsSnapshot:T,defaultSettings:x,settingsSchema:u,refreshSettings:y}})});var Bn=ue((Zr,Ft)=>{"use strict";var xr={TIMESTAMP_SECONDS_THRESHOLD:9999999999,DEFAULT_PRICE_BAR_POSITION:.5};(function(t,a){let h=a();if(typeof Ft=="object"&&Ft.exports)Ft.exports=h;else{let c=t.CryptoTickerConstants||{};t.CryptoTickerConstants=Object.assign({},c,h)}})(typeof globalThis!="undefined"?globalThis:self,function(){return xr})});var _n=ue((Ln,Bt)=>{"use strict";(function(n,t){let a=t();typeof Bt=="object"&&Bt.exports&&(Bt.exports=a),n&&typeof n=="object"&&(n.CryptoTickerConnectionStatusIcons=a)})(typeof self!="undefined"?self:Ln,function(){function t(){return{LIVE:"live",DETACHED:"detached",BACKUP:"backup",BROKEN:"broken"}}function a(c){if(!c||typeof c!="object")return t();let i=t(),p={};for(let v in i){if(!Object.prototype.hasOwnProperty.call(i,v))continue;let T=i[v],x=c[v];p[v]=typeof x=="string"&&x?x:T}return p}function h(c){let i=c.canvasContext,p=c.canvas,v=c.state,T=c.color,x=c.sizeMultiplier,y=c.position,u=c.connectionStates;if(!p||!i||!v)return;let f=a(u),k=(y||"OFF").toUpperCase();if(k==="OFF")return;let d=String(v).toLowerCase(),P=typeof x=="number"&&Number.isFinite(x)&&x>0?x:1,l=20*P,g=4*P,S=p.width-l-g,I=g;k==="BOTTOM_LEFT"&&(S=g,I=p.height-l-g),i.save(),i.translate(S,I),i.lineWidth=Math.max(1.5*P,1),i.strokeStyle=T,i.fillStyle=T;function C(N){if(!(!Array.isArray(N)||N.length===0)){i.beginPath();for(let E=0;E<N.length;E++){let B=N[E],z=B[0]*l,O=B[1]*l;E===0?i.moveTo(z,O):i.lineTo(z,O)}i.closePath(),i.fill()}}d===f.LIVE?C([[.7545784909869392,0],[.18263591551829597,.5685964091677761],[.3947756629367107,.5685964091677761],[.23171302126434715,1],[.8173281041988991,.43136761054941897],[.6051523764976793,.43136761054941897]]):d===f.DETACHED?(C([[0,.45],[.4,.45],[.4,.6],[0,.6]]),C([[.6,.45],[1,.45],[1,.6],[.6,.6]])):d===f.BACKUP?(C([[0,.3],[.4,.3],[.4,.38],[0,.38]]),C([[.6,.3],[1,.3],[1,.38],[.6,.38]]),C([[0,.62],[.4,.62],[.4,.7],[0,.7]]),C([[.6,.62],[1,.62],[1,.7],[.6,.7]])):d===f.BROKEN&&(i.save(),i.fillStyle="#ff0000",i.beginPath(),i.moveTo(l*.46,l*.32),i.lineTo(l*.42,l*.38),i.lineTo(l*.46,l*.44),i.lineTo(l*.41,l*.5),i.lineTo(l*.43,l*.88),i.lineTo(l*.3,l*.73),i.lineTo(l*.18,l*.62),i.bezierCurveTo(l*.08,l*.52,l*.08,l*.38,l*.15,l*.28),i.bezierCurveTo(l*.25,l*.16,l*.4,l*.2,l*.46,l*.32),i.closePath(),i.fill(),i.beginPath(),i.moveTo(l*.54,l*.28),i.lineTo(l*.58,l*.34),i.lineTo(l*.54,l*.4),i.lineTo(l*.59,l*.46),i.lineTo(l*.57,l*.84),i.lineTo(l*.7,l*.69),i.lineTo(l*.82,l*.58),i.bezierCurveTo(l*.92,l*.48,l*.92,l*.34,l*.85,l*.24),i.bezierCurveTo(l*.75,l*.12,l*.6,l*.16,l*.54,l*.28),i.closePath(),i.fill(),i.restore()),i.restore()}return{renderConnectionStatusIcon:h}})});var $n=ue((jn,at)=>{"use strict";(function(n,t){let a=typeof at=="object"&&at.exports?[Yt(),Gt(),Nt(),Bn(),_n()]:[n==null?void 0:n.CryptoTickerAlertManager,n==null?void 0:n.CryptoTickerFormatters,n==null?void 0:n.CryptoTickerExpressionEvaluator,n==null?void 0:n.CryptoTickerConstants,n==null?void 0:n.CryptoTickerConnectionStatusIcons],h=t(a[0],a[1],a[2],a[3],a[4]);typeof at=="object"&&at.exports&&(at.exports=h),n&&typeof n=="object"&&(n.CryptoTickerCanvasRenderer=h)})(typeof self!="undefined"?self:jn,function(n,t,a,h,c){if(!n)throw new Error("Alert manager dependency is missing");if(!t)throw new Error("Formatters dependency is missing");if(!a)throw new Error("Expression evaluator dependency is missing");let i=h||{},p=typeof i.TIMESTAMP_SECONDS_THRESHOLD=="number"?i.TIMESTAMP_SECONDS_THRESHOLD:9999999999,v=typeof i.DEFAULT_PRICE_BAR_POSITION=="number"?i.DEFAULT_PRICE_BAR_POSITION:.5;function T(){let C=a.allowedVariables.slice(0),N=["alert","backgroundColor","textColor","defaultBackgroundColor","defaultTextColor"];for(let E=0;E<N.length;E++)C.indexOf(N[E])===-1&&C.push(N[E]);return a.createEvaluator({allowedVariables:C})}let x=T(),y=c&&typeof c=="object"?c:null,u=y&&typeof y.renderConnectionStatusIcon=="function"?y.renderConnectionStatusIcon:function(){};function f(C,N){return Math.max(C/144,N/144)}function k(C){let N=parseInt(C.candlesDisplayed);return isNaN(N)?20:Math.min(60,Math.max(5,N))}function d(C,N,E,B,z){let O=Math.sqrt(.75*Math.pow(B,2));C.beginPath(),C.moveTo(N-B/2,E-O/3),C.lineTo(N+B/2,E-O/3),C.lineTo(N,E+O*2/3),C.fillStyle=z,C.fill()}function P(C,N,E,B){if(!N&&N!==0)return[""];let z=String(N).split(/\r?\n/),O=[];function G(X){let V=X.split(""),ee=[],$="";for(let H=0;H<V.length;H++){let he=$+V[H];C.measureText(he).width>E&&$?(ee.push($),$=V[H]):$=he}return $&&ee.push($),ee}C.font=B;for(let X=0;X<z.length;X++){let V=z[X];if(!V||V.trim()===""){O.push("");continue}let ee=V.trim().split(/\s+/),$=ee.shift()||"";for(;ee.length>0;){let H=ee.shift(),he=$?$+" "+H:H;if(C.measureText(he).width<=E){$=he;continue}if($&&O.push($),C.measureText(H).width<=E)$=H;else{let F=G(H);for(let q=0;q<F.length-1;q++)O.push(F[q]);$=F.length>0?F[F.length-1]:""}}$&&O.push($)}return O.length===0&&O.push(""),O}function l(C){if(C==null)return null;let N=typeof C=="number"?C:parseFloat(C);if(!Number.isFinite(N))return null;let E=N>p?N:N*1e3,B=new Date(E);if(isNaN(B.getTime()))return null;try{return B.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}catch{return B.toISOString()}}function g(C){let N=C.canvas,E=C.canvasContext,B=C.message,z=C.backgroundColor||"#000000",O=C.textColor||"#ffffff",G=C.font||"Lato",X=C.fontSize,V=C.connectionStates,ee=C.connectionState,$=(C.displayConnectionStatusIcon||"OFF").toUpperCase(),H=N.width,he=N.height,F=f(H,he),q=12*F,ve=X?X*F:Math.max(22*F,14),Se="bold "+ve+"px "+G,ye=ve*1.25;E.clearRect(0,0,H,he),E.fillStyle=z,E.fillRect(0,0,H,he);let fe=H-q*2,te=P(E,B,fe,Se),Ee=he-q*2;$!=="OFF"&&V&&(Ee-=28*F);let Q=ye*te.length,xe=q+(Ee-Q)/2+ye/2;xe<q+ye/2&&(xe=q+ye/2),E.fillStyle=O,E.textAlign="center",E.textBaseline="middle",E.font=Se;for(let Z=0;Z<te.length;Z++){let ne=te[Z];ne&&E.fillText(ne,H/2,xe+Z*ye)}$!=="OFF"&&V&&u({canvas:N,canvasContext:E,state:ee,color:O,sizeMultiplier:F,position:$,connectionStates:V})}function S(C){let N=C.canvas,E=C.canvasContext,B=C.settings||{},z=C.values||{},O=C.context,G=C.connectionStates,X=C.connectionState,V=C.dataState||"live",ee=C.infoMessage||"",$=C.lastValidTimestamp||z.lastUpdated||null,H=N.width,he=N.height,F=f(H,he),q=10*F,ve=B.pair,Se=B.title||z.pairDisplay||z.pair||ve||"",ye=B.multiplier||1,fe=B.priceFormat||"compact";function te(oe,ie){let ae=parseFloat(oe);return isNaN(ae)||ae<=0?ie:ae}function Ee(oe,ie){let ae=parseInt(oe,10);return isNaN(ae)||ae<0?ie:ae}let Q=Ee(B.digits,2),xe=Ee(B.highLowDigits,Q),Z=te(B.fontSizeBase,25),ne=te(B.fontSizePrice,Z*35/25),Ue=te(B.fontSizeHighLow,Z),Be=te(B.fontSizeChange,Z*19/25);function Le(oe,ie){return typeof oe=="string"&&oe.length>0?oe:ie}let Re={thousandsSeparator:Le(B.thousandsSeparator,","),decimalSeparator:Le(B.decimalSeparator,".")},Fe=B.backgroundColor||"#000000",Me=B.textColor||"#ffffff",Ce=Fe,pe=Me,gt=X||z.connectionState||null,_e=typeof z.last=="number"&&Number.isFinite(z.last)?z.last:null,A=typeof z.high=="number"&&Number.isFinite(z.high)?z.high:null,e=typeof z.low=="number"&&Number.isFinite(z.low)?z.low:null,o=typeof z.changeDailyPercent=="number"&&Number.isFinite(z.changeDailyPercent)?z.changeDailyPercent:null,b=o!==null?o*100:null,w=typeof V=="string"?V.toLowerCase():"live",M=w==="stale"?"#f6a623":w==="missing"?"#d9534f":null,D=n.evaluateAlert({context:O,settings:B,values:z,backgroundColor:Ce,textColor:pe}),j=D.alertMode;Ce=D.backgroundColor,pe=D.textColor;let L=a.buildContext(z,{alert:j,backgroundColor:Ce,textColor:pe,defaultBackgroundColor:Fe,defaultTextColor:Me});if(B.backgroundColorRule)try{let oe=x.evaluate(B.backgroundColorRule,L),ie=String(oe||"").trim();ie&&(Ce=ie,L.backgroundColor=Ce)}catch(oe){console.error("Error evaluating backgroundColorRule",{context:O,expression:B.backgroundColorRule,values:z,error:oe instanceof Error?oe.message:oe})}if(B.textColorRule)try{L.textColor=pe;let oe=x.evaluate(B.textColorRule,L),ie=String(oe||"").trim();ie&&(pe=ie,L.textColor=pe)}catch(oe){console.error("Error evaluating textColorRule",{context:O,expression:B.textColorRule,values:z,error:oe instanceof Error?oe.message:oe})}E.clearRect(0,0,H,he),E.fillStyle=Ce,E.fillRect(0,0,H,he);let K=B.font||"Lato",se=Z*F+"px "+K;E.font=se,E.fillStyle=pe,E.textAlign="left",E.textBaseline="alphabetic";let ke=25*F,je=q;if(M){let oe=5*F,ie=q+oe,ae=ke-Z*F*.4;E.beginPath(),E.fillStyle=M,E.arc(ie,ae,oe,0,Math.PI*2),E.fill(),E.fillStyle=pe,je+=oe*2+6*F}if(Se&&E.fillText(Se,je,ke),w==="stale"){let oe=ee?ee.toUpperCase():"STALE",ie=l($),ae=ie?oe+" \u2022 "+ie:oe,Te=Math.max(14,Z*.6)*F;E.font=Te+"px "+K,E.fillStyle=M||pe,E.fillText(ae,je,ke+Te+4*F),E.font=se,E.fillStyle=pe}if(w!=="missing"){let oe=_e!==null?t.getRoundedValue(_e,Q,ye,fe,Re):"--";if(E.font="bold "+ne*F+"px "+K,E.fillStyle=pe,E.textAlign="left",E.fillText(oe,q,60*F),B.displayHighLow!=="off"){E.font=Ue*F+"px "+K,E.fillStyle=pe,E.textAlign="left";let ie=e!==null?t.getRoundedValue(e,xe,ye,fe,Re):"--";E.fillText(ie,q,90*F),E.textAlign="right";let ae=A!==null?t.getRoundedValue(A,xe,ye,fe,Re):"--";E.fillText(ae,H-q,135*F)}if(B.displayDailyChange!=="off"&&b!==null){let ie=E.fillStyle,ae=2;Math.abs(b)>=100?ae=0:Math.abs(b)>=10&&(ae=1);let Te=t.getRoundedValue(b,ae,1,"plain",Re);b>0?(Te="+"+Te,E.fillStyle="green"):b<0?E.fillStyle="red":E.fillStyle=ie,E.font=Be*F+"px "+K,E.textAlign="right",E.fillText(Te,H-q,90*F),E.fillStyle=ie}if(B.displayHighLowBar!=="off"&&A!==null&&e!==null&&_e!==null){let ie=104*F,ae=5*F,Te=6*F,$e=A-e,qe=$e>0?Math.min(Math.max((_e-e)/$e,0),1):v,Ve=H-ae*2,Oe=ae+Math.round(Ve*qe),Ge=12*F;E.beginPath(),E.moveTo(ae,ie),E.lineTo(Oe,ie),E.lineWidth=Te,E.strokeStyle="green",E.stroke(),E.beginPath(),E.moveTo(Oe,ie),E.lineTo(H-ae,ie),E.lineWidth=Te,E.strokeStyle="red",E.stroke(),d(E,Oe,ie,Ge,pe)}}else{let oe=ee?ee.toUpperCase():"NO DATA",ie=Math.max(26,Z)*F,ae="bold "+ie+"px "+K;E.font=ae,E.fillStyle=M||pe;let Te=E.textAlign,$e=E.textBaseline;E.textAlign="center",E.textBaseline="middle";let qe=H-q*2,Ve=P(E,oe,qe,ae),Oe=ie*1.1,Ge=Oe*Ve.length,jt=(he-Ge)/2+Oe/2;for(let Ke=0;Ke<Ve.length;Ke++)E.fillText(Ve[Ke],H/2,jt+Ke*Oe);E.textAlign=Te,E.textBaseline=$e,E.font=se,E.fillStyle=pe}let vt=(B.displayConnectionStatusIcon||"OFF").toUpperCase();vt!=="OFF"&&u({canvas:N,canvasContext:E,state:gt,color:pe,sizeMultiplier:F,position:vt,connectionStates:G})}function I(C){let N=C.canvas,E=C.canvasContext,B=C.settings||{},z=C.candlesNormalized||[],O=C.connectionStates,G=C.connectionState,X=N.width,V=N.height,ee=f(X,V),$=10*ee,H=(B.displayConnectionStatusIcon||"OFF").toUpperCase(),he=G||null,F=B.backgroundColor||"#000000",q=B.textColor||"#ffffff",ve=z.slice(-k(B)),Se=ve.length,ye=X-2*$,fe=V-2*$,te=Se>0?ye/Se:ye,Ee=Math.max(2*ee,te*.15),Q=Math.max(4*ee,te*.6);E.clearRect(0,0,X,V),E.fillStyle=F,E.fillRect(0,0,X,V);let xe=B.font||"Lato";E.font=15*ee+"px "+xe,E.fillStyle=q;let Z=B.candlesInterval||"1h";E.textAlign="right",E.fillText(Z,X-10*ee,V-5*ee),ve.forEach(function(ne){let Ue=Math.round($+Math.round(ne.timePercent*ye)),Be=Math.round($+fe-ne.highPercent*fe),Le=Math.round($+fe-ne.lowPercent*fe);E.beginPath(),E.moveTo(Ue,Be),E.lineTo(Ue,Le),E.lineWidth=Ee,E.strokeStyle=ne.closePercent>ne.openPercent?"#1c9900":"#a10",E.stroke();let Re=Math.round($+fe-ne.openPercent*fe),Fe=Math.round($+fe-ne.closePercent*fe),Me=Math.min(Re,Fe),Ce=Math.max(Re,Fe);E.beginPath(),E.rect(Math.round(Ue-Q/2),Me,Math.round(Q),Math.max(1,Ce-Me)),E.fillStyle=ne.closePercent>ne.openPercent?"#1c9900":"#a10",E.fill()}),H!=="OFF"&&u({canvas:N,canvasContext:E,state:he,color:q,sizeMultiplier:ee,position:H,connectionStates:O})}return{getCanvasSizeMultiplier:f,getCandlesDisplayCount:k,renderConnectionStatusIcon:u,renderTickerCanvas:S,renderCandlesCanvas:I,renderMessageCanvas:g}})});var Kn=ue((ei,tn)=>{"use strict";var Vn={tProxyBase:"https://tproxyv8.opendle.com",fallbackPollIntervalMs:6e4,staleTickerTimeoutMs:36e4,messages:{loading:"LOADING...",stale:"STALE",noData:"NO DATA",misconfigured:"INVALID PAIR",conversionError:"CONVERSION ERROR"}};function Ne(n){if(typeof ze=="function")try{return ze(n)}catch{return null}return null}function Pr(){return typeof CryptoTickerConfig!="undefined"?CryptoTickerConfig:null}function ct(n){if(typeof n=="string"){let t=n.trim();return t.length===0?null:t.toUpperCase()}return n==null?null:String(n).trim().toUpperCase()||null}var Rr=Ne("./config"),Mr=Ne("./constants"),Ir=Pr(),De=Object.assign({},Vn,Rr||{},Ir||{}),Wn=Mr||(typeof CryptoTickerConstants!="undefined"?CryptoTickerConstants:null)||{},Ar=typeof Wn.TIMESTAMP_SECONDS_THRESHOLD=="number"?Wn.TIMESTAMP_SECONDS_THRESHOLD:9999999999,mt=De.tProxyBase,zn=typeof mt=="string"?mt.replace(/\/$/,""):"",Hn="_ctBust",Dr=Vn.messages,Ie=Object.assign({},Dr,De&&De.messages||{});function Or(n){if(!n||typeof n!="string")return n;try{let t=new URL(n);return t.searchParams.set(Hn,Date.now().toString()),t.toString()}catch{let a=n.indexOf("?")===-1?"?":"&";return n+a+Hn+"="+Date.now()}}function qn(n,t){if(!n||typeof n!="string")return{url:n,options:t};let a=n.replace(/\/$/,"");if(!zn||a.indexOf(zn)!==0)return{url:n,options:t};let h=Object.assign({},t||{});h.cache="no-store";let c=Object.assign({},h.headers||{});return c["cache-control"]="no-cache",c.pragma="no-cache",h.headers=c,{url:Or(n),options:h}}var Xt=Ne("./providers/subscription-key"),ft=typeof CryptoTickerProviders!="undefined"?CryptoTickerProviders:null,Nr=Xt&&Xt.buildSubscriptionKey?Xt.buildSubscriptionKey:ft&&typeof ft.buildSubscriptionKey=="function"?ft.buildSubscriptionKey:function(n,t,a,h){let c=n||"",i=t||"",p=a||null,v=h||null,T="";return p!==null&&v!==null&&p!==v&&(T="__"+p+"_"+v),c+"__"+i+T},Ur=Ne("./providers/connection-states"),Ae=Ur||(typeof CryptoTickerConnectionStates!="undefined"?CryptoTickerConnectionStates:{LIVE:"live",DETACHED:"detached",BACKUP:"backup",BROKEN:"broken"}),Fr=Ne("./canvas-renderer"),Br=Ne("./alert-manager"),Lr=Ne("./formatters"),_r=Ne("./ticker-state"),jr=Ne("./settings-manager"),ut=Fr||(typeof CryptoTickerCanvasRenderer!="undefined"?CryptoTickerCanvasRenderer:null),Zt=Br||(typeof CryptoTickerAlertManager!="undefined"?CryptoTickerAlertManager:null),en=Lr||(typeof CryptoTickerFormatters!="undefined"?CryptoTickerFormatters:null),we=_r||(typeof CryptoTickerState!="undefined"?CryptoTickerState:null),dt=jr||(typeof CryptoTickerSettingsManager!="undefined"?CryptoTickerSettingsManager:null);if(!ut||!Zt||!en||!we||!dt)throw new Error("CryptoTicker dependencies are not available");var Gn=!1,ht=null,lt,Lt,$r=!1,Wr=60*60*1e3,Qt=null,_t=dt.applyDefaultSettings,zr=dt.defaultSettings,Hr=dt.getDefaultSettingsSnapshot,qr=dt.settingsSchema,me={type:"com.courcelle.cryptoticker.ticker",log:function(...n){Gn&&console.log(...n)},setContextConnectionState:function(n,t){we.setConnectionState(n,t)},getContextConnectionState:function(n){return we.getConnectionState(n)},clearContextConnectionState:function(n){we.clearConnectionState(n)},getProviderRegistry:function(){if(!Qt){let n=Ne("./providers/provider-registry"),t=n&&n.ProviderRegistry?n.ProviderRegistry:ft&&ft.ProviderRegistry?ft.ProviderRegistry:null;if(!t)throw new Error("ProviderRegistry is not available");Qt=new t({baseUrl:mt,logger:(...a)=>{this.log(...a)},fallbackPollIntervalMs:De.fallbackPollIntervalMs,staleTickerTimeoutMs:De.staleTickerTimeoutMs,binanceRestBaseUrl:De.binanceRestBaseUrl,binanceWsBaseUrl:De.binanceWsBaseUrl,binanceSymbolOverrides:De.binanceSymbolOverrides,bitfinexRestBaseUrl:De.bitfinexRestBaseUrl,bitfinexWsBaseUrl:De.bitfinexWsBaseUrl,bitfinexSymbolOverrides:De.bitfinexSymbolOverrides})}return Qt},websocketSend:function(n){ht&&ht.send(n)},onKeyDown:async function(n,t,a,h){switch(t.mode){case"candles":t.mode="ticker";break;case"ticker":default:Zt.shouldDisarmOnKeyPress(n)?Zt.disarmAlert(n):t.mode="candles";break}this.websocketSend(JSON.stringify({event:"setSettings",context:n,payload:t})),this.refreshTimer(n,t)},onKeyUp:function(n,t,a,h){},onWillAppear:async function(n,t,a){this.initCanvas(),this.refreshTimer(n,t)},refreshTimers:async function(){we.forEachContext(n=>{this.refreshTimer(n.context,n.settings)})},refreshTimer:async function(n,t){let a=this.refreshSettings(n,t);this.updateTicker(n,a)},connect:function(){let n=this.getProviderRegistry();n&&typeof n.ensureAllConnections=="function"&&n.ensureAllConnections()},updateSubscription:function(n,t){let a=t.exchange,h=t.pair,c=this.resolveConversionCurrencies(t.fromCurrency,t.currency),i=this.getSubscriptionContextKey(a,h,c.from,null),p=we.getSubscription(n);if(p&&p.key===i)return p;if(p&&typeof p.unsubscribe=="function"){try{p.unsubscribe()}catch(u){this.log("Error unsubscribing from provider",u)}we.clearSubscription(n),this.clearContextConnectionState(n)}let T=this.getProviderRegistry().getProvider(a),x={exchange:a,symbol:h,fromCurrency:c.from,toCurrency:null},y=this;try{let u=T.subscribeTicker(x,{onData:async function(f){let k=we.getContextDetails(n);if(k){y.setContextConnectionState(k.context,f&&f.connectionState);try{let d=await y.convertTickerValues(f,k.settings&&k.settings.fromCurrency,k.settings&&k.settings.currency);await y.updateCanvas(k.context,k.settings,d)}catch(d){y.log("Error updating canvas from subscription",d)}}},onError:function(f){y.log("Provider subscription error",f),y.setContextConnectionState(n,Ae.BROKEN)}});return we.setSubscription(n,{key:i,unsubscribe:u&&typeof u.unsubscribe=="function"?u.unsubscribe:function(){},providerId:T.getId?T.getId():null}),we.getSubscription(n)}catch(u){this.log("Error subscribing to provider",u)}return null},refreshSettings:function(n,t){return dt.refreshSettings({context:n,settings:t,updateSubscription:a=>{this.updateSubscription(n,a)}})},getSubscriptionContextKey:function(n,t,a,h){return Nr(n,t,a,h)},resolveConversionCurrencies:function(n,t){let a=ct(n)||"USD",h=ct(t);return!h||h===a?{from:a,to:null}:{from:a,to:h}},getConversionRate:async function(n,t){let a=ct(n),h=ct(t);if(!a||!h||a===h)return 1;let c=a+"_"+h,i=Date.now(),p=we.getOrCreateConversionRateEntry(c);if(typeof p.rate=="number"&&p.rate>0&&p.fetchedAt&&i-p.fetchedAt<Wr)return p.rate;if(p.promise)try{return await p.promise}catch(u){this.log("Conversion rate promise failed",u)}let v=typeof fetch=="function"?fetch:null;if(!v)return typeof p.rate=="number"&&p.rate>0?p.rate:1;let T=(mt||"").replace(/\/$/,"");if(!T)return typeof p.rate=="number"&&p.rate>0?p.rate:1;let x=T+"/api/ticker/json/currency/"+encodeURIComponent(a)+"/"+encodeURIComponent(h),y=this;p.promise=async function(){try{let u=qn(x),f=await v(u.url,u.options);if(!f||!f.ok)throw new Error("Conversion rate response not ok");let k=await f.json(),d=k&&k.rate!==void 0?parseFloat(k.rate):NaN;if(!d||!isFinite(d)||d<=0)throw new Error("Invalid conversion rate");return p.rate=d,p.fetchedAt=Date.now(),d}catch(u){throw y.log("Error fetching conversion rate",u),u}finally{delete p.promise}}();try{return await p.promise}catch{return typeof p.rate=="number"&&p.rate>0?p.rate:1}},convertTickerValues:async function(n,t,a){if(!n)return n;let h=this.resolveConversionCurrencies(t,a);if(!h.to)return n;let c=ct(n.conversionToCurrency),i=ct(n.conversionFromCurrency);if(c===h.to&&i===h.from)return n;let p=null;try{p=await this.getConversionRate(h.from,h.to)}catch(v){return this.log("Conversion rate error",v),this.createConversionErrorValues(n)}return!p||!isFinite(p)||p<=0?this.createConversionErrorValues(n):this.applyTickerConversion(n,p,h.from,h.to)},createConversionErrorValues:function(n){let t=Object.assign({},n),a=["last","high","low","open","close","changeDaily","changeDailyPercent","volume"];for(let h=0;h<a.length;h++){let c=a[h];Object.prototype.hasOwnProperty.call(t,c)&&delete t[c]}return t.conversionRate=null,t.conversionError=!0,t},applyTickerConversion:function(n,t,a,h){if(!n||typeof n!="object")return n;let c=Object.assign({},n),i=["last","high","low","open","close","changeDaily"];for(let p=0;p<i.length;p++){let v=i[p];if(!Object.prototype.hasOwnProperty.call(n,v))continue;let T=n[v],x=typeof T=="number"?T:parseFloat(T);isNaN(x)||(c[v]=x*t)}return c.conversionRate=t,c.conversionFromCurrency=a,c.conversionToCurrency=h,c},applyCandlesConversion:function(n,t){return!Array.isArray(n)||!t||!isFinite(t)||t<=0?n:n.map(function(a){if(!a||typeof a!="object")return a;let h=Object.assign({},a),c=["open","close","high","low"];for(let i=0;i<c.length;i++){let p=c[i];if(!Object.prototype.hasOwnProperty.call(a,p))continue;let v=a[p],T=typeof v=="number"?v:parseFloat(v);isNaN(T)||(h[p]=T*t)}if(Object.prototype.hasOwnProperty.call(a,"volumeQuote")){let i=a.volumeQuote,p=typeof i=="number"?i:parseFloat(i);isNaN(p)||(h.volumeQuote=p*t)}return h})},updateTicker:async function(n,t){let a=t.pair,h=await this.getTickerValue(a,t.currency,t.exchange,t.fromCurrency);this.setContextConnectionState(n,h&&h.connectionState),this.updateCanvas(n,t,h)},initCanvas:function(){lt=document.getElementById("ticker"),Lt=lt.getContext("2d")},updateCanvas:async function(n,t,a){this.log("updateCanvas",n,t,a);let h=a&&a.connectionState||this.getContextConnectionState(n);switch(t.mode){case"candles":{let c=await this.getCandles(t);this.updateCanvasCandles(n,t,c,h);break}case"ticker":default:this.updateCanvasTicker(n,t,a,h);break}},sanitizeTickerValues:function(n){if(!n||typeof n!="object")return{values:{},hasAny:!1,hasCritical:!1,timestamp:null};let t=Object.assign({},n);function a(v,T,x){if(typeof v=="number"&&Number.isFinite(v))return x?Math.round(v):v;if(typeof v=="string"){let y=v.trim();if(y){let u=x?parseInt(y,10):parseFloat(y);if(!isNaN(u)&&Number.isFinite(u))return x?Math.round(u):u}}return T}let h=a(n.last,null,!1);h===null?delete t.last:t.last=h;let c={high:null,low:null,volume:0,changeDaily:0,changeDailyPercent:0};Object.keys(c).forEach(v=>{let T=c[v],x=a(n[v],T,!1);x==null||!Number.isFinite(x)?delete t[v]:x===T&&n[v]===void 0?T===null?delete t[v]:t[v]=T:t[v]=x});let i=["lastUpdated","timestamp","time","updatedAt"],p=null;for(let v=0;v<i.length;v++){let T=i[v];if(!Object.prototype.hasOwnProperty.call(n,T))continue;let y=a(n[T],null,!0);if(y!=null){let u=y>Ar?y:y*1e3;p=u,t.lastUpdated=u;break}}return typeof t.pairDisplay!="string"&&delete t.pairDisplay,{values:t,hasAny:Object.keys(n).length>0,hasCritical:h!==null,timestamp:p}},buildTickerRenderContext:function(n,t,a,h){let c=this.sanitizeTickerValues(a),i=c.values,p=Date.now(),v="missing",T=null,x=null,y=i,u=null,f=h||i.connectionState||null,k=we.getLastGoodTicker(n),d=f===Ae.BROKEN,l=[Ae.LIVE,Ae.BACKUP,Ae.DETACHED].indexOf(f)!==-1,g=c.hasCritical&&Number.isFinite(i.last)&&i.last===0&&(!Number.isFinite(i.high)||i.high===0)&&(!Number.isFinite(i.low)||i.low===0)&&(!Number.isFinite(i.volume)||i.volume===0)&&c.timestamp===null,S=c.hasCritical&&(!l||d)&&g;if(!!i.conversionError){v="missing",y=Object.assign({},i);let C=t.title||i.pairDisplay||i.pair||t.pair||"";return!y.pairDisplay&&C&&(y.pairDisplay=C),T=Ie.conversionError||"CONVERSION ERROR",u="conversion_error",{values:y,dataState:v,infoMessage:T,lastValidTimestamp:x,degradedReason:u}}if(c.hasCritical&&!d&&!S){let C=c.timestamp||p;i.lastUpdated=C,we.setLastGoodTicker(n,i,C),x=C,v="live",y=Object.assign({},i)}else if(k&&k.values&&typeof k.values=="object"&&Number.isFinite(k.values.last))v="stale",y=Object.assign({},k.values),x=k.timestamp,y.lastUpdated||(y.lastUpdated=k.timestamp),T=Ie.stale,u=c.hasAny?"partial":"missing";else{v="missing",y=Object.assign({},i);let C=t.title||i.pairDisplay||i.pair||t.pair||"";!y.pairDisplay&&C&&(y.pairDisplay=C),S||d?(T=Ie.misconfigured||Ie.noData,u="misconfigured"):(T=Ie.loading,u=c.hasAny?"partial":"none")}return!T&&v==="missing"&&(T=d?Ie.misconfigured||Ie.noData:Ie.loading),!T&&v==="live"&&d&&(T=Ie.misconfigured||Ie.noData),!T&&v==="stale"&&!Ie.stale&&(T="STALE"),{values:y,dataState:v,infoMessage:T,lastValidTimestamp:x,degradedReason:u}},displayMessage:function(n,t,a){this.initCanvas();let h=a||{},c=_t(h.settings||{}),i=h.backgroundColor||c.backgroundColor||"#000000",p=h.textColor||c.textColor||"#ffffff",v=h.font||c.font||"Lato",T=h.fontSize||null,x=h.connectionState||null,y=h.displayConnectionStatusIcon||c.displayConnectionStatusIcon||"OFF";x&&this.setContextConnectionState(n,x),ut.renderMessageCanvas({canvas:lt,canvasContext:Lt,message:t,backgroundColor:i,textColor:p,font:v,fontSize:T,connectionStates:Ae,connectionState:x||this.getContextConnectionState(n),displayConnectionStatusIcon:y}),this.sendCanvas(n)},getCanvasSizeMultiplier:function(n,t){return ut.getCanvasSizeMultiplier(n,t)},getCandlesDisplayCount:function(n){return ut.getCandlesDisplayCount(n)},updateCanvasTicker:function(n,t,a,h){this.log("updateCanvasTicker",n,t,a);let c=this.buildTickerRenderContext(n,t,a,h);ut.renderTickerCanvas({canvas:lt,canvasContext:Lt,settings:t,values:c.values,context:n,connectionStates:Ae,connectionState:h||a&&a.connectionState||null,dataState:c.dataState,infoMessage:c.infoMessage,lastValidTimestamp:c.lastValidTimestamp,degradedReason:c.degradedReason}),this.sendCanvas(n)},updateCanvasCandles:function(n,t,a,h){this.log("updateCanvasCandles",n,t,a),ut.renderCandlesCanvas({canvas:lt,canvasContext:Lt,settings:t,candlesNormalized:a,connectionStates:Ae,connectionState:h||this.getContextConnectionState(n)}),this.sendCanvas(n)},sendCanvas:function(n){var t={event:"setImage",context:n,payload:{image:lt.toDataURL(),target:DestinationEnum.HARDWARE_AND_SOFTWARE}};this.websocketSend(JSON.stringify(t))},getRoundedValue:function(n,t,a,h){return en.getRoundedValue(n,t,a,h)},getTickerValue:async function(n,t,a,h){let i=this.getProviderRegistry().getProvider(a),p=this.resolveConversionCurrencies(h,t),v={exchange:a,symbol:n,fromCurrency:p.from,toCurrency:null};try{let T=await i.fetchTicker(v),y=await this.convertTickerValues(T,p.from,p.to)||T;return y&&typeof y=="object"&&!y.connectionState&&(y.connectionState=Ae.DETACHED),y}catch(T){this.log("Error fetching ticker",T);let x=this.getSubscriptionContextKey(a,n,p.from,null);if(i&&typeof i.getCachedTicker=="function"){let y=i.getCachedTicker(x);if(y){let f=await this.convertTickerValues(y,p.from,p.to)||y;return f&&!f.connectionState&&(f.connectionState=Ae.BACKUP),f}}return{changeDaily:0,changeDailyPercent:0,last:0,volume:0,high:0,low:0,pair:n,pairDisplay:n,connectionState:Ae.BROKEN}}},getCandles:async function(n){this.log("getCandles");let t=n.exchange,a=n.pair,h=this.convertCandlesInterval(n.candlesInterval||"1h"),c=this.getCandlesDisplayCount(n),i=this.resolveConversionCurrencies(n.fromCurrency,n.currency),p=i.to||i.from||"",v=t+"_"+a+"_"+h+"_"+c+"_"+p,T=we.getCandlesCacheEntry(v);T||(T={},we.setCandlesCacheEntry(v,T));let x=new Date().getTime(),y="time",u="candles";if(T[y]&&T[y]>x-60*1e3)return T[u];let f={exchange:t,symbol:a,interval:h,limit:24},k=null;try{let g=this.getProviderRegistry(),S=g.getProvider(t);if(S&&typeof S.fetchCandles=="function"&&(k=await S.fetchCandles(f)),Array.isArray(k)||(k=null),k===null){let I=g.getGenericProvider();I&&typeof I.fetchCandles=="function"&&(k=await I.fetchCandles(f),Array.isArray(k)||(k=null))}}catch(g){this.log("Error fetching provider candles",g),k=null}if(k===null)try{let g=mt+"/api/Candles/json/"+t+"/"+a+"/"+h+"?limit=24",S=qn(g),C=await(await fetch(S.url,S.options)).json();C&&Array.isArray(C.candles)&&(k=C.candles)}catch(g){this.log("Error fetching candles from proxy",g)}if(!Array.isArray(k))return T[u]||[];let d=this.prepareCandlesForDisplay(k,c),P=d;if(i.to)try{let g=await this.getConversionRate(i.from,i.to);g&&isFinite(g)&&g>0&&(P=this.applyCandlesConversion(d,g))}catch(g){this.log("Conversion rate error for candles",g)}let l=this.getCandlesNormalized(P);return T[y]=x,T[u]=l,T[u]},convertCandlesInterval:function(n){switch(n){case"1m":return"MINUTES_1";case"5m":return"MINUTES_5";case"15m":return"MINUTES_15";case"1h":return"HOURS_1";case"6h":return"HOURS_6";case"12h":return"HOURS_12";case"1D":return"DAYS_1";case"7D":return"DAYS_7";case"1M":return"MONTHS_1"}return n},prepareCandlesForDisplay:function(n,t){if(!Array.isArray(n)||n.length===0)return[];let a=n.map(function(h){if(!h)return null;let c=h.ts;if(typeof c!="number"){let i=h.openTime;if(i){let p=Date.parse(i);isNaN(p)||(c=Math.floor(p/1e3))}}return typeof c!="number"||isNaN(c)?null:{candle:h,ts:c}}).filter(function(h){return h!==null}).sort(function(h,c){return h.ts-c.ts}).map(function(h){return h.candle.ts===h.ts?h.candle:Object.assign({},h.candle,{ts:h.ts})});return typeof t=="number"&&t>0&&a.length>t?a.slice(-t):a},getCandlesNormalized:function(n){let t=Number.POSITIVE_INFINITY,a=0,h=Number.POSITIVE_INFINITY,c=0,i=Number.POSITIVE_INFINITY,p=0;(n||[]).forEach(function(x){i=Math.min(i,x.ts),p=Math.max(p,x.ts),t=Math.min(t,x.open),t=Math.min(t,x.close),t=Math.min(t,x.high),t=Math.min(t,x.low),a=Math.max(a,x.open),a=Math.max(a,x.close),a=Math.max(a,x.high),a=Math.max(a,x.low),h=Math.min(h,x.volumeQuote),c=Math.max(c,x.volumeQuote)});let v=this,T=[];return(n||[]).forEach(function(x){T.push({timePercent:v.normalizeValue(x.ts,i,p),openPercent:v.normalizeValue(x.open,t,a),closePercent:v.normalizeValue(x.close,t,a),highPercent:v.normalizeValue(x.high,t,a),lowPercent:v.normalizeValue(x.low,t,a),volumePercent:v.normalizeValue(x.volumeQuote,h,c)})}),this.log("getCandlesNormalized",T),T},normalizeValue:function(n,t,a){return en.normalizeValue(n,t,a)}};me.defaultSettings=zr;me.applyDefaultSettings=_t;me.getDefaultSettings=function(){return Hr()};me.settingsSchema=qr;function Vr(n,t,a,h,c){ht=new WebSocket("ws://127.0.0.1:"+n);function i(p){var v={event:a,uuid:p};me.websocketSend(JSON.stringify(v))}ht.onopen=function(){i(t)},ht.onmessage=async function(p){var v=JSON.parse(p.data);let T=v.event,x=v.context,y=v.payload||{},u=y.settings;!u&&T==="sendToPlugin"&&(u=y);let f=u,k=y.coordinates,d=y.userDesiredState;["deviceDidConnect","titleParametersDidChange"].indexOf(T)>=0||(f!=null&&(f=_t(f)),T=="keyDown"?await me.onKeyDown(x,f,k,d):T=="keyUp"?await me.onKeyUp(x,f,k,d):T=="willAppear"?await me.onWillAppear(x,f,k):f!=null&&(me.refreshSettings(x,f),me.refreshTimer(x,f)))},ht.onclose=function(){},setInterval(async function(){await me.refreshTimers()},3e5)}if($r){Gn=!0,me.connect();let n=_t({digits:0,pair:"LTCUSD",mode:"ticker"}),t="test",a={column:1,row:1},h=null;setTimeout(function(){me.onWillAppear(t,n,a),setInterval(async function(){await me.onKeyDown(t,n,a,h),await me.onKeyUp(t,n,a,h)},5e3)},1e3)}typeof tn!="undefined"&&(tn.exports=me);typeof window!="undefined"&&(window.connectElgatoStreamDeckSocket=Vr)});var ni=be(hn()),ri=be(dn()),ii=be(Ye()),si=be(yt()),oi=be(Je()),ai=be(Qe()),ci=be(et()),li=be(Cn()),ui=be(Mt()),hi=be(Ht()),fi=be(qt()),di=be(Vt()),pi=be(xn()),gi=be(Gt()),bi=be(Nt()),yi=be(Yt()),mi=be(Jt()),vi=be(Fn()),Ci=be($n()),wi=be(Kn());var Yn=typeof window!="undefined"?window:globalThis,pt=typeof CryptoTickerDefaults!="undefined"?CryptoTickerDefaults:null,Pe=typeof tickerAction!="undefined"?tickerAction:null;if(!Pe)throw new Error("Ticker action dependency is missing for the preview page");var Gr=pt&&typeof pt.getDefaultSettings=="function"?pt.getDefaultSettings():typeof Pe.getDefaultSettings=="function"?Pe.getDefaultSettings():{},Kr=pt&&typeof pt.applyDefaults=="function"?function(n){return pt.applyDefaults(n||{})}:function(n){return Object.assign({},Gr,n||{})};Pe.sendCanvas=function(){};function Jn(n){if(Yn.canvas=n,Yn.canvasContext=n.getContext("2d"),Pe&&typeof Pe.initCanvas=="function"&&typeof document!="undefined"){let t=document.getElementById.bind(document);document.getElementById=function(a){return a==="ticker"?n:t(a)};try{Pe.initCanvas()}finally{document.getElementById=t}}}function Yr(n){let t=[],a=n.high||0,h=n.low||0,c=n.volume||0,i=a-h||1,p=20;for(let v=0;v<p;v++){let T=h+i*v/p,x=h+i*(v+.5)/p,y=Math.max(T,x)+i*.05,u=Math.min(T,x)-i*.05;t.push({ts:v,open:T,close:x,high:y,low:u,volumeQuote:c})}return Pe.getCandlesNormalized(t)}async function Xn(){let n=document.getElementById("precomputedToggle").checked,a=await(await fetch("/dev/options.json")).json(),h=document.getElementById("previews");h.innerHTML="";for(let c=0;c<a.length;c++){let i=a[c],p=document.createElement("div");p.className="preview-group";let v=document.createElement("div");v.className="canvas-row";let T=document.createElement("canvas");T.width=288,T.height=288,v.appendChild(T);let x=document.createElement("canvas");x.width=288,x.height=288,v.appendChild(x),p.appendChild(v);let y=document.createElement("div");y.className="label",y.textContent=i.name||"Option "+(c+1),p.appendChild(y);let u=Kr(i.settings),f=document.createElement("pre");f.className="settings",f.textContent=JSON.stringify(u,null,4),p.appendChild(f),h.appendChild(p),Jn(T);let k;n&&i.values?k=i.values:k=await Pe.getTickerValue(u.pair,u.currency,u.exchange),Pe.updateCanvasTicker(c+"-ticker",u,k,k&&k.connectionState),Jn(x);let d;n&&i.values?d=Yr(i.values):d=await Pe.getCandles(u),Pe.updateCanvasCandles(c+"-candles",u,d,k&&k.connectionState)}}document.getElementById("precomputedToggle").addEventListener("change",Xn);Xn();})();
