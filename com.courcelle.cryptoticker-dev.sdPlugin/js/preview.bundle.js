"use strict";(()=>{var br=Object.create;var an=Object.defineProperty;var yr=Object.getOwnPropertyDescriptor;var mr=Object.getOwnPropertyNames;var vr=Object.getPrototypeOf,Cr=Object.prototype.hasOwnProperty;var He=(n=>typeof require!="undefined"?require:typeof Proxy!="undefined"?new Proxy(n,{get:(t,a)=>(typeof require!="undefined"?require:t)[a]}):n)(function(n){if(typeof require!="undefined")return require.apply(this,arguments);throw Error('Dynamic require of "'+n+'" is not supported')});var he=(n,t)=>()=>(t||n((t={exports:{}}).exports,t),t.exports);var wr=(n,t,a,l)=>{if(t&&typeof t=="object"||typeof t=="function")for(let c of mr(t))!Cr.call(n,c)&&c!==a&&an(n,c,{get:()=>t[c],enumerable:!(l=yr(t,c))||l.enumerable});return n};var be=(n,t,a)=>(a=n!=null?br(vr(n)):{},wr(t||!n||!n.__esModule?an(a,"default",{value:n,enumerable:!0}):a,n));var ln=he((kt,Wt)=>{"use strict";var cn,bt;cn=self,bt=()=>(()=>{var n={d:(D,e)=>{for(var o in e)n.o(e,o)&&!n.o(D,o)&&Object.defineProperty(D,o,{enumerable:!0,get:e[o]})}};n.g=function(){if(typeof globalThis=="object")return globalThis;try{return this||new Function("return this")()}catch{if(typeof window=="object")return window}}(),n.o=(D,e)=>Object.prototype.hasOwnProperty.call(D,e),n.r=D=>{typeof Symbol!="undefined"&&Symbol.toStringTag&&Object.defineProperty(D,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(D,"t",{value:!0})};var t,a={};n.r(a),n.d(a,{AbortError:()=>i,DefaultHttpClient:()=>W,HttpClient:()=>p,HttpError:()=>l,HttpResponse:()=>f,HttpTransportType:()=>Q,HubConnection:()=>pe,HubConnectionBuilder:()=>Be,HubConnectionState:()=>q,JsonHubProtocol:()=>Ue,LogLevel:()=>t,MessageType:()=>U,NullLogger:()=>C,Subject:()=>ve,TimeoutError:()=>c,TransferFormat:()=>ee,VERSION:()=>g});class l extends Error{constructor(e,o){let b=new.target.prototype;super(`${e}: Status code '${o}'`),this.statusCode=o,this.__proto__=b}}class c extends Error{constructor(e="A timeout occurred."){let o=new.target.prototype;super(e),this.__proto__=o}}class i extends Error{constructor(e="An abort occurred."){let o=new.target.prototype;super(e),this.__proto__=o}}class d extends Error{constructor(e,o){let b=new.target.prototype;super(e),this.transport=o,this.errorType="UnsupportedTransportError",this.__proto__=b}}class k extends Error{constructor(e,o){let b=new.target.prototype;super(e),this.transport=o,this.errorType="DisabledTransportError",this.__proto__=b}}class x extends Error{constructor(e,o){let b=new.target.prototype;super(e),this.transport=o,this.errorType="FailedToStartTransportError",this.__proto__=b}}class m extends Error{constructor(e){let o=new.target.prototype;super(e),this.errorType="FailedToNegotiateWithServerError",this.__proto__=o}}class T extends Error{constructor(e,o){let b=new.target.prototype;super(e),this.innerErrors=o,this.__proto__=b}}class f{constructor(e,o,b){this.statusCode=e,this.statusText=o,this.content=b}}class p{get(e,o){return this.send({...o,method:"GET",url:e})}post(e,o){return this.send({...o,method:"POST",url:e})}delete(e,o){return this.send({...o,method:"DELETE",url:e})}getCookieString(e){return""}}(function(D){D[D.Trace=0]="Trace",D[D.Debug=1]="Debug",D[D.Information=2]="Information",D[D.Warning=3]="Warning",D[D.Error=4]="Error",D[D.Critical=5]="Critical",D[D.None=6]="None"})(t||(t={}));class C{constructor(){}log(e,o){}}C.instance=new C;let g="8.0.0";class P{static isRequired(e,o){if(e==null)throw new Error(`The '${o}' argument is required.`)}static isNotEmpty(e,o){if(!e||e.match(/^\s*$/))throw new Error(`The '${o}' argument should not be empty.`)}static isIn(e,o,b){if(!(e in o))throw new Error(`Unknown ${b} value: ${e}.`)}}class u{static get isBrowser(){return!u.isNode&&typeof window=="object"&&typeof window.document=="object"}static get isWebWorker(){return!u.isNode&&typeof self=="object"&&"importScripts"in self}static get isReactNative(){return!u.isNode&&typeof window=="object"&&window.document===void 0}static get isNode(){return typeof process!="undefined"&&process.release&&process.release.name==="node"}}function h(D,e){let o="";return S(D)?(o=`Binary data of length ${D.byteLength}`,e&&(o+=`. Content: '${function(b){let w=new Uint8Array(b),I="";return w.forEach(A=>{I+=`0x${A<16?"0":""}${A.toString(16)} `}),I.substr(0,I.length-1)}(D)}'`)):typeof D=="string"&&(o=`String data of length ${D.length}`,e&&(o+=`. Content: '${D}'`)),o}function S(D){return D&&typeof ArrayBuffer!="undefined"&&(D instanceof ArrayBuffer||D.constructor&&D.constructor.name==="ArrayBuffer")}async function M(D,e,o,b,w,I){let A={},[L,j]=E();A[L]=j,D.log(t.Trace,`(${e} transport) sending data. ${h(w,I.logMessageContent)}.`);let G=S(w)?"arraybuffer":"text",ne=await o.post(b,{content:w,headers:{...A,...I.headers},responseType:G,timeout:I.timeout,withCredentials:I.withCredentials});D.log(t.Trace,`(${e} transport) request complete. Response status: ${ne.statusCode}.`)}class y{constructor(e,o){this.i=e,this.h=o}dispose(){let e=this.i.observers.indexOf(this.h);e>-1&&this.i.observers.splice(e,1),this.i.observers.length===0&&this.i.cancelCallback&&this.i.cancelCallback().catch(o=>{})}}class O{constructor(e){this.l=e,this.out=console}log(e,o){if(e>=this.l){let b=`[${new Date().toISOString()}] ${t[e]}: ${o}`;switch(e){case t.Critical:case t.Error:this.out.error(b);break;case t.Warning:this.out.warn(b);break;case t.Information:this.out.info(b);break;default:this.out.log(b)}}}}function E(){let D="X-SignalR-User-Agent";return u.isNode&&(D="User-Agent"),[D,B(g,H(),u.isNode?"NodeJS":"Browser",N())]}function B(D,e,o,b){let w="Microsoft SignalR/",I=D.split(".");return w+=`${I[0]}.${I[1]}`,w+=` (${D}; `,w+=e&&e!==""?`${e}; `:"Unknown OS; ",w+=`${o}`,w+=b?`; ${b}`:"; Unknown Runtime Version",w+=")",w}function H(){if(!u.isNode)return"";switch(process.platform){case"win32":return"Windows NT";case"darwin":return"macOS";case"linux":return"Linux";default:return process.platform}}function N(){if(u.isNode)return process.versions.node}function Y(D){return D.stack?D.stack:D.message?D.message:`${D}`}class re extends p{constructor(e){super(),this.u=e,this.p=fetch.bind(function(){if(typeof globalThis!="undefined")return globalThis;if(typeof self!="undefined")return self;if(typeof window!="undefined")return window;if(n.g!==void 0)return n.g;throw new Error("could not find global")}()),this.m=AbortController,this.m}async send(e){if(e.abortSignal&&e.abortSignal.aborted)throw new i;if(!e.method)throw new Error("No method defined.");if(!e.url)throw new Error("No url defined.");let o=new this.m,b;e.abortSignal&&(e.abortSignal.onabort=()=>{o.abort(),b=new i});let w,I=null;if(e.timeout){let j=e.timeout;I=setTimeout(()=>{o.abort(),this.u.log(t.Warning,"Timeout from HTTP request."),b=new c},j)}e.content===""&&(e.content=void 0),e.content&&(e.headers=e.headers||{},S(e.content)?e.headers["Content-Type"]="application/octet-stream":e.headers["Content-Type"]="text/plain;charset=UTF-8");try{w=await this.p(e.url,{body:e.content,cache:"no-cache",credentials:e.withCredentials===!0?"include":"same-origin",headers:{"X-Requested-With":"XMLHttpRequest",...e.headers},method:e.method,mode:"cors",redirect:"follow",signal:o.signal})}catch(j){throw b||(this.u.log(t.Warning,`Error from HTTP request. ${j}.`),j)}finally{I&&clearTimeout(I),e.abortSignal&&(e.abortSignal.onabort=null)}if(!w.ok){let j=await J(w,"text");throw new l(j||w.statusText,w.status)}let A=J(w,e.responseType),L=await A;return new f(w.status,w.statusText,L)}getCookieString(e){let o="";return u.isNode&&this.v&&this.v.getCookies(e,(b,w)=>o=w.join("; ")),o}}function J(D,e){let o;switch(e){case"arraybuffer":o=D.arrayBuffer();break;case"text":default:o=D.text();break;case"blob":case"document":case"json":throw new Error(`${e} is not supported.`)}return o}class ie extends p{constructor(e){super(),this.u=e}send(e){return e.abortSignal&&e.abortSignal.aborted?Promise.reject(new i):e.method?e.url?new Promise((o,b)=>{let w=new XMLHttpRequest;w.open(e.method,e.url,!0),w.withCredentials=e.withCredentials===void 0||e.withCredentials,w.setRequestHeader("X-Requested-With","XMLHttpRequest"),e.content===""&&(e.content=void 0),e.content&&(S(e.content)?w.setRequestHeader("Content-Type","application/octet-stream"):w.setRequestHeader("Content-Type","text/plain;charset=UTF-8"));let I=e.headers;I&&Object.keys(I).forEach(A=>{w.setRequestHeader(A,I[A])}),e.responseType&&(w.responseType=e.responseType),e.abortSignal&&(e.abortSignal.onabort=()=>{w.abort(),b(new i)}),e.timeout&&(w.timeout=e.timeout),w.onload=()=>{e.abortSignal&&(e.abortSignal.onabort=null),w.status>=200&&w.status<300?o(new f(w.status,w.statusText,w.response||w.responseText)):b(new l(w.response||w.responseText||w.statusText,w.status))},w.onerror=()=>{this.u.log(t.Warning,`Error from HTTP request. ${w.status}: ${w.statusText}.`),b(new l(w.statusText,w.status))},w.ontimeout=()=>{this.u.log(t.Warning,"Timeout from HTTP request."),b(new c)},w.send(e.content)}):Promise.reject(new Error("No url defined.")):Promise.reject(new Error("No method defined."))}}class W extends p{constructor(e){if(super(),typeof fetch!="undefined"||u.isNode)this.$=new re(e);else{if(typeof XMLHttpRequest=="undefined")throw new Error("No usable HttpClient found.");this.$=new ie(e)}}send(e){return e.abortSignal&&e.abortSignal.aborted?Promise.reject(new i):e.method?e.url?this.$.send(e):Promise.reject(new Error("No url defined.")):Promise.reject(new Error("No method defined."))}getCookieString(e){return this.$.getCookieString(e)}}class z{static write(e){return`${e}${z.RecordSeparator}`}static parse(e){if(e[e.length-1]!==z.RecordSeparator)throw new Error("Message is incomplete.");let o=e.split(z.RecordSeparator);return o.pop(),o}}z.RecordSeparatorCode=30,z.RecordSeparator=String.fromCharCode(z.RecordSeparatorCode);class fe{writeHandshakeRequest(e){return z.write(JSON.stringify(e))}parseHandshakeResponse(e){let o,b;if(S(e)){let A=new Uint8Array(e),L=A.indexOf(z.RecordSeparatorCode);if(L===-1)throw new Error("Message is incomplete.");let j=L+1;o=String.fromCharCode.apply(null,Array.prototype.slice.call(A.slice(0,j))),b=A.byteLength>j?A.slice(j).buffer:null}else{let A=e,L=A.indexOf(z.RecordSeparator);if(L===-1)throw new Error("Message is incomplete.");let j=L+1;o=A.substring(0,j),b=A.length>j?A.substring(j):null}let w=z.parse(o),I=JSON.parse(w[0]);if(I.type)throw new Error("Expected a handshake response from the server.");return[b,I]}}var U,q;(function(D){D[D.Invocation=1]="Invocation",D[D.StreamItem=2]="StreamItem",D[D.Completion=3]="Completion",D[D.StreamInvocation=4]="StreamInvocation",D[D.CancelInvocation=5]="CancelInvocation",D[D.Ping=6]="Ping",D[D.Close=7]="Close",D[D.Ack=8]="Ack",D[D.Sequence=9]="Sequence"})(U||(U={}));class ve{constructor(){this.observers=[]}next(e){for(let o of this.observers)o.next(e)}error(e){for(let o of this.observers)o.error&&o.error(e)}complete(){for(let e of this.observers)e.complete&&e.complete()}subscribe(e){return this.observers.push(e),new y(this,e)}}class we{constructor(e,o,b){this.C=1e5,this.S=[],this.k=0,this.P=!1,this.T=1,this.I=0,this._=0,this.H=!1,this.D=e,this.R=o,this.C=b}async A(e){let o=this.D.writeMessage(e),b=Promise.resolve();if(this.U(e)){this.k++;let w=()=>{},I=()=>{};S(o)?this._+=o.byteLength:this._+=o.length,this._>=this.C&&(b=new Promise((A,L)=>{w=A,I=L})),this.S.push(new ye(o,this.k,w,I))}try{this.H||await this.R.send(o)}catch{this.L()}await b}N(e){let o=-1;for(let b=0;b<this.S.length;b++){let w=this.S[b];if(w.q<=e.sequenceId)o=b,S(w.M)?this._-=w.M.byteLength:this._-=w.M.length,w.j();else{if(!(this._<this.C))break;w.j()}}o!==-1&&(this.S=this.S.slice(o+1))}W(e){if(this.P)return e.type===U.Sequence&&(this.P=!1,!0);if(!this.U(e))return!0;let o=this.T;return this.T++,o<=this.I?(o===this.I&&this.O(),!1):(this.I=o,this.O(),!0)}F(e){e.sequenceId>this.T?this.R.stop(new Error("Sequence ID greater than amount of messages we've received.")):this.T=e.sequenceId}L(){this.H=!0,this.P=!0}async B(){let e=this.S.length!==0?this.S[0].q:this.k+1;await this.R.send(this.D.writeMessage({type:U.Sequence,sequenceId:e}));let o=this.S;for(let b of o)await this.R.send(b.M);this.H=!1}X(e){e!=null||(e=new Error("Unable to reconnect to server."));for(let o of this.S)o.J(e)}U(e){switch(e.type){case U.Invocation:case U.StreamItem:case U.Completion:case U.StreamInvocation:case U.CancelInvocation:return!0;case U.Close:case U.Sequence:case U.Ping:case U.Ack:return!1}}O(){this.V===void 0&&(this.V=setTimeout(async()=>{try{this.H||await this.R.send(this.D.writeMessage({type:U.Ack,sequenceId:this.I}))}catch{}clearTimeout(this.V),this.V=void 0},1e3))}}class ye{constructor(e,o,b,w){this.M=e,this.q=o,this.j=b,this.J=w}}(function(D){D.Disconnected="Disconnected",D.Connecting="Connecting",D.Connected="Connected",D.Disconnecting="Disconnecting",D.Reconnecting="Reconnecting"})(q||(q={}));class pe{static create(e,o,b,w,I,A,L){return new pe(e,o,b,w,I,A,L)}constructor(e,o,b,w,I,A,L){this.K=0,this.G=()=>{this.u.log(t.Warning,"The page is being frozen, this will likely lead to the connection being closed and messages being lost. For more information see the docs at https://learn.microsoft.com/aspnet/core/signalr/javascript-client#bsleep")},P.isRequired(e,"connection"),P.isRequired(o,"logger"),P.isRequired(b,"protocol"),this.serverTimeoutInMilliseconds=I!=null?I:3e4,this.keepAliveIntervalInMilliseconds=A!=null?A:15e3,this.Y=L!=null?L:1e5,this.u=o,this.D=b,this.connection=e,this.Z=w,this.tt=new fe,this.connection.onreceive=j=>this.et(j),this.connection.onclose=j=>this.st(j),this.it={},this.nt={},this.rt=[],this.ot=[],this.ht=[],this.ct=0,this.lt=!1,this.ut=q.Disconnected,this.dt=!1,this.ft=this.D.writeMessage({type:U.Ping})}get state(){return this.ut}get connectionId(){return this.connection&&this.connection.connectionId||null}get baseUrl(){return this.connection.baseUrl||""}set baseUrl(e){if(this.ut!==q.Disconnected&&this.ut!==q.Reconnecting)throw new Error("The HubConnection must be in the Disconnected or Reconnecting state to change the url.");if(!e)throw new Error("The HubConnection url must be a valid url.");this.connection.baseUrl=e}start(){return this.wt=this.gt(),this.wt}async gt(){if(this.ut!==q.Disconnected)return Promise.reject(new Error("Cannot start a HubConnection that is not in the 'Disconnected' state."));this.ut=q.Connecting,this.u.log(t.Debug,"Starting HubConnection.");try{await this.yt(),u.isBrowser&&window.document.addEventListener("freeze",this.G),this.ut=q.Connected,this.dt=!0,this.u.log(t.Debug,"HubConnection connected successfully.")}catch(e){return this.ut=q.Disconnected,this.u.log(t.Debug,`HubConnection failed to start successfully because of error '${e}'.`),Promise.reject(e)}}async yt(){this.bt=void 0,this.lt=!1;let e=new Promise((o,b)=>{this.vt=o,this.Et=b});await this.connection.start(this.D.transferFormat);try{let o=this.D.version;this.connection.features.reconnect||(o=1);let b={protocol:this.D.name,version:o};if(this.u.log(t.Debug,"Sending handshake request."),await this.$t(this.tt.writeHandshakeRequest(b)),this.u.log(t.Information,`Using HubProtocol '${this.D.name}'.`),this.Ct(),this.St(),this.kt(),await e,this.bt)throw this.bt;this.connection.features.reconnect&&(this.Pt=new we(this.D,this.connection,this.Y),this.connection.features.disconnected=this.Pt.L.bind(this.Pt),this.connection.features.resend=()=>{if(this.Pt)return this.Pt.B()}),this.connection.features.inherentKeepAlive||await this.$t(this.ft)}catch(o){throw this.u.log(t.Debug,`Hub handshake failed with error '${o}' during start(). Stopping HubConnection.`),this.Ct(),this.Tt(),await this.connection.stop(o),o}}async stop(){let e=this.wt;this.connection.features.reconnect=!1,this.It=this._t(),await this.It;try{await e}catch{}}_t(e){if(this.ut===q.Disconnected)return this.u.log(t.Debug,`Call to HubConnection.stop(${e}) ignored because it is already in the disconnected state.`),Promise.resolve();if(this.ut===q.Disconnecting)return this.u.log(t.Debug,`Call to HttpConnection.stop(${e}) ignored because the connection is already in the disconnecting state.`),this.It;let o=this.ut;return this.ut=q.Disconnecting,this.u.log(t.Debug,"Stopping HubConnection."),this.Ht?(this.u.log(t.Debug,"Connection stopped during reconnect delay. Done reconnecting."),clearTimeout(this.Ht),this.Ht=void 0,this.Dt(),Promise.resolve()):(o===q.Connected&&this.Rt(),this.Ct(),this.Tt(),this.bt=e||new i("The connection was stopped before the hub handshake could complete."),this.connection.stop(e))}async Rt(){try{await this.xt(this.At())}catch{}}stream(e,...o){let[b,w]=this.Ut(o),I=this.Lt(e,o,w),A,L=new ve;return L.cancelCallback=()=>{let j=this.Nt(I.invocationId);return delete this.it[I.invocationId],A.then(()=>this.xt(j))},this.it[I.invocationId]=(j,G)=>{G?L.error(G):j&&(j.type===U.Completion?j.error?L.error(new Error(j.error)):L.complete():L.next(j.item))},A=this.xt(I).catch(j=>{L.error(j),delete this.it[I.invocationId]}),this.qt(b,A),L}$t(e){return this.kt(),this.connection.send(e)}xt(e){return this.Pt?this.Pt.A(e):this.$t(this.D.writeMessage(e))}send(e,...o){let[b,w]=this.Ut(o),I=this.xt(this.Mt(e,o,!0,w));return this.qt(b,I),I}invoke(e,...o){let[b,w]=this.Ut(o),I=this.Mt(e,o,!1,w);return new Promise((A,L)=>{this.it[I.invocationId]=(G,ne)=>{ne?L(ne):G&&(G.type===U.Completion?G.error?L(new Error(G.error)):A(G.result):L(new Error(`Unexpected message type: ${G.type}`)))};let j=this.xt(I).catch(G=>{L(G),delete this.it[I.invocationId]});this.qt(b,j)})}on(e,o){e&&o&&(e=e.toLowerCase(),this.nt[e]||(this.nt[e]=[]),this.nt[e].indexOf(o)===-1&&this.nt[e].push(o))}off(e,o){if(!e)return;e=e.toLowerCase();let b=this.nt[e];if(b)if(o){let w=b.indexOf(o);w!==-1&&(b.splice(w,1),b.length===0&&delete this.nt[e])}else delete this.nt[e]}onclose(e){e&&this.rt.push(e)}onreconnecting(e){e&&this.ot.push(e)}onreconnected(e){e&&this.ht.push(e)}et(e){if(this.Ct(),this.lt||(e=this.jt(e),this.lt=!0),e){let o=this.D.parseMessages(e,this.u);for(let b of o)if(!this.Pt||this.Pt.W(b))switch(b.type){case U.Invocation:this.Wt(b);break;case U.StreamItem:case U.Completion:{let w=this.it[b.invocationId];if(w){b.type===U.Completion&&delete this.it[b.invocationId];try{w(b)}catch(I){this.u.log(t.Error,`Stream callback threw error: ${Y(I)}`)}}break}case U.Ping:break;case U.Close:{this.u.log(t.Information,"Close message received from server.");let w=b.error?new Error("Server returned an error on close: "+b.error):void 0;b.allowReconnect===!0?this.connection.stop(w):this.It=this._t(w);break}case U.Ack:this.Pt&&this.Pt.N(b);break;case U.Sequence:this.Pt&&this.Pt.F(b);break;default:this.u.log(t.Warning,`Invalid message type: ${b.type}.`)}}this.St()}jt(e){let o,b;try{[b,o]=this.tt.parseHandshakeResponse(e)}catch(w){let I="Error parsing handshake response: "+w;this.u.log(t.Error,I);let A=new Error(I);throw this.Et(A),A}if(o.error){let w="Server returned handshake error: "+o.error;this.u.log(t.Error,w);let I=new Error(w);throw this.Et(I),I}return this.u.log(t.Debug,"Server handshake complete."),this.vt(),b}kt(){this.connection.features.inherentKeepAlive||(this.K=new Date().getTime()+this.keepAliveIntervalInMilliseconds,this.Tt())}St(){if(!(this.connection.features&&this.connection.features.inherentKeepAlive||(this.Ot=setTimeout(()=>this.serverTimeout(),this.serverTimeoutInMilliseconds),this.Ft!==void 0))){let e=this.K-new Date().getTime();e<0&&(e=0),this.Ft=setTimeout(async()=>{if(this.ut===q.Connected)try{await this.$t(this.ft)}catch{this.Tt()}},e)}}serverTimeout(){this.connection.stop(new Error("Server timeout elapsed without receiving a message from the server."))}async Wt(e){let o=e.target.toLowerCase(),b=this.nt[o];if(!b)return this.u.log(t.Warning,`No client method with the name '${o}' found.`),void(e.invocationId&&(this.u.log(t.Warning,`No result given for '${o}' method and invocation ID '${e.invocationId}'.`),await this.xt(this.Bt(e.invocationId,"Client didn't provide a result.",null))));let w=b.slice(),I=!!e.invocationId,A,L,j;for(let G of w)try{let ne=A;A=await G.apply(this,e.arguments),I&&A&&ne&&(this.u.log(t.Error,`Multiple results provided for '${o}'. Sending error to server.`),j=this.Bt(e.invocationId,"Client provided multiple results.",null)),L=void 0}catch(ne){L=ne,this.u.log(t.Error,`A callback for the method '${o}' threw error '${ne}'.`)}j?await this.xt(j):I?(L?j=this.Bt(e.invocationId,`${L}`,null):A!==void 0?j=this.Bt(e.invocationId,null,A):(this.u.log(t.Warning,`No result given for '${o}' method and invocation ID '${e.invocationId}'.`),j=this.Bt(e.invocationId,"Client didn't provide a result.",null)),await this.xt(j)):A&&this.u.log(t.Error,`Result given for '${o}' method but server is not expecting a result.`)}st(e){this.u.log(t.Debug,`HubConnection.connectionClosed(${e}) called while in state ${this.ut}.`),this.bt=this.bt||e||new i("The underlying connection was closed before the hub handshake could complete."),this.vt&&this.vt(),this.Xt(e||new Error("Invocation canceled due to the underlying connection being closed.")),this.Ct(),this.Tt(),this.ut===q.Disconnecting?this.Dt(e):this.ut===q.Connected&&this.Z?this.Jt(e):this.ut===q.Connected&&this.Dt(e)}Dt(e){if(this.dt){this.ut=q.Disconnected,this.dt=!1,this.Pt&&(this.Pt.X(e!=null?e:new Error("Connection closed.")),this.Pt=void 0),u.isBrowser&&window.document.removeEventListener("freeze",this.G);try{this.rt.forEach(o=>o.apply(this,[e]))}catch(o){this.u.log(t.Error,`An onclose callback called with error '${e}' threw error '${o}'.`)}}}async Jt(e){let o=Date.now(),b=0,w=e!==void 0?e:new Error("Attempting to reconnect due to a unknown error."),I=this.zt(b++,0,w);if(I===null)return this.u.log(t.Debug,"Connection not reconnecting because the IRetryPolicy returned null on the first reconnect attempt."),void this.Dt(e);if(this.ut=q.Reconnecting,e?this.u.log(t.Information,`Connection reconnecting because of error '${e}'.`):this.u.log(t.Information,"Connection reconnecting."),this.ot.length!==0){try{this.ot.forEach(A=>A.apply(this,[e]))}catch(A){this.u.log(t.Error,`An onreconnecting callback called with error '${e}' threw error '${A}'.`)}if(this.ut!==q.Reconnecting)return void this.u.log(t.Debug,"Connection left the reconnecting state in onreconnecting callback. Done reconnecting.")}for(;I!==null;){if(this.u.log(t.Information,`Reconnect attempt number ${b} will start in ${I} ms.`),await new Promise(A=>{this.Ht=setTimeout(A,I)}),this.Ht=void 0,this.ut!==q.Reconnecting)return void this.u.log(t.Debug,"Connection left the reconnecting state during reconnect delay. Done reconnecting.");try{if(await this.yt(),this.ut=q.Connected,this.u.log(t.Information,"HubConnection reconnected successfully."),this.ht.length!==0)try{this.ht.forEach(A=>A.apply(this,[this.connection.connectionId]))}catch(A){this.u.log(t.Error,`An onreconnected callback called with connectionId '${this.connection.connectionId}; threw error '${A}'.`)}return}catch(A){if(this.u.log(t.Information,`Reconnect attempt failed because of error '${A}'.`),this.ut!==q.Reconnecting)return this.u.log(t.Debug,`Connection moved to the '${this.ut}' from the reconnecting state during reconnect attempt. Done reconnecting.`),void(this.ut===q.Disconnecting&&this.Dt());w=A instanceof Error?A:new Error(A.toString()),I=this.zt(b++,Date.now()-o,w)}}this.u.log(t.Information,`Reconnect retries have been exhausted after ${Date.now()-o} ms and ${b} failed attempts. Connection disconnecting.`),this.Dt()}zt(e,o,b){try{return this.Z.nextRetryDelayInMilliseconds({elapsedMilliseconds:o,previousRetryCount:e,retryReason:b})}catch(w){return this.u.log(t.Error,`IRetryPolicy.nextRetryDelayInMilliseconds(${e}, ${o}) threw error '${w}'.`),null}}Xt(e){let o=this.it;this.it={},Object.keys(o).forEach(b=>{let w=o[b];try{w(null,e)}catch(I){this.u.log(t.Error,`Stream 'error' callback called with '${e}' threw error: ${Y(I)}`)}})}Tt(){this.Ft&&(clearTimeout(this.Ft),this.Ft=void 0)}Ct(){this.Ot&&clearTimeout(this.Ot)}Mt(e,o,b,w){if(b)return w.length!==0?{arguments:o,streamIds:w,target:e,type:U.Invocation}:{arguments:o,target:e,type:U.Invocation};{let I=this.ct;return this.ct++,w.length!==0?{arguments:o,invocationId:I.toString(),streamIds:w,target:e,type:U.Invocation}:{arguments:o,invocationId:I.toString(),target:e,type:U.Invocation}}}qt(e,o){if(e.length!==0){o||(o=Promise.resolve());for(let b in e)e[b].subscribe({complete:()=>{o=o.then(()=>this.xt(this.Bt(b)))},error:w=>{let I;I=w instanceof Error?w.message:w&&w.toString?w.toString():"Unknown error",o=o.then(()=>this.xt(this.Bt(b,I)))},next:w=>{o=o.then(()=>this.xt(this.Vt(b,w)))}})}}Ut(e){let o=[],b=[];for(let w=0;w<e.length;w++){let I=e[w];if(this.Kt(I)){let A=this.ct;this.ct++,o[A]=I,b.push(A.toString()),e.splice(w,1)}}return[o,b]}Kt(e){return e&&e.subscribe&&typeof e.subscribe=="function"}Lt(e,o,b){let w=this.ct;return this.ct++,b.length!==0?{arguments:o,invocationId:w.toString(),streamIds:b,target:e,type:U.StreamInvocation}:{arguments:o,invocationId:w.toString(),target:e,type:U.StreamInvocation}}Nt(e){return{invocationId:e,type:U.CancelInvocation}}Vt(e,o){return{invocationId:e,item:o,type:U.StreamItem}}Bt(e,o,b){return o?{error:o,invocationId:e,type:U.Completion}:{invocationId:e,result:b,type:U.Completion}}At(){return{type:U.Close}}}let Z=[0,2e3,1e4,3e4,null];class Te{constructor(e){this.Gt=e!==void 0?[...e,null]:Z}nextRetryDelayInMilliseconds(e){return this.Gt[e.previousRetryCount]}}class X{}X.Authorization="Authorization",X.Cookie="Cookie";class Ee extends p{constructor(e,o){super(),this.Qt=e,this.Yt=o}async send(e){let o=!0;this.Yt&&(!this.Zt||e.url&&e.url.indexOf("/negotiate?")>0)&&(o=!1,this.Zt=await this.Yt()),this.te(e);let b=await this.Qt.send(e);return o&&b.statusCode===401&&this.Yt?(this.Zt=await this.Yt(),this.te(e),await this.Qt.send(e)):b}te(e){e.headers||(e.headers={}),this.Zt?e.headers[X.Authorization]=`Bearer ${this.Zt}`:this.Yt&&e.headers[X.Authorization]&&delete e.headers[X.Authorization]}getCookieString(e){return this.Qt.getCookieString(e)}}var Q,ee;(function(D){D[D.None=0]="None",D[D.WebSockets=1]="WebSockets",D[D.ServerSentEvents=2]="ServerSentEvents",D[D.LongPolling=4]="LongPolling"})(Q||(Q={})),function(D){D[D.Text=1]="Text",D[D.Binary=2]="Binary"}(ee||(ee={}));class Ne{constructor(){this.ee=!1,this.onabort=null}abort(){this.ee||(this.ee=!0,this.onabort&&this.onabort())}get signal(){return this}get aborted(){return this.ee}}class _e{get pollAborted(){return this.se.aborted}constructor(e,o,b){this.$=e,this.u=o,this.se=new Ne,this.ie=b,this.ne=!1,this.onreceive=null,this.onclose=null}async connect(e,o){if(P.isRequired(e,"url"),P.isRequired(o,"transferFormat"),P.isIn(o,ee,"transferFormat"),this.re=e,this.u.log(t.Trace,"(LongPolling transport) Connecting."),o===ee.Binary&&typeof XMLHttpRequest!="undefined"&&typeof new XMLHttpRequest().responseType!="string")throw new Error("Binary protocols over XmlHttpRequest not implementing advanced features are not supported.");let[b,w]=E(),I={[b]:w,...this.ie.headers},A={abortSignal:this.se.signal,headers:I,timeout:1e5,withCredentials:this.ie.withCredentials};o===ee.Binary&&(A.responseType="arraybuffer");let L=`${e}&_=${Date.now()}`;this.u.log(t.Trace,`(LongPolling transport) polling: ${L}.`);let j=await this.$.get(L,A);j.statusCode!==200?(this.u.log(t.Error,`(LongPolling transport) Unexpected response code: ${j.statusCode}.`),this.oe=new l(j.statusText||"",j.statusCode),this.ne=!1):this.ne=!0,this.he=this.ce(this.re,A)}async ce(e,o){try{for(;this.ne;)try{let b=`${e}&_=${Date.now()}`;this.u.log(t.Trace,`(LongPolling transport) polling: ${b}.`);let w=await this.$.get(b,o);w.statusCode===204?(this.u.log(t.Information,"(LongPolling transport) Poll terminated by server."),this.ne=!1):w.statusCode!==200?(this.u.log(t.Error,`(LongPolling transport) Unexpected response code: ${w.statusCode}.`),this.oe=new l(w.statusText||"",w.statusCode),this.ne=!1):w.content?(this.u.log(t.Trace,`(LongPolling transport) data received. ${h(w.content,this.ie.logMessageContent)}.`),this.onreceive&&this.onreceive(w.content)):this.u.log(t.Trace,"(LongPolling transport) Poll timed out, reissuing.")}catch(b){this.ne?b instanceof c?this.u.log(t.Trace,"(LongPolling transport) Poll timed out, reissuing."):(this.oe=b,this.ne=!1):this.u.log(t.Trace,`(LongPolling transport) Poll errored after shutdown: ${b.message}`)}}finally{this.u.log(t.Trace,"(LongPolling transport) Polling complete."),this.pollAborted||this.ae()}}async send(e){return this.ne?M(this.u,"LongPolling",this.$,this.re,e,this.ie):Promise.reject(new Error("Cannot send until the transport is connected"))}async stop(){this.u.log(t.Trace,"(LongPolling transport) Stopping polling."),this.ne=!1,this.se.abort();try{await this.he,this.u.log(t.Trace,`(LongPolling transport) sending DELETE request to ${this.re}.`);let e={},[o,b]=E();e[o]=b;let w={headers:{...e,...this.ie.headers},timeout:this.ie.timeout,withCredentials:this.ie.withCredentials},I;try{await this.$.delete(this.re,w)}catch(A){I=A}I?I instanceof l&&(I.statusCode===404?this.u.log(t.Trace,"(LongPolling transport) A 404 response was returned from sending a DELETE request."):this.u.log(t.Trace,`(LongPolling transport) Error sending a DELETE request: ${I}`)):this.u.log(t.Trace,"(LongPolling transport) DELETE request accepted.")}finally{this.u.log(t.Trace,"(LongPolling transport) Stop finished."),this.ae()}}ae(){if(this.onclose){let e="(LongPolling transport) Firing onclose event.";this.oe&&(e+=" Error: "+this.oe),this.u.log(t.Trace,e),this.onclose(this.oe)}}}class je{constructor(e,o,b,w){this.$=e,this.Zt=o,this.u=b,this.ie=w,this.onreceive=null,this.onclose=null}async connect(e,o){return P.isRequired(e,"url"),P.isRequired(o,"transferFormat"),P.isIn(o,ee,"transferFormat"),this.u.log(t.Trace,"(SSE transport) Connecting."),this.re=e,this.Zt&&(e+=(e.indexOf("?")<0?"?":"&")+`access_token=${encodeURIComponent(this.Zt)}`),new Promise((b,w)=>{let I,A=!1;if(o===ee.Text){if(u.isBrowser||u.isWebWorker)I=new this.ie.EventSource(e,{withCredentials:this.ie.withCredentials});else{let L=this.$.getCookieString(e),j={};j.Cookie=L;let[G,ne]=E();j[G]=ne,I=new this.ie.EventSource(e,{withCredentials:this.ie.withCredentials,headers:{...j,...this.ie.headers}})}try{I.onmessage=L=>{if(this.onreceive)try{this.u.log(t.Trace,`(SSE transport) data received. ${h(L.data,this.ie.logMessageContent)}.`),this.onreceive(L.data)}catch(j){return void this.le(j)}},I.onerror=L=>{A?this.le():w(new Error("EventSource failed to connect. The connection could not be found on the server, either the connection ID is not present on the server, or a proxy is refusing/buffering the connection. If you have multiple servers check that sticky sessions are enabled."))},I.onopen=()=>{this.u.log(t.Information,`SSE connected to ${this.re}`),this.ue=I,A=!0,b()}}catch(L){return void w(L)}}else w(new Error("The Server-Sent Events transport only supports the 'Text' transfer format"))})}async send(e){return this.ue?M(this.u,"SSE",this.$,this.re,e,this.ie):Promise.reject(new Error("Cannot send until the transport is connected"))}stop(){return this.le(),Promise.resolve()}le(e){this.ue&&(this.ue.close(),this.ue=void 0,this.onclose&&this.onclose(e))}}class Fe{constructor(e,o,b,w,I,A){this.u=b,this.Yt=o,this.de=w,this.fe=I,this.$=e,this.onreceive=null,this.onclose=null,this.pe=A}async connect(e,o){let b;return P.isRequired(e,"url"),P.isRequired(o,"transferFormat"),P.isIn(o,ee,"transferFormat"),this.u.log(t.Trace,"(WebSockets transport) Connecting."),this.Yt&&(b=await this.Yt()),new Promise((w,I)=>{let A;e=e.replace(/^http/,"ws");let L=this.$.getCookieString(e),j=!1;if(u.isNode||u.isReactNative){let G={},[ne,Ae]=E();G[ne]=Ae,b&&(G[X.Authorization]=`Bearer ${b}`),L&&(G[X.Cookie]=L),A=new this.fe(e,void 0,{headers:{...G,...this.pe}})}else b&&(e+=(e.indexOf("?")<0?"?":"&")+`access_token=${encodeURIComponent(b)}`);A||(A=new this.fe(e)),o===ee.Binary&&(A.binaryType="arraybuffer"),A.onopen=G=>{this.u.log(t.Information,`WebSocket connected to ${e}.`),this.we=A,j=!0,w()},A.onerror=G=>{let ne=null;ne=typeof ErrorEvent!="undefined"&&G instanceof ErrorEvent?G.error:"There was an error with the transport",this.u.log(t.Information,`(WebSockets transport) ${ne}.`)},A.onmessage=G=>{if(this.u.log(t.Trace,`(WebSockets transport) data received. ${h(G.data,this.de)}.`),this.onreceive)try{this.onreceive(G.data)}catch(ne){return void this.le(ne)}},A.onclose=G=>{if(j)this.le(G);else{let ne=null;ne=typeof ErrorEvent!="undefined"&&G instanceof ErrorEvent?G.error:"WebSocket failed to connect. The connection could not be found on the server, either the endpoint may not be a SignalR endpoint, the connection ID is not present on the server, or there is a proxy blocking WebSockets. If you have multiple servers check that sticky sessions are enabled.",I(new Error(ne))}}})}send(e){return this.we&&this.we.readyState===this.fe.OPEN?(this.u.log(t.Trace,`(WebSockets transport) sending data. ${h(e,this.de)}.`),this.we.send(e),Promise.resolve()):Promise.reject("WebSocket is not in the OPEN state")}stop(){return this.we&&this.le(void 0),Promise.resolve()}le(e){this.we&&(this.we.onclose=()=>{},this.we.onmessage=()=>{},this.we.onerror=()=>{},this.we.close(),this.we=void 0),this.u.log(t.Trace,"(WebSockets transport) socket closed."),this.onclose&&(!this.ge(e)||e.wasClean!==!1&&e.code===1e3?e instanceof Error?this.onclose(e):this.onclose():this.onclose(new Error(`WebSocket closed with status code: ${e.code} (${e.reason||"no reason given"}).`)))}ge(e){return e&&typeof e.wasClean=="boolean"&&typeof e.code=="number"}}class Se{constructor(e,o={}){var b;if(this.me=()=>{},this.features={},this.ye=1,P.isRequired(e,"url"),this.u=(b=o.logger)===void 0?new O(t.Information):b===null?C.instance:b.log!==void 0?b:new O(b),this.baseUrl=this.be(e),(o=o||{}).logMessageContent=o.logMessageContent!==void 0&&o.logMessageContent,typeof o.withCredentials!="boolean"&&o.withCredentials!==void 0)throw new Error("withCredentials option was not a 'boolean' or 'undefined' value");o.withCredentials=o.withCredentials===void 0||o.withCredentials,o.timeout=o.timeout===void 0?1e5:o.timeout;let w=null,I=null;u.isNode&&(w=function(){throw new Error("Trying to import 'ws' in the browser.")}(),I=function(){throw new Error("Trying to import 'eventsource' in the browser.")}()),u.isNode||typeof WebSocket=="undefined"||o.WebSocket?u.isNode&&!o.WebSocket&&w&&(o.WebSocket=w):o.WebSocket=WebSocket,u.isNode||typeof EventSource=="undefined"||o.EventSource?u.isNode&&!o.EventSource&&I!==void 0&&(o.EventSource=I):o.EventSource=EventSource,this.$=new Ee(o.httpClient||new W(this.u),o.accessTokenFactory),this.ut="Disconnected",this.dt=!1,this.ie=o,this.onreceive=null,this.onclose=null}async start(e){if(e=e||ee.Binary,P.isIn(e,ee,"transferFormat"),this.u.log(t.Debug,`Starting connection with transfer format '${ee[e]}'.`),this.ut!=="Disconnected")return Promise.reject(new Error("Cannot start an HttpConnection that is not in the 'Disconnected' state."));if(this.ut="Connecting",this.ve=this.yt(e),await this.ve,this.ut==="Disconnecting"){let o="Failed to start the HttpConnection before stop() was called.";return this.u.log(t.Error,o),await this.It,Promise.reject(new i(o))}if(this.ut!=="Connected"){let o="HttpConnection.startInternal completed gracefully but didn't enter the connection into the connected state!";return this.u.log(t.Error,o),Promise.reject(new i(o))}this.dt=!0}send(e){return this.ut!=="Connected"?Promise.reject(new Error("Cannot send data if the connection is not in the 'Connected' State.")):(this.Ee||(this.Ee=new ce(this.transport)),this.Ee.send(e))}async stop(e){return this.ut==="Disconnected"?(this.u.log(t.Debug,`Call to HttpConnection.stop(${e}) ignored because the connection is already in the disconnected state.`),Promise.resolve()):this.ut==="Disconnecting"?(this.u.log(t.Debug,`Call to HttpConnection.stop(${e}) ignored because the connection is already in the disconnecting state.`),this.It):(this.ut="Disconnecting",this.It=new Promise(o=>{this.me=o}),await this._t(e),void await this.It)}async _t(e){this.$e=e;try{await this.ve}catch{}if(this.transport){try{await this.transport.stop()}catch(o){this.u.log(t.Error,`HttpConnection.transport.stop() threw error '${o}'.`),this.Ce()}this.transport=void 0}else this.u.log(t.Debug,"HttpConnection.transport is undefined in HttpConnection.stop() because start() failed.")}async yt(e){let o=this.baseUrl;this.Yt=this.ie.accessTokenFactory,this.$.Yt=this.Yt;try{if(this.ie.skipNegotiation){if(this.ie.transport!==Q.WebSockets)throw new Error("Negotiation can only be skipped when using the WebSocket transport directly.");this.transport=this.Se(Q.WebSockets),await this.ke(o,e)}else{let b=null,w=0;do{if(b=await this.Pe(o),this.ut==="Disconnecting"||this.ut==="Disconnected")throw new i("The connection was stopped during negotiation.");if(b.error)throw new Error(b.error);if(b.ProtocolVersion)throw new Error("Detected a connection attempt to an ASP.NET SignalR Server. This client only supports connecting to an ASP.NET Core SignalR Server. See https://aka.ms/signalr-core-differences for details.");if(b.url&&(o=b.url),b.accessToken){let I=b.accessToken;this.Yt=()=>I,this.$.Zt=I,this.$.Yt=void 0}w++}while(b.url&&w<100);if(w===100&&b.url)throw new Error("Negotiate redirection limit exceeded.");await this.Te(o,this.ie.transport,b,e)}this.transport instanceof _e&&(this.features.inherentKeepAlive=!0),this.ut==="Connecting"&&(this.u.log(t.Debug,"The HttpConnection connected successfully."),this.ut="Connected")}catch(b){return this.u.log(t.Error,"Failed to start the connection: "+b),this.ut="Disconnected",this.transport=void 0,this.me(),Promise.reject(b)}}async Pe(e){let o={},[b,w]=E();o[b]=w;let I=this.Ie(e);this.u.log(t.Debug,`Sending negotiation request: ${I}.`);try{let A=await this.$.post(I,{content:"",headers:{...o,...this.ie.headers},timeout:this.ie.timeout,withCredentials:this.ie.withCredentials});if(A.statusCode!==200)return Promise.reject(new Error(`Unexpected status code returned from negotiate '${A.statusCode}'`));let L=JSON.parse(A.content);return(!L.negotiateVersion||L.negotiateVersion<1)&&(L.connectionToken=L.connectionId),L.useStatefulReconnect&&this.ie._e!==!0?Promise.reject(new m("Client didn't negotiate Stateful Reconnect but the server did.")):L}catch(A){let L="Failed to complete negotiation with the server: "+A;return A instanceof l&&A.statusCode===404&&(L+=" Either this is not a SignalR endpoint or there is a proxy blocking the connection."),this.u.log(t.Error,L),Promise.reject(new m(L))}}He(e,o){return o?e+(e.indexOf("?")===-1?"?":"&")+`id=${o}`:e}async Te(e,o,b,w){let I=this.He(e,b.connectionToken);if(this.De(o))return this.u.log(t.Debug,"Connection was provided an instance of ITransport, using that directly."),this.transport=o,await this.ke(I,w),void(this.connectionId=b.connectionId);let A=[],L=b.availableTransports||[],j=b;for(let G of L){let ne=this.Re(G,o,w,(j==null?void 0:j.useStatefulReconnect)===!0);if(ne instanceof Error)A.push(`${G.transport} failed:`),A.push(ne);else if(this.De(ne)){if(this.transport=ne,!j){try{j=await this.Pe(e)}catch(Ae){return Promise.reject(Ae)}I=this.He(e,j.connectionToken)}try{return await this.ke(I,w),void(this.connectionId=j.connectionId)}catch(Ae){if(this.u.log(t.Error,`Failed to start the transport '${G.transport}': ${Ae}`),j=void 0,A.push(new x(`${G.transport} failed: ${Ae}`,Q[G.transport])),this.ut!=="Connecting"){let ze="Failed to select transport before stop() was called.";return this.u.log(t.Debug,ze),Promise.reject(new i(ze))}}}}return A.length>0?Promise.reject(new T(`Unable to connect to the server with any of the available transports. ${A.join(" ")}`,A)):Promise.reject(new Error("None of the transports supported by the client are supported by the server."))}Se(e){switch(e){case Q.WebSockets:if(!this.ie.WebSocket)throw new Error("'WebSocket' is not supported in your environment.");return new Fe(this.$,this.Yt,this.u,this.ie.logMessageContent,this.ie.WebSocket,this.ie.headers||{});case Q.ServerSentEvents:if(!this.ie.EventSource)throw new Error("'EventSource' is not supported in your environment.");return new je(this.$,this.$.Zt,this.u,this.ie);case Q.LongPolling:return new _e(this.$,this.u,this.ie);default:throw new Error(`Unknown transport: ${e}.`)}}ke(e,o){return this.transport.onreceive=this.onreceive,this.features.reconnect?this.transport.onclose=async b=>{let w=!1;if(this.features.reconnect){try{this.features.disconnected(),await this.transport.connect(e,o),await this.features.resend()}catch{w=!0}w&&this.Ce(b)}else this.Ce(b)}:this.transport.onclose=b=>this.Ce(b),this.transport.connect(e,o)}Re(e,o,b,w){let I=Q[e.transport];if(I==null)return this.u.log(t.Debug,`Skipping transport '${e.transport}' because it is not supported by this client.`),new Error(`Skipping transport '${e.transport}' because it is not supported by this client.`);if(!function(A,L){return!A||(L&A)!=0}(o,I))return this.u.log(t.Debug,`Skipping transport '${Q[I]}' because it was disabled by the client.`),new k(`'${Q[I]}' is disabled by the client.`,I);if(!(e.transferFormats.map(A=>ee[A]).indexOf(b)>=0))return this.u.log(t.Debug,`Skipping transport '${Q[I]}' because it does not support the requested transfer format '${ee[b]}'.`),new Error(`'${Q[I]}' does not support ${ee[b]}.`);if(I===Q.WebSockets&&!this.ie.WebSocket||I===Q.ServerSentEvents&&!this.ie.EventSource)return this.u.log(t.Debug,`Skipping transport '${Q[I]}' because it is not supported in your environment.'`),new d(`'${Q[I]}' is not supported in your environment.`,I);this.u.log(t.Debug,`Selecting transport '${Q[I]}'.`);try{return this.features.reconnect=I===Q.WebSockets?w:void 0,this.Se(I)}catch(A){return A}}De(e){return e&&typeof e=="object"&&"connect"in e}Ce(e){if(this.u.log(t.Debug,`HttpConnection.stopConnection(${e}) called while in state ${this.ut}.`),this.transport=void 0,e=this.$e||e,this.$e=void 0,this.ut!=="Disconnected"){if(this.ut==="Connecting")throw this.u.log(t.Warning,`Call to HttpConnection.stopConnection(${e}) was ignored because the connection is still in the connecting state.`),new Error(`HttpConnection.stopConnection(${e}) was called while the connection is still in the connecting state.`);if(this.ut==="Disconnecting"&&this.me(),e?this.u.log(t.Error,`Connection disconnected with error '${e}'.`):this.u.log(t.Information,"Connection disconnected."),this.Ee&&(this.Ee.stop().catch(o=>{this.u.log(t.Error,`TransportSendQueue.stop() threw error '${o}'.`)}),this.Ee=void 0),this.connectionId=void 0,this.ut="Disconnected",this.dt){this.dt=!1;try{this.onclose&&this.onclose(e)}catch(o){this.u.log(t.Error,`HttpConnection.onclose(${e}) threw error '${o}'.`)}}}else this.u.log(t.Debug,`Call to HttpConnection.stopConnection(${e}) was ignored because the connection is already in the disconnected state.`)}be(e){if(e.lastIndexOf("https://",0)===0||e.lastIndexOf("http://",0)===0)return e;if(!u.isBrowser)throw new Error(`Cannot resolve '${e}'.`);let o=window.document.createElement("a");return o.href=e,this.u.log(t.Information,`Normalizing '${e}' to '${o.href}'.`),o.href}Ie(e){let o=new URL(e);o.pathname.endsWith("/")?o.pathname+="negotiate":o.pathname+="/negotiate";let b=new URLSearchParams(o.searchParams);return b.has("negotiateVersion")||b.append("negotiateVersion",this.ye.toString()),b.has("useStatefulReconnect")?b.get("useStatefulReconnect")==="true"&&(this.ie._e=!0):this.ie._e===!0&&b.append("useStatefulReconnect","true"),o.search=b.toString(),o.toString()}}class ce{constructor(e){this.xe=e,this.Ae=[],this.Ue=!0,this.Le=new De,this.Ne=new De,this.qe=this.Me()}send(e){return this.je(e),this.Ne||(this.Ne=new De),this.Ne.promise}stop(){return this.Ue=!1,this.Le.resolve(),this.qe}je(e){if(this.Ae.length&&typeof this.Ae[0]!=typeof e)throw new Error(`Expected data to be of type ${typeof this.Ae} but was of type ${typeof e}`);this.Ae.push(e),this.Le.resolve()}async Me(){for(;;){if(await this.Le.promise,!this.Ue){this.Ne&&this.Ne.reject("Connection stopped.");break}this.Le=new De;let e=this.Ne;this.Ne=void 0;let o=typeof this.Ae[0]=="string"?this.Ae.join(""):ce.We(this.Ae);this.Ae.length=0;try{await this.xe.send(o),e.resolve()}catch(b){e.reject(b)}}}static We(e){let o=e.map(I=>I.byteLength).reduce((I,A)=>I+A),b=new Uint8Array(o),w=0;for(let I of e)b.set(new Uint8Array(I),w),w+=I.byteLength;return b.buffer}}class De{constructor(){this.promise=new Promise((e,o)=>[this.j,this.Oe]=[e,o])}resolve(){this.j()}reject(e){this.Oe(e)}}class Ue{constructor(){this.name="json",this.version=2,this.transferFormat=ee.Text}parseMessages(e,o){if(typeof e!="string")throw new Error("Invalid input for JSON hub protocol. Expected a string.");if(!e)return[];o===null&&(o=C.instance);let b=z.parse(e),w=[];for(let I of b){let A=JSON.parse(I);if(typeof A.type!="number")throw new Error("Invalid payload.");switch(A.type){case U.Invocation:this.U(A);break;case U.StreamItem:this.Fe(A);break;case U.Completion:this.Be(A);break;case U.Ping:case U.Close:break;case U.Ack:this.Xe(A);break;case U.Sequence:this.Je(A);break;default:o.log(t.Information,"Unknown message type '"+A.type+"' ignored.");continue}w.push(A)}return w}writeMessage(e){return z.write(JSON.stringify(e))}U(e){this.ze(e.target,"Invalid payload for Invocation message."),e.invocationId!==void 0&&this.ze(e.invocationId,"Invalid payload for Invocation message.")}Fe(e){if(this.ze(e.invocationId,"Invalid payload for StreamItem message."),e.item===void 0)throw new Error("Invalid payload for StreamItem message.")}Be(e){if(e.result&&e.error)throw new Error("Invalid payload for Completion message.");!e.result&&e.error&&this.ze(e.error,"Invalid payload for Completion message."),this.ze(e.invocationId,"Invalid payload for Completion message.")}Xe(e){if(typeof e.sequenceId!="number")throw new Error("Invalid SequenceId for Ack message.")}Je(e){if(typeof e.sequenceId!="number")throw new Error("Invalid SequenceId for Sequence message.")}ze(e,o){if(typeof e!="string"||e==="")throw new Error(o)}}let $e={trace:t.Trace,debug:t.Debug,info:t.Information,information:t.Information,warn:t.Warning,warning:t.Warning,error:t.Error,critical:t.Critical,none:t.None};class Be{configureLogging(e){if(P.isRequired(e,"logging"),e.log!==void 0)this.logger=e;else if(typeof e=="string"){let o=function(b){let w=$e[b.toLowerCase()];if(w!==void 0)return w;throw new Error(`Unknown log level: ${b}`)}(e);this.logger=new O(o)}else this.logger=new O(e);return this}withUrl(e,o){return P.isRequired(e,"url"),P.isNotEmpty(e,"url"),this.url=e,this.httpConnectionOptions=typeof o=="object"?{...this.httpConnectionOptions,...o}:{...this.httpConnectionOptions,transport:o},this}withHubProtocol(e){return P.isRequired(e,"protocol"),this.protocol=e,this}withAutomaticReconnect(e){if(this.reconnectPolicy)throw new Error("A reconnectPolicy has already been set.");return e?Array.isArray(e)?this.reconnectPolicy=new Te(e):this.reconnectPolicy=e:this.reconnectPolicy=new Te,this}withServerTimeout(e){return P.isRequired(e,"milliseconds"),this.Ve=e,this}withKeepAliveInterval(e){return P.isRequired(e,"milliseconds"),this.Ke=e,this}withStatefulReconnect(e){return this.httpConnectionOptions===void 0&&(this.httpConnectionOptions={}),this.httpConnectionOptions._e=!0,this.Y=e==null?void 0:e.bufferSize,this}build(){let e=this.httpConnectionOptions||{};if(e.logger===void 0&&(e.logger=this.logger),!this.url)throw new Error("The 'HubConnectionBuilder.withUrl' method must be called before building the connection.");let o=new Se(this.url,e);return pe.create(o,this.logger||C.instance,this.protocol||new Ue,this.reconnectPolicy,this.Ve,this.Ke,this.Y)}}return Uint8Array.prototype.indexOf||Object.defineProperty(Uint8Array.prototype,"indexOf",{value:Array.prototype.indexOf,writable:!0}),Uint8Array.prototype.slice||Object.defineProperty(Uint8Array.prototype,"slice",{value:function(D,e){return new Uint8Array(Array.prototype.slice.call(this,D,e))},writable:!0}),Uint8Array.prototype.forEach||Object.defineProperty(Uint8Array.prototype,"forEach",{value:Array.prototype.forEach,writable:!0}),a})(),typeof kt=="object"&&typeof Wt=="object"?Wt.exports=bt():typeof define=="function"&&define.amd?define([],bt):typeof kt=="object"?kt.signalR=bt():cn.signalR=bt()});var hn=he((un,St)=>{"use strict";(function(n,t){if(typeof St=="object"&&St.exports)St.exports=t();else{let a=t();n.CryptoTickerConfig=Object.assign({},n.CryptoTickerConfig||{},a)}})(typeof self!="undefined"?self:un,function(){return{tProxyBase:"https://tproxyv8.opendle.com",fallbackPollIntervalMs:6e4,staleTickerTimeoutMs:5*60*1e3,binanceRestBaseUrl:"https://api.binance.com",binanceWsBaseUrl:"wss://stream.binance.com:9443/ws",binanceSymbolOverrides:{},bitfinexRestBaseUrl:"https://api-pub.bitfinex.com",bitfinexWsBaseUrl:"wss://api-pub.bitfinex.com/ws/2",bitfinexSymbolOverrides:{},messages:{loading:"LOADING...",stale:"STALE",noData:"NO DATA",misconfigured:"INVALID PAIR",conversionError:"CONVERT ERROR"}}})});var Ke=he((fn,Tt)=>{"use strict";var kr={LIVE:"live",DETACHED:"detached",BACKUP:"backup",BROKEN:"broken"};(function(n,t){let a=typeof globalThis!="undefined"?globalThis:n,l=t();typeof Tt=="object"&&Tt.exports&&(Tt.exports=l),a&&(a.CryptoTickerConnectionStates=l)})(typeof self!="undefined"?self:fn,function(){return kr})});var yt=he((pn,Et)=>{"use strict";(function(n,t){let a=typeof globalThis!="undefined"?globalThis:n,l=t();typeof Et=="object"&&Et.exports&&(Et.exports=l),a&&(a.CryptoTickerProviders=a.CryptoTickerProviders||{},a.CryptoTickerProviders.buildSubscriptionKey=l.buildSubscriptionKey)})(typeof self!="undefined"?self:pn,function(){function t(a,l,c,i){let d=a||"",k=l||"",x=c||null,m=i||null,T="";return x!==null&&m!==null&&x!==m&&(T="__"+x+"_"+m),d+"__"+k+T}return{buildSubscriptionKey:t}})});var Ye=he((dn,xt)=>{"use strict";(function(n,t){let a=typeof globalThis!="undefined"?globalThis:n,l=t();typeof xt=="object"&&xt.exports&&(xt.exports=l),a&&(a.CryptoTickerProviders=a.CryptoTickerProviders||{},a.CryptoTickerProviders.ProviderInterface=l.ProviderInterface)})(typeof self!="undefined"?self:dn,function(){function t(){}class a{constructor(c){let i=c||{};this.baseUrl=typeof i.baseUrl=="string"?i.baseUrl:"",this.logger=typeof i.logger=="function"?i.logger:t}getId(){throw new Error("Provider must implement getId()")}subscribeTicker(c,i){throw new Error("Provider must implement subscribeTicker()")}async fetchTicker(c){throw new Error("Provider must implement fetchTicker()")}getCachedTicker(c){return null}async fetchCandles(c){throw new Error("Provider must implement fetchCandles()")}ensureConnection(){}async fetchConversionRate(c,i){return 1}}return{ProviderInterface:a}})});var Xe=he((gn,Je)=>{"use strict";(function(n,t){let a=typeof globalThis!="undefined"?globalThis:n,l=typeof Je=="object"&&Je.exports?[yt(),Ke()]:[n==null?void 0:n.CryptoTickerProviders,n==null?void 0:n.CryptoTickerConnectionStates],c=t(l[0],l[1]);typeof Je=="object"&&Je.exports&&(Je.exports=c),a&&(a.CryptoTickerProviders=a.CryptoTickerProviders||{},a.CryptoTickerProviders.TickerSubscriptionManager=c.TickerSubscriptionManager)})(typeof self!="undefined"?self:gn,function(n,t){let a=n.buildSubscriptionKey||n,l=t||{LIVE:"live",DETACHED:"detached",BACKUP:"backup",BROKEN:"broken"},c=6e4,i=5*60*1e3;function d(){}function k(T){let f=T||{};return{onData:typeof f.onData=="function"?f.onData:null,onError:typeof f.onError=="function"?f.onError:null}}function x(T){let f=T||{},p=f.fromCurrency||null,C=f.toCurrency||null;return{exchange:f.exchange,symbol:f.symbol,fromCurrency:p,toCurrency:C}}class m{constructor(f){let p=f||{};this.logger=typeof p.logger=="function"?p.logger:d,this.fetchTickerFn=typeof p.fetchTicker=="function"?p.fetchTicker:null,this.subscribeStreamingFn=typeof p.subscribeStreaming=="function"?p.subscribeStreaming:null,this.unsubscribeStreamingFn=typeof p.unsubscribeStreaming=="function"?p.unsubscribeStreaming:null,this.ensureConnectionFn=typeof p.ensureConnection=="function"?p.ensureConnection:null,this.subscriptionKeyBuilder=typeof p.buildSubscriptionKey=="function"?p.buildSubscriptionKey:a,this.fallbackPollIntervalMs=typeof p.fallbackPollIntervalMs=="number"?p.fallbackPollIntervalMs:c,this.staleTickerTimeoutMs=typeof p.staleTickerTimeoutMs=="number"?p.staleTickerTimeoutMs:i,this.connectionStates=l,this.entries={},this.cache={}}subscribe(f,p){let C=k(p),g=this.getOrCreateEntry(f);if(g.subscribers.push(C),this.ensureConnectionFn)try{this.ensureConnectionFn()}catch(u){this.logger("TickerSubscriptionManager: ensureConnection error",u)}this.ensureStreaming(g),this.startFallbackPolling(g);let P=this;return this.fetchTickerFn&&this.fetchTickerFn(g.params).then(function(u){P.applyTickerStateFromFetch(g,u),P.cache[g.key]=u,P.notifySubscribers(g,u)}).catch(function(u){if(P.logger("TickerSubscriptionManager: fetchTicker error",u),C.onError)try{C.onError(u)}catch(h){P.logger("TickerSubscriptionManager: onError handler threw",h)}}),{key:g.key,unsubscribe:()=>{this.unsubscribe(g.key,C)}}}unsubscribe(f,p){let C=this.entries[f];if(!C)return;let g=C.subscribers.indexOf(p);g>=0&&C.subscribers.splice(g,1),C.subscribers.length===0&&(this.stopFallbackPolling(C),this.stopStreaming(C),delete this.entries[f])}getCachedTicker(f){return this.cache[f]||null}handleStreamingUpdate(f,p){let C=this.entries[f];C&&(C.lastStreamUpdate=Date.now(),this.setEntryConnectionState(C,this.connectionStates.LIVE,p),this.cache[f]=p,this.notifySubscribers(C,p))}getEntry(f){return this.entries[f]||null}handleStreamingUpdateFromParts(f,p,C,g,P){let u=this.buildKey(f,p,C,g);this.handleStreamingUpdate(u,P)}buildKey(f,p,C,g){return this.subscriptionKeyBuilder(f,p,C,g)}buildKeyFromParams(f){let p=f||{};return this.buildKey(p.exchange,p.symbol,p.fromCurrency,p.toCurrency)}forEachEntry(f){if(typeof f!="function")return;let p=Object.keys(this.entries);for(let C=0;C<p.length;C++){let g=p[C];f(this.entries[g])}}ensureStreaming(f){if(!f||f.streamingActive||!this.subscribeStreamingFn){f&&!f.streamingActive&&(f.streamingActive=!!this.subscribeStreamingFn);return}try{let p=this.subscribeStreamingFn(f);p&&typeof p.then=="function"?p.then(()=>{f.streamingActive=!0}).catch(C=>{f.streamingActive=!1,this.logger("TickerSubscriptionManager: subscribeStreaming promise rejected",C)}):p===!1?f.streamingActive=!1:f.streamingActive=!0}catch(p){f.streamingActive=!1,this.logger("TickerSubscriptionManager: subscribeStreaming error",p)}}stopStreaming(f){if(!(!f||!this.unsubscribeStreamingFn||!f.streamingActive))try{let p=this.unsubscribeStreamingFn(f);p&&typeof p.then=="function"?p.then(()=>{f.streamingActive=!1}).catch(C=>{this.logger("TickerSubscriptionManager: unsubscribeStreaming promise rejected",C)}):f.streamingActive=!1}catch(p){f.streamingActive=!1,this.logger("TickerSubscriptionManager: unsubscribeStreaming error",p)}}notifySubscribers(f,p){if(!f)return;let C=f.subscribers;for(let g=0;g<C.length;g++){let P=C[g];if(P&&P.onData)try{P.onData(p)}catch(u){this.logger("TickerSubscriptionManager: onData handler threw",u)}}}startFallbackPolling(f){if(!f||f.fallbackTimerId||!this.fetchTickerFn)return;let p=this;f.fallbackTimerId=setInterval(function(){p.pollEntryIfNeeded(f)},this.fallbackPollIntervalMs)}stopFallbackPolling(f){!f||!f.fallbackTimerId||(clearInterval(f.fallbackTimerId),f.fallbackTimerId=null)}pollEntryIfNeeded(f){if(!f||!this.fetchTickerFn||!this.shouldPollEntry(f))return;let p=this;this.fetchTickerFn(f.params).then(function(C){p.applyTickerStateFromFetch(f,C),p.cache[f.key]=C,p.notifySubscribers(f,C)}).catch(function(C){p.logger("TickerSubscriptionManager: fallback fetch error",C),p.handleFetchError(f)})}shouldPollEntry(f){if(!f)return!1;if(!f.streamingActive)return!0;let p=f.lastStreamUpdate||0;return p?Date.now()-p>this.staleTickerTimeoutMs:!0}getOrCreateEntry(f){let p=this.buildKeyFromParams(f),C=this.entries[p];return C||(C={key:p,params:x(f),subscribers:[],streamingActive:!1,lastStreamUpdate:0,fallbackTimerId:null,meta:{},connectionState:null},this.entries[p]=C),C}setEntryConnectionState(f,p,C){f&&(f.connectionState=p,C&&typeof C=="object"&&(C.connectionState=p))}applyTickerStateFromFetch(f,p){if(!f||!p)return;let C=p.connectionState||(f.streamingActive?this.connectionStates.LIVE:this.connectionStates.DETACHED);this.setEntryConnectionState(f,C,p)}handleFetchError(f){if(!f)return;this.setEntryConnectionState(f,this.connectionStates.BROKEN);let p=f.key,C=this.cache[p];if(C){C.connectionState=this.connectionStates.BROKEN,this.notifySubscribers(f,C);return}let g={changeDaily:0,changeDailyPercent:0,last:0,volume:0,high:0,low:0,pair:f.params.symbol,pairDisplay:f.params.symbol,connectionState:this.connectionStates.BROKEN};this.cache[p]=g,this.notifySubscribers(f,g)}}return{TickerSubscriptionManager:m}})});var Ze=he((bn,Qe)=>{"use strict";(function(n,t){let a=typeof globalThis!="undefined"?globalThis:n,l=typeof Qe=="object"&&Qe.exports?[Ye(),yt(),Xe(),Ke()]:[n==null?void 0:n.CryptoTickerProviders,n==null?void 0:n.CryptoTickerProviders,n==null?void 0:n.CryptoTickerProviders,n==null?void 0:n.CryptoTickerConnectionStates],c=t(l[0],l[1],l[2],l[3]);typeof Qe=="object"&&Qe.exports&&(Qe.exports=c),a&&(a.CryptoTickerProviders=a.CryptoTickerProviders||{},a.CryptoTickerProviders.GenericProvider=c.GenericProvider)})(typeof self!="undefined"?self:bn,function(n,t,a,l){let c=n.ProviderInterface||n,i=t.buildSubscriptionKey||t,d=a.TickerSubscriptionManager||a,k=l||{LIVE:"live",DETACHED:"detached",BACKUP:"backup",BROKEN:"broken"},x="Connected",m=5e3,T="_ctBust";function f(C){if(!C||typeof C!="string")return C;try{let g=new URL(C);return g.searchParams.set(T,Date.now().toString()),g.toString()}catch{let P=C.indexOf("?")===-1?"?":"&";return C+P+T+"="+Date.now()}}class p extends c{constructor(g){super(g);let P=g||{};this.retryDelayMs=typeof P.retryDelayMs=="number"?P.retryDelayMs:m,this.connection=null,this.shouldReconnect=!0,this.connectionState="Disconnected",this.startingConnection=!1,this.normalizedBaseUrl=(this.baseUrl||"").replace(/\/$/,"");let u={logger:(...h)=>{this.logger(...h)},fetchTicker:this.rawFetchTicker.bind(this),subscribeStreaming:this.subscribeEntry.bind(this),unsubscribeStreaming:this.unsubscribeEntry.bind(this),ensureConnection:this.ensureConnection.bind(this),buildSubscriptionKey:function(h,S,M,y){return i(h,S,M,y)},fallbackPollIntervalMs:P.fallbackPollIntervalMs,staleTickerTimeoutMs:P.staleTickerTimeoutMs};this.subscriptionManager=new d(u)}getId(){return"GENERIC"}subscribeTicker(g,P){return this.subscriptionManager.subscribe(g,P)}getCachedTicker(g){return this.subscriptionManager.getCachedTicker(g)}ensureConnection(){if(!(this.connection&&(this.connectionState===x||this.startingConnection))){if(typeof signalR=="undefined"||!signalR.HubConnectionBuilder){this.logger("GenericProvider: SignalR not available, skipping WebSocket connection.");return}if(!this.connection){this.connection=new signalR.HubConnectionBuilder().withUrl(this.baseUrl+"/tickerhub").withAutomaticReconnect().configureLogging(signalR.LogLevel.Warning).build();let g=this;this.connection.on("ticker",function(P){g.handleTickerMessage(P)}),this.connection.onreconnected(function(){g.logger("GenericProvider: connection re-established, resubscribing."),g.onConnectionEstablished()}),this.connection.onclose(function(){g.connectionState="Disconnected",g.shouldReconnect&&setTimeout(function(){g.startConnection()},g.retryDelayMs)})}this.startConnection()}}startConnection(){if(!this.connection||this.startingConnection||this.connectionState===x)return;let g=this;this.startingConnection=!0,this.connection.start().then(function(){g.connectionState=x,g.startingConnection=!1,g.onConnectionEstablished()}).catch(function(P){g.connectionState="Disconnected",g.startingConnection=!1,g.logger("GenericProvider: error starting connection",P),setTimeout(function(){g.startConnection()},g.retryDelayMs)})}isConnected(){return this.connection&&this.connectionState===x}onConnectionEstablished(){let g=this;this.subscriptionManager.forEachEntry(function(P){P&&(P.streamingActive=!1,P.meta&&(P.meta.isSubscribed=!1,P.meta.pending=!0),g.subscriptionManager.ensureStreaming(P))})}subscribeEntry(g){if(!g)return!1;if(g.meta=g.meta||{},!this.connection)return this.ensureConnection(),g.meta.pending=!0,g.streamingActive=!1,!1;if(!this.isConnected())return this.startConnection(),g.meta.pending=!0,g.streamingActive=!1,!1;if(g.meta.isSubscribed)return g.meta.pending=!1,!0;g.meta.pending=!0;let P=g.params,u=this;return this.connection.invoke("Subscribe",P.exchange,P.symbol,P.fromCurrency,P.toCurrency).then(function(){return g.meta.isSubscribed=!0,g.meta.pending=!1,g.streamingActive=!0,!0}).catch(function(h){return g.meta.isSubscribed=!1,g.meta.pending=!1,g.streamingActive=!1,u.logger("GenericProvider: error invoking Subscribe",h),!1})}unsubscribeEntry(g){if(!g)return!0;if(g.meta=g.meta||{},!this.connection||!g.meta.isSubscribed)return g.meta.isSubscribed=!1,g.streamingActive=!1,!0;let P=g.params,u=this;return this.connection.invoke("Unsubscribe",P.exchange,P.symbol,P.fromCurrency,P.toCurrency).then(function(){return g.meta.isSubscribed=!1,g.streamingActive=!1,!0}).catch(function(h){return g.meta.isSubscribed=!1,g.streamingActive=!1,u.logger("GenericProvider: error invoking Unsubscribe",h),!1})}fetchTicker(g){return this.rawFetchTicker(g)}rawFetchTicker(g){let P=g.exchange||"",u=g.symbol||"",h=g.fromCurrency||"USD",S=g.toCurrency||null,M=(this.baseUrl||"").replace(/\/$/,""),y=encodeURIComponent(P),O=encodeURIComponent(u),E=M+"/api/Ticker/json/"+y+"/"+O+"?fromCurrency="+encodeURIComponent(h);S!==null&&(E+="&toCurrency="+encodeURIComponent(S));let B=this,H=this.buildProxyRequestConfig(E);return fetch(H.url,H.options).then(function(N){return N.json()}).then(function(N){let Y=B.transformTickerResponse(N);return Y.connectionState=k.BACKUP,Y}).catch(function(N){B.logger("GenericProvider: error fetching ticker",N);let Y=B.subscriptionManager.buildKey(P,u,h,S),re=B.subscriptionManager.getCachedTicker(Y);if(re)return re.connectionState=re.connectionState||k.BACKUP,re;let J=B.buildEmptyTicker(u);return J.connectionState=k.BROKEN,J})}handleTickerMessage(g){if(!g)return;let P=g.provider||g.provider,u=g.symbol||g.symbol,h=g.conversionFromCurrency||g.conversionFromCurrency||null,S=g.conversionToCurrency||g.conversionToCurrency||null,M=this.subscriptionManager.buildKey(P,u,h,S),y=this.transformTickerResponse(g),O=this.subscriptionManager.getEntry(M);O&&O.meta&&(O.meta.isSubscribed=!0,O.meta.pending=!1,O.streamingActive=!0),this.subscriptionManager.handleStreamingUpdate(M,y)}async fetchCandles(g){let P=g.exchange,u=g.symbol,h=g.interval,S=typeof g.limit=="number"&&g.limit>0?g.limit:24,y=this.baseUrl.replace(/\/$/,"")+"/api/Candles/json/"+encodeURIComponent(P)+"/"+encodeURIComponent(u)+"/"+h+"?limit="+S;try{let O=this.buildProxyRequestConfig(y),E=await fetch(O.url,O.options);if(!E||!E.ok)throw new Error("GenericProvider: candles response not ok");let B=await E.json();return Array.isArray(B.candles)?B.candles:[]}catch(O){throw this.logger("GenericProvider: error fetching candles",O),O}}buildProxyRequestConfig(g,P){if(!g||typeof g!="string")return{url:g,options:P};let u=this.normalizedBaseUrl,h=g.replace(/\/$/,"");if(!u||h.indexOf(u)!==0)return{url:g,options:P};let S=Object.assign({},P||{});S.cache="no-store";let M=Object.assign({},S.headers||{});return M["cache-control"]="no-cache",M.pragma="no-cache",S.headers=M,{url:f(g),options:S}}transformTickerResponse(g){let P=g||{};return{changeDaily:P.dailyChange||0,changeDailyPercent:P.dailyChangeRelative||0,last:P.last||0,volume:P.volume||0,high:P.high24h||0,low:P.low24h||0,pair:P.symbol||P.pair||"",pairDisplay:P.symbolDisplay||P.symbol||P.pair||""}}buildEmptyTicker(g){let P=g||"";return{changeDaily:0,changeDailyPercent:0,last:0,volume:0,high:0,low:0,pair:P,pairDisplay:P,connectionState:k.BROKEN}}}return{GenericProvider:p}})});var mn=he((yn,Pt)=>{"use strict";(function(t,a){let l=a();typeof Pt=="object"&&Pt.exports&&(Pt.exports=l),t&&typeof t=="object"&&(t.CryptoTickerDefaults=l)})(typeof self!="undefined"?self:yn,function(){function t(m){if(m===null||typeof m!="object")return m;if(Array.isArray(m))return m.map(f=>t(f));let T={};for(let f in m)Object.prototype.hasOwnProperty.call(m,f)&&(T[f]=t(m[f]));return T}function a(m){let T=m==null?void 0:m.case,f=(m==null?void 0:m.allowEmptyString)===!0,p=(m==null?void 0:m.allowNull)===!0,C=Object.prototype.hasOwnProperty.call(m||{},"trim")?!!(m!=null&&m.trim):!0,g=Array.isArray(m==null?void 0:m.allowedValues)?m==null?void 0:m.allowedValues:null;return function(u){if(u===void 0)return null;if(u===null)return p?null:"";let h=String(u);if(C&&(h=h.trim()),!h&&!f)return null;if(T==="upper"?h=h.toUpperCase():T==="lower"&&(h=h.toLowerCase()),g&&g.length>0){let S=T==="lower"?h.toLowerCase():T==="upper"?h.toUpperCase():h;return g.some(y=>T==="lower"?y.toLowerCase()===S:T==="upper"?y.toUpperCase()===S:y===S)?T==="lower"||T==="upper"?S:h:null}return h}}function l(m){let T=typeof(m==null?void 0:m.min)=="number"?m.min:null,f=typeof(m==null?void 0:m.max)=="number"?m.max:null,p=(m==null?void 0:m.integer)===!0;return function(g){if(g==null||g==="")return null;let P=typeof g=="number"?g:parseFloat(String(g));return Number.isNaN(P)?null:(p&&(P=Math.round(P)),T!==null&&P<T&&(P=T),f!==null&&P>f&&(P=f),P)}}let c={title:{type:"string",default:"",normalize:a({allowEmptyString:!0,allowNull:!0,trim:!0})},exchange:{type:"string",default:"BINANCE",normalize:a({trim:!0,allowEmptyString:!1,case:"upper"})},pair:{type:"string",default:"BTCUSD",normalize:a({trim:!0,allowEmptyString:!1,case:"upper"})},fromCurrency:{type:"string",default:"USD",normalize:a({trim:!0,allowEmptyString:!1,case:"upper"})},currency:{type:"string",default:"",normalize:a({trim:!0,allowEmptyString:!0,case:"upper",allowNull:!0})},candlesInterval:{type:"string",default:"1h",normalize:a({trim:!0,allowEmptyString:!1})},candlesDisplayed:{type:"number",default:20,normalize:l({min:5,max:60,integer:!0})},multiplier:{type:"number",default:1,normalize:l({min:0})},digits:{type:"number",default:2,normalize:l({min:0,max:10,integer:!0})},highLowDigits:{type:"string",default:"",normalize:a({trim:!0,allowEmptyString:!0})},font:{type:"string",default:"Lato,'Roboto Condensed',Helvetica,Calibri,sans-serif",normalize:a({trim:!0,allowEmptyString:!1})},fontSizeBase:{type:"number",default:25,normalize:l({min:1,max:200,integer:!0})},fontSizePrice:{type:"number",default:35,normalize:l({min:1,max:200,integer:!0})},fontSizeHighLow:{type:"string",default:"",normalize:a({trim:!0,allowEmptyString:!0})},fontSizeChange:{type:"number",default:19,normalize:l({min:1,max:200,integer:!0})},priceFormat:{type:"string",default:"compact",normalize:a({trim:!0,allowEmptyString:!1,case:"lower"})},backgroundColor:{type:"string",default:"#000000",normalize:a({trim:!0,allowEmptyString:!1})},textColor:{type:"string",default:"#ffffff",normalize:a({trim:!0,allowEmptyString:!1})},displayHighLow:{type:"string",default:"on",normalize:a({trim:!0,allowEmptyString:!1,case:"lower",allowedValues:["on","off"]})},displayHighLowBar:{type:"string",default:"on",normalize:a({trim:!0,allowEmptyString:!1,case:"lower",allowedValues:["on","off"]})},displayDailyChange:{type:"string",default:"on",normalize:a({trim:!0,allowEmptyString:!1,case:"lower",allowedValues:["on","off"]})},displayConnectionStatusIcon:{type:"string",default:"OFF",normalize:a({trim:!0,allowEmptyString:!1,case:"upper",allowedValues:["OFF","TOP_RIGHT","BOTTOM_LEFT"]})},alertRule:{type:"string",default:"",normalize:a({trim:!0,allowEmptyString:!0})},backgroundColorRule:{type:"string",default:"",normalize:a({trim:!0,allowEmptyString:!0})},textColorRule:{type:"string",default:"",normalize:a({trim:!0,allowEmptyString:!0})},mode:{type:"string",default:"ticker",normalize:a({trim:!0,allowEmptyString:!1,case:"lower",allowedValues:["ticker","candles"]})}};function i(m,T,f){if(!m||typeof m!="object")return{value:T,error:null};let p=m.normalize,C=m.default;if(typeof p!="function")return{value:T===void 0?t(C):T,error:null};let g=p(T);if(g==null){let P=p(C);return{value:P==null?t(C):P,error:f?"Invalid "+m.type:null}}return{value:g,error:null}}function d(m){let T=m&&typeof m=="object"?m:{},f={},p=[];for(let C in c){if(!Object.prototype.hasOwnProperty.call(c,C))continue;let g=c[C],P=Object.prototype.hasOwnProperty.call(T,C),u=P?T[C]:void 0,h=i(g,u,P);f[C]=h.value,h.error&&p.push({key:C,message:h.error})}for(let C in T)!Object.prototype.hasOwnProperty.call(c,C)&&Object.prototype.hasOwnProperty.call(T,C)&&(f[C]=T[C]);return{settings:f,errors:p}}function k(m){return d(m).settings}let x=k(null);return{settingsSchema:c,defaultSettings:x,getDefaultSettings:function(){return t(x)},validateSettings:function(m){let T=d(m);return{settings:T.settings,errors:T.errors.slice(0)}},applyDefaults:k}})});var Mt=he((vn,Rt)=>{"use strict";(function(n,t){let a=typeof globalThis!="undefined"?globalThis:n,l=t();typeof Rt=="object"&&Rt.exports&&(Rt.exports=l),a&&(a.CryptoTickerProviders=a.CryptoTickerProviders||{},a.CryptoTickerProviders.WebSocketConnectionPool=l.WebSocketConnectionPool)})(typeof self!="undefined"?self:vn,function(){function n(){}function t(l,c){if(!c||typeof c!="object")return l;let i=Object.keys(c);for(let d=0;d<i.length;d++){let k=i[d];l[k]=c[k]}return l}class a{constructor(c){let i=c||{};this.logger=typeof i.logger=="function"?i.logger:n,this.createWebSocket=typeof i.createWebSocket=="function"?i.createWebSocket:null,this.subscribeHandler=typeof i.subscribe=="function"?i.subscribe:null,this.unsubscribeHandler=typeof i.unsubscribe=="function"?i.unsubscribe:null,this.handleMessageFn=typeof i.handleMessage=="function"?i.handleMessage:null,this.onOpen=typeof i.onOpen=="function"?i.onOpen:null,this.onError=typeof i.onError=="function"?i.onError:null,this.onClose=typeof i.onClose=="function"?i.onClose:null,this.reconnectDelayMs=typeof i.reconnectDelayMs=="number"?i.reconnectDelayMs:5e3,this.autoCloseDelayMs=typeof i.autoCloseDelayMs=="number"?i.autoCloseDelayMs:0,this.shouldResubscribeOnReconnect=i.shouldResubscribeOnReconnect!==!1,this.symbolEntries={},this.ws=null,this.wsClosedByUser=!1,this.reconnectTimer=null,this.closeTimer=null,this.isConnecting=!1}subscribe(c,i){let d=typeof c=="string"?c:"";if(!d)return this.logger("WebSocketConnectionPool: subscribe called without symbol"),null;if(!this.createWebSocket)return this.logger("WebSocketConnectionPool: createWebSocket not configured"),null;let k=this.buildSubscriber(i);if(!k.onData)return this.logger("WebSocketConnectionPool: subscriber missing onData handler for",d),null;let x=this.symbolEntries[d];x||(x={symbol:d,subscribers:[],subscribed:!1,subscriptionRequested:!1,meta:{}},this.symbolEntries[d]=x),x.subscribers.push(k),this.clearCloseTimer(),this.ensureConnection(),this.isSocketOpen()&&!x.subscribed&&!x.subscriptionRequested&&this.requestSubscribe(x);let m=this;return{symbol:d,unsubscribe:function(){m.removeSubscriber(d,k)},updateMetadata:function(T){m.updateSymbolMetadata(d,T)},getMetadata:function(){let T=m.symbolEntries[d];return T?T.meta:null}}}removeSubscriber(c,i){let d=this.symbolEntries[c];if(!d)return;let k=d.subscribers.indexOf(i);if(k>=0&&d.subscribers.splice(k,1),!(d.subscribers.length>0)){if(this.isSocketOpen()&&this.unsubscribeHandler&&(d.subscribed||d.subscriptionRequested))try{this.unsubscribeHandler(this.ws,c,d.meta)}catch(x){this.logger("WebSocketConnectionPool: unsubscribe handler error",x)}delete this.symbolEntries[c],this.maybeCloseConnection()}}ensureConnection(){if(this.ws||this.isConnecting)return;let c=null;try{c=this.createWebSocket()}catch(i){this.logger("WebSocketConnectionPool: failed to create WebSocket",i);return}if(!c){this.logger("WebSocketConnectionPool: createWebSocket returned falsy value"),this.scheduleReconnect();return}this.ws=c,this.wsClosedByUser=!1,this.isConnecting=!0,this.attachSocketHandlers(c)}attachSocketHandlers(c){let i=this;c.onopen=function(){if(i.isConnecting=!1,i.onOpen)try{i.onOpen(i.ws)}catch(d){i.logger("WebSocketConnectionPool: onOpen handler error",d)}i.flushPendingSubscriptions()},c.onmessage=function(d){if(i.handleMessageFn)try{i.handleMessageFn(d,i.buildMessageHelpers())}catch(k){i.logger("WebSocketConnectionPool: handleMessage error",k)}},c.onerror=function(d){if(i.onError)try{i.onError(d)}catch(k){i.logger("WebSocketConnectionPool: onError handler error",k)}},c.onclose=function(d){i.handleSocketClose(d)}}handleSocketClose(c){if(this.onClose)try{this.onClose(c)}catch(d){this.logger("WebSocketConnectionPool: onClose handler error",d)}let i=this.hasSubscribers();if(this.isConnecting=!1,this.ws=null,!this.wsClosedByUser&&i){this.resetSubscriptionState(),this.notifyAllDisconnected(),this.scheduleReconnect();return}this.wsClosedByUser=!1,this.resetSubscriptionState()}resetSubscriptionState(){let c=Object.keys(this.symbolEntries);for(let i=0;i<c.length;i++){let d=this.symbolEntries[c[i]];d.subscribed=!1,d.subscriptionRequested=!1}}scheduleReconnect(){if(this.reconnectTimer||!this.hasSubscribers())return;let c=this;this.reconnectTimer=setTimeout(function(){c.reconnectTimer=null,c.hasSubscribers()&&c.ensureConnection()},this.reconnectDelayMs)}clearReconnectTimer(){this.reconnectTimer&&(clearTimeout(this.reconnectTimer),this.reconnectTimer=null)}flushPendingSubscriptions(){let c=Object.keys(this.symbolEntries);for(let i=0;i<c.length;i++){let d=this.symbolEntries[c[i]];!d.subscribed&&!d.subscriptionRequested&&this.requestSubscribe(d)}}requestSubscribe(c){if(!(!c||!this.isSocketOpen())){if(!this.subscribeHandler){c.subscribed=!0,this.notifySubscribed(c.symbol,null);return}try{c.subscriptionRequested=!0,this.subscribeHandler(this.ws,c.symbol,c.meta)}catch(i){c.subscriptionRequested=!1,this.logger("WebSocketConnectionPool: subscribe handler error",i),this.notifySubscribeError(c.symbol,i)}}}notifySubscribed(c,i){let d=this.symbolEntries[c];if(!d)return;if(d.subscribed){i&&t(d.meta,i);return}d.subscribed=!0,d.subscriptionRequested=!1,i&&t(d.meta,i);let k=d.subscribers;for(let x=0;x<k.length;x++){let m=k[x];if(m.onSubscribed)try{m.onSubscribed(m.context)}catch(T){this.logger("WebSocketConnectionPool: onSubscribed handler error",T)}}}notifySubscribeError(c,i){let d=this.symbolEntries[c];if(!d)return;let k=d.subscribers;for(let x=0;x<k.length;x++){let m=k[x];if(m.onError)try{m.onError(i,m.context)}catch(T){this.logger("WebSocketConnectionPool: onError handler error",T)}}}notifyAllDisconnected(){let c=Object.keys(this.symbolEntries);for(let i=0;i<c.length;i++)this.notifyDisconnected(c[i])}notifyDisconnected(c){let i=this.symbolEntries[c];if(!i)return;let d=i.subscribers;for(let k=0;k<d.length;k++){let x=d[k];if(x.onDisconnected)try{x.onDisconnected(x.context)}catch(m){this.logger("WebSocketConnectionPool: onDisconnected handler error",m)}}}dispatch(c,i,d){let k=this.symbolEntries[c];if(!k)return;let x=k.subscribers;for(let m=0;m<x.length;m++){let T=x[m];if(T.onData)try{T.onData(i,d,T.context)}catch(f){this.logger("WebSocketConnectionPool: subscriber onData error",f)}}}dispatchToAll(c,i){let d=Object.keys(this.symbolEntries);for(let k=0;k<d.length;k++)this.dispatch(d[k],c,i)}markSymbolSubscribed(c,i){this.notifySubscribed(c,i)}markSymbolUnsubscribed(c){let i=this.symbolEntries[c];i&&(i.subscribed=!1,i.subscriptionRequested=!1)}updateSymbolMetadata(c,i){let d=this.symbolEntries[c];d&&t(d.meta,i)}getSymbolMetadata(c){let i=this.symbolEntries[c];return i?i.meta:null}findSymbolByMeta(c){if(typeof c!="function")return null;let i=Object.keys(this.symbolEntries);for(let d=0;d<i.length;d++){let k=this.symbolEntries[i[d]];if(c(k.meta,k.symbol))return k.symbol}return null}hasSubscribers(){let c=Object.keys(this.symbolEntries);for(let i=0;i<c.length;i++)if(this.symbolEntries[c[i]].subscribers.length>0)return!0;return!1}maybeCloseConnection(){this.hasSubscribers()||(this.autoCloseDelayMs>0?this.scheduleCloseTimer():this.closeConnection())}scheduleCloseTimer(){if(this.closeTimer)return;let c=this;this.closeTimer=setTimeout(function(){c.closeTimer=null,c.hasSubscribers()||c.closeConnection()},this.autoCloseDelayMs)}clearCloseTimer(){this.closeTimer&&(clearTimeout(this.closeTimer),this.closeTimer=null)}closeConnection(){if(this.clearReconnectTimer(),!!this.ws){this.wsClosedByUser=!0;try{this.ws.close()}catch(c){this.logger("WebSocketConnectionPool: error closing WebSocket",c)}this.ws=null}}buildSubscriber(c){let i=c||{};return{context:i.context||null,onData:typeof i.onData=="function"?i.onData:null,onError:typeof i.onError=="function"?i.onError:null,onSubscribed:typeof i.onSubscribed=="function"?i.onSubscribed:null,onDisconnected:typeof i.onDisconnected=="function"?i.onDisconnected:null}}buildMessageHelpers(){let c=this;return{dispatch:function(i,d,k){c.dispatch(i,d,k)},dispatchToAll:function(i,d){c.dispatchToAll(i,d)},markSubscribed:function(i,d){c.markSymbolSubscribed(i,d)},markUnsubscribed:function(i){c.markSymbolUnsubscribed(i)},updateMetadata:function(i,d){c.updateSymbolMetadata(i,d)},getMetadata:function(i){return c.getSymbolMetadata(i)},findSymbol:function(i){return c.findSymbolByMeta(i)},getActiveSymbols:function(){return Object.keys(c.symbolEntries)}}}isSocketOpen(){return this.ws&&this.ws.readyState===1}}return{WebSocketConnectionPool:a}})});var Ht=he((Cn,et)=>{"use strict";(function(n,t){let a=typeof globalThis!="undefined"?globalThis:n,l=typeof et=="object"&&et.exports?[Ye(),Ze(),Xe(),Ke(),Mt()]:[n==null?void 0:n.CryptoTickerProviders,n==null?void 0:n.CryptoTickerProviders,n==null?void 0:n.CryptoTickerProviders,n==null?void 0:n.CryptoTickerConnectionStates,n==null?void 0:n.CryptoTickerProviders],c=t(l[0],l[1],l[2],l[3],l[4]);typeof et=="object"&&et.exports&&(et.exports=c),a&&(a.CryptoTickerProviders=a.CryptoTickerProviders||{},a.CryptoTickerProviders.BinanceProvider=c.BinanceProvider)})(typeof self!="undefined"?self:Cn,function(n,t,a,l,c){let i=n.ProviderInterface||n,d=t.GenericProvider||t,k=a.TickerSubscriptionManager||a,x=l||{LIVE:"live",DETACHED:"detached",BACKUP:"backup",BROKEN:"broken"},m=c.WebSocketConnectionPool||c,T=5e3;function f(){return typeof WebSocket!="undefined"?WebSocket:typeof window!="undefined"&&window.WebSocket?window.WebSocket:typeof global!="undefined"&&global.WebSocket?global.WebSocket:null}function p(u){let h=parseFloat(u);return isNaN(h)?0:h}function C(u){return p(u)/100}function g(u){switch(u){case"MINUTES_1":return"1m";case"MINUTES_5":return"5m";case"MINUTES_15":return"15m";case"HOURS_1":return"1h";case"HOURS_6":return"6h";case"HOURS_12":return"12h";case"DAYS_1":return"1d";case"DAYS_7":return"1w";case"MONTHS_1":return"1M"}return null}class P extends i{constructor(h){super(h);let S=h||{};this.genericFallback=S.genericFallback instanceof d?S.genericFallback:new d(h),this.restBaseUrl=typeof S.binanceRestBaseUrl=="string"&&S.binanceRestBaseUrl.length>0?S.binanceRestBaseUrl:"https://api.binance.com",this.wsBaseUrl=typeof S.binanceWsBaseUrl=="string"&&S.binanceWsBaseUrl.length>0?S.binanceWsBaseUrl:"wss://stream.binance.com:9443/ws",this.symbolOverrides=S.binanceSymbolOverrides||{},this.wsReconnectDelayMs=typeof S.retryDelayMs=="number"?S.retryDelayMs:T;let M={logger:(...y)=>{this.logger(...y)},fetchTicker:this.fetchTickerDirect.bind(this),subscribeStreaming:this.subscribeStream.bind(this),unsubscribeStreaming:this.unsubscribeStream.bind(this),fallbackPollIntervalMs:S.fallbackPollIntervalMs,staleTickerTimeoutMs:S.staleTickerTimeoutMs};this.subscriptionManager=new k(M),this.wsRequestId=0,this.webSocketPool=new m({logger:(...y)=>{this.logger(...y)},reconnectDelayMs:this.wsReconnectDelayMs,createWebSocket:()=>{let y=f();if(!y)return this.logger("BinanceProvider: WebSocket not available in this environment"),null;let O=this.wsBaseUrl.replace(/\/$/,"");try{return new y(O)}catch(E){return this.logger("BinanceProvider: error creating pooled WebSocket",E),null}},subscribe:(y,O)=>{this.sendBinanceSubscription(y,O,!0)},unsubscribe:(y,O)=>{this.sendBinanceSubscription(y,O,!1)},handleMessage:(y,O)=>{this.handlePoolMessage(y,O)},onError:y=>{this.logger("BinanceProvider: pooled WebSocket error",y)},onClose:()=>{this.wsRequestId=0}})}getId(){return"BINANCE"}subscribeTicker(h,S){return this.subscriptionManager.subscribe(h,S)}getCachedTicker(h){let S=this.subscriptionManager.getCachedTicker(h);return S||(this.genericFallback&&typeof this.genericFallback.getCachedTicker=="function"?this.genericFallback.getCachedTicker(h):null)}ensureConnection(){let h=this;this.subscriptionManager.forEachEntry(function(S){h.subscriptionManager.ensureStreaming(S)})}async fetchTicker(h){try{return await this.fetchTickerDirect(h)}catch(S){if(this.logger("BinanceProvider: direct fetch failed, using fallback",S),this.genericFallback&&typeof this.genericFallback.fetchTicker=="function")return this.genericFallback.fetchTicker(h);throw S}}async fetchTickerDirect(h){let S=this.resolveSymbol(h);if(!S)throw new Error("BinanceProvider: unable to resolve symbol for "+(h.symbol||""));let M=this.buildRestUrl(S);try{let y=await fetch(M);if(!y||!y.ok)throw new Error("BinanceProvider: REST response not ok for "+S);let O=await y.json(),E=this.transformRestTicker(O,h,S);return E.connectionState=x.DETACHED,E}catch(y){if(this.logger("BinanceProvider: REST fetch error",y),this.genericFallback&&typeof this.genericFallback.fetchTicker=="function"){let O=await this.genericFallback.fetchTicker(h);return O&&typeof O=="object"&&!O.connectionState&&(O.connectionState=x.BACKUP),O}throw y}}subscribeStream(h){if(!h)return!1;let S=this.ensureEntryMeta(h);if(S.binanceSymbol=this.resolveSymbol(h.params),!S.binanceSymbol)return this.logger("BinanceProvider: cannot subscribe, unresolved symbol",h.params),!1;let M=this.webSocketPool.subscribe(S.binanceSymbol,{context:h,onData:y=>{let O=this.transformStreamTicker(y,h,S.binanceSymbol);this.subscriptionManager.handleStreamingUpdate(h.key,O)},onSubscribed:()=>{h.streamingActive=!0},onDisconnected:()=>{h.streamingActive=!1},onError:y=>{this.logger("BinanceProvider: subscription error",y)}});return M?(S.poolSubscription=M,h.streamingActive=!0,!0):(h.streamingActive=!1,!1)}unsubscribeStream(h){if(!h)return!0;let S=this.ensureEntryMeta(h);return S.poolSubscription&&typeof S.poolSubscription.unsubscribe=="function"&&S.poolSubscription.unsubscribe(),S.poolSubscription=null,h.streamingActive=!1,!0}resolveSymbol(h){if(!h)return null;let S=(h.symbol||"").toUpperCase();return S?this.symbolOverrides&&this.symbolOverrides[S]?(this.symbolOverrides[S]||"").toUpperCase():S.endsWith("USD")?S.slice(0,-3)+"USDT":S:null}buildRestUrl(h){return this.restBaseUrl.replace(/\/$/,"")+"/api/v3/ticker/24hr?symbol="+encodeURIComponent(h)}sendBinanceSubscription(h,S,M){if(!h||!S)return;let y=S.toLowerCase()+"@ticker",O={method:M?"SUBSCRIBE":"UNSUBSCRIBE",params:[y],id:this.nextWsRequestId()};try{h.send(JSON.stringify(O))}catch(E){this.logger("BinanceProvider: error sending subscription message",E)}}nextWsRequestId(){return this.wsRequestId+=1,this.wsRequestId>1e6&&(this.wsRequestId=1),this.wsRequestId}handlePoolMessage(h,S){if(!h)return;let M=h.data;if(!M)return;if(typeof M=="string")try{M=JSON.parse(M)}catch(E){this.logger("BinanceProvider: failed to parse WebSocket message",E);return}if(!M||Array.isArray(M))return;if(M.error){this.logger("BinanceProvider: WebSocket error message",M.error);return}if(typeof M.result!="undefined")return;let y=M;if(M.data&&typeof M.data=="object"&&(y=M.data),!y||typeof y!="object")return;let O=(y.s||y.symbol||"").toUpperCase();O&&(S.markSubscribed(O),S.dispatch(O,y,M))}transformRestTicker(h,S,M){let y=S&&S.symbol?S.symbol:M;return{changeDaily:p(h.priceChange),changeDailyPercent:C(h.priceChangePercent),last:p(h.lastPrice),volume:p(h.volume),high:p(h.highPrice),low:p(h.lowPrice),pair:y,pairDisplay:y}}transformStreamTicker(h,S,M){let y=S?S.params:null,O=y&&y.symbol?y.symbol:M;return{changeDaily:p(h.p||h.priceChange),changeDailyPercent:C(h.P||h.priceChangePercent),last:p(h.c||h.lastPrice),volume:p(h.v||h.volume),high:p(h.h||h.highPrice),low:p(h.l||h.lowPrice),pair:O,pairDisplay:O}}ensureEntryMeta(h){return h.meta=h.meta||{},h.meta}async fetchCandles(h){let S=this.resolveSymbol(h);if(!S)throw new Error("BinanceProvider: unable to resolve symbol for candles");let M=g(h.interval);if(!M)throw new Error("BinanceProvider: unsupported interval "+h.interval);let y=Math.min(Math.max(parseInt(h.limit,10)||24,1),1e3),E=this.restBaseUrl.replace(/\/$/,"")+"/api/v3/klines?symbol="+encodeURIComponent(S)+"&interval="+encodeURIComponent(M)+"&limit="+y;try{let B=await fetch(E);if(!B||!B.ok)throw new Error("BinanceProvider: candles response not ok");let H=await B.json();if(!Array.isArray(H))throw new Error("BinanceProvider: unexpected candles payload");return H.map(function(N){return{ts:Math.floor((N[0]||0)/1e3),open:p(N[1]),high:p(N[2]),low:p(N[3]),close:p(N[4]),volume:p(N[5]),volumeQuote:p(N[7])}})}catch(B){if(this.logger("BinanceProvider: error fetching candles",B),this.genericFallback&&typeof this.genericFallback.fetchCandles=="function")return this.genericFallback.fetchCandles(h);throw B}}}return{BinanceProvider:P}})});var qt=he((wn,tt)=>{"use strict";(function(n,t){let a=typeof globalThis!="undefined"?globalThis:n,l=typeof tt=="object"&&tt.exports?[Ye(),Ze(),Xe(),Ke(),Mt()]:[n==null?void 0:n.CryptoTickerProviders,n==null?void 0:n.CryptoTickerProviders,n==null?void 0:n.CryptoTickerProviders,n==null?void 0:n.CryptoTickerConnectionStates,n==null?void 0:n.CryptoTickerProviders],c=t(l[0],l[1],l[2],l[3],l[4]);typeof tt=="object"&&tt.exports&&(tt.exports=c),a&&(a.CryptoTickerProviders=a.CryptoTickerProviders||{},a.CryptoTickerProviders.BitfinexProvider=c.BitfinexProvider)})(typeof self!="undefined"?self:wn,function(n,t,a,l,c){let i=n.ProviderInterface||n,d=t.GenericProvider||t,k=a.TickerSubscriptionManager||a,x=l||{LIVE:"live",DETACHED:"detached",BACKUP:"backup",BROKEN:"broken"},m=c.WebSocketConnectionPool||c,T=5e3;function f(){return typeof WebSocket!="undefined"?WebSocket:typeof window!="undefined"&&window.WebSocket?window.WebSocket:typeof global!="undefined"&&global.WebSocket?global.WebSocket:null}function p(P){let u=parseFloat(P);return isNaN(u)?0:u}function C(P){switch(P){case"MINUTES_1":return"1m";case"MINUTES_5":return"5m";case"MINUTES_15":return"15m";case"HOURS_1":return"1h";case"HOURS_6":return"6h";case"HOURS_12":return"12h";case"DAYS_1":return"1D";case"DAYS_7":return"1W";case"MONTHS_1":return"1M"}return null}class g extends i{constructor(u){super(u);let h=u||{};this.genericFallback=h.genericFallback instanceof d?h.genericFallback:new d(u),this.restBaseUrl=typeof h.bitfinexRestBaseUrl=="string"&&h.bitfinexRestBaseUrl.length>0?h.bitfinexRestBaseUrl:"https://api-pub.bitfinex.com",this.wsBaseUrl=typeof h.bitfinexWsBaseUrl=="string"&&h.bitfinexWsBaseUrl.length>0?h.bitfinexWsBaseUrl:"wss://api-pub.bitfinex.com/ws/2",this.symbolOverrides=h.bitfinexSymbolOverrides||{},this.wsReconnectDelayMs=typeof h.retryDelayMs=="number"?h.retryDelayMs:T;let S={logger:(...M)=>{this.logger(...M)},fetchTicker:this.fetchTickerDirect.bind(this),subscribeStreaming:this.subscribeStream.bind(this),unsubscribeStreaming:this.unsubscribeStream.bind(this),fallbackPollIntervalMs:h.fallbackPollIntervalMs,staleTickerTimeoutMs:h.staleTickerTimeoutMs};this.subscriptionManager=new k(S),this.channelIdToSymbol={},this.webSocketPool=new m({logger:(...M)=>{this.logger(...M)},reconnectDelayMs:this.wsReconnectDelayMs,createWebSocket:()=>{let M=f();if(!M)return this.logger("BitfinexProvider: WebSocket not available in this environment"),null;let y=this.wsBaseUrl.replace(/\/$/,"");try{return new M(y)}catch(O){return this.logger("BitfinexProvider: error creating pooled WebSocket",O),null}},subscribe:(M,y)=>{this.sendBitfinexSubscribe(M,y)},unsubscribe:(M,y,O)=>{this.sendBitfinexUnsubscribe(M,y,O)},handleMessage:(M,y)=>{this.handlePoolMessage(M,y)},onError:M=>{this.logger("BitfinexProvider: pooled WebSocket error",M)},onClose:()=>{this.channelIdToSymbol={}}})}getId(){return"BITFINEX"}subscribeTicker(u,h){return this.subscriptionManager.subscribe(u,h)}getCachedTicker(u){let h=this.subscriptionManager.getCachedTicker(u);return h||(this.genericFallback&&typeof this.genericFallback.getCachedTicker=="function"?this.genericFallback.getCachedTicker(u):null)}ensureConnection(){let u=this;this.subscriptionManager.forEachEntry(function(h){u.subscriptionManager.ensureStreaming(h)})}async fetchTicker(u){try{return await this.fetchTickerDirect(u)}catch(h){if(this.logger("BitfinexProvider: direct fetch failed, using fallback",h),this.genericFallback&&typeof this.genericFallback.fetchTicker=="function")return this.genericFallback.fetchTicker(u);throw h}}async fetchTickerDirect(u){let h=this.resolveSymbol(u);if(!h)throw new Error("BitfinexProvider: unable to resolve symbol for "+(u.symbol||""));let S=this.buildRestUrl(h);try{let M=await fetch(S);if(!M||!M.ok)throw new Error("BitfinexProvider: REST response not ok for "+h);let y=await M.json(),O=this.transformRestTicker(y,u,h);return O.connectionState=x.DETACHED,O}catch(M){if(this.logger("BitfinexProvider: REST fetch error",M),this.genericFallback&&typeof this.genericFallback.fetchTicker=="function"){let y=await this.genericFallback.fetchTicker(u);return y&&typeof y=="object"&&!y.connectionState&&(y.connectionState=x.BACKUP),y}throw M}}subscribeStream(u){if(!u)return!1;let h=this.ensureEntryMeta(u);if(h.bitfinexSymbol=this.resolveSymbol(u.params),!h.bitfinexSymbol)return this.logger("BitfinexProvider: cannot subscribe, unresolved symbol",u.params),!1;h.chanId=null;let S=this.webSocketPool.subscribe(h.bitfinexSymbol,{context:u,onData:M=>{let y=this.buildTickerFromArray(M,u);y&&this.subscriptionManager.handleStreamingUpdate(u.key,y)},onSubscribed:()=>{u.streamingActive=!0;let M=S.getMetadata?S.getMetadata():null;M&&M.chanId&&(h.chanId=M.chanId,this.channelIdToSymbol[h.chanId]=h.bitfinexSymbol)},onDisconnected:()=>{u.streamingActive=!1,h.chanId=null},onError:M=>{this.logger("BitfinexProvider: subscription error",M)}});return S?(h.poolSubscription=S,u.streamingActive=!0,!0):(u.streamingActive=!1,!1)}unsubscribeStream(u){if(!u)return!0;let h=this.ensureEntryMeta(u);return h.poolSubscription&&typeof h.poolSubscription.unsubscribe=="function"&&h.poolSubscription.unsubscribe(),h.poolSubscription=null,h.chanId=null,u.streamingActive=!1,!0}resolveSymbol(u){if(!u)return null;let h=(u.symbol||"").toUpperCase();if(!h)return null;if(this.symbolOverrides&&this.symbolOverrides[h])return(this.symbolOverrides[h]||"").toUpperCase();let S=h.replace(/[:/]/g,"");if(!S)return null;let M=S.toUpperCase();return"t"+(M.startsWith("T")?M.substring(1):M)}buildRestUrl(u){return this.restBaseUrl.replace(/\/$/,"")+"/v2/ticker/"+encodeURIComponent(u)}sendBitfinexSubscribe(u,h){if(!u||!h)return;let S={event:"subscribe",channel:"ticker",symbol:h};try{u.send(JSON.stringify(S))}catch(M){this.logger("BitfinexProvider: error sending subscribe",M)}}sendBitfinexUnsubscribe(u,h,S){if(!u)return;let M=S&&S.chanId;if(M)try{u.send(JSON.stringify({event:"unsubscribe",chanId:M}))}catch(y){this.logger("BitfinexProvider: error sending unsubscribe",y)}}handlePoolMessage(u,h){if(!u)return;let S=u.data;if(S){if(typeof S=="string")try{S=JSON.parse(S)}catch(M){this.logger("BitfinexProvider: failed to parse WebSocket message",M);return}if(S){if(Array.isArray(S)){this.handleBitfinexDataArray(S,h);return}S&&typeof S=="object"&&this.handleBitfinexEvent(S,h)}}}handleBitfinexEvent(u,h){if(!u||typeof u!="object")return;let S=u.event;if(S==="subscribed"&&u.channel==="ticker"){let M=typeof u.symbol=="string"?u.symbol:"";if(!M)return;let y=u.chanId;y&&(this.channelIdToSymbol[y]=M),h.markSubscribed(M,{chanId:y||null});return}if(S==="unsubscribed"){let M=u.chanId,y=null;M&&(y=this.channelIdToSymbol[M]||h.findSymbol(function(O){return O&&O.chanId===M}),delete this.channelIdToSymbol[M]),y&&(h.markUnsubscribed(y),h.updateMetadata(y,{chanId:null}));return}S==="error"&&this.logger("BitfinexProvider: subscription error",u)}handleBitfinexDataArray(u,h){if(!Array.isArray(u)||u.length<2)return;let S=u[0],M=u[1];if(M==="hb"||!Array.isArray(M))return;let y=this.channelIdToSymbol[S]||h.findSymbol(function(O){return O&&O.chanId===S});y&&h.dispatch(y,M,u)}buildTickerFromArray(u,h){if(!Array.isArray(u))return null;let S=h?h.params:null,M=S&&S.symbol?S.symbol:this.ensureEntryMeta(h).bitfinexSymbol;return{changeDaily:p(u[4]),changeDailyPercent:p(u[5]),last:p(u[6]),volume:p(u[7]),high:p(u[8]),low:p(u[9]),pair:M,pairDisplay:M}}transformRestTicker(u,h,S){if(!Array.isArray(u))throw new Error("BitfinexProvider: unexpected REST payload for "+S);let M=h&&h.symbol?h.symbol:S;return{changeDaily:p(u[4]),changeDailyPercent:p(u[5]),last:p(u[6]),volume:p(u[7]),high:p(u[8]),low:p(u[9]),pair:M,pairDisplay:M}}ensureEntryMeta(u){return u.meta=u.meta||{},u.meta}async fetchCandles(u){let h=this.resolveSymbol(u);if(!h)throw new Error("BitfinexProvider: unable to resolve symbol for candles");let S=C(u.interval);if(!S)throw new Error("BitfinexProvider: unsupported interval "+u.interval);let M=Math.min(Math.max(parseInt(u.limit,10)||24,1),1e3),O=this.restBaseUrl.replace(/\/$/,"")+"/v2/candles/trade:"+S+":"+encodeURIComponent(h)+"/hist?limit="+M;try{let E=await fetch(O);if(!E||!E.ok)throw new Error("BitfinexProvider: candles response not ok");let B=await E.json();if(!Array.isArray(B))throw new Error("BitfinexProvider: unexpected candles payload");return B.map(function(H){return{ts:Math.floor((H[0]||0)/1e3),open:p(H[1]),close:p(H[2]),high:p(H[3]),low:p(H[4]),volume:p(H[5]),volumeQuote:p(H[5])}})}catch(E){if(this.logger("BitfinexProvider: error fetching candles",E),this.genericFallback&&typeof this.genericFallback.fetchCandles=="function")return this.genericFallback.fetchCandles(u);throw E}}}return{BitfinexProvider:g}})});var zt=he((kn,nt)=>{"use strict";(function(n,t){let a=typeof globalThis!="undefined"?globalThis:n,l=typeof nt=="object"&&nt.exports?[Ye(),Ze(),Xe(),yt()]:[n==null?void 0:n.CryptoTickerProviders,n==null?void 0:n.CryptoTickerProviders,n==null?void 0:n.CryptoTickerProviders,n==null?void 0:n.CryptoTickerProviders],c=t(l[0],l[1],l[2],l[3]);typeof nt=="object"&&nt.exports&&(nt.exports=c),a&&(a.CryptoTickerProviders=a.CryptoTickerProviders||{},a.CryptoTickerProviders.YFinanceProvider=c.YFinanceProvider)})(typeof self!="undefined"?self:kn,function(n,t,a,l){let c=n.ProviderInterface||n,i=t.GenericProvider||t,d=a.TickerSubscriptionManager||a,k=l.buildSubscriptionKey||l;class x extends c{constructor(T){super(T);let f=T||{};this.genericFallback=f.genericFallback instanceof i?f.genericFallback:new i(T);let p={logger:(...C)=>{this.logger(...C)},fetchTicker:C=>this.genericFallback.fetchTicker(C),subscribeStreaming:null,unsubscribeStreaming:null,ensureConnection:null,buildSubscriptionKey:function(C,g,P,u){return k(C,g,P,u)},fallbackPollIntervalMs:f.fallbackPollIntervalMs,staleTickerTimeoutMs:f.staleTickerTimeoutMs};this.subscriptionManager=new d(p)}getId(){return"YFINANCE"}ensureConnection(){}subscribeTicker(T,f){return this.subscriptionManager.subscribe(T,f)}async fetchTicker(T){return this.genericFallback.fetchTicker(T)}async fetchCandles(T){return this.genericFallback&&typeof this.genericFallback.fetchCandles=="function"?this.genericFallback.fetchCandles(T):c.prototype.fetchCandles.call(this,T)}getCachedTicker(T){let f=this.subscriptionManager.getCachedTicker(T);return f||this.genericFallback.getCachedTicker(T)}}return{YFinanceProvider:x}})});var Tn=he((Sn,rt)=>{"use strict";(function(n,t){let a=typeof globalThis!="undefined"?globalThis:n,l=typeof rt=="object"&&rt.exports?[Ze(),Ht(),qt(),zt()]:[n==null?void 0:n.CryptoTickerProviders,n==null?void 0:n.CryptoTickerProviders,n==null?void 0:n.CryptoTickerProviders,n==null?void 0:n.CryptoTickerProviders],c=t(l[0],l[1],l[2],l[3]);typeof rt=="object"&&rt.exports&&(rt.exports=c),a&&(a.CryptoTickerProviders=a.CryptoTickerProviders||{},a.CryptoTickerProviders.ProviderRegistry=c.ProviderRegistry)})(typeof self!="undefined"?self:Sn,function(n,t,a,l){let c=n.GenericProvider||n,i=t.BinanceProvider||t,d=a.BitfinexProvider||a,k=l.YFinanceProvider||l;class x{constructor(T){let f=T||{};this.logger=typeof f.logger=="function"?f.logger:function(){},this.baseUrl=f.baseUrl||"",this.providers={},this.fallbackPollIntervalMs=typeof f.fallbackPollIntervalMs=="number"?f.fallbackPollIntervalMs:void 0,this.staleTickerTimeoutMs=typeof f.staleTickerTimeoutMs=="number"?f.staleTickerTimeoutMs:void 0,this.binanceRestBaseUrl=typeof f.binanceRestBaseUrl=="string"&&f.binanceRestBaseUrl.length>0?f.binanceRestBaseUrl:"https://api.binance.com",this.binanceWsBaseUrl=typeof f.binanceWsBaseUrl=="string"&&f.binanceWsBaseUrl.length>0?f.binanceWsBaseUrl:"wss://stream.binance.com:9443/ws",this.binanceSymbolOverrides=f.binanceSymbolOverrides||{},this.bitfinexRestBaseUrl=typeof f.bitfinexRestBaseUrl=="string"&&f.bitfinexRestBaseUrl.length>0?f.bitfinexRestBaseUrl:"https://api-pub.bitfinex.com",this.bitfinexWsBaseUrl=typeof f.bitfinexWsBaseUrl=="string"&&f.bitfinexWsBaseUrl.length>0?f.bitfinexWsBaseUrl:"wss://api-pub.bitfinex.com/ws/2",this.bitfinexSymbolOverrides=f.bitfinexSymbolOverrides||{};let p={baseUrl:this.baseUrl,logger:this.logger,fallbackPollIntervalMs:this.fallbackPollIntervalMs,staleTickerTimeoutMs:this.staleTickerTimeoutMs};this.genericProvider=f.genericProvider instanceof c?f.genericProvider:new c(p),this.register(this.genericProvider),this.register(new i({baseUrl:this.baseUrl,logger:this.logger,fallbackPollIntervalMs:this.fallbackPollIntervalMs,staleTickerTimeoutMs:this.staleTickerTimeoutMs,genericFallback:this.genericProvider,binanceRestBaseUrl:this.binanceRestBaseUrl,binanceWsBaseUrl:this.binanceWsBaseUrl,binanceSymbolOverrides:this.binanceSymbolOverrides})),this.register(new d({baseUrl:this.baseUrl,logger:this.logger,fallbackPollIntervalMs:this.fallbackPollIntervalMs,staleTickerTimeoutMs:this.staleTickerTimeoutMs,genericFallback:this.genericProvider,bitfinexRestBaseUrl:this.bitfinexRestBaseUrl,bitfinexWsBaseUrl:this.bitfinexWsBaseUrl,bitfinexSymbolOverrides:this.bitfinexSymbolOverrides})),this.register(new k({baseUrl:this.baseUrl,logger:this.logger,fallbackPollIntervalMs:this.fallbackPollIntervalMs,staleTickerTimeoutMs:this.staleTickerTimeoutMs,genericFallback:this.genericProvider}))}register(T){if(!T||typeof T.getId!="function")return;let f=T.getId();f&&(this.providers[f.toUpperCase()]=T)}getProvider(T){let f=(T||"").toUpperCase();return this.providers[f]||this.genericProvider}getGenericProvider(){return this.genericProvider}ensureAllConnections(){let T=Object.keys(this.providers);for(let f=0;f<T.length;f++){let p=this.providers[T[f]];p&&typeof p.ensureConnection=="function"&&p.ensureConnection()}}}return{ProviderRegistry:x}})});var Vt=he((En,It)=>{"use strict";(function(n,t){let a=t();typeof It=="object"&&It.exports&&(It.exports=a),n&&typeof n=="object"&&(n.CryptoTickerFormatters=a)})(typeof self!="undefined"?self:En,function(){let n=["auto","full","compact","plain"],t=[{value:1e12,suffix:"T"},{value:1e9,suffix:"B"},{value:1e6,suffix:"M"},{value:1e3,suffix:"K"}];function a(c,i,d,k){let x=k||"auto",T=typeof i=="number"?i:parseInt(String(i!=null?i:""),10);(Number.isNaN(T)||T<0)&&(T=2);let f=c*(typeof d=="number"?d:1),p=Math.abs(f),C=f<0?"-":"";function g(S,M){let y=Math.pow(10,M);return Math.round(S*y)/y}function P(S,M){try{return S.toLocaleString(void 0,M)}catch{return S.toString()}}let u="",h=Math.max(0,T);switch(x){case"full":{let S=g(p,h);u=P(S,{minimumFractionDigits:h,maximumFractionDigits:h,useGrouping:!0});break}case"compact":{let S="",M=p;for(let O of t)if(p>=O.value){S=O.suffix,M=p/O.value;break}let y=g(M,h);u=P(y,{minimumFractionDigits:h,maximumFractionDigits:h,useGrouping:!S})+S;break}case"plain":{let S=g(p,h);u=P(S,{minimumFractionDigits:h,maximumFractionDigits:h,useGrouping:!1});break}case"auto":default:{let S="",M=p;p>1e5&&(S="K",M=p/1e3);let y=g(M,h);u=P(y,{minimumFractionDigits:h,maximumFractionDigits:h,useGrouping:!1})+S;break}}return C+u}function l(c,i,d){return d-i===0?.5:(c-i)/(d-i)}return{getRoundedValue:a,normalizeValue:l}})});var Pn=he((Dt,xn)=>{(function(n,t){typeof Dt=="object"&&typeof xn!="undefined"?t(Dt):typeof define=="function"&&define.amd?define(["exports"],t):(n=n||self,t(n.exprEval={}))})(Dt,function(n){"use strict";var t="INUMBER",a="IOP1",l="IOP2",c="IOP3",i="IVAR",d="IVARNAME",k="IFUNCALL",x="IFUNDEF",m="IEXPR",T="IEXPREVAL",f="IMEMBER",p="IENDSTATEMENT",C="IARRAY";function g(r,s){this.type=r,this.value=s!=null?s:0}g.prototype.toString=function(){switch(this.type){case t:case a:case l:case c:case i:case d:case p:return this.value;case k:return"CALL "+this.value;case x:return"DEF "+this.value;case C:return"ARRAY "+this.value;case f:return"."+this.value;default:return"Invalid Instruction"}};function P(r){return new g(a,r)}function u(r){return new g(l,r)}function h(r){return new g(c,r)}function S(r,s,v,R,F){for(var $=[],_=[],K,te,ue,le,ge=0;ge<r.length;ge++){var V=r[ge],de=V.type;if(de===t||de===d)Array.isArray(V.value)?$.push.apply($,S(V.value.map(function(Ct){return new g(t,Ct)}).concat(new g(C,V.value.length)),s,v,R,F)):$.push(V);else if(de===i&&F.hasOwnProperty(V.value))V=new g(t,F[V.value]),$.push(V);else if(de===l&&$.length>1)te=$.pop(),K=$.pop(),le=v[V.value],V=new g(t,le(K.value,te.value)),$.push(V);else if(de===c&&$.length>2)ue=$.pop(),te=$.pop(),K=$.pop(),V.value==="?"?$.push(K.value?te.value:ue.value):(le=R[V.value],V=new g(t,le(K.value,te.value,ue.value)),$.push(V));else if(de===a&&$.length>0)K=$.pop(),le=s[V.value],V=new g(t,le(K.value)),$.push(V);else if(de===m){for(;$.length>0;)_.push($.shift());_.push(new g(m,S(V.value,s,v,R,F)))}else if(de===f&&$.length>0)K=$.pop(),$.push(new g(t,K.value[V.value]));else{for(;$.length>0;)_.push($.shift());_.push(V)}}for(;$.length>0;)_.push($.shift());return _}function M(r,s,v){for(var R=[],F=0;F<r.length;F++){var $=r[F],_=$.type;if(_===i&&$.value===s)for(var K=0;K<v.tokens.length;K++){var te=v.tokens[K],ue;te.type===a?ue=P(te.value):te.type===l?ue=u(te.value):te.type===c?ue=h(te.value):ue=new g(te.type,te.value),R.push(ue)}else _===m?R.push(new g(m,M($.value,s,v))):R.push($)}return R}function y(r,s,v){var R=[],F,$,_,K,te,ue;if(E(r))return B(r,v);for(var le=r.length,ge=0;ge<le;ge++){var V=r[ge],de=V.type;if(de===t||de===d)R.push(V.value);else if(de===l)$=R.pop(),F=R.pop(),V.value==="and"?R.push(F?!!y($,s,v):!1):V.value==="or"?R.push(F?!0:!!y($,s,v)):V.value==="="?(K=s.binaryOps[V.value],R.push(K(F,y($,s,v),v))):(K=s.binaryOps[V.value],R.push(K(B(F,v),B($,v))));else if(de===c)_=R.pop(),$=R.pop(),F=R.pop(),V.value==="?"?R.push(y(F?$:_,s,v)):(K=s.ternaryOps[V.value],R.push(K(B(F,v),B($,v),B(_,v))));else if(de===i)if(V.value in s.functions)R.push(s.functions[V.value]);else if(V.value in s.unaryOps&&s.parser.isOperatorEnabled(V.value))R.push(s.unaryOps[V.value]);else{var Ct=v[V.value];if(Ct!==void 0)R.push(Ct);else throw new Error("undefined variable: "+V.value)}else if(de===a)F=R.pop(),K=s.unaryOps[V.value],R.push(K(B(F,v)));else if(de===k){for(ue=V.value,te=[];ue-- >0;)te.unshift(B(R.pop(),v));if(K=R.pop(),K.apply&&K.call)R.push(K.apply(void 0,te));else throw new Error(K+" is not a function")}else if(de===x)R.push(function(){for(var pr=R.pop(),jt=[],dr=V.value;dr-- >0;)jt.unshift(R.pop());var sn=R.pop(),$t=function(){for(var on=Object.assign({},v),wt=0,gr=jt.length;wt<gr;wt++)on[jt[wt]]=arguments[wt];return y(pr,s,on)};return Object.defineProperty($t,"name",{value:sn,writable:!1}),v[sn]=$t,$t}());else if(de===m)R.push(O(V,s));else if(de===T)R.push(V);else if(de===f)F=R.pop(),R.push(F[V.value]);else if(de===p)R.pop();else if(de===C){for(ue=V.value,te=[];ue-- >0;)te.unshift(R.pop());R.push(te)}else throw new Error("invalid Expression")}if(R.length>1)throw new Error("invalid Expression (parity)");return R[0]===0?0:B(R[0],v)}function O(r,s,v){return E(r)?r:{type:T,value:function(R){return y(r.value,s,R)}}}function E(r){return r&&r.type===T}function B(r,s){return E(r)?r.value(s):r}function H(r,s){for(var v=[],R,F,$,_,K,te,ue=0;ue<r.length;ue++){var le=r[ue],ge=le.type;if(ge===t)typeof le.value=="number"&&le.value<0?v.push("("+le.value+")"):Array.isArray(le.value)?v.push("["+le.value.map(N).join(", ")+"]"):v.push(N(le.value));else if(ge===l)F=v.pop(),R=v.pop(),_=le.value,s?_==="^"?v.push("Math.pow("+R+", "+F+")"):_==="and"?v.push("(!!"+R+" && !!"+F+")"):_==="or"?v.push("(!!"+R+" || !!"+F+")"):_==="||"?v.push("(function(a,b){ return Array.isArray(a) && Array.isArray(b) ? a.concat(b) : String(a) + String(b); }(("+R+"),("+F+")))"):_==="=="?v.push("("+R+" === "+F+")"):_==="!="?v.push("("+R+" !== "+F+")"):_==="["?v.push(R+"[("+F+") | 0]"):v.push("("+R+" "+_+" "+F+")"):_==="["?v.push(R+"["+F+"]"):v.push("("+R+" "+_+" "+F+")");else if(ge===c)if($=v.pop(),F=v.pop(),R=v.pop(),_=le.value,_==="?")v.push("("+R+" ? "+F+" : "+$+")");else throw new Error("invalid Expression");else if(ge===i||ge===d)v.push(le.value);else if(ge===a)R=v.pop(),_=le.value,_==="-"||_==="+"?v.push("("+_+R+")"):s?_==="not"?v.push("(!"+R+")"):_==="!"?v.push("fac("+R+")"):v.push(_+"("+R+")"):_==="!"?v.push("("+R+"!)"):v.push("("+_+" "+R+")");else if(ge===k){for(te=le.value,K=[];te-- >0;)K.unshift(v.pop());_=v.pop(),v.push(_+"("+K.join(", ")+")")}else if(ge===x){for(F=v.pop(),te=le.value,K=[];te-- >0;)K.unshift(v.pop());R=v.pop(),s?v.push("("+R+" = function("+K.join(", ")+") { return "+F+" })"):v.push("("+R+"("+K.join(", ")+") = "+F+")")}else if(ge===f)R=v.pop(),v.push(R+"."+le.value);else if(ge===C){for(te=le.value,K=[];te-- >0;)K.unshift(v.pop());v.push("["+K.join(", ")+"]")}else if(ge===m)v.push("("+H(le.value,s)+")");else if(ge!==p)throw new Error("invalid Expression")}return v.length>1&&(s?v=[v.join(",")]:v=[v.join(";")]),String(v[0])}function N(r){return typeof r=="string"?JSON.stringify(r).replace(/\u2028/g,"\\u2028").replace(/\u2029/g,"\\u2029"):r}function Y(r,s){for(var v=0;v<r.length;v++)if(r[v]===s)return!0;return!1}function re(r,s,v){v=v||{};for(var R=!!v.withMembers,F=null,$=0;$<r.length;$++){var _=r[$];_.type===i||_.type===d?!R&&!Y(s,_.value)?s.push(_.value):(F!==null&&(Y(s,F)||s.push(F)),F=_.value):_.type===f&&R&&F!==null?F+="."+_.value:_.type===m?re(_.value,s,v):F!==null&&(Y(s,F)||s.push(F),F=null)}F!==null&&!Y(s,F)&&s.push(F)}function J(r,s){this.tokens=r,this.parser=s,this.unaryOps=s.unaryOps,this.binaryOps=s.binaryOps,this.ternaryOps=s.ternaryOps,this.functions=s.functions}J.prototype.simplify=function(r){return r=r||{},new J(S(this.tokens,this.unaryOps,this.binaryOps,this.ternaryOps,r),this.parser)},J.prototype.substitute=function(r,s){return s instanceof J||(s=this.parser.parse(String(s))),new J(M(this.tokens,r,s),this.parser)},J.prototype.evaluate=function(r){return r=r||{},y(this.tokens,this,r)},J.prototype.toString=function(){return H(this.tokens,!1)},J.prototype.symbols=function(r){r=r||{};var s=[];return re(this.tokens,s,r),s},J.prototype.variables=function(r){r=r||{};var s=[];re(this.tokens,s,r);var v=this.functions;return s.filter(function(R){return!(R in v)})},J.prototype.toJSFunction=function(r,s){var v=this,R=new Function(r,"with(this.functions) with (this.ternaryOps) with (this.binaryOps) with (this.unaryOps) { return "+H(this.simplify(s).tokens,!0)+"; }");return function(){return R.apply(v,arguments)}};var ie="TEOF",W="TOP",z="TNUMBER",fe="TSTRING",U="TPAREN",q="TBRACKET",ve="TCOMMA",we="TNAME",ye="TSEMICOLON";function pe(r,s,v){this.type=r,this.value=s,this.index=v}pe.prototype.toString=function(){return this.type+": "+this.value};function Z(r,s){this.pos=0,this.current=null,this.unaryOps=r.unaryOps,this.binaryOps=r.binaryOps,this.ternaryOps=r.ternaryOps,this.consts=r.consts,this.expression=s,this.savedPosition=0,this.savedCurrent=null,this.options=r.options,this.parser=r}Z.prototype.newToken=function(r,s,v){return new pe(r,s,v!=null?v:this.pos)},Z.prototype.save=function(){this.savedPosition=this.pos,this.savedCurrent=this.current},Z.prototype.restore=function(){this.pos=this.savedPosition,this.current=this.savedCurrent},Z.prototype.next=function(){if(this.pos>=this.expression.length)return this.newToken(ie,"EOF");if(this.isWhitespace()||this.isComment())return this.next();if(this.isRadixInteger()||this.isNumber()||this.isOperator()||this.isString()||this.isParen()||this.isBracket()||this.isComma()||this.isSemicolon()||this.isNamedOp()||this.isConst()||this.isName())return this.current;this.parseError('Unknown character "'+this.expression.charAt(this.pos)+'"')},Z.prototype.isString=function(){var r=!1,s=this.pos,v=this.expression.charAt(s);if(v==="'"||v==='"')for(var R=this.expression.indexOf(v,s+1);R>=0&&this.pos<this.expression.length;){if(this.pos=R+1,this.expression.charAt(R-1)!=="\\"){var F=this.expression.substring(s+1,R);this.current=this.newToken(fe,this.unescape(F),s),r=!0;break}R=this.expression.indexOf(v,R+1)}return r},Z.prototype.isParen=function(){var r=this.expression.charAt(this.pos);return r==="("||r===")"?(this.current=this.newToken(U,r),this.pos++,!0):!1},Z.prototype.isBracket=function(){var r=this.expression.charAt(this.pos);return(r==="["||r==="]")&&this.isOperatorEnabled("[")?(this.current=this.newToken(q,r),this.pos++,!0):!1},Z.prototype.isComma=function(){var r=this.expression.charAt(this.pos);return r===","?(this.current=this.newToken(ve,","),this.pos++,!0):!1},Z.prototype.isSemicolon=function(){var r=this.expression.charAt(this.pos);return r===";"?(this.current=this.newToken(ye,";"),this.pos++,!0):!1},Z.prototype.isConst=function(){for(var r=this.pos,s=r;s<this.expression.length;s++){var v=this.expression.charAt(s);if(v.toUpperCase()===v.toLowerCase()&&(s===this.pos||v!=="_"&&v!=="."&&(v<"0"||v>"9")))break}if(s>r){var R=this.expression.substring(r,s);if(R in this.consts)return this.current=this.newToken(z,this.consts[R]),this.pos+=R.length,!0}return!1},Z.prototype.isNamedOp=function(){for(var r=this.pos,s=r;s<this.expression.length;s++){var v=this.expression.charAt(s);if(v.toUpperCase()===v.toLowerCase()&&(s===this.pos||v!=="_"&&(v<"0"||v>"9")))break}if(s>r){var R=this.expression.substring(r,s);if(this.isOperatorEnabled(R)&&(R in this.binaryOps||R in this.unaryOps||R in this.ternaryOps))return this.current=this.newToken(W,R),this.pos+=R.length,!0}return!1},Z.prototype.isName=function(){for(var r=this.pos,s=r,v=!1;s<this.expression.length;s++){var R=this.expression.charAt(s);if(R.toUpperCase()===R.toLowerCase()){if(s===this.pos&&(R==="$"||R==="_")){R==="_"&&(v=!0);continue}else if(s===this.pos||!v||R!=="_"&&(R<"0"||R>"9"))break}else v=!0}if(v){var F=this.expression.substring(r,s);return this.current=this.newToken(we,F),this.pos+=F.length,!0}return!1},Z.prototype.isWhitespace=function(){for(var r=!1,s=this.expression.charAt(this.pos);(s===" "||s==="	"||s===`
`||s==="\r")&&(r=!0,this.pos++,!(this.pos>=this.expression.length));)s=this.expression.charAt(this.pos);return r};var Te=/^[0-9a-f]{4}$/i;Z.prototype.unescape=function(r){var s=r.indexOf("\\");if(s<0)return r;for(var v=r.substring(0,s);s>=0;){var R=r.charAt(++s);switch(R){case"'":v+="'";break;case'"':v+='"';break;case"\\":v+="\\";break;case"/":v+="/";break;case"b":v+="\b";break;case"f":v+="\f";break;case"n":v+=`
`;break;case"r":v+="\r";break;case"t":v+="	";break;case"u":var F=r.substring(s+1,s+5);Te.test(F)||this.parseError("Illegal escape sequence: \\u"+F),v+=String.fromCharCode(parseInt(F,16)),s+=4;break;default:throw this.parseError('Illegal escape sequence: "\\'+R+'"')}++s;var $=r.indexOf("\\",s);v+=r.substring(s,$<0?r.length:$),s=$}return v},Z.prototype.isComment=function(){var r=this.expression.charAt(this.pos);return r==="/"&&this.expression.charAt(this.pos+1)==="*"?(this.pos=this.expression.indexOf("*/",this.pos)+2,this.pos===1&&(this.pos=this.expression.length),!0):!1},Z.prototype.isRadixInteger=function(){var r=this.pos;if(r>=this.expression.length-2||this.expression.charAt(r)!=="0")return!1;++r;var s,v;if(this.expression.charAt(r)==="x")s=16,v=/^[0-9a-f]$/i,++r;else if(this.expression.charAt(r)==="b")s=2,v=/^[01]$/i,++r;else return!1;for(var R=!1,F=r;r<this.expression.length;){var $=this.expression.charAt(r);if(v.test($))r++,R=!0;else break}return R&&(this.current=this.newToken(z,parseInt(this.expression.substring(F,r),s)),this.pos=r),R},Z.prototype.isNumber=function(){for(var r=!1,s=this.pos,v=s,R=s,F=!1,$=!1,_;s<this.expression.length&&(_=this.expression.charAt(s),_>="0"&&_<="9"||!F&&_===".");)_==="."?F=!0:$=!0,s++,r=$;if(r&&(R=s),_==="e"||_==="E"){s++;for(var K=!0,te=!1;s<this.expression.length;){if(_=this.expression.charAt(s),K&&(_==="+"||_==="-"))K=!1;else if(_>="0"&&_<="9")te=!0,K=!1;else break;s++}te||(s=R)}return r?(this.current=this.newToken(z,parseFloat(this.expression.substring(v,s))),this.pos=s):this.pos=R,r},Z.prototype.isOperator=function(){var r=this.pos,s=this.expression.charAt(this.pos);if(s==="+"||s==="-"||s==="*"||s==="/"||s==="%"||s==="^"||s==="?"||s===":"||s===".")this.current=this.newToken(W,s);else if(s==="\u2219"||s==="\u2022")this.current=this.newToken(W,"*");else if(s===">")this.expression.charAt(this.pos+1)==="="?(this.current=this.newToken(W,">="),this.pos++):this.current=this.newToken(W,">");else if(s==="<")this.expression.charAt(this.pos+1)==="="?(this.current=this.newToken(W,"<="),this.pos++):this.current=this.newToken(W,"<");else if(s==="|")if(this.expression.charAt(this.pos+1)==="|")this.current=this.newToken(W,"||"),this.pos++;else return!1;else if(s==="=")this.expression.charAt(this.pos+1)==="="?(this.current=this.newToken(W,"=="),this.pos++):this.current=this.newToken(W,s);else if(s==="!")this.expression.charAt(this.pos+1)==="="?(this.current=this.newToken(W,"!="),this.pos++):this.current=this.newToken(W,s);else return!1;return this.pos++,this.isOperatorEnabled(this.current.value)?!0:(this.pos=r,!1)},Z.prototype.isOperatorEnabled=function(r){return this.parser.isOperatorEnabled(r)},Z.prototype.getCoordinates=function(){var r=0,s,v=-1;do r++,s=this.pos-v,v=this.expression.indexOf(`
`,v+1);while(v>=0&&v<this.pos);return{line:r,column:s}},Z.prototype.parseError=function(r){var s=this.getCoordinates();throw new Error("parse error ["+s.line+":"+s.column+"]: "+r)};function X(r,s,v){this.parser=r,this.tokens=s,this.current=null,this.nextToken=null,this.next(),this.savedCurrent=null,this.savedNextToken=null,this.allowMemberAccess=v.allowMemberAccess!==!1}X.prototype.next=function(){return this.current=this.nextToken,this.nextToken=this.tokens.next()},X.prototype.tokenMatches=function(r,s){return typeof s=="undefined"?!0:Array.isArray(s)?Y(s,r.value):typeof s=="function"?s(r):r.value===s},X.prototype.save=function(){this.savedCurrent=this.current,this.savedNextToken=this.nextToken,this.tokens.save()},X.prototype.restore=function(){this.tokens.restore(),this.current=this.savedCurrent,this.nextToken=this.savedNextToken},X.prototype.accept=function(r,s){return this.nextToken.type===r&&this.tokenMatches(this.nextToken,s)?(this.next(),!0):!1},X.prototype.expect=function(r,s){if(!this.accept(r,s)){var v=this.tokens.getCoordinates();throw new Error("parse error ["+v.line+":"+v.column+"]: Expected "+(s||r))}},X.prototype.parseAtom=function(r){var s=this.tokens.unaryOps;function v(F){return F.value in s}if(this.accept(we)||this.accept(W,v))r.push(new g(i,this.current.value));else if(this.accept(z))r.push(new g(t,this.current.value));else if(this.accept(fe))r.push(new g(t,this.current.value));else if(this.accept(U,"("))this.parseExpression(r),this.expect(U,")");else if(this.accept(q,"["))if(this.accept(q,"]"))r.push(new g(C,0));else{var R=this.parseArrayList(r);r.push(new g(C,R))}else throw new Error("unexpected "+this.nextToken)},X.prototype.parseExpression=function(r){var s=[];this.parseUntilEndStatement(r,s)||(this.parseVariableAssignmentExpression(s),!this.parseUntilEndStatement(r,s)&&this.pushExpression(r,s))},X.prototype.pushExpression=function(r,s){for(var v=0,R=s.length;v<R;v++)r.push(s[v])},X.prototype.parseUntilEndStatement=function(r,s){return this.accept(ye)?(this.nextToken&&this.nextToken.type!==ie&&!(this.nextToken.type===U&&this.nextToken.value===")")&&s.push(new g(p)),this.nextToken.type!==ie&&this.parseExpression(s),r.push(new g(m,s)),!0):!1},X.prototype.parseArrayList=function(r){for(var s=0;!this.accept(q,"]");)for(this.parseExpression(r),++s;this.accept(ve);)this.parseExpression(r),++s;return s},X.prototype.parseVariableAssignmentExpression=function(r){for(this.parseConditionalExpression(r);this.accept(W,"=");){var s=r.pop(),v=[],R=r.length-1;if(s.type===k){if(!this.tokens.isOperatorEnabled("()="))throw new Error("function definition is not permitted");for(var F=0,$=s.value+1;F<$;F++){var _=R-F;r[_].type===i&&(r[_]=new g(d,r[_].value))}this.parseVariableAssignmentExpression(v),r.push(new g(m,v)),r.push(new g(x,s.value));continue}if(s.type!==i&&s.type!==f)throw new Error("expected variable for assignment");this.parseVariableAssignmentExpression(v),r.push(new g(d,s.value)),r.push(new g(m,v)),r.push(u("="))}},X.prototype.parseConditionalExpression=function(r){for(this.parseOrExpression(r);this.accept(W,"?");){var s=[],v=[];this.parseConditionalExpression(s),this.expect(W,":"),this.parseConditionalExpression(v),r.push(new g(m,s)),r.push(new g(m,v)),r.push(h("?"))}},X.prototype.parseOrExpression=function(r){for(this.parseAndExpression(r);this.accept(W,"or");){var s=[];this.parseAndExpression(s),r.push(new g(m,s)),r.push(u("or"))}},X.prototype.parseAndExpression=function(r){for(this.parseComparison(r);this.accept(W,"and");){var s=[];this.parseComparison(s),r.push(new g(m,s)),r.push(u("and"))}};var Ee=["==","!=","<","<=",">=",">","in"];X.prototype.parseComparison=function(r){for(this.parseAddSub(r);this.accept(W,Ee);){var s=this.current;this.parseAddSub(r),r.push(u(s.value))}};var Q=["+","-","||"];X.prototype.parseAddSub=function(r){for(this.parseTerm(r);this.accept(W,Q);){var s=this.current;this.parseTerm(r),r.push(u(s.value))}};var ee=["*","/","%"];X.prototype.parseTerm=function(r){for(this.parseFactor(r);this.accept(W,ee);){var s=this.current;this.parseFactor(r),r.push(u(s.value))}},X.prototype.parseFactor=function(r){var s=this.tokens.unaryOps;function v(F){return F.value in s}if(this.save(),this.accept(W,v)){if(this.current.value!=="-"&&this.current.value!=="+"){if(this.nextToken.type===U&&this.nextToken.value==="("){this.restore(),this.parseExponential(r);return}else if(this.nextToken.type===ye||this.nextToken.type===ve||this.nextToken.type===ie||this.nextToken.type===U&&this.nextToken.value===")"){this.restore(),this.parseAtom(r);return}}var R=this.current;this.parseFactor(r),r.push(P(R.value))}else this.parseExponential(r)},X.prototype.parseExponential=function(r){for(this.parsePostfixExpression(r);this.accept(W,"^");)this.parseFactor(r),r.push(u("^"))},X.prototype.parsePostfixExpression=function(r){for(this.parseFunctionCall(r);this.accept(W,"!");)r.push(P("!"))},X.prototype.parseFunctionCall=function(r){var s=this.tokens.unaryOps;function v($){return $.value in s}if(this.accept(W,v)){var R=this.current;this.parseAtom(r),r.push(P(R.value))}else for(this.parseMemberExpression(r);this.accept(U,"(");)if(this.accept(U,")"))r.push(new g(k,0));else{var F=this.parseArgumentList(r);r.push(new g(k,F))}},X.prototype.parseArgumentList=function(r){for(var s=0;!this.accept(U,")");)for(this.parseExpression(r),++s;this.accept(ve);)this.parseExpression(r),++s;return s},X.prototype.parseMemberExpression=function(r){for(this.parseAtom(r);this.accept(W,".")||this.accept(q,"[");){var s=this.current;if(s.value==="."){if(!this.allowMemberAccess)throw new Error('unexpected ".", member access is not permitted');this.expect(we),r.push(new g(f,this.current.value))}else if(s.value==="["){if(!this.tokens.isOperatorEnabled("["))throw new Error('unexpected "[]", arrays are disabled');this.parseExpression(r),this.expect(q,"]"),r.push(u("["))}else throw new Error("unexpected symbol: "+s.value)}};function Ne(r,s){return Number(r)+Number(s)}function _e(r,s){return r-s}function je(r,s){return r*s}function Fe(r,s){return r/s}function Se(r,s){return r%s}function ce(r,s){return Array.isArray(r)&&Array.isArray(s)?r.concat(s):""+r+s}function De(r,s){return r===s}function Ue(r,s){return r!==s}function $e(r,s){return r>s}function Be(r,s){return r<s}function D(r,s){return r>=s}function e(r,s){return r<=s}function o(r,s){return!!(r&&s)}function b(r,s){return!!(r||s)}function w(r,s){return Y(s,r)}function I(r){return(Math.exp(r)-Math.exp(-r))/2}function A(r){return(Math.exp(r)+Math.exp(-r))/2}function L(r){return r===1/0?1:r===-1/0?-1:(Math.exp(r)-Math.exp(-r))/(Math.exp(r)+Math.exp(-r))}function j(r){return r===-1/0?r:Math.log(r+Math.sqrt(r*r+1))}function G(r){return Math.log(r+Math.sqrt(r*r-1))}function ne(r){return Math.log((1+r)/(1-r))/2}function Ae(r){return Math.log(r)*Math.LOG10E}function ze(r){return-r}function oe(r){return!r}function se(r){return r<0?Math.ceil(r):Math.floor(r)}function ae(r){return Math.random()*(r||1)}function ke(r){return Pe(r+1)}function Ge(r){return isFinite(r)&&r===Math.round(r)}var dt=4.7421875,Le=[.9999999999999971,57.15623566586292,-59.59796035547549,14.136097974741746,-.4919138160976202,3399464998481189e-20,4652362892704858e-20,-9837447530487956e-20,.0001580887032249125,-.00021026444172410488,.00021743961811521265,-.0001643181065367639,8441822398385275e-20,-26190838401581408e-21,36899182659531625e-22];function Pe(r){var s,v;if(Ge(r)){if(r<=0)return isFinite(r)?1/0:NaN;if(r>171)return 1/0;for(var R=r-2,F=r-1;R>1;)F*=R,R--;return F===0&&(F=1),F}if(r<.5)return Math.PI/(Math.sin(Math.PI*r)*Pe(1-r));if(r>=171.35)return 1/0;if(r>85){var $=r*r,_=$*r,K=_*r,te=K*r;return Math.sqrt(2*Math.PI/r)*Math.pow(r/Math.E,r)*(1+1/(12*r)+1/(288*$)-139/(51840*_)-571/(2488320*K)+163879/(209018880*te)+5246819/(75246796800*te*r))}--r,v=Le[0];for(var ue=1;ue<Le.length;++ue)v+=Le[ue]/(r+ue);return s=r+dt+.5,Math.sqrt(2*Math.PI)*Math.pow(s,r+.5)*Math.exp(-s)*v}function gt(r){return Array.isArray(r)?r.length:String(r).length}function vt(){for(var r=0,s=0,v=0;v<arguments.length;v++){var R=Math.abs(arguments[v]),F;s<R?(F=s/R,r=r*F*F+1,s=R):R>0?(F=R/s,r+=F*F):r+=R}return s===1/0?1/0:s*Math.sqrt(r)}function Ve(r,s,v){return r?s:v}function Jn(r,s){return typeof s=="undefined"||+s==0?Math.round(r):(r=+r,s=-+s,isNaN(r)||!(typeof s=="number"&&s%1===0)?NaN:(r=r.toString().split("e"),r=Math.round(+(r[0]+"e"+(r[1]?+r[1]-s:-s))),r=r.toString().split("e"),+(r[0]+"e"+(r[1]?+r[1]+s:s))))}function Xn(r,s,v){return v&&(v[r]=s),s}function Qn(r,s){return r[s|0]}function Zn(r){return arguments.length===1&&Array.isArray(r)?Math.max.apply(Math,r):Math.max.apply(Math,arguments)}function er(r){return arguments.length===1&&Array.isArray(r)?Math.min.apply(Math,r):Math.min.apply(Math,arguments)}function tr(r,s){if(typeof r!="function")throw new Error("First argument to map is not a function");if(!Array.isArray(s))throw new Error("Second argument to map is not an array");return s.map(function(v,R){return r(v,R)})}function nr(r,s,v){if(typeof r!="function")throw new Error("First argument to fold is not a function");if(!Array.isArray(v))throw new Error("Second argument to fold is not an array");return v.reduce(function(R,F,$){return r(R,F,$)},s)}function rr(r,s){if(typeof r!="function")throw new Error("First argument to filter is not a function");if(!Array.isArray(s))throw new Error("Second argument to filter is not an array");return s.filter(function(v,R){return r(v,R)})}function ir(r,s){if(!(Array.isArray(s)||typeof s=="string"))throw new Error("Second argument to indexOf is not a string or array");return s.indexOf(r)}function sr(r,s){if(!Array.isArray(s))throw new Error("Second argument to join is not an array");return s.join(r)}function or(r){return(r>0)-(r<0)||+r}var tn=1/3;function ar(r){return r<0?-Math.pow(-r,tn):Math.pow(r,tn)}function cr(r){return Math.exp(r)-1}function lr(r){return Math.log(1+r)}function ur(r){return Math.log(r)/Math.LN2}function We(r){this.options=r||{},this.unaryOps={sin:Math.sin,cos:Math.cos,tan:Math.tan,asin:Math.asin,acos:Math.acos,atan:Math.atan,sinh:Math.sinh||I,cosh:Math.cosh||A,tanh:Math.tanh||L,asinh:Math.asinh||j,acosh:Math.acosh||G,atanh:Math.atanh||ne,sqrt:Math.sqrt,cbrt:Math.cbrt||ar,log:Math.log,log2:Math.log2||ur,ln:Math.log,lg:Math.log10||Ae,log10:Math.log10||Ae,expm1:Math.expm1||cr,log1p:Math.log1p||lr,abs:Math.abs,ceil:Math.ceil,floor:Math.floor,round:Math.round,trunc:Math.trunc||se,"-":ze,"+":Number,exp:Math.exp,not:oe,length:gt,"!":ke,sign:Math.sign||or},this.binaryOps={"+":Ne,"-":_e,"*":je,"/":Fe,"%":Se,"^":Math.pow,"||":ce,"==":De,"!=":Ue,">":$e,"<":Be,">=":D,"<=":e,and:o,or:b,in:w,"=":Xn,"[":Qn},this.ternaryOps={"?":Ve},this.functions={random:ae,fac:ke,min:er,max:Zn,hypot:Math.hypot||vt,pyt:Math.hypot||vt,pow:Math.pow,atan2:Math.atan2,if:Ve,gamma:Pe,roundTo:Jn,map:tr,fold:nr,filter:rr,indexOf:ir,join:sr},this.consts={E:Math.E,PI:Math.PI,true:!0,false:!1}}We.prototype.parse=function(r){var s=[],v=new X(this,new Z(this,r),{allowMemberAccess:this.options.allowMemberAccess});return v.parseExpression(s),v.expect(ie,"EOF"),new J(s,this)},We.prototype.evaluate=function(r,s){return this.parse(r).evaluate(s)};var nn=new We;We.parse=function(r){return nn.parse(r)},We.evaluate=function(r,s){return nn.parse(r).evaluate(s)};var rn={"+":"add","-":"subtract","*":"multiply","/":"divide","%":"remainder","^":"power","!":"factorial","<":"comparison",">":"comparison","<=":"comparison",">=":"comparison","==":"comparison","!=":"comparison","||":"concatenate",and:"logical",or:"logical",not:"logical","?":"conditional",":":"conditional","=":"assignment","[":"array","()=":"fndef"};function hr(r){return rn.hasOwnProperty(r)?rn[r]:r}We.prototype.isOperatorEnabled=function(r){var s=hr(r),v=this.options.operators||{};return!(s in v)||!!v[s]};var fr={Parser:We,Expression:J};n.Expression=J,n.Parser=We,n.default=fr,Object.defineProperty(n,"__esModule",{value:!0})})});var Nt=he((In,At)=>{"use strict";var Ot=class{constructor(t,a){let l=t||{},c=Array.isArray(l.allowedVariables)&&l.allowedVariables.length>0?l.allowedVariables.slice():Gt.slice();this.allowedVariables=c;let i=a||Mn();this.parser=new i({operators:{add:!0,subtract:!0,multiply:!0,divide:!0,remainder:!0,power:!1,factorial:!1,comparison:!0,logical:!0,conditional:!0,concatenate:!1,assignment:!1,array:!1,fndef:!1},allowMemberAccess:!1}),this.cache={}}validate(t){let a;try{a=this.getCacheEntry(t)}catch(l){return{ok:!1,error:l instanceof Error?l.message:"Invalid expression"}}return a?a.disallowedVariables.length>0?{ok:!1,error:"Unknown variables: "+a.disallowedVariables.join(", ")+". Allowed variables: "+this.allowedVariables.join(", ")}:{ok:!0,variables:a.variables.slice()}:{ok:!1,error:"Expression cannot be empty"}}evaluate(t,a){let l=this.getCacheEntry(t);if(!l)throw new Error("Expression cannot be empty");if(l.disallowedVariables.length>0)throw new Error("Unknown variables: "+l.disallowedVariables.join(", ")+". Allowed variables: "+this.allowedVariables.join(", "));let c={},i=a||{};for(let d of this.allowedVariables){let k=Object.prototype.hasOwnProperty.call(i,d)?i[d]:void 0;if(Gt.indexOf(d)!==-1){c[d]=qe(k);continue}typeof k=="number"?c[d]=Number.isFinite(k)?k:0:typeof k=="boolean"||typeof k=="string"?c[d]=k:k==null?c[d]=0:c[d]=k}return l.compiled.evaluate(c)}clearCache(){this.cache={}}getCacheEntry(t){let a=this.normalizeExpression(t);if(!a)return null;if(this.cache[a])return this.cache[a];let l;try{l=this.parser.parse(a)}catch(k){throw this.wrapParseError(k)}let c=l.variables({withMembers:!1})||[],i=c.filter(k=>this.allowedVariables.indexOf(k)===-1),d={expression:a,compiled:l,variables:c.slice(),disallowedVariables:i.slice()};return this.cache[a]=d,d}normalizeExpression(t){return typeof t!="string"?"":t.trim()}wrapParseError(t){let a=t&&typeof t=="object"&&t instanceof Error&&t.message?Er(t.message):"Invalid expression",l=new Error(a);return t&&typeof t=="object"&&(l.originalError=t),l}},Gt=["value","high","low","changeDaily","changeDailyPercent","volume"];function Sr(n){return n?n.slice():[]}function qe(n){if(n==null)return 0;if(typeof n=="number")return Number.isFinite(n)?n:0;if(typeof n=="string"&&n.trim()!==""){let t=Number(n);if(!Number.isNaN(t)&&Number.isFinite(t))return t}return 0}function Rn(n){let t=n||{};return{value:qe(t.last),high:qe(t.high),low:qe(t.low),changeDaily:qe(t.changeDaily),changeDailyPercent:qe(t.changeDailyPercent),volume:qe(t.volume)}}function Tr(n,t){let a=Rn(n);if(t&&typeof t=="object")for(let l in t)Object.prototype.hasOwnProperty.call(t,l)&&(a[l]=t[l]);return a}function Er(n){return n?n.indexOf("member access is not permitted")>=0?n+'. Remove object-style prefixes (for example use "value" instead of "values.last").':n:"Invalid expression"}function Mn(){if(typeof He=="function")try{let a=Pn();if(a&&a.Parser)return a.Parser}catch{}let n=typeof globalThis!="undefined"?globalThis:{},t=n.exprEval&&n.exprEval.Parser;if(t)return t;throw new Error("expr-eval dependency is missing")}(function(t,a){let l=Mn(),c=a(l);typeof At=="object"&&At.exports&&(At.exports=c),t&&typeof t=="object"&&(t.CryptoTickerExpressionEvaluator=c)})(typeof self!="undefined"?self:In,function(t){return{createEvaluator:a=>new Ot(a,t),ExpressionEvaluator:Ot,normalizeNumericValue:qe,buildBaseContext:Rn,buildContext:Tr,allowedVariables:Sr(Gt)}})});var Kt=he((Dn,it)=>{"use strict";(function(n,t){let a=typeof it=="object"&&it.exports?Nt():n==null?void 0:n.CryptoTickerExpressionEvaluator,l=t(a);typeof it=="object"&&it.exports&&(it.exports=l),n&&typeof n=="object"&&(n.CryptoTickerAlertManager=l)})(typeof self!="undefined"?self:Dn,function(n){if(!n)throw new Error("Expression evaluator dependency is missing");let t=n,a=t.createEvaluator(),l={},c={};function i(p){return l[p]||"off"}function d(p){return c[p]!=="off"}function k(p){c[p]="off"}function x(p){c[p]="on"}function m(p){return d(p)&&i(p)==="on"}function T(p){delete l[p],delete c[p]}function f(p){let C=p.context,g=p.settings||{},P=p.values||{},u=p.backgroundColor,h=p.textColor,S=!1,M=g.alertRule;if(!M)return l[C]="off",{alertMode:S,backgroundColor:u,textColor:h};try{let y=t.buildBaseContext(P);if(a.evaluate(M,y)){if(l[C]="on",d(C)){S=!0;let E=u;u=h,h=E}}else l[C]="off",x(C)}catch(y){l[C]="error",console.error("Error evaluating alertRule",{context:C,settings:g,values:P,error:y instanceof Error?y.message:y})}return{alertMode:S,backgroundColor:u,textColor:h}}return{evaluateAlert:f,shouldDisarmOnKeyPress:m,disarmAlert:k,armAlert:x,clearContext:T,getAlertStatus:i,isAlertArmed:d}})});var Yt=he((An,Ft)=>{"use strict";(function(t,a){let l=a();typeof Ft=="object"&&Ft.exports&&(Ft.exports=l),t&&typeof t=="object"&&(t.CryptoTickerState=l)})(typeof self!="undefined"?self:An,function(){let t={},a={},l={},c={},i={},d={};function k(N,Y){t[N]={context:N,settings:Y}}function x(N){return t[N]||null}function m(N){Object.keys(t).forEach(Y=>{N(t[Y],Y)})}function T(N){delete t[N],delete d[N]}function f(N,Y){N&&(a[N]=Y||null)}function p(N){return N&&a[N]||null}function C(N){N&&delete a[N]}function g(N,Y){N&&Y&&(l[N]=Y)}function P(N){return N&&l[N]||null}function u(N){N&&(delete l[N],delete d[N])}function h(N){return c[N]||(c[N]={}),c[N]}function S(N,Y){c[N]=Y}function M(N){return i[N]}function y(N,Y){i[N]=Y}function O(){Object.keys(t).forEach(N=>{delete t[N]}),Object.keys(a).forEach(N=>{let Y=a[N];if(Y&&typeof Y.unsubscribe=="function")try{Y.unsubscribe()}catch{}delete a[N]}),Object.keys(l).forEach(N=>{delete l[N]}),Object.keys(c).forEach(N=>{delete c[N]}),Object.keys(i).forEach(N=>{delete i[N]}),Object.keys(d).forEach(N=>{delete d[N]})}function E(N,Y,re){if(!N||!Y)return;let J=typeof re=="number"?re:Date.now();d[N]={values:Object.assign({},Y),timestamp:J}}function B(N){return N&&d[N]||null}function H(N){N&&delete d[N]}return{setContextDetails:k,getContextDetails:x,forEachContext:m,clearContextDetails:T,setSubscription:f,getSubscription:p,clearSubscription:C,setConnectionState:g,getConnectionState:P,clearConnectionState:u,getOrCreateConversionRateEntry:h,setConversionRateEntry:S,getCandlesCacheEntry:M,setCandlesCacheEntry:y,resetAllState:O,setLastGoodTicker:E,getLastGoodTicker:B,clearLastGoodTicker:H}})});var Nn=he((On,st)=>{"use strict";(function(n,t){let a=typeof globalThis!="undefined"?globalThis:n,l=typeof st=="object"&&st.exports?Yt():n==null?void 0:n.CryptoTickerState,c=t(l,a);typeof st=="object"&&st.exports&&(st.exports=c),n&&typeof n=="object"&&(n.CryptoTickerSettingsManager=c)})(typeof self!="undefined"?self:On,function(t,a){function l(p){if(typeof He=="function")try{return He(p)}catch{return null}return null}function c(){return a&&typeof a.CryptoTickerDefaults!="undefined"?a.CryptoTickerDefaults:l("./default-settings")}let i=c();function d(){if(!i)throw new Error("Default settings module is not available");return i}function k(p){let C=d();return typeof C.applyDefaults=="function"?C.applyDefaults(p):C.defaultSettings?Object.assign({},C.defaultSettings,p||{}):Object.assign({},p||{})}function x(){let p=d();return typeof p.getDefaultSettings=="function"?p.getDefaultSettings():p.defaultSettings?JSON.parse(JSON.stringify(p.defaultSettings)):{}}let m=x();function T(p){let C=p.context,g=p.settings,P=p.updateSubscription,u=k(g);return t.setContextDetails(C,u),typeof P=="function"&&P(u),u}let f=i&&i.settingsSchema?i.settingsSchema:null;return{applyDefaultSettings:k,getDefaultSettingsSnapshot:x,defaultSettings:m,settingsSchema:f,refreshSettings:T}})});var Fn=he((Zr,Ut)=>{"use strict";var xr={TIMESTAMP_SECONDS_THRESHOLD:9999999999,DEFAULT_PRICE_BAR_POSITION:.5};(function(t,a){let l=a();if(typeof Ut=="object"&&Ut.exports)Ut.exports=l;else{let c=t.CryptoTickerConstants||{};t.CryptoTickerConstants=Object.assign({},c,l)}})(typeof globalThis!="undefined"?globalThis:self,function(){return xr})});var Bn=he((Un,Bt)=>{"use strict";(function(n,t){let a=t();typeof Bt=="object"&&Bt.exports&&(Bt.exports=a),n&&typeof n=="object"&&(n.CryptoTickerConnectionStatusIcons=a)})(typeof self!="undefined"?self:Un,function(){function t(){return{LIVE:"live",DETACHED:"detached",BACKUP:"backup",BROKEN:"broken"}}function a(c){if(!c||typeof c!="object")return t();let i=t(),d={};for(let k in i){if(!Object.prototype.hasOwnProperty.call(i,k))continue;let x=i[k],m=c[k];d[k]=typeof m=="string"&&m?m:x}return d}function l(c){let i=c.canvasContext,d=c.canvas,k=c.state,x=c.color,m=c.sizeMultiplier,T=c.position,f=c.connectionStates;if(!d||!i||!k)return;let p=a(f),C=(T||"OFF").toUpperCase();if(C==="OFF")return;let g=String(k).toLowerCase(),P=typeof m=="number"&&Number.isFinite(m)&&m>0?m:1,u=20*P,h=4*P,S=d.width-u-h,M=h;C==="BOTTOM_LEFT"&&(S=h,M=d.height-u-h),i.save(),i.translate(S,M),i.lineWidth=Math.max(1.5*P,1),i.strokeStyle=x,i.fillStyle=x;function y(O){if(!(!Array.isArray(O)||O.length===0)){i.beginPath();for(let E=0;E<O.length;E++){let B=O[E],H=B[0]*u,N=B[1]*u;E===0?i.moveTo(H,N):i.lineTo(H,N)}i.closePath(),i.fill()}}g===p.LIVE?y([[.7545784909869392,0],[.18263591551829597,.5685964091677761],[.3947756629367107,.5685964091677761],[.23171302126434715,1],[.8173281041988991,.43136761054941897],[.6051523764976793,.43136761054941897]]):g===p.DETACHED?(y([[0,.45],[.4,.45],[.4,.6],[0,.6]]),y([[.6,.45],[1,.45],[1,.6],[.6,.6]])):g===p.BACKUP?(y([[0,.3],[.4,.3],[.4,.38],[0,.38]]),y([[.6,.3],[1,.3],[1,.38],[.6,.38]]),y([[0,.62],[.4,.62],[.4,.7],[0,.7]]),y([[.6,.62],[1,.62],[1,.7],[.6,.7]])):g===p.BROKEN&&(i.save(),i.fillStyle="#ff0000",i.beginPath(),i.moveTo(u*.46,u*.32),i.lineTo(u*.42,u*.38),i.lineTo(u*.46,u*.44),i.lineTo(u*.41,u*.5),i.lineTo(u*.43,u*.88),i.lineTo(u*.3,u*.73),i.lineTo(u*.18,u*.62),i.bezierCurveTo(u*.08,u*.52,u*.08,u*.38,u*.15,u*.28),i.bezierCurveTo(u*.25,u*.16,u*.4,u*.2,u*.46,u*.32),i.closePath(),i.fill(),i.beginPath(),i.moveTo(u*.54,u*.28),i.lineTo(u*.58,u*.34),i.lineTo(u*.54,u*.4),i.lineTo(u*.59,u*.46),i.lineTo(u*.57,u*.84),i.lineTo(u*.7,u*.69),i.lineTo(u*.82,u*.58),i.bezierCurveTo(u*.92,u*.48,u*.92,u*.34,u*.85,u*.24),i.bezierCurveTo(u*.75,u*.12,u*.6,u*.16,u*.54,u*.28),i.closePath(),i.fill(),i.restore()),i.restore()}return{renderConnectionStatusIcon:l}})});var _n=he((Ln,ot)=>{"use strict";(function(n,t){let a=typeof ot=="object"&&ot.exports?[Kt(),Vt(),Nt(),Fn(),Bn()]:[n==null?void 0:n.CryptoTickerAlertManager,n==null?void 0:n.CryptoTickerFormatters,n==null?void 0:n.CryptoTickerExpressionEvaluator,n==null?void 0:n.CryptoTickerConstants,n==null?void 0:n.CryptoTickerConnectionStatusIcons],l=t(a[0],a[1],a[2],a[3],a[4]);typeof ot=="object"&&ot.exports&&(ot.exports=l),n&&typeof n=="object"&&(n.CryptoTickerCanvasRenderer=l)})(typeof self!="undefined"?self:Ln,function(n,t,a,l,c){if(!n)throw new Error("Alert manager dependency is missing");if(!t)throw new Error("Formatters dependency is missing");if(!a)throw new Error("Expression evaluator dependency is missing");let i=l||{},d=typeof i.TIMESTAMP_SECONDS_THRESHOLD=="number"?i.TIMESTAMP_SECONDS_THRESHOLD:9999999999,k=typeof i.DEFAULT_PRICE_BAR_POSITION=="number"?i.DEFAULT_PRICE_BAR_POSITION:.5;function x(){let y=a.allowedVariables.slice(0),O=["alert","backgroundColor","textColor","defaultBackgroundColor","defaultTextColor"];for(let E=0;E<O.length;E++)y.indexOf(O[E])===-1&&y.push(O[E]);return a.createEvaluator({allowedVariables:y})}let m=x(),T=c&&typeof c=="object"?c:null,f=T&&typeof T.renderConnectionStatusIcon=="function"?T.renderConnectionStatusIcon:function(){};function p(y,O){return Math.max(y/144,O/144)}function C(y){let O=parseInt(y.candlesDisplayed);return isNaN(O)?20:Math.min(60,Math.max(5,O))}function g(y,O,E,B,H){let N=Math.sqrt(.75*Math.pow(B,2));y.beginPath(),y.moveTo(O-B/2,E-N/3),y.lineTo(O+B/2,E-N/3),y.lineTo(O,E+N*2/3),y.fillStyle=H,y.fill()}function P(y,O,E,B){if(!O&&O!==0)return[""];let H=String(O).split(/\r?\n/),N=[];function Y(re){let J=re.split(""),ie=[],W="";for(let z=0;z<J.length;z++){let fe=W+J[z];y.measureText(fe).width>E&&W?(ie.push(W),W=J[z]):W=fe}return W&&ie.push(W),ie}y.font=B;for(let re=0;re<H.length;re++){let J=H[re];if(!J||J.trim()===""){N.push("");continue}let ie=J.trim().split(/\s+/),W=ie.shift()||"";for(;ie.length>0;){let z=ie.shift(),fe=W?W+" "+z:z;if(y.measureText(fe).width<=E){W=fe;continue}if(W&&N.push(W),y.measureText(z).width<=E)W=z;else{let U=Y(z);for(let q=0;q<U.length-1;q++)N.push(U[q]);W=U.length>0?U[U.length-1]:""}}W&&N.push(W)}return N.length===0&&N.push(""),N}function u(y){if(y==null)return null;let O=typeof y=="number"?y:parseFloat(y);if(!Number.isFinite(O))return null;let E=O>d?O:O*1e3,B=new Date(E);if(isNaN(B.getTime()))return null;try{return B.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}catch{return B.toISOString()}}function h(y){let O=y.canvas,E=y.canvasContext,B=y.message,H=y.backgroundColor||"#000000",N=y.textColor||"#ffffff",Y=y.font||"Lato",re=y.fontSize,J=y.connectionStates,ie=y.connectionState,W=(y.displayConnectionStatusIcon||"OFF").toUpperCase(),z=O.width,fe=O.height,U=p(z,fe),q=12*U,ve=re?re*U:Math.max(22*U,14),we="bold "+ve+"px "+Y,ye=ve*1.25;E.clearRect(0,0,z,fe),E.fillStyle=H,E.fillRect(0,0,z,fe);let pe=z-q*2,Z=P(E,B,pe,we),Te=fe-q*2;W!=="OFF"&&J&&(Te-=28*U);let X=ye*Z.length,Ee=q+(Te-X)/2+ye/2;Ee<q+ye/2&&(Ee=q+ye/2),E.fillStyle=N,E.textAlign="center",E.textBaseline="middle",E.font=we;for(let Q=0;Q<Z.length;Q++){let ee=Z[Q];ee&&E.fillText(ee,z/2,Ee+Q*ye)}W!=="OFF"&&J&&f({canvas:O,canvasContext:E,state:ie,color:N,sizeMultiplier:U,position:W,connectionStates:J})}function S(y){let O=y.canvas,E=y.canvasContext,B=y.settings||{},H=y.values||{},N=y.context,Y=y.connectionStates,re=y.connectionState,J=y.dataState||"live",ie=y.infoMessage||"",W=y.lastValidTimestamp||H.lastUpdated||null,z=O.width,fe=O.height,U=p(z,fe),q=10*U,ve=B.pair,we=B.title||H.pairDisplay||H.pair||ve||"",ye=B.multiplier||1,pe=B.priceFormat||"compact";function Z(oe,se){let ae=parseFloat(oe);return isNaN(ae)||ae<=0?se:ae}function Te(oe,se){let ae=parseInt(oe,10);return isNaN(ae)||ae<0?se:ae}let X=Te(B.digits,2),Ee=Te(B.highLowDigits,X),Q=Z(B.fontSizeBase,25),ee=Z(B.fontSizePrice,Q*35/25),Ne=Z(B.fontSizeHighLow,Q),_e=Z(B.fontSizeChange,Q*19/25),je=B.backgroundColor||"#000000",Fe=B.textColor||"#ffffff",Se=je,ce=Fe,De=re||H.connectionState||null,Ue=typeof H.last=="number"&&Number.isFinite(H.last)?H.last:null,$e=typeof H.high=="number"&&Number.isFinite(H.high)?H.high:null,Be=typeof H.low=="number"&&Number.isFinite(H.low)?H.low:null,D=typeof H.changeDailyPercent=="number"&&Number.isFinite(H.changeDailyPercent)?H.changeDailyPercent:null,e=D!==null?D*100:null,o=typeof J=="string"?J.toLowerCase():"live",b=o==="stale"?"#f6a623":o==="missing"?"#d9534f":null,w=n.evaluateAlert({context:N,settings:B,values:H,backgroundColor:Se,textColor:ce}),I=w.alertMode;Se=w.backgroundColor,ce=w.textColor;let A=a.buildContext(H,{alert:I,backgroundColor:Se,textColor:ce,defaultBackgroundColor:je,defaultTextColor:Fe});if(B.backgroundColorRule)try{let oe=m.evaluate(B.backgroundColorRule,A),se=String(oe||"").trim();se&&(Se=se,A.backgroundColor=Se)}catch(oe){console.error("Error evaluating backgroundColorRule",{context:N,expression:B.backgroundColorRule,values:H,error:oe instanceof Error?oe.message:oe})}if(B.textColorRule)try{A.textColor=ce;let oe=m.evaluate(B.textColorRule,A),se=String(oe||"").trim();se&&(ce=se,A.textColor=ce)}catch(oe){console.error("Error evaluating textColorRule",{context:N,expression:B.textColorRule,values:H,error:oe instanceof Error?oe.message:oe})}E.clearRect(0,0,z,fe),E.fillStyle=Se,E.fillRect(0,0,z,fe);let L=B.font||"Lato",j=Q*U+"px "+L;E.font=j,E.fillStyle=ce,E.textAlign="left",E.textBaseline="alphabetic";let G=25*U,ne=q;if(b){let oe=5*U,se=q+oe,ae=G-Q*U*.4;E.beginPath(),E.fillStyle=b,E.arc(se,ae,oe,0,Math.PI*2),E.fill(),E.fillStyle=ce,ne+=oe*2+6*U}if(we&&E.fillText(we,ne,G),o==="stale"){let oe=ie?ie.toUpperCase():"STALE",se=u(W),ae=se?oe+" \u2022 "+se:oe,ke=Math.max(14,Q*.6)*U;E.font=ke+"px "+L,E.fillStyle=b||ce,E.fillText(ae,ne,G+ke+4*U),E.font=j,E.fillStyle=ce}if(o!=="missing"){let oe=Ue!==null?t.getRoundedValue(Ue,X,ye,pe):"--";if(E.font="bold "+ee*U+"px "+L,E.fillStyle=ce,E.textAlign="left",E.fillText(oe,q,60*U),B.displayHighLow!=="off"){E.font=Ne*U+"px "+L,E.fillStyle=ce,E.textAlign="left";let se=Be!==null?t.getRoundedValue(Be,Ee,ye,pe):"--";E.fillText(se,q,90*U),E.textAlign="right";let ae=$e!==null?t.getRoundedValue($e,Ee,ye,pe):"--";E.fillText(ae,z-q,135*U)}if(B.displayDailyChange!=="off"&&e!==null){let se=E.fillStyle,ae=2;Math.abs(e)>=100?ae=0:Math.abs(e)>=10&&(ae=1);let ke=t.getRoundedValue(e,ae,1,"plain");e>0?(ke="+"+ke,E.fillStyle="green"):e<0?E.fillStyle="red":E.fillStyle=se,E.font=_e*U+"px "+L,E.textAlign="right",E.fillText(ke,z-q,90*U),E.fillStyle=se}if(B.displayHighLowBar!=="off"&&$e!==null&&Be!==null&&Ue!==null){let se=104*U,ae=5*U,ke=6*U,Ge=$e-Be,dt=Ge>0?Math.min(Math.max((Ue-Be)/Ge,0),1):k,Le=z-ae*2,Pe=ae+Math.round(Le*dt),gt=12*U;E.beginPath(),E.moveTo(ae,se),E.lineTo(Pe,se),E.lineWidth=ke,E.strokeStyle="green",E.stroke(),E.beginPath(),E.moveTo(Pe,se),E.lineTo(z-ae,se),E.lineWidth=ke,E.strokeStyle="red",E.stroke(),g(E,Pe,se,gt,ce)}}else{let oe=ie?ie.toUpperCase():"NO DATA",se=Math.max(26,Q)*U,ae="bold "+se+"px "+L;E.font=ae,E.fillStyle=b||ce;let ke=E.textAlign,Ge=E.textBaseline;E.textAlign="center",E.textBaseline="middle";let dt=z-q*2,Le=P(E,oe,dt,ae),Pe=se*1.1,gt=Pe*Le.length,vt=(fe-gt)/2+Pe/2;for(let Ve=0;Ve<Le.length;Ve++)E.fillText(Le[Ve],z/2,vt+Ve*Pe);E.textAlign=ke,E.textBaseline=Ge,E.font=j,E.fillStyle=ce}let ze=(B.displayConnectionStatusIcon||"OFF").toUpperCase();ze!=="OFF"&&f({canvas:O,canvasContext:E,state:De,color:ce,sizeMultiplier:U,position:ze,connectionStates:Y})}function M(y){let O=y.canvas,E=y.canvasContext,B=y.settings||{},H=y.candlesNormalized||[],N=y.connectionStates,Y=y.connectionState,re=O.width,J=O.height,ie=p(re,J),W=10*ie,z=(B.displayConnectionStatusIcon||"OFF").toUpperCase(),fe=Y||null,U=B.backgroundColor||"#000000",q=B.textColor||"#ffffff",ve=H.slice(-C(B)),we=ve.length,ye=re-2*W,pe=J-2*W,Z=we>0?ye/we:ye,Te=Math.max(2*ie,Z*.15),X=Math.max(4*ie,Z*.6);E.clearRect(0,0,re,J),E.fillStyle=U,E.fillRect(0,0,re,J);let Ee=B.font||"Lato";E.font=15*ie+"px "+Ee,E.fillStyle=q;let Q=B.candlesInterval||"1h";E.textAlign="right",E.fillText(Q,re-10*ie,J-5*ie),ve.forEach(function(ee){let Ne=Math.round(W+Math.round(ee.timePercent*ye)),_e=Math.round(W+pe-ee.highPercent*pe),je=Math.round(W+pe-ee.lowPercent*pe);E.beginPath(),E.moveTo(Ne,_e),E.lineTo(Ne,je),E.lineWidth=Te,E.strokeStyle=ee.closePercent>ee.openPercent?"#1c9900":"#a10",E.stroke();let Fe=Math.round(W+pe-ee.openPercent*pe),Se=Math.round(W+pe-ee.closePercent*pe),ce=Math.min(Fe,Se),De=Math.max(Fe,Se);E.beginPath(),E.rect(Math.round(Ne-X/2),ce,Math.round(X),Math.max(1,De-ce)),E.fillStyle=ee.closePercent>ee.openPercent?"#1c9900":"#a10",E.fill()}),z!=="OFF"&&f({canvas:O,canvasContext:E,state:fe,color:q,sizeMultiplier:ie,position:z,connectionStates:N})}return{getCanvasSizeMultiplier:p,getCandlesDisplayCount:C,renderConnectionStatusIcon:f,renderTickerCanvas:S,renderCandlesCanvas:M,renderMessageCanvas:h}})});var Vn=he((ei,en)=>{"use strict";var qn={tProxyBase:"https://tproxyv8.opendle.com",fallbackPollIntervalMs:6e4,staleTickerTimeoutMs:36e4,messages:{loading:"LOADING...",stale:"STALE",noData:"NO DATA",misconfigured:"INVALID PAIR",conversionError:"CONVERSION ERROR"}};function Oe(n){if(typeof He=="function")try{return He(n)}catch{return null}return null}function Pr(){return typeof CryptoTickerConfig!="undefined"?CryptoTickerConfig:null}function at(n){if(typeof n=="string"){let t=n.trim();return t.length===0?null:t.toUpperCase()}return n==null?null:String(n).trim().toUpperCase()||null}var Rr=Oe("./config"),Mr=Oe("./constants"),Ir=Pr(),Ie=Object.assign({},qn,Rr||{},Ir||{}),jn=Mr||(typeof CryptoTickerConstants!="undefined"?CryptoTickerConstants:null)||{},Dr=typeof jn.TIMESTAMP_SECONDS_THRESHOLD=="number"?jn.TIMESTAMP_SECONDS_THRESHOLD:9999999999,mt=Ie.tProxyBase,$n=typeof mt=="string"?mt.replace(/\/$/,""):"",Wn="_ctBust",Ar=qn.messages,Re=Object.assign({},Ar,Ie&&Ie.messages||{});function Or(n){if(!n||typeof n!="string")return n;try{let t=new URL(n);return t.searchParams.set(Wn,Date.now().toString()),t.toString()}catch{let a=n.indexOf("?")===-1?"?":"&";return n+a+Wn+"="+Date.now()}}function Hn(n,t){if(!n||typeof n!="string")return{url:n,options:t};let a=n.replace(/\/$/,"");if(!$n||a.indexOf($n)!==0)return{url:n,options:t};let l=Object.assign({},t||{});l.cache="no-store";let c=Object.assign({},l.headers||{});return c["cache-control"]="no-cache",c.pragma="no-cache",l.headers=c,{url:Or(n),options:l}}var Jt=Oe("./providers/subscription-key"),ht=typeof CryptoTickerProviders!="undefined"?CryptoTickerProviders:null,Nr=Jt&&Jt.buildSubscriptionKey?Jt.buildSubscriptionKey:ht&&typeof ht.buildSubscriptionKey=="function"?ht.buildSubscriptionKey:function(n,t,a,l){let c=n||"",i=t||"",d=a||null,k=l||null,x="";return d!==null&&k!==null&&d!==k&&(x="__"+d+"_"+k),c+"__"+i+x},Fr=Oe("./providers/connection-states"),Me=Fr||(typeof CryptoTickerConnectionStates!="undefined"?CryptoTickerConnectionStates:{LIVE:"live",DETACHED:"detached",BACKUP:"backup",BROKEN:"broken"}),Ur=Oe("./canvas-renderer"),Br=Oe("./alert-manager"),Lr=Oe("./formatters"),_r=Oe("./ticker-state"),jr=Oe("./settings-manager"),lt=Ur||(typeof CryptoTickerCanvasRenderer!="undefined"?CryptoTickerCanvasRenderer:null),Qt=Br||(typeof CryptoTickerAlertManager!="undefined"?CryptoTickerAlertManager:null),Zt=Lr||(typeof CryptoTickerFormatters!="undefined"?CryptoTickerFormatters:null),Ce=_r||(typeof CryptoTickerState!="undefined"?CryptoTickerState:null),ft=jr||(typeof CryptoTickerSettingsManager!="undefined"?CryptoTickerSettingsManager:null);if(!lt||!Qt||!Zt||!Ce||!ft)throw new Error("CryptoTicker dependencies are not available");var zn=!1,ut=null,ct,Lt,$r=!1,Wr=60*60*1e3,Xt=null,_t=ft.applyDefaultSettings,Hr=ft.defaultSettings,qr=ft.getDefaultSettingsSnapshot,zr=ft.settingsSchema,me={type:"com.courcelle.cryptoticker.ticker",log:function(...n){zn&&console.log(...n)},setContextConnectionState:function(n,t){Ce.setConnectionState(n,t)},getContextConnectionState:function(n){return Ce.getConnectionState(n)},clearContextConnectionState:function(n){Ce.clearConnectionState(n)},getProviderRegistry:function(){if(!Xt){let n=Oe("./providers/provider-registry"),t=n&&n.ProviderRegistry?n.ProviderRegistry:ht&&ht.ProviderRegistry?ht.ProviderRegistry:null;if(!t)throw new Error("ProviderRegistry is not available");Xt=new t({baseUrl:mt,logger:(...a)=>{this.log(...a)},fallbackPollIntervalMs:Ie.fallbackPollIntervalMs,staleTickerTimeoutMs:Ie.staleTickerTimeoutMs,binanceRestBaseUrl:Ie.binanceRestBaseUrl,binanceWsBaseUrl:Ie.binanceWsBaseUrl,binanceSymbolOverrides:Ie.binanceSymbolOverrides,bitfinexRestBaseUrl:Ie.bitfinexRestBaseUrl,bitfinexWsBaseUrl:Ie.bitfinexWsBaseUrl,bitfinexSymbolOverrides:Ie.bitfinexSymbolOverrides})}return Xt},websocketSend:function(n){ut&&ut.send(n)},onKeyDown:async function(n,t,a,l){switch(t.mode){case"candles":t.mode="ticker";break;case"ticker":default:Qt.shouldDisarmOnKeyPress(n)?Qt.disarmAlert(n):t.mode="candles";break}this.websocketSend(JSON.stringify({event:"setSettings",context:n,payload:t})),this.refreshTimer(n,t)},onKeyUp:function(n,t,a,l){},onWillAppear:async function(n,t,a){this.initCanvas(),this.refreshTimer(n,t)},refreshTimers:async function(){Ce.forEachContext(n=>{this.refreshTimer(n.context,n.settings)})},refreshTimer:async function(n,t){let a=this.refreshSettings(n,t);this.updateTicker(n,a)},connect:function(){let n=this.getProviderRegistry();n&&typeof n.ensureAllConnections=="function"&&n.ensureAllConnections()},updateSubscription:function(n,t){let a=t.exchange,l=t.pair,c=this.resolveConversionCurrencies(t.fromCurrency,t.currency),i=this.getSubscriptionContextKey(a,l,c.from,null),d=Ce.getSubscription(n);if(d&&d.key===i)return d;if(d&&typeof d.unsubscribe=="function"){try{d.unsubscribe()}catch(f){this.log("Error unsubscribing from provider",f)}Ce.clearSubscription(n),this.clearContextConnectionState(n)}let x=this.getProviderRegistry().getProvider(a),m={exchange:a,symbol:l,fromCurrency:c.from,toCurrency:null},T=this;try{let f=x.subscribeTicker(m,{onData:async function(p){let C=Ce.getContextDetails(n);if(C){T.setContextConnectionState(C.context,p&&p.connectionState);try{let g=await T.convertTickerValues(p,C.settings&&C.settings.fromCurrency,C.settings&&C.settings.currency);await T.updateCanvas(C.context,C.settings,g)}catch(g){T.log("Error updating canvas from subscription",g)}}},onError:function(p){T.log("Provider subscription error",p),T.setContextConnectionState(n,Me.BROKEN)}});return Ce.setSubscription(n,{key:i,unsubscribe:f&&typeof f.unsubscribe=="function"?f.unsubscribe:function(){},providerId:x.getId?x.getId():null}),Ce.getSubscription(n)}catch(f){this.log("Error subscribing to provider",f)}return null},refreshSettings:function(n,t){return ft.refreshSettings({context:n,settings:t,updateSubscription:a=>{this.updateSubscription(n,a)}})},getSubscriptionContextKey:function(n,t,a,l){return Nr(n,t,a,l)},resolveConversionCurrencies:function(n,t){let a=at(n)||"USD",l=at(t);return!l||l===a?{from:a,to:null}:{from:a,to:l}},getConversionRate:async function(n,t){let a=at(n),l=at(t);if(!a||!l||a===l)return 1;let c=a+"_"+l,i=Date.now(),d=Ce.getOrCreateConversionRateEntry(c);if(typeof d.rate=="number"&&d.rate>0&&d.fetchedAt&&i-d.fetchedAt<Wr)return d.rate;if(d.promise)try{return await d.promise}catch(f){this.log("Conversion rate promise failed",f)}let k=typeof fetch=="function"?fetch:null;if(!k)return typeof d.rate=="number"&&d.rate>0?d.rate:1;let x=(mt||"").replace(/\/$/,"");if(!x)return typeof d.rate=="number"&&d.rate>0?d.rate:1;let m=x+"/api/ticker/json/currency/"+encodeURIComponent(a)+"/"+encodeURIComponent(l),T=this;d.promise=async function(){try{let f=Hn(m),p=await k(f.url,f.options);if(!p||!p.ok)throw new Error("Conversion rate response not ok");let C=await p.json(),g=C&&C.rate!==void 0?parseFloat(C.rate):NaN;if(!g||!isFinite(g)||g<=0)throw new Error("Invalid conversion rate");return d.rate=g,d.fetchedAt=Date.now(),g}catch(f){throw T.log("Error fetching conversion rate",f),f}finally{delete d.promise}}();try{return await d.promise}catch{return typeof d.rate=="number"&&d.rate>0?d.rate:1}},convertTickerValues:async function(n,t,a){if(!n)return n;let l=this.resolveConversionCurrencies(t,a);if(!l.to)return n;let c=at(n.conversionToCurrency),i=at(n.conversionFromCurrency);if(c===l.to&&i===l.from)return n;let d=null;try{d=await this.getConversionRate(l.from,l.to)}catch(k){return this.log("Conversion rate error",k),this.createConversionErrorValues(n)}return!d||!isFinite(d)||d<=0?this.createConversionErrorValues(n):this.applyTickerConversion(n,d,l.from,l.to)},createConversionErrorValues:function(n){let t=Object.assign({},n),a=["last","high","low","open","close","changeDaily","changeDailyPercent","volume"];for(let l=0;l<a.length;l++){let c=a[l];Object.prototype.hasOwnProperty.call(t,c)&&delete t[c]}return t.conversionRate=null,t.conversionError=!0,t},applyTickerConversion:function(n,t,a,l){if(!n||typeof n!="object")return n;let c=Object.assign({},n),i=["last","high","low","open","close","changeDaily"];for(let d=0;d<i.length;d++){let k=i[d];if(!Object.prototype.hasOwnProperty.call(n,k))continue;let x=n[k],m=typeof x=="number"?x:parseFloat(x);isNaN(m)||(c[k]=m*t)}return c.conversionRate=t,c.conversionFromCurrency=a,c.conversionToCurrency=l,c},applyCandlesConversion:function(n,t){return!Array.isArray(n)||!t||!isFinite(t)||t<=0?n:n.map(function(a){if(!a||typeof a!="object")return a;let l=Object.assign({},a),c=["open","close","high","low"];for(let i=0;i<c.length;i++){let d=c[i];if(!Object.prototype.hasOwnProperty.call(a,d))continue;let k=a[d],x=typeof k=="number"?k:parseFloat(k);isNaN(x)||(l[d]=x*t)}if(Object.prototype.hasOwnProperty.call(a,"volumeQuote")){let i=a.volumeQuote,d=typeof i=="number"?i:parseFloat(i);isNaN(d)||(l.volumeQuote=d*t)}return l})},updateTicker:async function(n,t){let a=t.pair,l=await this.getTickerValue(a,t.currency,t.exchange,t.fromCurrency);this.setContextConnectionState(n,l&&l.connectionState),this.updateCanvas(n,t,l)},initCanvas:function(){ct=document.getElementById("ticker"),Lt=ct.getContext("2d")},updateCanvas:async function(n,t,a){this.log("updateCanvas",n,t,a);let l=a&&a.connectionState||this.getContextConnectionState(n);switch(t.mode){case"candles":{let c=await this.getCandles(t);this.updateCanvasCandles(n,t,c,l);break}case"ticker":default:this.updateCanvasTicker(n,t,a,l);break}},sanitizeTickerValues:function(n){if(!n||typeof n!="object")return{values:{},hasAny:!1,hasCritical:!1,timestamp:null};let t=Object.assign({},n);function a(k,x,m){if(typeof k=="number"&&Number.isFinite(k))return m?Math.round(k):k;if(typeof k=="string"){let T=k.trim();if(T){let f=m?parseInt(T,10):parseFloat(T);if(!isNaN(f)&&Number.isFinite(f))return m?Math.round(f):f}}return x}let l=a(n.last,null,!1);l===null?delete t.last:t.last=l;let c={high:null,low:null,volume:0,changeDaily:0,changeDailyPercent:0};Object.keys(c).forEach(k=>{let x=c[k],m=a(n[k],x,!1);m==null||!Number.isFinite(m)?delete t[k]:m===x&&n[k]===void 0?x===null?delete t[k]:t[k]=x:t[k]=m});let i=["lastUpdated","timestamp","time","updatedAt"],d=null;for(let k=0;k<i.length;k++){let x=i[k];if(!Object.prototype.hasOwnProperty.call(n,x))continue;let T=a(n[x],null,!0);if(T!=null){let f=T>Dr?T:T*1e3;d=f,t.lastUpdated=f;break}}return typeof t.pairDisplay!="string"&&delete t.pairDisplay,{values:t,hasAny:Object.keys(n).length>0,hasCritical:l!==null,timestamp:d}},buildTickerRenderContext:function(n,t,a,l){let c=this.sanitizeTickerValues(a),i=c.values,d=Date.now(),k="missing",x=null,m=null,T=i,f=null,p=l||i.connectionState||null,C=Ce.getLastGoodTicker(n),g=p===Me.BROKEN,u=[Me.LIVE,Me.BACKUP,Me.DETACHED].indexOf(p)!==-1,h=c.hasCritical&&Number.isFinite(i.last)&&i.last===0&&(!Number.isFinite(i.high)||i.high===0)&&(!Number.isFinite(i.low)||i.low===0)&&(!Number.isFinite(i.volume)||i.volume===0)&&c.timestamp===null,S=c.hasCritical&&(!u||g)&&h;if(!!i.conversionError){k="missing",T=Object.assign({},i);let y=t.title||i.pairDisplay||i.pair||t.pair||"";return!T.pairDisplay&&y&&(T.pairDisplay=y),x=Re.conversionError||"CONVERSION ERROR",f="conversion_error",{values:T,dataState:k,infoMessage:x,lastValidTimestamp:m,degradedReason:f}}if(c.hasCritical&&!g&&!S){let y=c.timestamp||d;i.lastUpdated=y,Ce.setLastGoodTicker(n,i,y),m=y,k="live",T=Object.assign({},i)}else if(C&&C.values&&typeof C.values=="object"&&Number.isFinite(C.values.last))k="stale",T=Object.assign({},C.values),m=C.timestamp,T.lastUpdated||(T.lastUpdated=C.timestamp),x=Re.stale,f=c.hasAny?"partial":"missing";else{k="missing",T=Object.assign({},i);let y=t.title||i.pairDisplay||i.pair||t.pair||"";!T.pairDisplay&&y&&(T.pairDisplay=y),S||g?(x=Re.misconfigured||Re.noData,f="misconfigured"):(x=Re.loading,f=c.hasAny?"partial":"none")}return!x&&k==="missing"&&(x=g?Re.misconfigured||Re.noData:Re.loading),!x&&k==="live"&&g&&(x=Re.misconfigured||Re.noData),!x&&k==="stale"&&!Re.stale&&(x="STALE"),{values:T,dataState:k,infoMessage:x,lastValidTimestamp:m,degradedReason:f}},displayMessage:function(n,t,a){this.initCanvas();let l=a||{},c=_t(l.settings||{}),i=l.backgroundColor||c.backgroundColor||"#000000",d=l.textColor||c.textColor||"#ffffff",k=l.font||c.font||"Lato",x=l.fontSize||null,m=l.connectionState||null,T=l.displayConnectionStatusIcon||c.displayConnectionStatusIcon||"OFF";m&&this.setContextConnectionState(n,m),lt.renderMessageCanvas({canvas:ct,canvasContext:Lt,message:t,backgroundColor:i,textColor:d,font:k,fontSize:x,connectionStates:Me,connectionState:m||this.getContextConnectionState(n),displayConnectionStatusIcon:T}),this.sendCanvas(n)},getCanvasSizeMultiplier:function(n,t){return lt.getCanvasSizeMultiplier(n,t)},getCandlesDisplayCount:function(n){return lt.getCandlesDisplayCount(n)},updateCanvasTicker:function(n,t,a,l){this.log("updateCanvasTicker",n,t,a);let c=this.buildTickerRenderContext(n,t,a,l);lt.renderTickerCanvas({canvas:ct,canvasContext:Lt,settings:t,values:c.values,context:n,connectionStates:Me,connectionState:l||a&&a.connectionState||null,dataState:c.dataState,infoMessage:c.infoMessage,lastValidTimestamp:c.lastValidTimestamp,degradedReason:c.degradedReason}),this.sendCanvas(n)},updateCanvasCandles:function(n,t,a,l){this.log("updateCanvasCandles",n,t,a),lt.renderCandlesCanvas({canvas:ct,canvasContext:Lt,settings:t,candlesNormalized:a,connectionStates:Me,connectionState:l||this.getContextConnectionState(n)}),this.sendCanvas(n)},sendCanvas:function(n){var t={event:"setImage",context:n,payload:{image:ct.toDataURL(),target:DestinationEnum.HARDWARE_AND_SOFTWARE}};this.websocketSend(JSON.stringify(t))},getRoundedValue:function(n,t,a,l){return Zt.getRoundedValue(n,t,a,l)},getTickerValue:async function(n,t,a,l){let i=this.getProviderRegistry().getProvider(a),d=this.resolveConversionCurrencies(l,t),k={exchange:a,symbol:n,fromCurrency:d.from,toCurrency:null};try{let x=await i.fetchTicker(k),T=await this.convertTickerValues(x,d.from,d.to)||x;return T&&typeof T=="object"&&!T.connectionState&&(T.connectionState=Me.DETACHED),T}catch(x){this.log("Error fetching ticker",x);let m=this.getSubscriptionContextKey(a,n,d.from,null);if(i&&typeof i.getCachedTicker=="function"){let T=i.getCachedTicker(m);if(T){let p=await this.convertTickerValues(T,d.from,d.to)||T;return p&&!p.connectionState&&(p.connectionState=Me.BACKUP),p}}return{changeDaily:0,changeDailyPercent:0,last:0,volume:0,high:0,low:0,pair:n,pairDisplay:n,connectionState:Me.BROKEN}}},getCandles:async function(n){this.log("getCandles");let t=n.exchange,a=n.pair,l=this.convertCandlesInterval(n.candlesInterval||"1h"),c=this.getCandlesDisplayCount(n),i=this.resolveConversionCurrencies(n.fromCurrency,n.currency),d=i.to||i.from||"",k=t+"_"+a+"_"+l+"_"+c+"_"+d,x=Ce.getCandlesCacheEntry(k);x||(x={},Ce.setCandlesCacheEntry(k,x));let m=new Date().getTime(),T="time",f="candles";if(x[T]&&x[T]>m-60*1e3)return x[f];let p={exchange:t,symbol:a,interval:l,limit:24},C=null;try{let h=this.getProviderRegistry(),S=h.getProvider(t);if(S&&typeof S.fetchCandles=="function"&&(C=await S.fetchCandles(p)),Array.isArray(C)||(C=null),C===null){let M=h.getGenericProvider();M&&typeof M.fetchCandles=="function"&&(C=await M.fetchCandles(p),Array.isArray(C)||(C=null))}}catch(h){this.log("Error fetching provider candles",h),C=null}if(C===null)try{let h=mt+"/api/Candles/json/"+t+"/"+a+"/"+l+"?limit=24",S=Hn(h),y=await(await fetch(S.url,S.options)).json();y&&Array.isArray(y.candles)&&(C=y.candles)}catch(h){this.log("Error fetching candles from proxy",h)}if(!Array.isArray(C))return x[f]||[];let g=this.prepareCandlesForDisplay(C,c),P=g;if(i.to)try{let h=await this.getConversionRate(i.from,i.to);h&&isFinite(h)&&h>0&&(P=this.applyCandlesConversion(g,h))}catch(h){this.log("Conversion rate error for candles",h)}let u=this.getCandlesNormalized(P);return x[T]=m,x[f]=u,x[f]},convertCandlesInterval:function(n){switch(n){case"1m":return"MINUTES_1";case"5m":return"MINUTES_5";case"15m":return"MINUTES_15";case"1h":return"HOURS_1";case"6h":return"HOURS_6";case"12h":return"HOURS_12";case"1D":return"DAYS_1";case"7D":return"DAYS_7";case"1M":return"MONTHS_1"}return n},prepareCandlesForDisplay:function(n,t){if(!Array.isArray(n)||n.length===0)return[];let a=n.map(function(l){if(!l)return null;let c=l.ts;if(typeof c!="number"){let i=l.openTime;if(i){let d=Date.parse(i);isNaN(d)||(c=Math.floor(d/1e3))}}return typeof c!="number"||isNaN(c)?null:{candle:l,ts:c}}).filter(function(l){return l!==null}).sort(function(l,c){return l.ts-c.ts}).map(function(l){return l.candle.ts===l.ts?l.candle:Object.assign({},l.candle,{ts:l.ts})});return typeof t=="number"&&t>0&&a.length>t?a.slice(-t):a},getCandlesNormalized:function(n){let t=Number.POSITIVE_INFINITY,a=0,l=Number.POSITIVE_INFINITY,c=0,i=Number.POSITIVE_INFINITY,d=0;(n||[]).forEach(function(m){i=Math.min(i,m.ts),d=Math.max(d,m.ts),t=Math.min(t,m.open),t=Math.min(t,m.close),t=Math.min(t,m.high),t=Math.min(t,m.low),a=Math.max(a,m.open),a=Math.max(a,m.close),a=Math.max(a,m.high),a=Math.max(a,m.low),l=Math.min(l,m.volumeQuote),c=Math.max(c,m.volumeQuote)});let k=this,x=[];return(n||[]).forEach(function(m){x.push({timePercent:k.normalizeValue(m.ts,i,d),openPercent:k.normalizeValue(m.open,t,a),closePercent:k.normalizeValue(m.close,t,a),highPercent:k.normalizeValue(m.high,t,a),lowPercent:k.normalizeValue(m.low,t,a),volumePercent:k.normalizeValue(m.volumeQuote,l,c)})}),this.log("getCandlesNormalized",x),x},normalizeValue:function(n,t,a){return Zt.normalizeValue(n,t,a)}};me.defaultSettings=Hr;me.applyDefaultSettings=_t;me.getDefaultSettings=function(){return qr()};me.settingsSchema=zr;function Vr(n,t,a,l,c){ut=new WebSocket("ws://127.0.0.1:"+n);function i(d){var k={event:a,uuid:d};me.websocketSend(JSON.stringify(k))}ut.onopen=function(){i(t)},ut.onmessage=async function(d){var k=JSON.parse(d.data);let x=k.event,m=k.context,T=k.payload||{},f=T.settings;!f&&x==="sendToPlugin"&&(f=T);let p=f,C=T.coordinates,g=T.userDesiredState;["deviceDidConnect","titleParametersDidChange"].indexOf(x)>=0||(p!=null&&(p=_t(p)),x=="keyDown"?await me.onKeyDown(m,p,C,g):x=="keyUp"?await me.onKeyUp(m,p,C,g):x=="willAppear"?await me.onWillAppear(m,p,C):p!=null&&(me.refreshSettings(m,p),me.refreshTimer(m,p)))},ut.onclose=function(){},setInterval(async function(){await me.refreshTimers()},3e5)}if($r){zn=!0,me.connect();let n=_t({digits:0,pair:"LTCUSD",mode:"ticker"}),t="test",a={column:1,row:1},l=null;setTimeout(function(){me.onWillAppear(t,n,a),setInterval(async function(){await me.onKeyDown(t,n,a,l),await me.onKeyUp(t,n,a,l)},5e3)},1e3)}typeof en!="undefined"&&(en.exports=me);typeof window!="undefined"&&(window.connectElgatoStreamDeckSocket=Vr)});var ni=be(ln()),ri=be(hn()),ii=be(Ke()),si=be(yt()),oi=be(Ye()),ai=be(Xe()),ci=be(Ze()),li=be(mn()),ui=be(Mt()),hi=be(Ht()),fi=be(qt()),pi=be(zt()),di=be(Tn()),gi=be(Vt()),bi=be(Nt()),yi=be(Kt()),mi=be(Yt()),vi=be(Nn()),Ci=be(_n()),wi=be(Vn());var Gn=typeof window!="undefined"?window:globalThis,pt=typeof CryptoTickerDefaults!="undefined"?CryptoTickerDefaults:null,xe=typeof tickerAction!="undefined"?tickerAction:null;if(!xe)throw new Error("Ticker action dependency is missing for the preview page");var Gr=pt&&typeof pt.getDefaultSettings=="function"?pt.getDefaultSettings():typeof xe.getDefaultSettings=="function"?xe.getDefaultSettings():{},Kr=pt&&typeof pt.applyDefaults=="function"?function(n){return pt.applyDefaults(n||{})}:function(n){return Object.assign({},Gr,n||{})};xe.sendCanvas=function(){};function Kn(n){if(Gn.canvas=n,Gn.canvasContext=n.getContext("2d"),xe&&typeof xe.initCanvas=="function"&&typeof document!="undefined"){let t=document.getElementById.bind(document);document.getElementById=function(a){return a==="ticker"?n:t(a)};try{xe.initCanvas()}finally{document.getElementById=t}}}function Yr(n){let t=[],a=n.high||0,l=n.low||0,c=n.volume||0,i=a-l||1,d=20;for(let k=0;k<d;k++){let x=l+i*k/d,m=l+i*(k+.5)/d,T=Math.max(x,m)+i*.05,f=Math.min(x,m)-i*.05;t.push({ts:k,open:x,close:m,high:T,low:f,volumeQuote:c})}return xe.getCandlesNormalized(t)}async function Yn(){let n=document.getElementById("precomputedToggle").checked,a=await(await fetch("/dev/options.json")).json(),l=document.getElementById("previews");l.innerHTML="";for(let c=0;c<a.length;c++){let i=a[c],d=document.createElement("div");d.className="preview-group";let k=document.createElement("div");k.className="canvas-row";let x=document.createElement("canvas");x.width=288,x.height=288,k.appendChild(x);let m=document.createElement("canvas");m.width=288,m.height=288,k.appendChild(m),d.appendChild(k);let T=document.createElement("div");T.className="label",T.textContent=i.name||"Option "+(c+1),d.appendChild(T);let f=Kr(i.settings),p=document.createElement("pre");p.className="settings",p.textContent=JSON.stringify(f,null,4),d.appendChild(p),l.appendChild(d),Kn(x);let C;n&&i.values?C=i.values:C=await xe.getTickerValue(f.pair,f.currency,f.exchange),xe.updateCanvasTicker(c+"-ticker",f,C,C&&C.connectionState),Kn(m);let g;n&&i.values?g=Yr(i.values):g=await xe.getCandles(f),xe.updateCanvasCandles(c+"-candles",f,g,C&&C.connectionState)}}document.getElementById("precomputedToggle").addEventListener("change",Yn);Yn();})();
