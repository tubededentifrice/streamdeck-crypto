"use strict";(()=>{var pr=Object.create;var an=Object.defineProperty;var dr=Object.getOwnPropertyDescriptor;var gr=Object.getOwnPropertyNames;var br=Object.getPrototypeOf,yr=Object.prototype.hasOwnProperty;var He=(r=>typeof require!="undefined"?require:typeof Proxy!="undefined"?new Proxy(r,{get:(t,c)=>(typeof require!="undefined"?require:t)[c]}):r)(function(r){if(typeof require!="undefined")return require.apply(this,arguments);throw Error('Dynamic require of "'+r+'" is not supported')});var he=(r,t)=>()=>(t||r((t={exports:{}}).exports,t),t.exports);var mr=(r,t,c,u)=>{if(t&&typeof t=="object"||typeof t=="function")for(let l of gr(t))!yr.call(r,l)&&l!==c&&an(r,l,{get:()=>t[l],enumerable:!(u=dr(t,l))||u.enumerable});return r};var be=(r,t,c)=>(c=r!=null?pr(br(r)):{},mr(t||!r||!r.__esModule?an(c,"default",{value:r,enumerable:!0}):c,r));var ln=he((wt,jt)=>{"use strict";var cn,gt;cn=self,gt=()=>(()=>{var r={d:(I,e)=>{for(var a in e)r.o(e,a)&&!r.o(I,a)&&Object.defineProperty(I,a,{enumerable:!0,get:e[a]})}};r.g=function(){if(typeof globalThis=="object")return globalThis;try{return this||new Function("return this")()}catch{if(typeof window=="object")return window}}(),r.o=(I,e)=>Object.prototype.hasOwnProperty.call(I,e),r.r=I=>{typeof Symbol!="undefined"&&Symbol.toStringTag&&Object.defineProperty(I,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(I,"t",{value:!0})};var t,c={};r.r(c),r.d(c,{AbortError:()=>i,DefaultHttpClient:()=>$,HttpClient:()=>s,HttpError:()=>u,HttpResponse:()=>d,HttpTransportType:()=>Q,HubConnection:()=>pe,HubConnectionBuilder:()=>Be,HubConnectionState:()=>H,JsonHubProtocol:()=>Ue,LogLevel:()=>t,MessageType:()=>U,NullLogger:()=>g,Subject:()=>ve,TimeoutError:()=>l,TransferFormat:()=>ee,VERSION:()=>R});class u extends Error{constructor(e,a){let b=new.target.prototype;super(`${e}: Status code '${a}'`),this.statusCode=a,this.__proto__=b}}class l extends Error{constructor(e="A timeout occurred."){let a=new.target.prototype;super(e),this.__proto__=a}}class i extends Error{constructor(e="An abort occurred."){let a=new.target.prototype;super(e),this.__proto__=a}}class f extends Error{constructor(e,a){let b=new.target.prototype;super(e),this.transport=a,this.errorType="UnsupportedTransportError",this.__proto__=b}}class w extends Error{constructor(e,a){let b=new.target.prototype;super(e),this.transport=a,this.errorType="DisabledTransportError",this.__proto__=b}}class E extends Error{constructor(e,a){let b=new.target.prototype;super(e),this.transport=a,this.errorType="FailedToStartTransportError",this.__proto__=b}}class y extends Error{constructor(e){let a=new.target.prototype;super(e),this.errorType="FailedToNegotiateWithServerError",this.__proto__=a}}class S extends Error{constructor(e,a){let b=new.target.prototype;super(e),this.innerErrors=a,this.__proto__=b}}class d{constructor(e,a,b){this.statusCode=e,this.statusText=a,this.content=b}}class s{get(e,a){return this.send({...a,method:"GET",url:e})}post(e,a){return this.send({...a,method:"POST",url:e})}delete(e,a){return this.send({...a,method:"DELETE",url:e})}getCookieString(e){return""}}(function(I){I[I.Trace=0]="Trace",I[I.Debug=1]="Debug",I[I.Information=2]="Information",I[I.Warning=3]="Warning",I[I.Error=4]="Error",I[I.Critical=5]="Critical",I[I.None=6]="None"})(t||(t={}));class g{constructor(){}log(e,a){}}g.instance=new g;let R="8.0.0";class A{static isRequired(e,a){if(e==null)throw new Error(`The '${a}' argument is required.`)}static isNotEmpty(e,a){if(!e||e.match(/^\s*$/))throw new Error(`The '${a}' argument should not be empty.`)}static isIn(e,a,b){if(!(e in a))throw new Error(`Unknown ${b} value: ${e}.`)}}class h{static get isBrowser(){return!h.isNode&&typeof window=="object"&&typeof window.document=="object"}static get isWebWorker(){return!h.isNode&&typeof self=="object"&&"importScripts"in self}static get isReactNative(){return!h.isNode&&typeof window=="object"&&window.document===void 0}static get isNode(){return typeof process!="undefined"&&process.release&&process.release.name==="node"}}function p(I,e){let a="";return k(I)?(a=`Binary data of length ${I.byteLength}`,e&&(a+=`. Content: '${function(b){let C=new Uint8Array(b),M="";return C.forEach(D=>{M+=`0x${D<16?"0":""}${D.toString(16)} `}),M.substr(0,M.length-1)}(I)}'`)):typeof I=="string"&&(a=`String data of length ${I.length}`,e&&(a+=`. Content: '${I}'`)),a}function k(I){return I&&typeof ArrayBuffer!="undefined"&&(I instanceof ArrayBuffer||I.constructor&&I.constructor.name==="ArrayBuffer")}async function x(I,e,a,b,C,M){let D={},[B,W]=T();D[B]=W,I.log(t.Trace,`(${e} transport) sending data. ${p(C,M.logMessageContent)}.`);let G=k(C)?"arraybuffer":"text",ne=await a.post(b,{content:C,headers:{...D,...M.headers},responseType:G,timeout:M.timeout,withCredentials:M.withCredentials});I.log(t.Trace,`(${e} transport) request complete. Response status: ${ne.statusCode}.`)}class m{constructor(e,a){this.i=e,this.h=a}dispose(){let e=this.i.observers.indexOf(this.h);e>-1&&this.i.observers.splice(e,1),this.i.observers.length===0&&this.i.cancelCallback&&this.i.cancelCallback().catch(a=>{})}}class O{constructor(e){this.l=e,this.out=console}log(e,a){if(e>=this.l){let b=`[${new Date().toISOString()}] ${t[e]}: ${a}`;switch(e){case t.Critical:case t.Error:this.out.error(b);break;case t.Warning:this.out.warn(b);break;case t.Information:this.out.info(b);break;default:this.out.log(b)}}}}function T(){let I="X-SignalR-User-Agent";return h.isNode&&(I="User-Agent"),[I,L(R,V(),h.isNode?"NodeJS":"Browser",N())]}function L(I,e,a,b){let C="Microsoft SignalR/",M=I.split(".");return C+=`${M[0]}.${M[1]}`,C+=` (${I}; `,C+=e&&e!==""?`${e}; `:"Unknown OS; ",C+=`${a}`,C+=b?`; ${b}`:"; Unknown Runtime Version",C+=")",C}function V(){if(!h.isNode)return"";switch(process.platform){case"win32":return"Windows NT";case"darwin":return"macOS";case"linux":return"Linux";default:return process.platform}}function N(){if(h.isNode)return process.versions.node}function X(I){return I.stack?I.stack:I.message?I.message:`${I}`}class ae extends s{constructor(e){super(),this.u=e,this.p=fetch.bind(function(){if(typeof globalThis!="undefined")return globalThis;if(typeof self!="undefined")return self;if(typeof window!="undefined")return window;if(r.g!==void 0)return r.g;throw new Error("could not find global")}()),this.m=AbortController,this.m}async send(e){if(e.abortSignal&&e.abortSignal.aborted)throw new i;if(!e.method)throw new Error("No method defined.");if(!e.url)throw new Error("No url defined.");let a=new this.m,b;e.abortSignal&&(e.abortSignal.onabort=()=>{a.abort(),b=new i});let C,M=null;if(e.timeout){let W=e.timeout;M=setTimeout(()=>{a.abort(),this.u.log(t.Warning,"Timeout from HTTP request."),b=new l},W)}e.content===""&&(e.content=void 0),e.content&&(e.headers=e.headers||{},k(e.content)?e.headers["Content-Type"]="application/octet-stream":e.headers["Content-Type"]="text/plain;charset=UTF-8");try{C=await this.p(e.url,{body:e.content,cache:"no-cache",credentials:e.withCredentials===!0?"include":"same-origin",headers:{"X-Requested-With":"XMLHttpRequest",...e.headers},method:e.method,mode:"cors",redirect:"follow",signal:a.signal})}catch(W){throw b||(this.u.log(t.Warning,`Error from HTTP request. ${W}.`),W)}finally{M&&clearTimeout(M),e.abortSignal&&(e.abortSignal.onabort=null)}if(!C.ok){let W=await J(C,"text");throw new u(W||C.statusText,C.status)}let D=J(C,e.responseType),B=await D;return new d(C.status,C.statusText,B)}getCookieString(e){let a="";return h.isNode&&this.v&&this.v.getCookies(e,(b,C)=>a=C.join("; ")),a}}function J(I,e){let a;switch(e){case"arraybuffer":a=I.arrayBuffer();break;case"text":default:a=I.text();break;case"blob":case"document":case"json":throw new Error(`${e} is not supported.`)}return a}class re extends s{constructor(e){super(),this.u=e}send(e){return e.abortSignal&&e.abortSignal.aborted?Promise.reject(new i):e.method?e.url?new Promise((a,b)=>{let C=new XMLHttpRequest;C.open(e.method,e.url,!0),C.withCredentials=e.withCredentials===void 0||e.withCredentials,C.setRequestHeader("X-Requested-With","XMLHttpRequest"),e.content===""&&(e.content=void 0),e.content&&(k(e.content)?C.setRequestHeader("Content-Type","application/octet-stream"):C.setRequestHeader("Content-Type","text/plain;charset=UTF-8"));let M=e.headers;M&&Object.keys(M).forEach(D=>{C.setRequestHeader(D,M[D])}),e.responseType&&(C.responseType=e.responseType),e.abortSignal&&(e.abortSignal.onabort=()=>{C.abort(),b(new i)}),e.timeout&&(C.timeout=e.timeout),C.onload=()=>{e.abortSignal&&(e.abortSignal.onabort=null),C.status>=200&&C.status<300?a(new d(C.status,C.statusText,C.response||C.responseText)):b(new u(C.response||C.responseText||C.statusText,C.status))},C.onerror=()=>{this.u.log(t.Warning,`Error from HTTP request. ${C.status}: ${C.statusText}.`),b(new u(C.statusText,C.status))},C.ontimeout=()=>{this.u.log(t.Warning,"Timeout from HTTP request."),b(new l)},C.send(e.content)}):Promise.reject(new Error("No url defined.")):Promise.reject(new Error("No method defined."))}}class $ extends s{constructor(e){if(super(),typeof fetch!="undefined"||h.isNode)this.$=new ae(e);else{if(typeof XMLHttpRequest=="undefined")throw new Error("No usable HttpClient found.");this.$=new re(e)}}send(e){return e.abortSignal&&e.abortSignal.aborted?Promise.reject(new i):e.method?e.url?this.$.send(e):Promise.reject(new Error("No url defined.")):Promise.reject(new Error("No method defined."))}getCookieString(e){return this.$.getCookieString(e)}}class z{static write(e){return`${e}${z.RecordSeparator}`}static parse(e){if(e[e.length-1]!==z.RecordSeparator)throw new Error("Message is incomplete.");let a=e.split(z.RecordSeparator);return a.pop(),a}}z.RecordSeparatorCode=30,z.RecordSeparator=String.fromCharCode(z.RecordSeparatorCode);class fe{writeHandshakeRequest(e){return z.write(JSON.stringify(e))}parseHandshakeResponse(e){let a,b;if(k(e)){let D=new Uint8Array(e),B=D.indexOf(z.RecordSeparatorCode);if(B===-1)throw new Error("Message is incomplete.");let W=B+1;a=String.fromCharCode.apply(null,Array.prototype.slice.call(D.slice(0,W))),b=D.byteLength>W?D.slice(W).buffer:null}else{let D=e,B=D.indexOf(z.RecordSeparator);if(B===-1)throw new Error("Message is incomplete.");let W=B+1;a=D.substring(0,W),b=D.length>W?D.substring(W):null}let C=z.parse(a),M=JSON.parse(C[0]);if(M.type)throw new Error("Expected a handshake response from the server.");return[b,M]}}var U,H;(function(I){I[I.Invocation=1]="Invocation",I[I.StreamItem=2]="StreamItem",I[I.Completion=3]="Completion",I[I.StreamInvocation=4]="StreamInvocation",I[I.CancelInvocation=5]="CancelInvocation",I[I.Ping=6]="Ping",I[I.Close=7]="Close",I[I.Ack=8]="Ack",I[I.Sequence=9]="Sequence"})(U||(U={}));class ve{constructor(){this.observers=[]}next(e){for(let a of this.observers)a.next(e)}error(e){for(let a of this.observers)a.error&&a.error(e)}complete(){for(let e of this.observers)e.complete&&e.complete()}subscribe(e){return this.observers.push(e),new m(this,e)}}class Ce{constructor(e,a,b){this.C=1e5,this.S=[],this.k=0,this.P=!1,this.T=1,this.I=0,this._=0,this.H=!1,this.D=e,this.R=a,this.C=b}async A(e){let a=this.D.writeMessage(e),b=Promise.resolve();if(this.U(e)){this.k++;let C=()=>{},M=()=>{};k(a)?this._+=a.byteLength:this._+=a.length,this._>=this.C&&(b=new Promise((D,B)=>{C=D,M=B})),this.S.push(new ye(a,this.k,C,M))}try{this.H||await this.R.send(a)}catch{this.L()}await b}N(e){let a=-1;for(let b=0;b<this.S.length;b++){let C=this.S[b];if(C.q<=e.sequenceId)a=b,k(C.M)?this._-=C.M.byteLength:this._-=C.M.length,C.j();else{if(!(this._<this.C))break;C.j()}}a!==-1&&(this.S=this.S.slice(a+1))}W(e){if(this.P)return e.type===U.Sequence&&(this.P=!1,!0);if(!this.U(e))return!0;let a=this.T;return this.T++,a<=this.I?(a===this.I&&this.O(),!1):(this.I=a,this.O(),!0)}F(e){e.sequenceId>this.T?this.R.stop(new Error("Sequence ID greater than amount of messages we've received.")):this.T=e.sequenceId}L(){this.H=!0,this.P=!0}async B(){let e=this.S.length!==0?this.S[0].q:this.k+1;await this.R.send(this.D.writeMessage({type:U.Sequence,sequenceId:e}));let a=this.S;for(let b of a)await this.R.send(b.M);this.H=!1}X(e){e!=null||(e=new Error("Unable to reconnect to server."));for(let a of this.S)a.J(e)}U(e){switch(e.type){case U.Invocation:case U.StreamItem:case U.Completion:case U.StreamInvocation:case U.CancelInvocation:return!0;case U.Close:case U.Sequence:case U.Ping:case U.Ack:return!1}}O(){this.V===void 0&&(this.V=setTimeout(async()=>{try{this.H||await this.R.send(this.D.writeMessage({type:U.Ack,sequenceId:this.I}))}catch{}clearTimeout(this.V),this.V=void 0},1e3))}}class ye{constructor(e,a,b,C){this.M=e,this.q=a,this.j=b,this.J=C}}(function(I){I.Disconnected="Disconnected",I.Connecting="Connecting",I.Connected="Connected",I.Disconnecting="Disconnecting",I.Reconnecting="Reconnecting"})(H||(H={}));class pe{static create(e,a,b,C,M,D,B){return new pe(e,a,b,C,M,D,B)}constructor(e,a,b,C,M,D,B){this.K=0,this.G=()=>{this.u.log(t.Warning,"The page is being frozen, this will likely lead to the connection being closed and messages being lost. For more information see the docs at https://learn.microsoft.com/aspnet/core/signalr/javascript-client#bsleep")},A.isRequired(e,"connection"),A.isRequired(a,"logger"),A.isRequired(b,"protocol"),this.serverTimeoutInMilliseconds=M!=null?M:3e4,this.keepAliveIntervalInMilliseconds=D!=null?D:15e3,this.Y=B!=null?B:1e5,this.u=a,this.D=b,this.connection=e,this.Z=C,this.tt=new fe,this.connection.onreceive=W=>this.et(W),this.connection.onclose=W=>this.st(W),this.it={},this.nt={},this.rt=[],this.ot=[],this.ht=[],this.ct=0,this.lt=!1,this.ut=H.Disconnected,this.dt=!1,this.ft=this.D.writeMessage({type:U.Ping})}get state(){return this.ut}get connectionId(){return this.connection&&this.connection.connectionId||null}get baseUrl(){return this.connection.baseUrl||""}set baseUrl(e){if(this.ut!==H.Disconnected&&this.ut!==H.Reconnecting)throw new Error("The HubConnection must be in the Disconnected or Reconnecting state to change the url.");if(!e)throw new Error("The HubConnection url must be a valid url.");this.connection.baseUrl=e}start(){return this.wt=this.gt(),this.wt}async gt(){if(this.ut!==H.Disconnected)return Promise.reject(new Error("Cannot start a HubConnection that is not in the 'Disconnected' state."));this.ut=H.Connecting,this.u.log(t.Debug,"Starting HubConnection.");try{await this.yt(),h.isBrowser&&window.document.addEventListener("freeze",this.G),this.ut=H.Connected,this.dt=!0,this.u.log(t.Debug,"HubConnection connected successfully.")}catch(e){return this.ut=H.Disconnected,this.u.log(t.Debug,`HubConnection failed to start successfully because of error '${e}'.`),Promise.reject(e)}}async yt(){this.bt=void 0,this.lt=!1;let e=new Promise((a,b)=>{this.vt=a,this.Et=b});await this.connection.start(this.D.transferFormat);try{let a=this.D.version;this.connection.features.reconnect||(a=1);let b={protocol:this.D.name,version:a};if(this.u.log(t.Debug,"Sending handshake request."),await this.$t(this.tt.writeHandshakeRequest(b)),this.u.log(t.Information,`Using HubProtocol '${this.D.name}'.`),this.Ct(),this.St(),this.kt(),await e,this.bt)throw this.bt;this.connection.features.reconnect&&(this.Pt=new Ce(this.D,this.connection,this.Y),this.connection.features.disconnected=this.Pt.L.bind(this.Pt),this.connection.features.resend=()=>{if(this.Pt)return this.Pt.B()}),this.connection.features.inherentKeepAlive||await this.$t(this.ft)}catch(a){throw this.u.log(t.Debug,`Hub handshake failed with error '${a}' during start(). Stopping HubConnection.`),this.Ct(),this.Tt(),await this.connection.stop(a),a}}async stop(){let e=this.wt;this.connection.features.reconnect=!1,this.It=this._t(),await this.It;try{await e}catch{}}_t(e){if(this.ut===H.Disconnected)return this.u.log(t.Debug,`Call to HubConnection.stop(${e}) ignored because it is already in the disconnected state.`),Promise.resolve();if(this.ut===H.Disconnecting)return this.u.log(t.Debug,`Call to HttpConnection.stop(${e}) ignored because the connection is already in the disconnecting state.`),this.It;let a=this.ut;return this.ut=H.Disconnecting,this.u.log(t.Debug,"Stopping HubConnection."),this.Ht?(this.u.log(t.Debug,"Connection stopped during reconnect delay. Done reconnecting."),clearTimeout(this.Ht),this.Ht=void 0,this.Dt(),Promise.resolve()):(a===H.Connected&&this.Rt(),this.Ct(),this.Tt(),this.bt=e||new i("The connection was stopped before the hub handshake could complete."),this.connection.stop(e))}async Rt(){try{await this.xt(this.At())}catch{}}stream(e,...a){let[b,C]=this.Ut(a),M=this.Lt(e,a,C),D,B=new ve;return B.cancelCallback=()=>{let W=this.Nt(M.invocationId);return delete this.it[M.invocationId],D.then(()=>this.xt(W))},this.it[M.invocationId]=(W,G)=>{G?B.error(G):W&&(W.type===U.Completion?W.error?B.error(new Error(W.error)):B.complete():B.next(W.item))},D=this.xt(M).catch(W=>{B.error(W),delete this.it[M.invocationId]}),this.qt(b,D),B}$t(e){return this.kt(),this.connection.send(e)}xt(e){return this.Pt?this.Pt.A(e):this.$t(this.D.writeMessage(e))}send(e,...a){let[b,C]=this.Ut(a),M=this.xt(this.Mt(e,a,!0,C));return this.qt(b,M),M}invoke(e,...a){let[b,C]=this.Ut(a),M=this.Mt(e,a,!1,C);return new Promise((D,B)=>{this.it[M.invocationId]=(G,ne)=>{ne?B(ne):G&&(G.type===U.Completion?G.error?B(new Error(G.error)):D(G.result):B(new Error(`Unexpected message type: ${G.type}`)))};let W=this.xt(M).catch(G=>{B(G),delete this.it[M.invocationId]});this.qt(b,W)})}on(e,a){e&&a&&(e=e.toLowerCase(),this.nt[e]||(this.nt[e]=[]),this.nt[e].indexOf(a)===-1&&this.nt[e].push(a))}off(e,a){if(!e)return;e=e.toLowerCase();let b=this.nt[e];if(b)if(a){let C=b.indexOf(a);C!==-1&&(b.splice(C,1),b.length===0&&delete this.nt[e])}else delete this.nt[e]}onclose(e){e&&this.rt.push(e)}onreconnecting(e){e&&this.ot.push(e)}onreconnected(e){e&&this.ht.push(e)}et(e){if(this.Ct(),this.lt||(e=this.jt(e),this.lt=!0),e){let a=this.D.parseMessages(e,this.u);for(let b of a)if(!this.Pt||this.Pt.W(b))switch(b.type){case U.Invocation:this.Wt(b);break;case U.StreamItem:case U.Completion:{let C=this.it[b.invocationId];if(C){b.type===U.Completion&&delete this.it[b.invocationId];try{C(b)}catch(M){this.u.log(t.Error,`Stream callback threw error: ${X(M)}`)}}break}case U.Ping:break;case U.Close:{this.u.log(t.Information,"Close message received from server.");let C=b.error?new Error("Server returned an error on close: "+b.error):void 0;b.allowReconnect===!0?this.connection.stop(C):this.It=this._t(C);break}case U.Ack:this.Pt&&this.Pt.N(b);break;case U.Sequence:this.Pt&&this.Pt.F(b);break;default:this.u.log(t.Warning,`Invalid message type: ${b.type}.`)}}this.St()}jt(e){let a,b;try{[b,a]=this.tt.parseHandshakeResponse(e)}catch(C){let M="Error parsing handshake response: "+C;this.u.log(t.Error,M);let D=new Error(M);throw this.Et(D),D}if(a.error){let C="Server returned handshake error: "+a.error;this.u.log(t.Error,C);let M=new Error(C);throw this.Et(M),M}return this.u.log(t.Debug,"Server handshake complete."),this.vt(),b}kt(){this.connection.features.inherentKeepAlive||(this.K=new Date().getTime()+this.keepAliveIntervalInMilliseconds,this.Tt())}St(){if(!(this.connection.features&&this.connection.features.inherentKeepAlive||(this.Ot=setTimeout(()=>this.serverTimeout(),this.serverTimeoutInMilliseconds),this.Ft!==void 0))){let e=this.K-new Date().getTime();e<0&&(e=0),this.Ft=setTimeout(async()=>{if(this.ut===H.Connected)try{await this.$t(this.ft)}catch{this.Tt()}},e)}}serverTimeout(){this.connection.stop(new Error("Server timeout elapsed without receiving a message from the server."))}async Wt(e){let a=e.target.toLowerCase(),b=this.nt[a];if(!b)return this.u.log(t.Warning,`No client method with the name '${a}' found.`),void(e.invocationId&&(this.u.log(t.Warning,`No result given for '${a}' method and invocation ID '${e.invocationId}'.`),await this.xt(this.Bt(e.invocationId,"Client didn't provide a result.",null))));let C=b.slice(),M=!!e.invocationId,D,B,W;for(let G of C)try{let ne=D;D=await G.apply(this,e.arguments),M&&D&&ne&&(this.u.log(t.Error,`Multiple results provided for '${a}'. Sending error to server.`),W=this.Bt(e.invocationId,"Client provided multiple results.",null)),B=void 0}catch(ne){B=ne,this.u.log(t.Error,`A callback for the method '${a}' threw error '${ne}'.`)}W?await this.xt(W):M?(B?W=this.Bt(e.invocationId,`${B}`,null):D!==void 0?W=this.Bt(e.invocationId,null,D):(this.u.log(t.Warning,`No result given for '${a}' method and invocation ID '${e.invocationId}'.`),W=this.Bt(e.invocationId,"Client didn't provide a result.",null)),await this.xt(W)):D&&this.u.log(t.Error,`Result given for '${a}' method but server is not expecting a result.`)}st(e){this.u.log(t.Debug,`HubConnection.connectionClosed(${e}) called while in state ${this.ut}.`),this.bt=this.bt||e||new i("The underlying connection was closed before the hub handshake could complete."),this.vt&&this.vt(),this.Xt(e||new Error("Invocation canceled due to the underlying connection being closed.")),this.Ct(),this.Tt(),this.ut===H.Disconnecting?this.Dt(e):this.ut===H.Connected&&this.Z?this.Jt(e):this.ut===H.Connected&&this.Dt(e)}Dt(e){if(this.dt){this.ut=H.Disconnected,this.dt=!1,this.Pt&&(this.Pt.X(e!=null?e:new Error("Connection closed.")),this.Pt=void 0),h.isBrowser&&window.document.removeEventListener("freeze",this.G);try{this.rt.forEach(a=>a.apply(this,[e]))}catch(a){this.u.log(t.Error,`An onclose callback called with error '${e}' threw error '${a}'.`)}}}async Jt(e){let a=Date.now(),b=0,C=e!==void 0?e:new Error("Attempting to reconnect due to a unknown error."),M=this.zt(b++,0,C);if(M===null)return this.u.log(t.Debug,"Connection not reconnecting because the IRetryPolicy returned null on the first reconnect attempt."),void this.Dt(e);if(this.ut=H.Reconnecting,e?this.u.log(t.Information,`Connection reconnecting because of error '${e}'.`):this.u.log(t.Information,"Connection reconnecting."),this.ot.length!==0){try{this.ot.forEach(D=>D.apply(this,[e]))}catch(D){this.u.log(t.Error,`An onreconnecting callback called with error '${e}' threw error '${D}'.`)}if(this.ut!==H.Reconnecting)return void this.u.log(t.Debug,"Connection left the reconnecting state in onreconnecting callback. Done reconnecting.")}for(;M!==null;){if(this.u.log(t.Information,`Reconnect attempt number ${b} will start in ${M} ms.`),await new Promise(D=>{this.Ht=setTimeout(D,M)}),this.Ht=void 0,this.ut!==H.Reconnecting)return void this.u.log(t.Debug,"Connection left the reconnecting state during reconnect delay. Done reconnecting.");try{if(await this.yt(),this.ut=H.Connected,this.u.log(t.Information,"HubConnection reconnected successfully."),this.ht.length!==0)try{this.ht.forEach(D=>D.apply(this,[this.connection.connectionId]))}catch(D){this.u.log(t.Error,`An onreconnected callback called with connectionId '${this.connection.connectionId}; threw error '${D}'.`)}return}catch(D){if(this.u.log(t.Information,`Reconnect attempt failed because of error '${D}'.`),this.ut!==H.Reconnecting)return this.u.log(t.Debug,`Connection moved to the '${this.ut}' from the reconnecting state during reconnect attempt. Done reconnecting.`),void(this.ut===H.Disconnecting&&this.Dt());C=D instanceof Error?D:new Error(D.toString()),M=this.zt(b++,Date.now()-a,C)}}this.u.log(t.Information,`Reconnect retries have been exhausted after ${Date.now()-a} ms and ${b} failed attempts. Connection disconnecting.`),this.Dt()}zt(e,a,b){try{return this.Z.nextRetryDelayInMilliseconds({elapsedMilliseconds:a,previousRetryCount:e,retryReason:b})}catch(C){return this.u.log(t.Error,`IRetryPolicy.nextRetryDelayInMilliseconds(${e}, ${a}) threw error '${C}'.`),null}}Xt(e){let a=this.it;this.it={},Object.keys(a).forEach(b=>{let C=a[b];try{C(null,e)}catch(M){this.u.log(t.Error,`Stream 'error' callback called with '${e}' threw error: ${X(M)}`)}})}Tt(){this.Ft&&(clearTimeout(this.Ft),this.Ft=void 0)}Ct(){this.Ot&&clearTimeout(this.Ot)}Mt(e,a,b,C){if(b)return C.length!==0?{arguments:a,streamIds:C,target:e,type:U.Invocation}:{arguments:a,target:e,type:U.Invocation};{let M=this.ct;return this.ct++,C.length!==0?{arguments:a,invocationId:M.toString(),streamIds:C,target:e,type:U.Invocation}:{arguments:a,invocationId:M.toString(),target:e,type:U.Invocation}}}qt(e,a){if(e.length!==0){a||(a=Promise.resolve());for(let b in e)e[b].subscribe({complete:()=>{a=a.then(()=>this.xt(this.Bt(b)))},error:C=>{let M;M=C instanceof Error?C.message:C&&C.toString?C.toString():"Unknown error",a=a.then(()=>this.xt(this.Bt(b,M)))},next:C=>{a=a.then(()=>this.xt(this.Vt(b,C)))}})}}Ut(e){let a=[],b=[];for(let C=0;C<e.length;C++){let M=e[C];if(this.Kt(M)){let D=this.ct;this.ct++,a[D]=M,b.push(D.toString()),e.splice(C,1)}}return[a,b]}Kt(e){return e&&e.subscribe&&typeof e.subscribe=="function"}Lt(e,a,b){let C=this.ct;return this.ct++,b.length!==0?{arguments:a,invocationId:C.toString(),streamIds:b,target:e,type:U.StreamInvocation}:{arguments:a,invocationId:C.toString(),target:e,type:U.StreamInvocation}}Nt(e){return{invocationId:e,type:U.CancelInvocation}}Vt(e,a){return{invocationId:e,item:a,type:U.StreamItem}}Bt(e,a,b){return a?{error:a,invocationId:e,type:U.Completion}:{invocationId:e,result:b,type:U.Completion}}At(){return{type:U.Close}}}let Z=[0,2e3,1e4,3e4,null];class Te{constructor(e){this.Gt=e!==void 0?[...e,null]:Z}nextRetryDelayInMilliseconds(e){return this.Gt[e.previousRetryCount]}}class Y{}Y.Authorization="Authorization",Y.Cookie="Cookie";class Ee extends s{constructor(e,a){super(),this.Qt=e,this.Yt=a}async send(e){let a=!0;this.Yt&&(!this.Zt||e.url&&e.url.indexOf("/negotiate?")>0)&&(a=!1,this.Zt=await this.Yt()),this.te(e);let b=await this.Qt.send(e);return a&&b.statusCode===401&&this.Yt?(this.Zt=await this.Yt(),this.te(e),await this.Qt.send(e)):b}te(e){e.headers||(e.headers={}),this.Zt?e.headers[Y.Authorization]=`Bearer ${this.Zt}`:this.Yt&&e.headers[Y.Authorization]&&delete e.headers[Y.Authorization]}getCookieString(e){return this.Qt.getCookieString(e)}}var Q,ee;(function(I){I[I.None=0]="None",I[I.WebSockets=1]="WebSockets",I[I.ServerSentEvents=2]="ServerSentEvents",I[I.LongPolling=4]="LongPolling"})(Q||(Q={})),function(I){I[I.Text=1]="Text",I[I.Binary=2]="Binary"}(ee||(ee={}));class Ne{constructor(){this.ee=!1,this.onabort=null}abort(){this.ee||(this.ee=!0,this.onabort&&this.onabort())}get signal(){return this}get aborted(){return this.ee}}class _e{get pollAborted(){return this.se.aborted}constructor(e,a,b){this.$=e,this.u=a,this.se=new Ne,this.ie=b,this.ne=!1,this.onreceive=null,this.onclose=null}async connect(e,a){if(A.isRequired(e,"url"),A.isRequired(a,"transferFormat"),A.isIn(a,ee,"transferFormat"),this.re=e,this.u.log(t.Trace,"(LongPolling transport) Connecting."),a===ee.Binary&&typeof XMLHttpRequest!="undefined"&&typeof new XMLHttpRequest().responseType!="string")throw new Error("Binary protocols over XmlHttpRequest not implementing advanced features are not supported.");let[b,C]=T(),M={[b]:C,...this.ie.headers},D={abortSignal:this.se.signal,headers:M,timeout:1e5,withCredentials:this.ie.withCredentials};a===ee.Binary&&(D.responseType="arraybuffer");let B=`${e}&_=${Date.now()}`;this.u.log(t.Trace,`(LongPolling transport) polling: ${B}.`);let W=await this.$.get(B,D);W.statusCode!==200?(this.u.log(t.Error,`(LongPolling transport) Unexpected response code: ${W.statusCode}.`),this.oe=new u(W.statusText||"",W.statusCode),this.ne=!1):this.ne=!0,this.he=this.ce(this.re,D)}async ce(e,a){try{for(;this.ne;)try{let b=`${e}&_=${Date.now()}`;this.u.log(t.Trace,`(LongPolling transport) polling: ${b}.`);let C=await this.$.get(b,a);C.statusCode===204?(this.u.log(t.Information,"(LongPolling transport) Poll terminated by server."),this.ne=!1):C.statusCode!==200?(this.u.log(t.Error,`(LongPolling transport) Unexpected response code: ${C.statusCode}.`),this.oe=new u(C.statusText||"",C.statusCode),this.ne=!1):C.content?(this.u.log(t.Trace,`(LongPolling transport) data received. ${p(C.content,this.ie.logMessageContent)}.`),this.onreceive&&this.onreceive(C.content)):this.u.log(t.Trace,"(LongPolling transport) Poll timed out, reissuing.")}catch(b){this.ne?b instanceof l?this.u.log(t.Trace,"(LongPolling transport) Poll timed out, reissuing."):(this.oe=b,this.ne=!1):this.u.log(t.Trace,`(LongPolling transport) Poll errored after shutdown: ${b.message}`)}}finally{this.u.log(t.Trace,"(LongPolling transport) Polling complete."),this.pollAborted||this.ae()}}async send(e){return this.ne?x(this.u,"LongPolling",this.$,this.re,e,this.ie):Promise.reject(new Error("Cannot send until the transport is connected"))}async stop(){this.u.log(t.Trace,"(LongPolling transport) Stopping polling."),this.ne=!1,this.se.abort();try{await this.he,this.u.log(t.Trace,`(LongPolling transport) sending DELETE request to ${this.re}.`);let e={},[a,b]=T();e[a]=b;let C={headers:{...e,...this.ie.headers},timeout:this.ie.timeout,withCredentials:this.ie.withCredentials},M;try{await this.$.delete(this.re,C)}catch(D){M=D}M?M instanceof u&&(M.statusCode===404?this.u.log(t.Trace,"(LongPolling transport) A 404 response was returned from sending a DELETE request."):this.u.log(t.Trace,`(LongPolling transport) Error sending a DELETE request: ${M}`)):this.u.log(t.Trace,"(LongPolling transport) DELETE request accepted.")}finally{this.u.log(t.Trace,"(LongPolling transport) Stop finished."),this.ae()}}ae(){if(this.onclose){let e="(LongPolling transport) Firing onclose event.";this.oe&&(e+=" Error: "+this.oe),this.u.log(t.Trace,e),this.onclose(this.oe)}}}class We{constructor(e,a,b,C){this.$=e,this.Zt=a,this.u=b,this.ie=C,this.onreceive=null,this.onclose=null}async connect(e,a){return A.isRequired(e,"url"),A.isRequired(a,"transferFormat"),A.isIn(a,ee,"transferFormat"),this.u.log(t.Trace,"(SSE transport) Connecting."),this.re=e,this.Zt&&(e+=(e.indexOf("?")<0?"?":"&")+`access_token=${encodeURIComponent(this.Zt)}`),new Promise((b,C)=>{let M,D=!1;if(a===ee.Text){if(h.isBrowser||h.isWebWorker)M=new this.ie.EventSource(e,{withCredentials:this.ie.withCredentials});else{let B=this.$.getCookieString(e),W={};W.Cookie=B;let[G,ne]=T();W[G]=ne,M=new this.ie.EventSource(e,{withCredentials:this.ie.withCredentials,headers:{...W,...this.ie.headers}})}try{M.onmessage=B=>{if(this.onreceive)try{this.u.log(t.Trace,`(SSE transport) data received. ${p(B.data,this.ie.logMessageContent)}.`),this.onreceive(B.data)}catch(W){return void this.le(W)}},M.onerror=B=>{D?this.le():C(new Error("EventSource failed to connect. The connection could not be found on the server, either the connection ID is not present on the server, or a proxy is refusing/buffering the connection. If you have multiple servers check that sticky sessions are enabled."))},M.onopen=()=>{this.u.log(t.Information,`SSE connected to ${this.re}`),this.ue=M,D=!0,b()}}catch(B){return void C(B)}}else C(new Error("The Server-Sent Events transport only supports the 'Text' transfer format"))})}async send(e){return this.ue?x(this.u,"SSE",this.$,this.re,e,this.ie):Promise.reject(new Error("Cannot send until the transport is connected"))}stop(){return this.le(),Promise.resolve()}le(e){this.ue&&(this.ue.close(),this.ue=void 0,this.onclose&&this.onclose(e))}}class Fe{constructor(e,a,b,C,M,D){this.u=b,this.Yt=a,this.de=C,this.fe=M,this.$=e,this.onreceive=null,this.onclose=null,this.pe=D}async connect(e,a){let b;return A.isRequired(e,"url"),A.isRequired(a,"transferFormat"),A.isIn(a,ee,"transferFormat"),this.u.log(t.Trace,"(WebSockets transport) Connecting."),this.Yt&&(b=await this.Yt()),new Promise((C,M)=>{let D;e=e.replace(/^http/,"ws");let B=this.$.getCookieString(e),W=!1;if(h.isNode||h.isReactNative){let G={},[ne,Ae]=T();G[ne]=Ae,b&&(G[Y.Authorization]=`Bearer ${b}`),B&&(G[Y.Cookie]=B),D=new this.fe(e,void 0,{headers:{...G,...this.pe}})}else b&&(e+=(e.indexOf("?")<0?"?":"&")+`access_token=${encodeURIComponent(b)}`);D||(D=new this.fe(e)),a===ee.Binary&&(D.binaryType="arraybuffer"),D.onopen=G=>{this.u.log(t.Information,`WebSocket connected to ${e}.`),this.we=D,W=!0,C()},D.onerror=G=>{let ne=null;ne=typeof ErrorEvent!="undefined"&&G instanceof ErrorEvent?G.error:"There was an error with the transport",this.u.log(t.Information,`(WebSockets transport) ${ne}.`)},D.onmessage=G=>{if(this.u.log(t.Trace,`(WebSockets transport) data received. ${p(G.data,this.de)}.`),this.onreceive)try{this.onreceive(G.data)}catch(ne){return void this.le(ne)}},D.onclose=G=>{if(W)this.le(G);else{let ne=null;ne=typeof ErrorEvent!="undefined"&&G instanceof ErrorEvent?G.error:"WebSocket failed to connect. The connection could not be found on the server, either the endpoint may not be a SignalR endpoint, the connection ID is not present on the server, or there is a proxy blocking WebSockets. If you have multiple servers check that sticky sessions are enabled.",M(new Error(ne))}}})}send(e){return this.we&&this.we.readyState===this.fe.OPEN?(this.u.log(t.Trace,`(WebSockets transport) sending data. ${p(e,this.de)}.`),this.we.send(e),Promise.resolve()):Promise.reject("WebSocket is not in the OPEN state")}stop(){return this.we&&this.le(void 0),Promise.resolve()}le(e){this.we&&(this.we.onclose=()=>{},this.we.onmessage=()=>{},this.we.onerror=()=>{},this.we.close(),this.we=void 0),this.u.log(t.Trace,"(WebSockets transport) socket closed."),this.onclose&&(!this.ge(e)||e.wasClean!==!1&&e.code===1e3?e instanceof Error?this.onclose(e):this.onclose():this.onclose(new Error(`WebSocket closed with status code: ${e.code} (${e.reason||"no reason given"}).`)))}ge(e){return e&&typeof e.wasClean=="boolean"&&typeof e.code=="number"}}class Se{constructor(e,a={}){var b;if(this.me=()=>{},this.features={},this.ye=1,A.isRequired(e,"url"),this.u=(b=a.logger)===void 0?new O(t.Information):b===null?g.instance:b.log!==void 0?b:new O(b),this.baseUrl=this.be(e),(a=a||{}).logMessageContent=a.logMessageContent!==void 0&&a.logMessageContent,typeof a.withCredentials!="boolean"&&a.withCredentials!==void 0)throw new Error("withCredentials option was not a 'boolean' or 'undefined' value");a.withCredentials=a.withCredentials===void 0||a.withCredentials,a.timeout=a.timeout===void 0?1e5:a.timeout;let C=null,M=null;h.isNode&&(C=function(){throw new Error("Trying to import 'ws' in the browser.")}(),M=function(){throw new Error("Trying to import 'eventsource' in the browser.")}()),h.isNode||typeof WebSocket=="undefined"||a.WebSocket?h.isNode&&!a.WebSocket&&C&&(a.WebSocket=C):a.WebSocket=WebSocket,h.isNode||typeof EventSource=="undefined"||a.EventSource?h.isNode&&!a.EventSource&&M!==void 0&&(a.EventSource=M):a.EventSource=EventSource,this.$=new Ee(a.httpClient||new $(this.u),a.accessTokenFactory),this.ut="Disconnected",this.dt=!1,this.ie=a,this.onreceive=null,this.onclose=null}async start(e){if(e=e||ee.Binary,A.isIn(e,ee,"transferFormat"),this.u.log(t.Debug,`Starting connection with transfer format '${ee[e]}'.`),this.ut!=="Disconnected")return Promise.reject(new Error("Cannot start an HttpConnection that is not in the 'Disconnected' state."));if(this.ut="Connecting",this.ve=this.yt(e),await this.ve,this.ut==="Disconnecting"){let a="Failed to start the HttpConnection before stop() was called.";return this.u.log(t.Error,a),await this.It,Promise.reject(new i(a))}if(this.ut!=="Connected"){let a="HttpConnection.startInternal completed gracefully but didn't enter the connection into the connected state!";return this.u.log(t.Error,a),Promise.reject(new i(a))}this.dt=!0}send(e){return this.ut!=="Connected"?Promise.reject(new Error("Cannot send data if the connection is not in the 'Connected' State.")):(this.Ee||(this.Ee=new ce(this.transport)),this.Ee.send(e))}async stop(e){return this.ut==="Disconnected"?(this.u.log(t.Debug,`Call to HttpConnection.stop(${e}) ignored because the connection is already in the disconnected state.`),Promise.resolve()):this.ut==="Disconnecting"?(this.u.log(t.Debug,`Call to HttpConnection.stop(${e}) ignored because the connection is already in the disconnecting state.`),this.It):(this.ut="Disconnecting",this.It=new Promise(a=>{this.me=a}),await this._t(e),void await this.It)}async _t(e){this.$e=e;try{await this.ve}catch{}if(this.transport){try{await this.transport.stop()}catch(a){this.u.log(t.Error,`HttpConnection.transport.stop() threw error '${a}'.`),this.Ce()}this.transport=void 0}else this.u.log(t.Debug,"HttpConnection.transport is undefined in HttpConnection.stop() because start() failed.")}async yt(e){let a=this.baseUrl;this.Yt=this.ie.accessTokenFactory,this.$.Yt=this.Yt;try{if(this.ie.skipNegotiation){if(this.ie.transport!==Q.WebSockets)throw new Error("Negotiation can only be skipped when using the WebSocket transport directly.");this.transport=this.Se(Q.WebSockets),await this.ke(a,e)}else{let b=null,C=0;do{if(b=await this.Pe(a),this.ut==="Disconnecting"||this.ut==="Disconnected")throw new i("The connection was stopped during negotiation.");if(b.error)throw new Error(b.error);if(b.ProtocolVersion)throw new Error("Detected a connection attempt to an ASP.NET SignalR Server. This client only supports connecting to an ASP.NET Core SignalR Server. See https://aka.ms/signalr-core-differences for details.");if(b.url&&(a=b.url),b.accessToken){let M=b.accessToken;this.Yt=()=>M,this.$.Zt=M,this.$.Yt=void 0}C++}while(b.url&&C<100);if(C===100&&b.url)throw new Error("Negotiate redirection limit exceeded.");await this.Te(a,this.ie.transport,b,e)}this.transport instanceof _e&&(this.features.inherentKeepAlive=!0),this.ut==="Connecting"&&(this.u.log(t.Debug,"The HttpConnection connected successfully."),this.ut="Connected")}catch(b){return this.u.log(t.Error,"Failed to start the connection: "+b),this.ut="Disconnected",this.transport=void 0,this.me(),Promise.reject(b)}}async Pe(e){let a={},[b,C]=T();a[b]=C;let M=this.Ie(e);this.u.log(t.Debug,`Sending negotiation request: ${M}.`);try{let D=await this.$.post(M,{content:"",headers:{...a,...this.ie.headers},timeout:this.ie.timeout,withCredentials:this.ie.withCredentials});if(D.statusCode!==200)return Promise.reject(new Error(`Unexpected status code returned from negotiate '${D.statusCode}'`));let B=JSON.parse(D.content);return(!B.negotiateVersion||B.negotiateVersion<1)&&(B.connectionToken=B.connectionId),B.useStatefulReconnect&&this.ie._e!==!0?Promise.reject(new y("Client didn't negotiate Stateful Reconnect but the server did.")):B}catch(D){let B="Failed to complete negotiation with the server: "+D;return D instanceof u&&D.statusCode===404&&(B+=" Either this is not a SignalR endpoint or there is a proxy blocking the connection."),this.u.log(t.Error,B),Promise.reject(new y(B))}}He(e,a){return a?e+(e.indexOf("?")===-1?"?":"&")+`id=${a}`:e}async Te(e,a,b,C){let M=this.He(e,b.connectionToken);if(this.De(a))return this.u.log(t.Debug,"Connection was provided an instance of ITransport, using that directly."),this.transport=a,await this.ke(M,C),void(this.connectionId=b.connectionId);let D=[],B=b.availableTransports||[],W=b;for(let G of B){let ne=this.Re(G,a,C,(W==null?void 0:W.useStatefulReconnect)===!0);if(ne instanceof Error)D.push(`${G.transport} failed:`),D.push(ne);else if(this.De(ne)){if(this.transport=ne,!W){try{W=await this.Pe(e)}catch(Ae){return Promise.reject(Ae)}M=this.He(e,W.connectionToken)}try{return await this.ke(M,C),void(this.connectionId=W.connectionId)}catch(Ae){if(this.u.log(t.Error,`Failed to start the transport '${G.transport}': ${Ae}`),W=void 0,D.push(new E(`${G.transport} failed: ${Ae}`,Q[G.transport])),this.ut!=="Connecting"){let ze="Failed to select transport before stop() was called.";return this.u.log(t.Debug,ze),Promise.reject(new i(ze))}}}}return D.length>0?Promise.reject(new S(`Unable to connect to the server with any of the available transports. ${D.join(" ")}`,D)):Promise.reject(new Error("None of the transports supported by the client are supported by the server."))}Se(e){switch(e){case Q.WebSockets:if(!this.ie.WebSocket)throw new Error("'WebSocket' is not supported in your environment.");return new Fe(this.$,this.Yt,this.u,this.ie.logMessageContent,this.ie.WebSocket,this.ie.headers||{});case Q.ServerSentEvents:if(!this.ie.EventSource)throw new Error("'EventSource' is not supported in your environment.");return new We(this.$,this.$.Zt,this.u,this.ie);case Q.LongPolling:return new _e(this.$,this.u,this.ie);default:throw new Error(`Unknown transport: ${e}.`)}}ke(e,a){return this.transport.onreceive=this.onreceive,this.features.reconnect?this.transport.onclose=async b=>{let C=!1;if(this.features.reconnect){try{this.features.disconnected(),await this.transport.connect(e,a),await this.features.resend()}catch{C=!0}C&&this.Ce(b)}else this.Ce(b)}:this.transport.onclose=b=>this.Ce(b),this.transport.connect(e,a)}Re(e,a,b,C){let M=Q[e.transport];if(M==null)return this.u.log(t.Debug,`Skipping transport '${e.transport}' because it is not supported by this client.`),new Error(`Skipping transport '${e.transport}' because it is not supported by this client.`);if(!function(D,B){return!D||(B&D)!=0}(a,M))return this.u.log(t.Debug,`Skipping transport '${Q[M]}' because it was disabled by the client.`),new w(`'${Q[M]}' is disabled by the client.`,M);if(!(e.transferFormats.map(D=>ee[D]).indexOf(b)>=0))return this.u.log(t.Debug,`Skipping transport '${Q[M]}' because it does not support the requested transfer format '${ee[b]}'.`),new Error(`'${Q[M]}' does not support ${ee[b]}.`);if(M===Q.WebSockets&&!this.ie.WebSocket||M===Q.ServerSentEvents&&!this.ie.EventSource)return this.u.log(t.Debug,`Skipping transport '${Q[M]}' because it is not supported in your environment.'`),new f(`'${Q[M]}' is not supported in your environment.`,M);this.u.log(t.Debug,`Selecting transport '${Q[M]}'.`);try{return this.features.reconnect=M===Q.WebSockets?C:void 0,this.Se(M)}catch(D){return D}}De(e){return e&&typeof e=="object"&&"connect"in e}Ce(e){if(this.u.log(t.Debug,`HttpConnection.stopConnection(${e}) called while in state ${this.ut}.`),this.transport=void 0,e=this.$e||e,this.$e=void 0,this.ut!=="Disconnected"){if(this.ut==="Connecting")throw this.u.log(t.Warning,`Call to HttpConnection.stopConnection(${e}) was ignored because the connection is still in the connecting state.`),new Error(`HttpConnection.stopConnection(${e}) was called while the connection is still in the connecting state.`);if(this.ut==="Disconnecting"&&this.me(),e?this.u.log(t.Error,`Connection disconnected with error '${e}'.`):this.u.log(t.Information,"Connection disconnected."),this.Ee&&(this.Ee.stop().catch(a=>{this.u.log(t.Error,`TransportSendQueue.stop() threw error '${a}'.`)}),this.Ee=void 0),this.connectionId=void 0,this.ut="Disconnected",this.dt){this.dt=!1;try{this.onclose&&this.onclose(e)}catch(a){this.u.log(t.Error,`HttpConnection.onclose(${e}) threw error '${a}'.`)}}}else this.u.log(t.Debug,`Call to HttpConnection.stopConnection(${e}) was ignored because the connection is already in the disconnected state.`)}be(e){if(e.lastIndexOf("https://",0)===0||e.lastIndexOf("http://",0)===0)return e;if(!h.isBrowser)throw new Error(`Cannot resolve '${e}'.`);let a=window.document.createElement("a");return a.href=e,this.u.log(t.Information,`Normalizing '${e}' to '${a.href}'.`),a.href}Ie(e){let a=new URL(e);a.pathname.endsWith("/")?a.pathname+="negotiate":a.pathname+="/negotiate";let b=new URLSearchParams(a.searchParams);return b.has("negotiateVersion")||b.append("negotiateVersion",this.ye.toString()),b.has("useStatefulReconnect")?b.get("useStatefulReconnect")==="true"&&(this.ie._e=!0):this.ie._e===!0&&b.append("useStatefulReconnect","true"),a.search=b.toString(),a.toString()}}class ce{constructor(e){this.xe=e,this.Ae=[],this.Ue=!0,this.Le=new De,this.Ne=new De,this.qe=this.Me()}send(e){return this.je(e),this.Ne||(this.Ne=new De),this.Ne.promise}stop(){return this.Ue=!1,this.Le.resolve(),this.qe}je(e){if(this.Ae.length&&typeof this.Ae[0]!=typeof e)throw new Error(`Expected data to be of type ${typeof this.Ae} but was of type ${typeof e}`);this.Ae.push(e),this.Le.resolve()}async Me(){for(;;){if(await this.Le.promise,!this.Ue){this.Ne&&this.Ne.reject("Connection stopped.");break}this.Le=new De;let e=this.Ne;this.Ne=void 0;let a=typeof this.Ae[0]=="string"?this.Ae.join(""):ce.We(this.Ae);this.Ae.length=0;try{await this.xe.send(a),e.resolve()}catch(b){e.reject(b)}}}static We(e){let a=e.map(M=>M.byteLength).reduce((M,D)=>M+D),b=new Uint8Array(a),C=0;for(let M of e)b.set(new Uint8Array(M),C),C+=M.byteLength;return b.buffer}}class De{constructor(){this.promise=new Promise((e,a)=>[this.j,this.Oe]=[e,a])}resolve(){this.j()}reject(e){this.Oe(e)}}class Ue{constructor(){this.name="json",this.version=2,this.transferFormat=ee.Text}parseMessages(e,a){if(typeof e!="string")throw new Error("Invalid input for JSON hub protocol. Expected a string.");if(!e)return[];a===null&&(a=g.instance);let b=z.parse(e),C=[];for(let M of b){let D=JSON.parse(M);if(typeof D.type!="number")throw new Error("Invalid payload.");switch(D.type){case U.Invocation:this.U(D);break;case U.StreamItem:this.Fe(D);break;case U.Completion:this.Be(D);break;case U.Ping:case U.Close:break;case U.Ack:this.Xe(D);break;case U.Sequence:this.Je(D);break;default:a.log(t.Information,"Unknown message type '"+D.type+"' ignored.");continue}C.push(D)}return C}writeMessage(e){return z.write(JSON.stringify(e))}U(e){this.ze(e.target,"Invalid payload for Invocation message."),e.invocationId!==void 0&&this.ze(e.invocationId,"Invalid payload for Invocation message.")}Fe(e){if(this.ze(e.invocationId,"Invalid payload for StreamItem message."),e.item===void 0)throw new Error("Invalid payload for StreamItem message.")}Be(e){if(e.result&&e.error)throw new Error("Invalid payload for Completion message.");!e.result&&e.error&&this.ze(e.error,"Invalid payload for Completion message."),this.ze(e.invocationId,"Invalid payload for Completion message.")}Xe(e){if(typeof e.sequenceId!="number")throw new Error("Invalid SequenceId for Ack message.")}Je(e){if(typeof e.sequenceId!="number")throw new Error("Invalid SequenceId for Sequence message.")}ze(e,a){if(typeof e!="string"||e==="")throw new Error(a)}}let je={trace:t.Trace,debug:t.Debug,info:t.Information,information:t.Information,warn:t.Warning,warning:t.Warning,error:t.Error,critical:t.Critical,none:t.None};class Be{configureLogging(e){if(A.isRequired(e,"logging"),e.log!==void 0)this.logger=e;else if(typeof e=="string"){let a=function(b){let C=je[b.toLowerCase()];if(C!==void 0)return C;throw new Error(`Unknown log level: ${b}`)}(e);this.logger=new O(a)}else this.logger=new O(e);return this}withUrl(e,a){return A.isRequired(e,"url"),A.isNotEmpty(e,"url"),this.url=e,this.httpConnectionOptions=typeof a=="object"?{...this.httpConnectionOptions,...a}:{...this.httpConnectionOptions,transport:a},this}withHubProtocol(e){return A.isRequired(e,"protocol"),this.protocol=e,this}withAutomaticReconnect(e){if(this.reconnectPolicy)throw new Error("A reconnectPolicy has already been set.");return e?Array.isArray(e)?this.reconnectPolicy=new Te(e):this.reconnectPolicy=e:this.reconnectPolicy=new Te,this}withServerTimeout(e){return A.isRequired(e,"milliseconds"),this.Ve=e,this}withKeepAliveInterval(e){return A.isRequired(e,"milliseconds"),this.Ke=e,this}withStatefulReconnect(e){return this.httpConnectionOptions===void 0&&(this.httpConnectionOptions={}),this.httpConnectionOptions._e=!0,this.Y=e==null?void 0:e.bufferSize,this}build(){let e=this.httpConnectionOptions||{};if(e.logger===void 0&&(e.logger=this.logger),!this.url)throw new Error("The 'HubConnectionBuilder.withUrl' method must be called before building the connection.");let a=new Se(this.url,e);return pe.create(a,this.logger||g.instance,this.protocol||new Ue,this.reconnectPolicy,this.Ve,this.Ke,this.Y)}}return Uint8Array.prototype.indexOf||Object.defineProperty(Uint8Array.prototype,"indexOf",{value:Array.prototype.indexOf,writable:!0}),Uint8Array.prototype.slice||Object.defineProperty(Uint8Array.prototype,"slice",{value:function(I,e){return new Uint8Array(Array.prototype.slice.call(this,I,e))},writable:!0}),Uint8Array.prototype.forEach||Object.defineProperty(Uint8Array.prototype,"forEach",{value:Array.prototype.forEach,writable:!0}),c})(),typeof wt=="object"&&typeof jt=="object"?jt.exports=gt():typeof define=="function"&&define.amd?define([],gt):typeof wt=="object"?wt.signalR=gt():cn.signalR=gt()});var hn=he((un,Ct)=>{"use strict";(function(r,t){if(typeof Ct=="object"&&Ct.exports)Ct.exports=t();else{let c=t();r.CryptoTickerConfig=Object.assign({},r.CryptoTickerConfig||{},c)}})(typeof self!="undefined"?self:un,function(){return{tProxyBase:"https://tproxyv8.opendle.com",fallbackPollIntervalMs:6e4,staleTickerTimeoutMs:5*60*1e3,binanceRestBaseUrl:"https://api.binance.com",binanceWsBaseUrl:"wss://stream.binance.com:9443/ws",binanceSymbolOverrides:{},bitfinexRestBaseUrl:"https://api-pub.bitfinex.com",bitfinexWsBaseUrl:"wss://api-pub.bitfinex.com/ws/2",bitfinexSymbolOverrides:{},messages:{loading:"LOADING...",stale:"STALE",noData:"NO DATA",misconfigured:"INVALID PAIR",conversionError:"CONVERT ERROR"}}})});var Ke=he((fn,kt)=>{"use strict";var vr={LIVE:"live",DETACHED:"detached",BACKUP:"backup",BROKEN:"broken"};(function(r,t){let c=typeof globalThis!="undefined"?globalThis:r,u=t();typeof kt=="object"&&kt.exports&&(kt.exports=u),c&&(c.CryptoTickerConnectionStates=u)})(typeof self!="undefined"?self:fn,function(){return vr})});var Tt=he((pn,St)=>{"use strict";(function(r,t){let c=typeof globalThis!="undefined"?globalThis:r,u=t();typeof St=="object"&&St.exports&&(St.exports=u),c&&(c.CryptoTickerProviders=c.CryptoTickerProviders||{},c.CryptoTickerProviders.buildSubscriptionKey=u.buildSubscriptionKey)})(typeof self!="undefined"?self:pn,function(){function t(c,u,l,i){let f=c||"",w=u||"",E=l||null,y=i||null,S="";return E!==null&&y!==null&&E!==y&&(S="__"+E+"_"+y),f+"__"+w+S}return{buildSubscriptionKey:t}})});var Ye=he((dn,Et)=>{"use strict";(function(r,t){let c=typeof globalThis!="undefined"?globalThis:r,u=t();typeof Et=="object"&&Et.exports&&(Et.exports=u),c&&(c.CryptoTickerProviders=c.CryptoTickerProviders||{},c.CryptoTickerProviders.ProviderInterface=u.ProviderInterface)})(typeof self!="undefined"?self:dn,function(){function t(){}class c{constructor(l){let i=l||{};this.baseUrl=typeof i.baseUrl=="string"?i.baseUrl:"",this.logger=typeof i.logger=="function"?i.logger:t}getId(){throw new Error("Provider must implement getId()")}subscribeTicker(l,i){throw new Error("Provider must implement subscribeTicker()")}async fetchTicker(l){throw new Error("Provider must implement fetchTicker()")}getCachedTicker(l){return null}async fetchCandles(l){throw new Error("Provider must implement fetchCandles()")}ensureConnection(){}async fetchConversionRate(l,i){return 1}}return{ProviderInterface:c}})});var bt=he((gn,Je)=>{"use strict";(function(r,t){let c=typeof globalThis!="undefined"?globalThis:r,u=typeof Je=="object"&&Je.exports?[Tt(),Ke()]:[r==null?void 0:r.CryptoTickerProviders,r==null?void 0:r.CryptoTickerConnectionStates],l=t(u[0],u[1]);typeof Je=="object"&&Je.exports&&(Je.exports=l),c&&(c.CryptoTickerProviders=c.CryptoTickerProviders||{},c.CryptoTickerProviders.TickerSubscriptionManager=l.TickerSubscriptionManager)})(typeof self!="undefined"?self:gn,function(r,t){let c=r.buildSubscriptionKey||r,u=t||{LIVE:"live",DETACHED:"detached",BACKUP:"backup",BROKEN:"broken"},l=6e4,i=5*60*1e3;function f(){}function w(S){let d=S||{};return{onData:typeof d.onData=="function"?d.onData:null,onError:typeof d.onError=="function"?d.onError:null}}function E(S){let d=S||{},s=d.fromCurrency||null,g=d.toCurrency||null;return{exchange:d.exchange,symbol:d.symbol,fromCurrency:s,toCurrency:g}}class y{constructor(d){let s=d||{};this.logger=typeof s.logger=="function"?s.logger:f,this.fetchTickerFn=typeof s.fetchTicker=="function"?s.fetchTicker:null,this.subscribeStreamingFn=typeof s.subscribeStreaming=="function"?s.subscribeStreaming:null,this.unsubscribeStreamingFn=typeof s.unsubscribeStreaming=="function"?s.unsubscribeStreaming:null,this.ensureConnectionFn=typeof s.ensureConnection=="function"?s.ensureConnection:null,this.subscriptionKeyBuilder=typeof s.buildSubscriptionKey=="function"?s.buildSubscriptionKey:c,this.fallbackPollIntervalMs=typeof s.fallbackPollIntervalMs=="number"?s.fallbackPollIntervalMs:l,this.staleTickerTimeoutMs=typeof s.staleTickerTimeoutMs=="number"?s.staleTickerTimeoutMs:i,this.connectionStates=u,this.entries={},this.cache={}}subscribe(d,s){let g=w(s),R=this.getOrCreateEntry(d);if(R.subscribers.push(g),this.ensureConnectionFn)try{this.ensureConnectionFn()}catch(h){this.logger("TickerSubscriptionManager: ensureConnection error",h)}this.ensureStreaming(R),this.startFallbackPolling(R);let A=this;return this.fetchTickerFn&&this.fetchTickerFn(R.params).then(function(h){A.applyTickerStateFromFetch(R,h),A.cache[R.key]=h,A.notifySubscribers(R,h)}).catch(function(h){if(A.logger("TickerSubscriptionManager: fetchTicker error",h),g.onError)try{g.onError(h)}catch(p){A.logger("TickerSubscriptionManager: onError handler threw",p)}}),{key:R.key,unsubscribe:()=>{this.unsubscribe(R.key,g)}}}unsubscribe(d,s){let g=this.entries[d];if(!g)return;let R=g.subscribers.indexOf(s);R>=0&&g.subscribers.splice(R,1),g.subscribers.length===0&&(this.stopFallbackPolling(g),this.stopStreaming(g),delete this.entries[d])}getCachedTicker(d){return this.cache[d]||null}handleStreamingUpdate(d,s){let g=this.entries[d];g&&(g.lastStreamUpdate=Date.now(),this.setEntryConnectionState(g,this.connectionStates.LIVE,s),this.cache[d]=s,this.notifySubscribers(g,s))}getEntry(d){return this.entries[d]||null}handleStreamingUpdateFromParts(d,s,g,R,A){let h=this.buildKey(d,s,g,R);this.handleStreamingUpdate(h,A)}buildKey(d,s,g,R){return this.subscriptionKeyBuilder(d,s,g,R)}buildKeyFromParams(d){let s=d||{};return this.buildKey(s.exchange,s.symbol,s.fromCurrency,s.toCurrency)}forEachEntry(d){if(typeof d!="function")return;let s=Object.keys(this.entries);for(let g=0;g<s.length;g++){let R=s[g];d(this.entries[R])}}ensureStreaming(d){if(!d||d.streamingActive||!this.subscribeStreamingFn){d&&!d.streamingActive&&(d.streamingActive=!!this.subscribeStreamingFn);return}try{let s=this.subscribeStreamingFn(d);s&&typeof s.then=="function"?s.then(()=>{d.streamingActive=!0}).catch(g=>{d.streamingActive=!1,this.logger("TickerSubscriptionManager: subscribeStreaming promise rejected",g)}):s===!1?d.streamingActive=!1:d.streamingActive=!0}catch(s){d.streamingActive=!1,this.logger("TickerSubscriptionManager: subscribeStreaming error",s)}}stopStreaming(d){if(!(!d||!this.unsubscribeStreamingFn||!d.streamingActive))try{let s=this.unsubscribeStreamingFn(d);s&&typeof s.then=="function"?s.then(()=>{d.streamingActive=!1}).catch(g=>{this.logger("TickerSubscriptionManager: unsubscribeStreaming promise rejected",g)}):d.streamingActive=!1}catch(s){d.streamingActive=!1,this.logger("TickerSubscriptionManager: unsubscribeStreaming error",s)}}notifySubscribers(d,s){if(!d)return;let g=d.subscribers;for(let R=0;R<g.length;R++){let A=g[R];if(A&&A.onData)try{A.onData(s)}catch(h){this.logger("TickerSubscriptionManager: onData handler threw",h)}}}startFallbackPolling(d){if(!d||d.fallbackTimerId||!this.fetchTickerFn)return;let s=this;d.fallbackTimerId=setInterval(function(){s.pollEntryIfNeeded(d)},this.fallbackPollIntervalMs)}stopFallbackPolling(d){!d||!d.fallbackTimerId||(clearInterval(d.fallbackTimerId),d.fallbackTimerId=null)}pollEntryIfNeeded(d){if(!d||!this.fetchTickerFn||!this.shouldPollEntry(d))return;let s=this;this.fetchTickerFn(d.params).then(function(g){s.applyTickerStateFromFetch(d,g),s.cache[d.key]=g,s.notifySubscribers(d,g)}).catch(function(g){s.logger("TickerSubscriptionManager: fallback fetch error",g),s.handleFetchError(d)})}shouldPollEntry(d){if(!d)return!1;if(!d.streamingActive)return!0;let s=d.lastStreamUpdate||0;return s?Date.now()-s>this.staleTickerTimeoutMs:!0}getOrCreateEntry(d){let s=this.buildKeyFromParams(d),g=this.entries[s];return g||(g={key:s,params:E(d),subscribers:[],streamingActive:!1,lastStreamUpdate:0,fallbackTimerId:null,meta:{},connectionState:null},this.entries[s]=g),g}setEntryConnectionState(d,s,g){d&&(d.connectionState=s,g&&typeof g=="object"&&(g.connectionState=s))}applyTickerStateFromFetch(d,s){if(!d||!s)return;let g=s.connectionState||(d.streamingActive?this.connectionStates.LIVE:this.connectionStates.DETACHED);this.setEntryConnectionState(d,g,s)}handleFetchError(d){if(!d)return;this.setEntryConnectionState(d,this.connectionStates.BROKEN);let s=d.key,g=this.cache[s];if(g){g.connectionState=this.connectionStates.BROKEN,this.notifySubscribers(d,g);return}let R={changeDaily:0,changeDailyPercent:0,last:0,volume:0,high:0,low:0,pair:d.params.symbol,pairDisplay:d.params.symbol,connectionState:this.connectionStates.BROKEN};this.cache[s]=R,this.notifySubscribers(d,R)}}return{TickerSubscriptionManager:y}})});var Qe=he((bn,Xe)=>{"use strict";(function(r,t){let c=typeof globalThis!="undefined"?globalThis:r,u=typeof Xe=="object"&&Xe.exports?[Ye(),Tt(),bt(),Ke()]:[r==null?void 0:r.CryptoTickerProviders,r==null?void 0:r.CryptoTickerProviders,r==null?void 0:r.CryptoTickerProviders,r==null?void 0:r.CryptoTickerConnectionStates],l=t(u[0],u[1],u[2],u[3]);typeof Xe=="object"&&Xe.exports&&(Xe.exports=l),c&&(c.CryptoTickerProviders=c.CryptoTickerProviders||{},c.CryptoTickerProviders.GenericProvider=l.GenericProvider)})(typeof self!="undefined"?self:bn,function(r,t,c,u){let l=r.ProviderInterface||r,i=t.buildSubscriptionKey||t,f=c.TickerSubscriptionManager||c,w=u||{LIVE:"live",DETACHED:"detached",BACKUP:"backup",BROKEN:"broken"},E="Connected",y=5e3;class S extends l{constructor(s){super(s);let g=s||{};this.retryDelayMs=typeof g.retryDelayMs=="number"?g.retryDelayMs:y,this.connection=null,this.shouldReconnect=!0,this.connectionState="Disconnected",this.startingConnection=!1;let R={logger:(...A)=>{this.logger(...A)},fetchTicker:this.rawFetchTicker.bind(this),subscribeStreaming:this.subscribeEntry.bind(this),unsubscribeStreaming:this.unsubscribeEntry.bind(this),ensureConnection:this.ensureConnection.bind(this),buildSubscriptionKey:function(A,h,p,k){return i(A,h,p,k)},fallbackPollIntervalMs:g.fallbackPollIntervalMs,staleTickerTimeoutMs:g.staleTickerTimeoutMs};this.subscriptionManager=new f(R)}getId(){return"GENERIC"}subscribeTicker(s,g){return this.subscriptionManager.subscribe(s,g)}getCachedTicker(s){return this.subscriptionManager.getCachedTicker(s)}ensureConnection(){if(!(this.connection&&(this.connectionState===E||this.startingConnection))){if(typeof signalR=="undefined"||!signalR.HubConnectionBuilder){this.logger("GenericProvider: SignalR not available, skipping WebSocket connection.");return}if(!this.connection){this.connection=new signalR.HubConnectionBuilder().withUrl(this.baseUrl+"/tickerhub").withAutomaticReconnect().configureLogging(signalR.LogLevel.Warning).build();let s=this;this.connection.on("ticker",function(g){s.handleTickerMessage(g)}),this.connection.onreconnected(function(){s.logger("GenericProvider: connection re-established, resubscribing."),s.onConnectionEstablished()}),this.connection.onclose(function(){s.connectionState="Disconnected",s.shouldReconnect&&setTimeout(function(){s.startConnection()},s.retryDelayMs)})}this.startConnection()}}startConnection(){if(!this.connection||this.startingConnection||this.connectionState===E)return;let s=this;this.startingConnection=!0,this.connection.start().then(function(){s.connectionState=E,s.startingConnection=!1,s.onConnectionEstablished()}).catch(function(g){s.connectionState="Disconnected",s.startingConnection=!1,s.logger("GenericProvider: error starting connection",g),setTimeout(function(){s.startConnection()},s.retryDelayMs)})}isConnected(){return this.connection&&this.connectionState===E}onConnectionEstablished(){let s=this;this.subscriptionManager.forEachEntry(function(g){g&&(g.streamingActive=!1,g.meta&&(g.meta.isSubscribed=!1,g.meta.pending=!0),s.subscriptionManager.ensureStreaming(g))})}subscribeEntry(s){if(!s)return!1;if(s.meta=s.meta||{},!this.connection)return this.ensureConnection(),s.meta.pending=!0,s.streamingActive=!1,!1;if(!this.isConnected())return this.startConnection(),s.meta.pending=!0,s.streamingActive=!1,!1;if(s.meta.isSubscribed)return s.meta.pending=!1,!0;s.meta.pending=!0;let g=s.params,R=this;return this.connection.invoke("Subscribe",g.exchange,g.symbol,g.fromCurrency,g.toCurrency).then(function(){return s.meta.isSubscribed=!0,s.meta.pending=!1,s.streamingActive=!0,!0}).catch(function(A){return s.meta.isSubscribed=!1,s.meta.pending=!1,s.streamingActive=!1,R.logger("GenericProvider: error invoking Subscribe",A),!1})}unsubscribeEntry(s){if(!s)return!0;if(s.meta=s.meta||{},!this.connection||!s.meta.isSubscribed)return s.meta.isSubscribed=!1,s.streamingActive=!1,!0;let g=s.params,R=this;return this.connection.invoke("Unsubscribe",g.exchange,g.symbol,g.fromCurrency,g.toCurrency).then(function(){return s.meta.isSubscribed=!1,s.streamingActive=!1,!0}).catch(function(A){return s.meta.isSubscribed=!1,s.streamingActive=!1,R.logger("GenericProvider: error invoking Unsubscribe",A),!1})}fetchTicker(s){return this.rawFetchTicker(s)}rawFetchTicker(s){let g=s.exchange,R=s.symbol,A=s.fromCurrency||"USD",h=s.toCurrency||null,p=this.baseUrl+"/api/Ticker/json/"+g+"/"+R+"?fromCurrency="+encodeURIComponent(A);h!==null&&(p+="&toCurrency="+encodeURIComponent(h));let k=this;return fetch(p).then(function(x){return x.json()}).then(function(x){let m=k.transformTickerResponse(x);return m.connectionState=w.BACKUP,m}).catch(function(x){k.logger("GenericProvider: error fetching ticker",x);let m=k.subscriptionManager.buildKey(g,R,A,h),O=k.subscriptionManager.getCachedTicker(m);if(O)return O.connectionState=O.connectionState||w.BACKUP,O;let T=k.buildEmptyTicker(R);return T.connectionState=w.BROKEN,T})}handleTickerMessage(s){if(!s)return;let g=s.provider||s.provider,R=s.symbol||s.symbol,A=s.conversionFromCurrency||s.conversionFromCurrency||null,h=s.conversionToCurrency||s.conversionToCurrency||null,p=this.subscriptionManager.buildKey(g,R,A,h),k=this.transformTickerResponse(s),x=this.subscriptionManager.getEntry(p);x&&x.meta&&(x.meta.isSubscribed=!0,x.meta.pending=!1,x.streamingActive=!0),this.subscriptionManager.handleStreamingUpdate(p,k)}async fetchCandles(s){let g=s.exchange,R=s.symbol,A=s.interval,h=typeof s.limit=="number"&&s.limit>0?s.limit:24,k=this.baseUrl.replace(/\/$/,"")+"/api/Candles/json/"+encodeURIComponent(g)+"/"+encodeURIComponent(R)+"/"+A+"?limit="+h;try{let x=await fetch(k);if(!x||!x.ok)throw new Error("GenericProvider: candles response not ok");let m=await x.json();return Array.isArray(m.candles)?m.candles:[]}catch(x){throw this.logger("GenericProvider: error fetching candles",x),x}}transformTickerResponse(s){let g=s||{};return{changeDaily:g.dailyChange||0,changeDailyPercent:g.dailyChangeRelative||0,last:g.last||0,volume:g.volume||0,high:g.high24h||0,low:g.low24h||0,pair:g.symbol||g.pair||"",pairDisplay:g.symbolDisplay||g.symbol||g.pair||""}}buildEmptyTicker(s){let g=s||"";return{changeDaily:0,changeDailyPercent:0,last:0,volume:0,high:0,low:0,pair:g,pairDisplay:g,connectionState:w.BROKEN}}}return{GenericProvider:S}})});var mn=he((yn,xt)=>{"use strict";(function(t,c){let u=c();typeof xt=="object"&&xt.exports&&(xt.exports=u),t&&typeof t=="object"&&(t.CryptoTickerDefaults=u)})(typeof self!="undefined"?self:yn,function(){function t(y){if(y===null||typeof y!="object")return y;if(Array.isArray(y))return y.map(d=>t(d));let S={};for(let d in y)Object.prototype.hasOwnProperty.call(y,d)&&(S[d]=t(y[d]));return S}function c(y){let S=y==null?void 0:y.case,d=(y==null?void 0:y.allowEmptyString)===!0,s=(y==null?void 0:y.allowNull)===!0,g=Object.prototype.hasOwnProperty.call(y||{},"trim")?!!(y!=null&&y.trim):!0,R=Array.isArray(y==null?void 0:y.allowedValues)?y==null?void 0:y.allowedValues:null;return function(h){if(h===void 0)return null;if(h===null)return s?null:"";let p=String(h);if(g&&(p=p.trim()),!p&&!d)return null;if(S==="upper"?p=p.toUpperCase():S==="lower"&&(p=p.toLowerCase()),R&&R.length>0){let k=S==="lower"?p.toLowerCase():S==="upper"?p.toUpperCase():p;return R.some(m=>S==="lower"?m.toLowerCase()===k:S==="upper"?m.toUpperCase()===k:m===k)?S==="lower"||S==="upper"?k:p:null}return p}}function u(y){let S=typeof(y==null?void 0:y.min)=="number"?y.min:null,d=typeof(y==null?void 0:y.max)=="number"?y.max:null,s=(y==null?void 0:y.integer)===!0;return function(R){if(R==null||R==="")return null;let A=typeof R=="number"?R:parseFloat(String(R));return Number.isNaN(A)?null:(s&&(A=Math.round(A)),S!==null&&A<S&&(A=S),d!==null&&A>d&&(A=d),A)}}let l={title:{type:"string",default:"",normalize:c({allowEmptyString:!0,allowNull:!0,trim:!0})},exchange:{type:"string",default:"BINANCE",normalize:c({trim:!0,allowEmptyString:!1,case:"upper"})},pair:{type:"string",default:"BTCUSD",normalize:c({trim:!0,allowEmptyString:!1,case:"upper"})},fromCurrency:{type:"string",default:"USD",normalize:c({trim:!0,allowEmptyString:!1,case:"upper"})},currency:{type:"string",default:"",normalize:c({trim:!0,allowEmptyString:!0,case:"upper",allowNull:!0})},candlesInterval:{type:"string",default:"1h",normalize:c({trim:!0,allowEmptyString:!1})},candlesDisplayed:{type:"number",default:20,normalize:u({min:5,max:60,integer:!0})},multiplier:{type:"number",default:1,normalize:u({min:0})},digits:{type:"number",default:2,normalize:u({min:0,max:10,integer:!0})},highLowDigits:{type:"string",default:"",normalize:c({trim:!0,allowEmptyString:!0})},font:{type:"string",default:"Lato,'Roboto Condensed',Helvetica,Calibri,sans-serif",normalize:c({trim:!0,allowEmptyString:!1})},fontSizeBase:{type:"number",default:25,normalize:u({min:1,max:200,integer:!0})},fontSizePrice:{type:"number",default:35,normalize:u({min:1,max:200,integer:!0})},fontSizeHighLow:{type:"string",default:"",normalize:c({trim:!0,allowEmptyString:!0})},fontSizeChange:{type:"number",default:19,normalize:u({min:1,max:200,integer:!0})},priceFormat:{type:"string",default:"compact",normalize:c({trim:!0,allowEmptyString:!1,case:"lower"})},backgroundColor:{type:"string",default:"#000000",normalize:c({trim:!0,allowEmptyString:!1})},textColor:{type:"string",default:"#ffffff",normalize:c({trim:!0,allowEmptyString:!1})},displayHighLow:{type:"string",default:"on",normalize:c({trim:!0,allowEmptyString:!1,case:"lower",allowedValues:["on","off"]})},displayHighLowBar:{type:"string",default:"on",normalize:c({trim:!0,allowEmptyString:!1,case:"lower",allowedValues:["on","off"]})},displayDailyChange:{type:"string",default:"on",normalize:c({trim:!0,allowEmptyString:!1,case:"lower",allowedValues:["on","off"]})},displayConnectionStatusIcon:{type:"string",default:"OFF",normalize:c({trim:!0,allowEmptyString:!1,case:"upper",allowedValues:["OFF","TOP_RIGHT","BOTTOM_LEFT"]})},alertRule:{type:"string",default:"",normalize:c({trim:!0,allowEmptyString:!0})},backgroundColorRule:{type:"string",default:"",normalize:c({trim:!0,allowEmptyString:!0})},textColorRule:{type:"string",default:"",normalize:c({trim:!0,allowEmptyString:!0})},mode:{type:"string",default:"ticker",normalize:c({trim:!0,allowEmptyString:!1,case:"lower",allowedValues:["ticker","candles"]})}};function i(y,S,d){if(!y||typeof y!="object")return{value:S,error:null};let s=y.normalize,g=y.default;if(typeof s!="function")return{value:S===void 0?t(g):S,error:null};let R=s(S);if(R==null){let A=s(g);return{value:A==null?t(g):A,error:d?"Invalid "+y.type:null}}return{value:R,error:null}}function f(y){let S=y&&typeof y=="object"?y:{},d={},s=[];for(let g in l){if(!Object.prototype.hasOwnProperty.call(l,g))continue;let R=l[g],A=Object.prototype.hasOwnProperty.call(S,g),h=A?S[g]:void 0,p=i(R,h,A);d[g]=p.value,p.error&&s.push({key:g,message:p.error})}for(let g in S)!Object.prototype.hasOwnProperty.call(l,g)&&Object.prototype.hasOwnProperty.call(S,g)&&(d[g]=S[g]);return{settings:d,errors:s}}function w(y){return f(y).settings}let E=w(null);return{settingsSchema:l,defaultSettings:E,getDefaultSettings:function(){return t(E)},validateSettings:function(y){let S=f(y);return{settings:S.settings,errors:S.errors.slice(0)}},applyDefaults:w}})});var Rt=he((vn,Pt)=>{"use strict";(function(r,t){let c=typeof globalThis!="undefined"?globalThis:r,u=t();typeof Pt=="object"&&Pt.exports&&(Pt.exports=u),c&&(c.CryptoTickerProviders=c.CryptoTickerProviders||{},c.CryptoTickerProviders.WebSocketConnectionPool=u.WebSocketConnectionPool)})(typeof self!="undefined"?self:vn,function(){function r(){}function t(u,l){if(!l||typeof l!="object")return u;let i=Object.keys(l);for(let f=0;f<i.length;f++){let w=i[f];u[w]=l[w]}return u}class c{constructor(l){let i=l||{};this.logger=typeof i.logger=="function"?i.logger:r,this.createWebSocket=typeof i.createWebSocket=="function"?i.createWebSocket:null,this.subscribeHandler=typeof i.subscribe=="function"?i.subscribe:null,this.unsubscribeHandler=typeof i.unsubscribe=="function"?i.unsubscribe:null,this.handleMessageFn=typeof i.handleMessage=="function"?i.handleMessage:null,this.onOpen=typeof i.onOpen=="function"?i.onOpen:null,this.onError=typeof i.onError=="function"?i.onError:null,this.onClose=typeof i.onClose=="function"?i.onClose:null,this.reconnectDelayMs=typeof i.reconnectDelayMs=="number"?i.reconnectDelayMs:5e3,this.autoCloseDelayMs=typeof i.autoCloseDelayMs=="number"?i.autoCloseDelayMs:0,this.shouldResubscribeOnReconnect=i.shouldResubscribeOnReconnect!==!1,this.symbolEntries={},this.ws=null,this.wsClosedByUser=!1,this.reconnectTimer=null,this.closeTimer=null,this.isConnecting=!1}subscribe(l,i){let f=typeof l=="string"?l:"";if(!f)return this.logger("WebSocketConnectionPool: subscribe called without symbol"),null;if(!this.createWebSocket)return this.logger("WebSocketConnectionPool: createWebSocket not configured"),null;let w=this.buildSubscriber(i);if(!w.onData)return this.logger("WebSocketConnectionPool: subscriber missing onData handler for",f),null;let E=this.symbolEntries[f];E||(E={symbol:f,subscribers:[],subscribed:!1,subscriptionRequested:!1,meta:{}},this.symbolEntries[f]=E),E.subscribers.push(w),this.clearCloseTimer(),this.ensureConnection(),this.isSocketOpen()&&!E.subscribed&&!E.subscriptionRequested&&this.requestSubscribe(E);let y=this;return{symbol:f,unsubscribe:function(){y.removeSubscriber(f,w)},updateMetadata:function(S){y.updateSymbolMetadata(f,S)},getMetadata:function(){let S=y.symbolEntries[f];return S?S.meta:null}}}removeSubscriber(l,i){let f=this.symbolEntries[l];if(!f)return;let w=f.subscribers.indexOf(i);if(w>=0&&f.subscribers.splice(w,1),!(f.subscribers.length>0)){if(this.isSocketOpen()&&this.unsubscribeHandler&&(f.subscribed||f.subscriptionRequested))try{this.unsubscribeHandler(this.ws,l,f.meta)}catch(E){this.logger("WebSocketConnectionPool: unsubscribe handler error",E)}delete this.symbolEntries[l],this.maybeCloseConnection()}}ensureConnection(){if(this.ws||this.isConnecting)return;let l=null;try{l=this.createWebSocket()}catch(i){this.logger("WebSocketConnectionPool: failed to create WebSocket",i);return}if(!l){this.logger("WebSocketConnectionPool: createWebSocket returned falsy value"),this.scheduleReconnect();return}this.ws=l,this.wsClosedByUser=!1,this.isConnecting=!0,this.attachSocketHandlers(l)}attachSocketHandlers(l){let i=this;l.onopen=function(){if(i.isConnecting=!1,i.onOpen)try{i.onOpen(i.ws)}catch(f){i.logger("WebSocketConnectionPool: onOpen handler error",f)}i.flushPendingSubscriptions()},l.onmessage=function(f){if(i.handleMessageFn)try{i.handleMessageFn(f,i.buildMessageHelpers())}catch(w){i.logger("WebSocketConnectionPool: handleMessage error",w)}},l.onerror=function(f){if(i.onError)try{i.onError(f)}catch(w){i.logger("WebSocketConnectionPool: onError handler error",w)}},l.onclose=function(f){i.handleSocketClose(f)}}handleSocketClose(l){if(this.onClose)try{this.onClose(l)}catch(f){this.logger("WebSocketConnectionPool: onClose handler error",f)}let i=this.hasSubscribers();if(this.isConnecting=!1,this.ws=null,!this.wsClosedByUser&&i){this.resetSubscriptionState(),this.notifyAllDisconnected(),this.scheduleReconnect();return}this.wsClosedByUser=!1,this.resetSubscriptionState()}resetSubscriptionState(){let l=Object.keys(this.symbolEntries);for(let i=0;i<l.length;i++){let f=this.symbolEntries[l[i]];f.subscribed=!1,f.subscriptionRequested=!1}}scheduleReconnect(){if(this.reconnectTimer||!this.hasSubscribers())return;let l=this;this.reconnectTimer=setTimeout(function(){l.reconnectTimer=null,l.hasSubscribers()&&l.ensureConnection()},this.reconnectDelayMs)}clearReconnectTimer(){this.reconnectTimer&&(clearTimeout(this.reconnectTimer),this.reconnectTimer=null)}flushPendingSubscriptions(){let l=Object.keys(this.symbolEntries);for(let i=0;i<l.length;i++){let f=this.symbolEntries[l[i]];!f.subscribed&&!f.subscriptionRequested&&this.requestSubscribe(f)}}requestSubscribe(l){if(!(!l||!this.isSocketOpen())){if(!this.subscribeHandler){l.subscribed=!0,this.notifySubscribed(l.symbol,null);return}try{l.subscriptionRequested=!0,this.subscribeHandler(this.ws,l.symbol,l.meta)}catch(i){l.subscriptionRequested=!1,this.logger("WebSocketConnectionPool: subscribe handler error",i),this.notifySubscribeError(l.symbol,i)}}}notifySubscribed(l,i){let f=this.symbolEntries[l];if(!f)return;if(f.subscribed){i&&t(f.meta,i);return}f.subscribed=!0,f.subscriptionRequested=!1,i&&t(f.meta,i);let w=f.subscribers;for(let E=0;E<w.length;E++){let y=w[E];if(y.onSubscribed)try{y.onSubscribed(y.context)}catch(S){this.logger("WebSocketConnectionPool: onSubscribed handler error",S)}}}notifySubscribeError(l,i){let f=this.symbolEntries[l];if(!f)return;let w=f.subscribers;for(let E=0;E<w.length;E++){let y=w[E];if(y.onError)try{y.onError(i,y.context)}catch(S){this.logger("WebSocketConnectionPool: onError handler error",S)}}}notifyAllDisconnected(){let l=Object.keys(this.symbolEntries);for(let i=0;i<l.length;i++)this.notifyDisconnected(l[i])}notifyDisconnected(l){let i=this.symbolEntries[l];if(!i)return;let f=i.subscribers;for(let w=0;w<f.length;w++){let E=f[w];if(E.onDisconnected)try{E.onDisconnected(E.context)}catch(y){this.logger("WebSocketConnectionPool: onDisconnected handler error",y)}}}dispatch(l,i,f){let w=this.symbolEntries[l];if(!w)return;let E=w.subscribers;for(let y=0;y<E.length;y++){let S=E[y];if(S.onData)try{S.onData(i,f,S.context)}catch(d){this.logger("WebSocketConnectionPool: subscriber onData error",d)}}}dispatchToAll(l,i){let f=Object.keys(this.symbolEntries);for(let w=0;w<f.length;w++)this.dispatch(f[w],l,i)}markSymbolSubscribed(l,i){this.notifySubscribed(l,i)}markSymbolUnsubscribed(l){let i=this.symbolEntries[l];i&&(i.subscribed=!1,i.subscriptionRequested=!1)}updateSymbolMetadata(l,i){let f=this.symbolEntries[l];f&&t(f.meta,i)}getSymbolMetadata(l){let i=this.symbolEntries[l];return i?i.meta:null}findSymbolByMeta(l){if(typeof l!="function")return null;let i=Object.keys(this.symbolEntries);for(let f=0;f<i.length;f++){let w=this.symbolEntries[i[f]];if(l(w.meta,w.symbol))return w.symbol}return null}hasSubscribers(){let l=Object.keys(this.symbolEntries);for(let i=0;i<l.length;i++)if(this.symbolEntries[l[i]].subscribers.length>0)return!0;return!1}maybeCloseConnection(){this.hasSubscribers()||(this.autoCloseDelayMs>0?this.scheduleCloseTimer():this.closeConnection())}scheduleCloseTimer(){if(this.closeTimer)return;let l=this;this.closeTimer=setTimeout(function(){l.closeTimer=null,l.hasSubscribers()||l.closeConnection()},this.autoCloseDelayMs)}clearCloseTimer(){this.closeTimer&&(clearTimeout(this.closeTimer),this.closeTimer=null)}closeConnection(){if(this.clearReconnectTimer(),!!this.ws){this.wsClosedByUser=!0;try{this.ws.close()}catch(l){this.logger("WebSocketConnectionPool: error closing WebSocket",l)}this.ws=null}}buildSubscriber(l){let i=l||{};return{context:i.context||null,onData:typeof i.onData=="function"?i.onData:null,onError:typeof i.onError=="function"?i.onError:null,onSubscribed:typeof i.onSubscribed=="function"?i.onSubscribed:null,onDisconnected:typeof i.onDisconnected=="function"?i.onDisconnected:null}}buildMessageHelpers(){let l=this;return{dispatch:function(i,f,w){l.dispatch(i,f,w)},dispatchToAll:function(i,f){l.dispatchToAll(i,f)},markSubscribed:function(i,f){l.markSymbolSubscribed(i,f)},markUnsubscribed:function(i){l.markSymbolUnsubscribed(i)},updateMetadata:function(i,f){l.updateSymbolMetadata(i,f)},getMetadata:function(i){return l.getSymbolMetadata(i)},findSymbol:function(i){return l.findSymbolByMeta(i)},getActiveSymbols:function(){return Object.keys(l.symbolEntries)}}}isSocketOpen(){return this.ws&&this.ws.readyState===1}}return{WebSocketConnectionPool:c}})});var $t=he((wn,Ze)=>{"use strict";(function(r,t){let c=typeof globalThis!="undefined"?globalThis:r,u=typeof Ze=="object"&&Ze.exports?[Ye(),Qe(),bt(),Ke(),Rt()]:[r==null?void 0:r.CryptoTickerProviders,r==null?void 0:r.CryptoTickerProviders,r==null?void 0:r.CryptoTickerProviders,r==null?void 0:r.CryptoTickerConnectionStates,r==null?void 0:r.CryptoTickerProviders],l=t(u[0],u[1],u[2],u[3],u[4]);typeof Ze=="object"&&Ze.exports&&(Ze.exports=l),c&&(c.CryptoTickerProviders=c.CryptoTickerProviders||{},c.CryptoTickerProviders.BinanceProvider=l.BinanceProvider)})(typeof self!="undefined"?self:wn,function(r,t,c,u,l){let i=r.ProviderInterface||r,f=t.GenericProvider||t,w=c.TickerSubscriptionManager||c,E=u||{LIVE:"live",DETACHED:"detached",BACKUP:"backup",BROKEN:"broken"},y=l.WebSocketConnectionPool||l,S=5e3;function d(){return typeof WebSocket!="undefined"?WebSocket:typeof window!="undefined"&&window.WebSocket?window.WebSocket:typeof global!="undefined"&&global.WebSocket?global.WebSocket:null}function s(h){let p=parseFloat(h);return isNaN(p)?0:p}function g(h){return s(h)/100}function R(h){switch(h){case"MINUTES_1":return"1m";case"MINUTES_5":return"5m";case"MINUTES_15":return"15m";case"HOURS_1":return"1h";case"HOURS_6":return"6h";case"HOURS_12":return"12h";case"DAYS_1":return"1d";case"DAYS_7":return"1w";case"MONTHS_1":return"1M"}return null}class A extends i{constructor(p){super(p);let k=p||{};this.genericFallback=k.genericFallback instanceof f?k.genericFallback:new f(p),this.restBaseUrl=typeof k.binanceRestBaseUrl=="string"&&k.binanceRestBaseUrl.length>0?k.binanceRestBaseUrl:"https://api.binance.com",this.wsBaseUrl=typeof k.binanceWsBaseUrl=="string"&&k.binanceWsBaseUrl.length>0?k.binanceWsBaseUrl:"wss://stream.binance.com:9443/ws",this.symbolOverrides=k.binanceSymbolOverrides||{},this.wsReconnectDelayMs=typeof k.retryDelayMs=="number"?k.retryDelayMs:S;let x={logger:(...m)=>{this.logger(...m)},fetchTicker:this.fetchTickerDirect.bind(this),subscribeStreaming:this.subscribeStream.bind(this),unsubscribeStreaming:this.unsubscribeStream.bind(this),fallbackPollIntervalMs:k.fallbackPollIntervalMs,staleTickerTimeoutMs:k.staleTickerTimeoutMs};this.subscriptionManager=new w(x),this.wsRequestId=0,this.webSocketPool=new y({logger:(...m)=>{this.logger(...m)},reconnectDelayMs:this.wsReconnectDelayMs,createWebSocket:()=>{let m=d();if(!m)return this.logger("BinanceProvider: WebSocket not available in this environment"),null;let O=this.wsBaseUrl.replace(/\/$/,"");try{return new m(O)}catch(T){return this.logger("BinanceProvider: error creating pooled WebSocket",T),null}},subscribe:(m,O)=>{this.sendBinanceSubscription(m,O,!0)},unsubscribe:(m,O)=>{this.sendBinanceSubscription(m,O,!1)},handleMessage:(m,O)=>{this.handlePoolMessage(m,O)},onError:m=>{this.logger("BinanceProvider: pooled WebSocket error",m)},onClose:()=>{this.wsRequestId=0}})}getId(){return"BINANCE"}subscribeTicker(p,k){return this.subscriptionManager.subscribe(p,k)}getCachedTicker(p){let k=this.subscriptionManager.getCachedTicker(p);return k||(this.genericFallback&&typeof this.genericFallback.getCachedTicker=="function"?this.genericFallback.getCachedTicker(p):null)}ensureConnection(){let p=this;this.subscriptionManager.forEachEntry(function(k){p.subscriptionManager.ensureStreaming(k)})}async fetchTicker(p){try{return await this.fetchTickerDirect(p)}catch(k){if(this.logger("BinanceProvider: direct fetch failed, using fallback",k),this.genericFallback&&typeof this.genericFallback.fetchTicker=="function")return this.genericFallback.fetchTicker(p);throw k}}async fetchTickerDirect(p){let k=this.resolveSymbol(p);if(!k)throw new Error("BinanceProvider: unable to resolve symbol for "+(p.symbol||""));let x=this.buildRestUrl(k);try{let m=await fetch(x);if(!m||!m.ok)throw new Error("BinanceProvider: REST response not ok for "+k);let O=await m.json(),T=this.transformRestTicker(O,p,k);return T.connectionState=E.DETACHED,T}catch(m){if(this.logger("BinanceProvider: REST fetch error",m),this.genericFallback&&typeof this.genericFallback.fetchTicker=="function"){let O=await this.genericFallback.fetchTicker(p);return O&&typeof O=="object"&&!O.connectionState&&(O.connectionState=E.BACKUP),O}throw m}}subscribeStream(p){if(!p)return!1;let k=this.ensureEntryMeta(p);if(k.binanceSymbol=this.resolveSymbol(p.params),!k.binanceSymbol)return this.logger("BinanceProvider: cannot subscribe, unresolved symbol",p.params),!1;let x=this.webSocketPool.subscribe(k.binanceSymbol,{context:p,onData:m=>{let O=this.transformStreamTicker(m,p,k.binanceSymbol);this.subscriptionManager.handleStreamingUpdate(p.key,O)},onSubscribed:()=>{p.streamingActive=!0},onDisconnected:()=>{p.streamingActive=!1},onError:m=>{this.logger("BinanceProvider: subscription error",m)}});return x?(k.poolSubscription=x,p.streamingActive=!0,!0):(p.streamingActive=!1,!1)}unsubscribeStream(p){if(!p)return!0;let k=this.ensureEntryMeta(p);return k.poolSubscription&&typeof k.poolSubscription.unsubscribe=="function"&&k.poolSubscription.unsubscribe(),k.poolSubscription=null,p.streamingActive=!1,!0}resolveSymbol(p){if(!p)return null;let k=(p.symbol||"").toUpperCase();return k?this.symbolOverrides&&this.symbolOverrides[k]?(this.symbolOverrides[k]||"").toUpperCase():k.endsWith("USD")?k.slice(0,-3)+"USDT":k:null}buildRestUrl(p){return this.restBaseUrl.replace(/\/$/,"")+"/api/v3/ticker/24hr?symbol="+encodeURIComponent(p)}sendBinanceSubscription(p,k,x){if(!p||!k)return;let m=k.toLowerCase()+"@ticker",O={method:x?"SUBSCRIBE":"UNSUBSCRIBE",params:[m],id:this.nextWsRequestId()};try{p.send(JSON.stringify(O))}catch(T){this.logger("BinanceProvider: error sending subscription message",T)}}nextWsRequestId(){return this.wsRequestId+=1,this.wsRequestId>1e6&&(this.wsRequestId=1),this.wsRequestId}handlePoolMessage(p,k){if(!p)return;let x=p.data;if(!x)return;if(typeof x=="string")try{x=JSON.parse(x)}catch(T){this.logger("BinanceProvider: failed to parse WebSocket message",T);return}if(!x||Array.isArray(x))return;if(x.error){this.logger("BinanceProvider: WebSocket error message",x.error);return}if(typeof x.result!="undefined")return;let m=x;if(x.data&&typeof x.data=="object"&&(m=x.data),!m||typeof m!="object")return;let O=(m.s||m.symbol||"").toUpperCase();O&&(k.markSubscribed(O),k.dispatch(O,m,x))}transformRestTicker(p,k,x){let m=k&&k.symbol?k.symbol:x;return{changeDaily:s(p.priceChange),changeDailyPercent:g(p.priceChangePercent),last:s(p.lastPrice),volume:s(p.volume),high:s(p.highPrice),low:s(p.lowPrice),pair:m,pairDisplay:m}}transformStreamTicker(p,k,x){let m=k?k.params:null,O=m&&m.symbol?m.symbol:x;return{changeDaily:s(p.p||p.priceChange),changeDailyPercent:g(p.P||p.priceChangePercent),last:s(p.c||p.lastPrice),volume:s(p.v||p.volume),high:s(p.h||p.highPrice),low:s(p.l||p.lowPrice),pair:O,pairDisplay:O}}ensureEntryMeta(p){return p.meta=p.meta||{},p.meta}async fetchCandles(p){let k=this.resolveSymbol(p);if(!k)throw new Error("BinanceProvider: unable to resolve symbol for candles");let x=R(p.interval);if(!x)throw new Error("BinanceProvider: unsupported interval "+p.interval);let m=Math.min(Math.max(parseInt(p.limit,10)||24,1),1e3),T=this.restBaseUrl.replace(/\/$/,"")+"/api/v3/klines?symbol="+encodeURIComponent(k)+"&interval="+encodeURIComponent(x)+"&limit="+m;try{let L=await fetch(T);if(!L||!L.ok)throw new Error("BinanceProvider: candles response not ok");let V=await L.json();if(!Array.isArray(V))throw new Error("BinanceProvider: unexpected candles payload");return V.map(function(N){return{ts:Math.floor((N[0]||0)/1e3),open:s(N[1]),high:s(N[2]),low:s(N[3]),close:s(N[4]),volume:s(N[5]),volumeQuote:s(N[7])}})}catch(L){if(this.logger("BinanceProvider: error fetching candles",L),this.genericFallback&&typeof this.genericFallback.fetchCandles=="function")return this.genericFallback.fetchCandles(p);throw L}}}return{BinanceProvider:A}})});var Ht=he((Cn,et)=>{"use strict";(function(r,t){let c=typeof globalThis!="undefined"?globalThis:r,u=typeof et=="object"&&et.exports?[Ye(),Qe(),bt(),Ke(),Rt()]:[r==null?void 0:r.CryptoTickerProviders,r==null?void 0:r.CryptoTickerProviders,r==null?void 0:r.CryptoTickerProviders,r==null?void 0:r.CryptoTickerConnectionStates,r==null?void 0:r.CryptoTickerProviders],l=t(u[0],u[1],u[2],u[3],u[4]);typeof et=="object"&&et.exports&&(et.exports=l),c&&(c.CryptoTickerProviders=c.CryptoTickerProviders||{},c.CryptoTickerProviders.BitfinexProvider=l.BitfinexProvider)})(typeof self!="undefined"?self:Cn,function(r,t,c,u,l){let i=r.ProviderInterface||r,f=t.GenericProvider||t,w=c.TickerSubscriptionManager||c,E=u||{LIVE:"live",DETACHED:"detached",BACKUP:"backup",BROKEN:"broken"},y=l.WebSocketConnectionPool||l,S=5e3;function d(){return typeof WebSocket!="undefined"?WebSocket:typeof window!="undefined"&&window.WebSocket?window.WebSocket:typeof global!="undefined"&&global.WebSocket?global.WebSocket:null}function s(A){let h=parseFloat(A);return isNaN(h)?0:h}function g(A){switch(A){case"MINUTES_1":return"1m";case"MINUTES_5":return"5m";case"MINUTES_15":return"15m";case"HOURS_1":return"1h";case"HOURS_6":return"6h";case"HOURS_12":return"12h";case"DAYS_1":return"1D";case"DAYS_7":return"1W";case"MONTHS_1":return"1M"}return null}class R extends i{constructor(h){super(h);let p=h||{};this.genericFallback=p.genericFallback instanceof f?p.genericFallback:new f(h),this.restBaseUrl=typeof p.bitfinexRestBaseUrl=="string"&&p.bitfinexRestBaseUrl.length>0?p.bitfinexRestBaseUrl:"https://api-pub.bitfinex.com",this.wsBaseUrl=typeof p.bitfinexWsBaseUrl=="string"&&p.bitfinexWsBaseUrl.length>0?p.bitfinexWsBaseUrl:"wss://api-pub.bitfinex.com/ws/2",this.symbolOverrides=p.bitfinexSymbolOverrides||{},this.wsReconnectDelayMs=typeof p.retryDelayMs=="number"?p.retryDelayMs:S;let k={logger:(...x)=>{this.logger(...x)},fetchTicker:this.fetchTickerDirect.bind(this),subscribeStreaming:this.subscribeStream.bind(this),unsubscribeStreaming:this.unsubscribeStream.bind(this),fallbackPollIntervalMs:p.fallbackPollIntervalMs,staleTickerTimeoutMs:p.staleTickerTimeoutMs};this.subscriptionManager=new w(k),this.channelIdToSymbol={},this.webSocketPool=new y({logger:(...x)=>{this.logger(...x)},reconnectDelayMs:this.wsReconnectDelayMs,createWebSocket:()=>{let x=d();if(!x)return this.logger("BitfinexProvider: WebSocket not available in this environment"),null;let m=this.wsBaseUrl.replace(/\/$/,"");try{return new x(m)}catch(O){return this.logger("BitfinexProvider: error creating pooled WebSocket",O),null}},subscribe:(x,m)=>{this.sendBitfinexSubscribe(x,m)},unsubscribe:(x,m,O)=>{this.sendBitfinexUnsubscribe(x,m,O)},handleMessage:(x,m)=>{this.handlePoolMessage(x,m)},onError:x=>{this.logger("BitfinexProvider: pooled WebSocket error",x)},onClose:()=>{this.channelIdToSymbol={}}})}getId(){return"BITFINEX"}subscribeTicker(h,p){return this.subscriptionManager.subscribe(h,p)}getCachedTicker(h){let p=this.subscriptionManager.getCachedTicker(h);return p||(this.genericFallback&&typeof this.genericFallback.getCachedTicker=="function"?this.genericFallback.getCachedTicker(h):null)}ensureConnection(){let h=this;this.subscriptionManager.forEachEntry(function(p){h.subscriptionManager.ensureStreaming(p)})}async fetchTicker(h){try{return await this.fetchTickerDirect(h)}catch(p){if(this.logger("BitfinexProvider: direct fetch failed, using fallback",p),this.genericFallback&&typeof this.genericFallback.fetchTicker=="function")return this.genericFallback.fetchTicker(h);throw p}}async fetchTickerDirect(h){let p=this.resolveSymbol(h);if(!p)throw new Error("BitfinexProvider: unable to resolve symbol for "+(h.symbol||""));let k=this.buildRestUrl(p);try{let x=await fetch(k);if(!x||!x.ok)throw new Error("BitfinexProvider: REST response not ok for "+p);let m=await x.json(),O=this.transformRestTicker(m,h,p);return O.connectionState=E.DETACHED,O}catch(x){if(this.logger("BitfinexProvider: REST fetch error",x),this.genericFallback&&typeof this.genericFallback.fetchTicker=="function"){let m=await this.genericFallback.fetchTicker(h);return m&&typeof m=="object"&&!m.connectionState&&(m.connectionState=E.BACKUP),m}throw x}}subscribeStream(h){if(!h)return!1;let p=this.ensureEntryMeta(h);if(p.bitfinexSymbol=this.resolveSymbol(h.params),!p.bitfinexSymbol)return this.logger("BitfinexProvider: cannot subscribe, unresolved symbol",h.params),!1;p.chanId=null;let k=this.webSocketPool.subscribe(p.bitfinexSymbol,{context:h,onData:x=>{let m=this.buildTickerFromArray(x,h);m&&this.subscriptionManager.handleStreamingUpdate(h.key,m)},onSubscribed:()=>{h.streamingActive=!0;let x=k.getMetadata?k.getMetadata():null;x&&x.chanId&&(p.chanId=x.chanId,this.channelIdToSymbol[p.chanId]=p.bitfinexSymbol)},onDisconnected:()=>{h.streamingActive=!1,p.chanId=null},onError:x=>{this.logger("BitfinexProvider: subscription error",x)}});return k?(p.poolSubscription=k,h.streamingActive=!0,!0):(h.streamingActive=!1,!1)}unsubscribeStream(h){if(!h)return!0;let p=this.ensureEntryMeta(h);return p.poolSubscription&&typeof p.poolSubscription.unsubscribe=="function"&&p.poolSubscription.unsubscribe(),p.poolSubscription=null,p.chanId=null,h.streamingActive=!1,!0}resolveSymbol(h){if(!h)return null;let p=(h.symbol||"").toUpperCase();if(!p)return null;if(this.symbolOverrides&&this.symbolOverrides[p])return(this.symbolOverrides[p]||"").toUpperCase();let k=p.replace(/[:/]/g,"");if(!k)return null;let x=k.toUpperCase();return"t"+(x.startsWith("T")?x.substring(1):x)}buildRestUrl(h){return this.restBaseUrl.replace(/\/$/,"")+"/v2/ticker/"+encodeURIComponent(h)}sendBitfinexSubscribe(h,p){if(!h||!p)return;let k={event:"subscribe",channel:"ticker",symbol:p};try{h.send(JSON.stringify(k))}catch(x){this.logger("BitfinexProvider: error sending subscribe",x)}}sendBitfinexUnsubscribe(h,p,k){if(!h)return;let x=k&&k.chanId;if(x)try{h.send(JSON.stringify({event:"unsubscribe",chanId:x}))}catch(m){this.logger("BitfinexProvider: error sending unsubscribe",m)}}handlePoolMessage(h,p){if(!h)return;let k=h.data;if(k){if(typeof k=="string")try{k=JSON.parse(k)}catch(x){this.logger("BitfinexProvider: failed to parse WebSocket message",x);return}if(k){if(Array.isArray(k)){this.handleBitfinexDataArray(k,p);return}k&&typeof k=="object"&&this.handleBitfinexEvent(k,p)}}}handleBitfinexEvent(h,p){if(!h||typeof h!="object")return;let k=h.event;if(k==="subscribed"&&h.channel==="ticker"){let x=typeof h.symbol=="string"?h.symbol:"";if(!x)return;let m=h.chanId;m&&(this.channelIdToSymbol[m]=x),p.markSubscribed(x,{chanId:m||null});return}if(k==="unsubscribed"){let x=h.chanId,m=null;x&&(m=this.channelIdToSymbol[x]||p.findSymbol(function(O){return O&&O.chanId===x}),delete this.channelIdToSymbol[x]),m&&(p.markUnsubscribed(m),p.updateMetadata(m,{chanId:null}));return}k==="error"&&this.logger("BitfinexProvider: subscription error",h)}handleBitfinexDataArray(h,p){if(!Array.isArray(h)||h.length<2)return;let k=h[0],x=h[1];if(x==="hb"||!Array.isArray(x))return;let m=this.channelIdToSymbol[k]||p.findSymbol(function(O){return O&&O.chanId===k});m&&p.dispatch(m,x,h)}buildTickerFromArray(h,p){if(!Array.isArray(h))return null;let k=p?p.params:null,x=k&&k.symbol?k.symbol:this.ensureEntryMeta(p).bitfinexSymbol;return{changeDaily:s(h[4]),changeDailyPercent:s(h[5]),last:s(h[6]),volume:s(h[7]),high:s(h[8]),low:s(h[9]),pair:x,pairDisplay:x}}transformRestTicker(h,p,k){if(!Array.isArray(h))throw new Error("BitfinexProvider: unexpected REST payload for "+k);let x=p&&p.symbol?p.symbol:k;return{changeDaily:s(h[4]),changeDailyPercent:s(h[5]),last:s(h[6]),volume:s(h[7]),high:s(h[8]),low:s(h[9]),pair:x,pairDisplay:x}}ensureEntryMeta(h){return h.meta=h.meta||{},h.meta}async fetchCandles(h){let p=this.resolveSymbol(h);if(!p)throw new Error("BitfinexProvider: unable to resolve symbol for candles");let k=g(h.interval);if(!k)throw new Error("BitfinexProvider: unsupported interval "+h.interval);let x=Math.min(Math.max(parseInt(h.limit,10)||24,1),1e3),O=this.restBaseUrl.replace(/\/$/,"")+"/v2/candles/trade:"+k+":"+encodeURIComponent(p)+"/hist?limit="+x;try{let T=await fetch(O);if(!T||!T.ok)throw new Error("BitfinexProvider: candles response not ok");let L=await T.json();if(!Array.isArray(L))throw new Error("BitfinexProvider: unexpected candles payload");return L.map(function(V){return{ts:Math.floor((V[0]||0)/1e3),open:s(V[1]),close:s(V[2]),high:s(V[3]),low:s(V[4]),volume:s(V[5]),volumeQuote:s(V[5])}})}catch(T){if(this.logger("BitfinexProvider: error fetching candles",T),this.genericFallback&&typeof this.genericFallback.fetchCandles=="function")return this.genericFallback.fetchCandles(h);throw T}}}return{BitfinexProvider:R}})});var Vt=he((kn,tt)=>{"use strict";(function(r,t){let c=typeof globalThis!="undefined"?globalThis:r,u=typeof tt=="object"&&tt.exports?[Ye(),Qe()]:[r==null?void 0:r.CryptoTickerProviders,r==null?void 0:r.CryptoTickerProviders],l=t(u[0],u[1]);typeof tt=="object"&&tt.exports&&(tt.exports=l),c&&(c.CryptoTickerProviders=c.CryptoTickerProviders||{},c.CryptoTickerProviders.YFinanceProvider=l.YFinanceProvider)})(typeof self!="undefined"?self:kn,function(r,t){let c=r.ProviderInterface||r,u=t.GenericProvider||t;class l extends c{constructor(f){super(f);let w=f||{};this.genericFallback=w.genericFallback instanceof u?w.genericFallback:new u(f)}getId(){return"YFINANCE"}ensureConnection(){this.genericFallback.ensureConnection()}subscribeTicker(f,w){return this.genericFallback.subscribeTicker(f,w)}async fetchTicker(f){return this.genericFallback.fetchTicker(f)}getCachedTicker(f){return this.genericFallback.getCachedTicker(f)}}return{YFinanceProvider:l}})});var Tn=he((Sn,nt)=>{"use strict";(function(r,t){let c=typeof globalThis!="undefined"?globalThis:r,u=typeof nt=="object"&&nt.exports?[Qe(),$t(),Ht(),Vt()]:[r==null?void 0:r.CryptoTickerProviders,r==null?void 0:r.CryptoTickerProviders,r==null?void 0:r.CryptoTickerProviders,r==null?void 0:r.CryptoTickerProviders],l=t(u[0],u[1],u[2],u[3]);typeof nt=="object"&&nt.exports&&(nt.exports=l),c&&(c.CryptoTickerProviders=c.CryptoTickerProviders||{},c.CryptoTickerProviders.ProviderRegistry=l.ProviderRegistry)})(typeof self!="undefined"?self:Sn,function(r,t,c,u){let l=r.GenericProvider||r,i=t.BinanceProvider||t,f=c.BitfinexProvider||c,w=u.YFinanceProvider||u;class E{constructor(S){let d=S||{};this.logger=typeof d.logger=="function"?d.logger:function(){},this.baseUrl=d.baseUrl||"",this.providers={},this.fallbackPollIntervalMs=typeof d.fallbackPollIntervalMs=="number"?d.fallbackPollIntervalMs:void 0,this.staleTickerTimeoutMs=typeof d.staleTickerTimeoutMs=="number"?d.staleTickerTimeoutMs:void 0,this.binanceRestBaseUrl=typeof d.binanceRestBaseUrl=="string"&&d.binanceRestBaseUrl.length>0?d.binanceRestBaseUrl:"https://api.binance.com",this.binanceWsBaseUrl=typeof d.binanceWsBaseUrl=="string"&&d.binanceWsBaseUrl.length>0?d.binanceWsBaseUrl:"wss://stream.binance.com:9443/ws",this.binanceSymbolOverrides=d.binanceSymbolOverrides||{},this.bitfinexRestBaseUrl=typeof d.bitfinexRestBaseUrl=="string"&&d.bitfinexRestBaseUrl.length>0?d.bitfinexRestBaseUrl:"https://api-pub.bitfinex.com",this.bitfinexWsBaseUrl=typeof d.bitfinexWsBaseUrl=="string"&&d.bitfinexWsBaseUrl.length>0?d.bitfinexWsBaseUrl:"wss://api-pub.bitfinex.com/ws/2",this.bitfinexSymbolOverrides=d.bitfinexSymbolOverrides||{};let s={baseUrl:this.baseUrl,logger:this.logger,fallbackPollIntervalMs:this.fallbackPollIntervalMs,staleTickerTimeoutMs:this.staleTickerTimeoutMs};this.genericProvider=d.genericProvider instanceof l?d.genericProvider:new l(s),this.register(this.genericProvider),this.register(new i({baseUrl:this.baseUrl,logger:this.logger,fallbackPollIntervalMs:this.fallbackPollIntervalMs,staleTickerTimeoutMs:this.staleTickerTimeoutMs,genericFallback:this.genericProvider,binanceRestBaseUrl:this.binanceRestBaseUrl,binanceWsBaseUrl:this.binanceWsBaseUrl,binanceSymbolOverrides:this.binanceSymbolOverrides})),this.register(new f({baseUrl:this.baseUrl,logger:this.logger,fallbackPollIntervalMs:this.fallbackPollIntervalMs,staleTickerTimeoutMs:this.staleTickerTimeoutMs,genericFallback:this.genericProvider,bitfinexRestBaseUrl:this.bitfinexRestBaseUrl,bitfinexWsBaseUrl:this.bitfinexWsBaseUrl,bitfinexSymbolOverrides:this.bitfinexSymbolOverrides})),this.register(new w({baseUrl:this.baseUrl,logger:this.logger,fallbackPollIntervalMs:this.fallbackPollIntervalMs,staleTickerTimeoutMs:this.staleTickerTimeoutMs,genericFallback:this.genericProvider}))}register(S){if(!S||typeof S.getId!="function")return;let d=S.getId();d&&(this.providers[d.toUpperCase()]=S)}getProvider(S){let d=(S||"").toUpperCase();return this.providers[d]||this.genericProvider}getGenericProvider(){return this.genericProvider}ensureAllConnections(){let S=Object.keys(this.providers);for(let d=0;d<S.length;d++){let s=this.providers[S[d]];s&&typeof s.ensureConnection=="function"&&s.ensureConnection()}}}return{ProviderRegistry:E}})});var zt=he((En,Mt)=>{"use strict";(function(r,t){let c=t();typeof Mt=="object"&&Mt.exports&&(Mt.exports=c),r&&typeof r=="object"&&(r.CryptoTickerFormatters=c)})(typeof self!="undefined"?self:En,function(){let r=["auto","full","compact","plain"],t=[{value:1e12,suffix:"T"},{value:1e9,suffix:"B"},{value:1e6,suffix:"M"},{value:1e3,suffix:"K"}];function c(l,i,f,w){let E=w||"auto",S=typeof i=="number"?i:parseInt(String(i!=null?i:""),10);(Number.isNaN(S)||S<0)&&(S=2);let d=l*(typeof f=="number"?f:1),s=Math.abs(d),g=d<0?"-":"";function R(k,x){let m=Math.pow(10,x);return Math.round(k*m)/m}function A(k,x){try{return k.toLocaleString(void 0,x)}catch{return k.toString()}}let h="",p=Math.max(0,S);switch(E){case"full":{let k=R(s,p);h=A(k,{minimumFractionDigits:p,maximumFractionDigits:p,useGrouping:!0});break}case"compact":{let k="",x=s;for(let O of t)if(s>=O.value){k=O.suffix,x=s/O.value;break}let m=R(x,p);h=A(m,{minimumFractionDigits:p,maximumFractionDigits:p,useGrouping:!k})+k;break}case"plain":{let k=R(s,p);h=A(k,{minimumFractionDigits:p,maximumFractionDigits:p,useGrouping:!1});break}case"auto":default:{let k="",x=s;s>1e5&&(k="K",x=s/1e3);let m=R(x,p);h=A(m,{minimumFractionDigits:p,maximumFractionDigits:p,useGrouping:!1})+k;break}}return g+h}function u(l,i,f){return f-i===0?.5:(l-i)/(f-i)}return{getRoundedValue:c,normalizeValue:u}})});var Pn=he((It,xn)=>{(function(r,t){typeof It=="object"&&typeof xn!="undefined"?t(It):typeof define=="function"&&define.amd?define(["exports"],t):(r=r||self,t(r.exprEval={}))})(It,function(r){"use strict";var t="INUMBER",c="IOP1",u="IOP2",l="IOP3",i="IVAR",f="IVARNAME",w="IFUNCALL",E="IFUNDEF",y="IEXPR",S="IEXPREVAL",d="IMEMBER",s="IENDSTATEMENT",g="IARRAY";function R(n,o){this.type=n,this.value=o!=null?o:0}R.prototype.toString=function(){switch(this.type){case t:case c:case u:case l:case i:case f:case s:return this.value;case w:return"CALL "+this.value;case E:return"DEF "+this.value;case g:return"ARRAY "+this.value;case d:return"."+this.value;default:return"Invalid Instruction"}};function A(n){return new R(c,n)}function h(n){return new R(u,n)}function p(n){return new R(l,n)}function k(n,o,v,P,F){for(var j=[],_=[],K,te,ue,le,ge=0;ge<n.length;ge++){var q=n[ge],de=q.type;if(de===t||de===f)Array.isArray(q.value)?j.push.apply(j,k(q.value.map(function(mt){return new R(t,mt)}).concat(new R(g,q.value.length)),o,v,P,F)):j.push(q);else if(de===i&&F.hasOwnProperty(q.value))q=new R(t,F[q.value]),j.push(q);else if(de===u&&j.length>1)te=j.pop(),K=j.pop(),le=v[q.value],q=new R(t,le(K.value,te.value)),j.push(q);else if(de===l&&j.length>2)ue=j.pop(),te=j.pop(),K=j.pop(),q.value==="?"?j.push(K.value?te.value:ue.value):(le=P[q.value],q=new R(t,le(K.value,te.value,ue.value)),j.push(q));else if(de===c&&j.length>0)K=j.pop(),le=o[q.value],q=new R(t,le(K.value)),j.push(q);else if(de===y){for(;j.length>0;)_.push(j.shift());_.push(new R(y,k(q.value,o,v,P,F)))}else if(de===d&&j.length>0)K=j.pop(),j.push(new R(t,K.value[q.value]));else{for(;j.length>0;)_.push(j.shift());_.push(q)}}for(;j.length>0;)_.push(j.shift());return _}function x(n,o,v){for(var P=[],F=0;F<n.length;F++){var j=n[F],_=j.type;if(_===i&&j.value===o)for(var K=0;K<v.tokens.length;K++){var te=v.tokens[K],ue;te.type===c?ue=A(te.value):te.type===u?ue=h(te.value):te.type===l?ue=p(te.value):ue=new R(te.type,te.value),P.push(ue)}else _===y?P.push(new R(y,x(j.value,o,v))):P.push(j)}return P}function m(n,o,v){var P=[],F,j,_,K,te,ue;if(T(n))return L(n,v);for(var le=n.length,ge=0;ge<le;ge++){var q=n[ge],de=q.type;if(de===t||de===f)P.push(q.value);else if(de===u)j=P.pop(),F=P.pop(),q.value==="and"?P.push(F?!!m(j,o,v):!1):q.value==="or"?P.push(F?!0:!!m(j,o,v)):q.value==="="?(K=o.binaryOps[q.value],P.push(K(F,m(j,o,v),v))):(K=o.binaryOps[q.value],P.push(K(L(F,v),L(j,v))));else if(de===l)_=P.pop(),j=P.pop(),F=P.pop(),q.value==="?"?P.push(m(F?j:_,o,v)):(K=o.ternaryOps[q.value],P.push(K(L(F,v),L(j,v),L(_,v))));else if(de===i)if(q.value in o.functions)P.push(o.functions[q.value]);else if(q.value in o.unaryOps&&o.parser.isOperatorEnabled(q.value))P.push(o.unaryOps[q.value]);else{var mt=v[q.value];if(mt!==void 0)P.push(mt);else throw new Error("undefined variable: "+q.value)}else if(de===c)F=P.pop(),K=o.unaryOps[q.value],P.push(K(L(F,v)));else if(de===w){for(ue=q.value,te=[];ue-- >0;)te.unshift(L(P.pop(),v));if(K=P.pop(),K.apply&&K.call)P.push(K.apply(void 0,te));else throw new Error(K+" is not a function")}else if(de===E)P.push(function(){for(var ur=P.pop(),_t=[],hr=q.value;hr-- >0;)_t.unshift(P.pop());var sn=P.pop(),Wt=function(){for(var on=Object.assign({},v),vt=0,fr=_t.length;vt<fr;vt++)on[_t[vt]]=arguments[vt];return m(ur,o,on)};return Object.defineProperty(Wt,"name",{value:sn,writable:!1}),v[sn]=Wt,Wt}());else if(de===y)P.push(O(q,o));else if(de===S)P.push(q);else if(de===d)F=P.pop(),P.push(F[q.value]);else if(de===s)P.pop();else if(de===g){for(ue=q.value,te=[];ue-- >0;)te.unshift(P.pop());P.push(te)}else throw new Error("invalid Expression")}if(P.length>1)throw new Error("invalid Expression (parity)");return P[0]===0?0:L(P[0],v)}function O(n,o,v){return T(n)?n:{type:S,value:function(P){return m(n.value,o,P)}}}function T(n){return n&&n.type===S}function L(n,o){return T(n)?n.value(o):n}function V(n,o){for(var v=[],P,F,j,_,K,te,ue=0;ue<n.length;ue++){var le=n[ue],ge=le.type;if(ge===t)typeof le.value=="number"&&le.value<0?v.push("("+le.value+")"):Array.isArray(le.value)?v.push("["+le.value.map(N).join(", ")+"]"):v.push(N(le.value));else if(ge===u)F=v.pop(),P=v.pop(),_=le.value,o?_==="^"?v.push("Math.pow("+P+", "+F+")"):_==="and"?v.push("(!!"+P+" && !!"+F+")"):_==="or"?v.push("(!!"+P+" || !!"+F+")"):_==="||"?v.push("(function(a,b){ return Array.isArray(a) && Array.isArray(b) ? a.concat(b) : String(a) + String(b); }(("+P+"),("+F+")))"):_==="=="?v.push("("+P+" === "+F+")"):_==="!="?v.push("("+P+" !== "+F+")"):_==="["?v.push(P+"[("+F+") | 0]"):v.push("("+P+" "+_+" "+F+")"):_==="["?v.push(P+"["+F+"]"):v.push("("+P+" "+_+" "+F+")");else if(ge===l)if(j=v.pop(),F=v.pop(),P=v.pop(),_=le.value,_==="?")v.push("("+P+" ? "+F+" : "+j+")");else throw new Error("invalid Expression");else if(ge===i||ge===f)v.push(le.value);else if(ge===c)P=v.pop(),_=le.value,_==="-"||_==="+"?v.push("("+_+P+")"):o?_==="not"?v.push("(!"+P+")"):_==="!"?v.push("fac("+P+")"):v.push(_+"("+P+")"):_==="!"?v.push("("+P+"!)"):v.push("("+_+" "+P+")");else if(ge===w){for(te=le.value,K=[];te-- >0;)K.unshift(v.pop());_=v.pop(),v.push(_+"("+K.join(", ")+")")}else if(ge===E){for(F=v.pop(),te=le.value,K=[];te-- >0;)K.unshift(v.pop());P=v.pop(),o?v.push("("+P+" = function("+K.join(", ")+") { return "+F+" })"):v.push("("+P+"("+K.join(", ")+") = "+F+")")}else if(ge===d)P=v.pop(),v.push(P+"."+le.value);else if(ge===g){for(te=le.value,K=[];te-- >0;)K.unshift(v.pop());v.push("["+K.join(", ")+"]")}else if(ge===y)v.push("("+V(le.value,o)+")");else if(ge!==s)throw new Error("invalid Expression")}return v.length>1&&(o?v=[v.join(",")]:v=[v.join(";")]),String(v[0])}function N(n){return typeof n=="string"?JSON.stringify(n).replace(/\u2028/g,"\\u2028").replace(/\u2029/g,"\\u2029"):n}function X(n,o){for(var v=0;v<n.length;v++)if(n[v]===o)return!0;return!1}function ae(n,o,v){v=v||{};for(var P=!!v.withMembers,F=null,j=0;j<n.length;j++){var _=n[j];_.type===i||_.type===f?!P&&!X(o,_.value)?o.push(_.value):(F!==null&&(X(o,F)||o.push(F)),F=_.value):_.type===d&&P&&F!==null?F+="."+_.value:_.type===y?ae(_.value,o,v):F!==null&&(X(o,F)||o.push(F),F=null)}F!==null&&!X(o,F)&&o.push(F)}function J(n,o){this.tokens=n,this.parser=o,this.unaryOps=o.unaryOps,this.binaryOps=o.binaryOps,this.ternaryOps=o.ternaryOps,this.functions=o.functions}J.prototype.simplify=function(n){return n=n||{},new J(k(this.tokens,this.unaryOps,this.binaryOps,this.ternaryOps,n),this.parser)},J.prototype.substitute=function(n,o){return o instanceof J||(o=this.parser.parse(String(o))),new J(x(this.tokens,n,o),this.parser)},J.prototype.evaluate=function(n){return n=n||{},m(this.tokens,this,n)},J.prototype.toString=function(){return V(this.tokens,!1)},J.prototype.symbols=function(n){n=n||{};var o=[];return ae(this.tokens,o,n),o},J.prototype.variables=function(n){n=n||{};var o=[];ae(this.tokens,o,n);var v=this.functions;return o.filter(function(P){return!(P in v)})},J.prototype.toJSFunction=function(n,o){var v=this,P=new Function(n,"with(this.functions) with (this.ternaryOps) with (this.binaryOps) with (this.unaryOps) { return "+V(this.simplify(o).tokens,!0)+"; }");return function(){return P.apply(v,arguments)}};var re="TEOF",$="TOP",z="TNUMBER",fe="TSTRING",U="TPAREN",H="TBRACKET",ve="TCOMMA",Ce="TNAME",ye="TSEMICOLON";function pe(n,o,v){this.type=n,this.value=o,this.index=v}pe.prototype.toString=function(){return this.type+": "+this.value};function Z(n,o){this.pos=0,this.current=null,this.unaryOps=n.unaryOps,this.binaryOps=n.binaryOps,this.ternaryOps=n.ternaryOps,this.consts=n.consts,this.expression=o,this.savedPosition=0,this.savedCurrent=null,this.options=n.options,this.parser=n}Z.prototype.newToken=function(n,o,v){return new pe(n,o,v!=null?v:this.pos)},Z.prototype.save=function(){this.savedPosition=this.pos,this.savedCurrent=this.current},Z.prototype.restore=function(){this.pos=this.savedPosition,this.current=this.savedCurrent},Z.prototype.next=function(){if(this.pos>=this.expression.length)return this.newToken(re,"EOF");if(this.isWhitespace()||this.isComment())return this.next();if(this.isRadixInteger()||this.isNumber()||this.isOperator()||this.isString()||this.isParen()||this.isBracket()||this.isComma()||this.isSemicolon()||this.isNamedOp()||this.isConst()||this.isName())return this.current;this.parseError('Unknown character "'+this.expression.charAt(this.pos)+'"')},Z.prototype.isString=function(){var n=!1,o=this.pos,v=this.expression.charAt(o);if(v==="'"||v==='"')for(var P=this.expression.indexOf(v,o+1);P>=0&&this.pos<this.expression.length;){if(this.pos=P+1,this.expression.charAt(P-1)!=="\\"){var F=this.expression.substring(o+1,P);this.current=this.newToken(fe,this.unescape(F),o),n=!0;break}P=this.expression.indexOf(v,P+1)}return n},Z.prototype.isParen=function(){var n=this.expression.charAt(this.pos);return n==="("||n===")"?(this.current=this.newToken(U,n),this.pos++,!0):!1},Z.prototype.isBracket=function(){var n=this.expression.charAt(this.pos);return(n==="["||n==="]")&&this.isOperatorEnabled("[")?(this.current=this.newToken(H,n),this.pos++,!0):!1},Z.prototype.isComma=function(){var n=this.expression.charAt(this.pos);return n===","?(this.current=this.newToken(ve,","),this.pos++,!0):!1},Z.prototype.isSemicolon=function(){var n=this.expression.charAt(this.pos);return n===";"?(this.current=this.newToken(ye,";"),this.pos++,!0):!1},Z.prototype.isConst=function(){for(var n=this.pos,o=n;o<this.expression.length;o++){var v=this.expression.charAt(o);if(v.toUpperCase()===v.toLowerCase()&&(o===this.pos||v!=="_"&&v!=="."&&(v<"0"||v>"9")))break}if(o>n){var P=this.expression.substring(n,o);if(P in this.consts)return this.current=this.newToken(z,this.consts[P]),this.pos+=P.length,!0}return!1},Z.prototype.isNamedOp=function(){for(var n=this.pos,o=n;o<this.expression.length;o++){var v=this.expression.charAt(o);if(v.toUpperCase()===v.toLowerCase()&&(o===this.pos||v!=="_"&&(v<"0"||v>"9")))break}if(o>n){var P=this.expression.substring(n,o);if(this.isOperatorEnabled(P)&&(P in this.binaryOps||P in this.unaryOps||P in this.ternaryOps))return this.current=this.newToken($,P),this.pos+=P.length,!0}return!1},Z.prototype.isName=function(){for(var n=this.pos,o=n,v=!1;o<this.expression.length;o++){var P=this.expression.charAt(o);if(P.toUpperCase()===P.toLowerCase()){if(o===this.pos&&(P==="$"||P==="_")){P==="_"&&(v=!0);continue}else if(o===this.pos||!v||P!=="_"&&(P<"0"||P>"9"))break}else v=!0}if(v){var F=this.expression.substring(n,o);return this.current=this.newToken(Ce,F),this.pos+=F.length,!0}return!1},Z.prototype.isWhitespace=function(){for(var n=!1,o=this.expression.charAt(this.pos);(o===" "||o==="	"||o===`
`||o==="\r")&&(n=!0,this.pos++,!(this.pos>=this.expression.length));)o=this.expression.charAt(this.pos);return n};var Te=/^[0-9a-f]{4}$/i;Z.prototype.unescape=function(n){var o=n.indexOf("\\");if(o<0)return n;for(var v=n.substring(0,o);o>=0;){var P=n.charAt(++o);switch(P){case"'":v+="'";break;case'"':v+='"';break;case"\\":v+="\\";break;case"/":v+="/";break;case"b":v+="\b";break;case"f":v+="\f";break;case"n":v+=`
`;break;case"r":v+="\r";break;case"t":v+="	";break;case"u":var F=n.substring(o+1,o+5);Te.test(F)||this.parseError("Illegal escape sequence: \\u"+F),v+=String.fromCharCode(parseInt(F,16)),o+=4;break;default:throw this.parseError('Illegal escape sequence: "\\'+P+'"')}++o;var j=n.indexOf("\\",o);v+=n.substring(o,j<0?n.length:j),o=j}return v},Z.prototype.isComment=function(){var n=this.expression.charAt(this.pos);return n==="/"&&this.expression.charAt(this.pos+1)==="*"?(this.pos=this.expression.indexOf("*/",this.pos)+2,this.pos===1&&(this.pos=this.expression.length),!0):!1},Z.prototype.isRadixInteger=function(){var n=this.pos;if(n>=this.expression.length-2||this.expression.charAt(n)!=="0")return!1;++n;var o,v;if(this.expression.charAt(n)==="x")o=16,v=/^[0-9a-f]$/i,++n;else if(this.expression.charAt(n)==="b")o=2,v=/^[01]$/i,++n;else return!1;for(var P=!1,F=n;n<this.expression.length;){var j=this.expression.charAt(n);if(v.test(j))n++,P=!0;else break}return P&&(this.current=this.newToken(z,parseInt(this.expression.substring(F,n),o)),this.pos=n),P},Z.prototype.isNumber=function(){for(var n=!1,o=this.pos,v=o,P=o,F=!1,j=!1,_;o<this.expression.length&&(_=this.expression.charAt(o),_>="0"&&_<="9"||!F&&_===".");)_==="."?F=!0:j=!0,o++,n=j;if(n&&(P=o),_==="e"||_==="E"){o++;for(var K=!0,te=!1;o<this.expression.length;){if(_=this.expression.charAt(o),K&&(_==="+"||_==="-"))K=!1;else if(_>="0"&&_<="9")te=!0,K=!1;else break;o++}te||(o=P)}return n?(this.current=this.newToken(z,parseFloat(this.expression.substring(v,o))),this.pos=o):this.pos=P,n},Z.prototype.isOperator=function(){var n=this.pos,o=this.expression.charAt(this.pos);if(o==="+"||o==="-"||o==="*"||o==="/"||o==="%"||o==="^"||o==="?"||o===":"||o===".")this.current=this.newToken($,o);else if(o==="\u2219"||o==="\u2022")this.current=this.newToken($,"*");else if(o===">")this.expression.charAt(this.pos+1)==="="?(this.current=this.newToken($,">="),this.pos++):this.current=this.newToken($,">");else if(o==="<")this.expression.charAt(this.pos+1)==="="?(this.current=this.newToken($,"<="),this.pos++):this.current=this.newToken($,"<");else if(o==="|")if(this.expression.charAt(this.pos+1)==="|")this.current=this.newToken($,"||"),this.pos++;else return!1;else if(o==="=")this.expression.charAt(this.pos+1)==="="?(this.current=this.newToken($,"=="),this.pos++):this.current=this.newToken($,o);else if(o==="!")this.expression.charAt(this.pos+1)==="="?(this.current=this.newToken($,"!="),this.pos++):this.current=this.newToken($,o);else return!1;return this.pos++,this.isOperatorEnabled(this.current.value)?!0:(this.pos=n,!1)},Z.prototype.isOperatorEnabled=function(n){return this.parser.isOperatorEnabled(n)},Z.prototype.getCoordinates=function(){var n=0,o,v=-1;do n++,o=this.pos-v,v=this.expression.indexOf(`
`,v+1);while(v>=0&&v<this.pos);return{line:n,column:o}},Z.prototype.parseError=function(n){var o=this.getCoordinates();throw new Error("parse error ["+o.line+":"+o.column+"]: "+n)};function Y(n,o,v){this.parser=n,this.tokens=o,this.current=null,this.nextToken=null,this.next(),this.savedCurrent=null,this.savedNextToken=null,this.allowMemberAccess=v.allowMemberAccess!==!1}Y.prototype.next=function(){return this.current=this.nextToken,this.nextToken=this.tokens.next()},Y.prototype.tokenMatches=function(n,o){return typeof o=="undefined"?!0:Array.isArray(o)?X(o,n.value):typeof o=="function"?o(n):n.value===o},Y.prototype.save=function(){this.savedCurrent=this.current,this.savedNextToken=this.nextToken,this.tokens.save()},Y.prototype.restore=function(){this.tokens.restore(),this.current=this.savedCurrent,this.nextToken=this.savedNextToken},Y.prototype.accept=function(n,o){return this.nextToken.type===n&&this.tokenMatches(this.nextToken,o)?(this.next(),!0):!1},Y.prototype.expect=function(n,o){if(!this.accept(n,o)){var v=this.tokens.getCoordinates();throw new Error("parse error ["+v.line+":"+v.column+"]: Expected "+(o||n))}},Y.prototype.parseAtom=function(n){var o=this.tokens.unaryOps;function v(F){return F.value in o}if(this.accept(Ce)||this.accept($,v))n.push(new R(i,this.current.value));else if(this.accept(z))n.push(new R(t,this.current.value));else if(this.accept(fe))n.push(new R(t,this.current.value));else if(this.accept(U,"("))this.parseExpression(n),this.expect(U,")");else if(this.accept(H,"["))if(this.accept(H,"]"))n.push(new R(g,0));else{var P=this.parseArrayList(n);n.push(new R(g,P))}else throw new Error("unexpected "+this.nextToken)},Y.prototype.parseExpression=function(n){var o=[];this.parseUntilEndStatement(n,o)||(this.parseVariableAssignmentExpression(o),!this.parseUntilEndStatement(n,o)&&this.pushExpression(n,o))},Y.prototype.pushExpression=function(n,o){for(var v=0,P=o.length;v<P;v++)n.push(o[v])},Y.prototype.parseUntilEndStatement=function(n,o){return this.accept(ye)?(this.nextToken&&this.nextToken.type!==re&&!(this.nextToken.type===U&&this.nextToken.value===")")&&o.push(new R(s)),this.nextToken.type!==re&&this.parseExpression(o),n.push(new R(y,o)),!0):!1},Y.prototype.parseArrayList=function(n){for(var o=0;!this.accept(H,"]");)for(this.parseExpression(n),++o;this.accept(ve);)this.parseExpression(n),++o;return o},Y.prototype.parseVariableAssignmentExpression=function(n){for(this.parseConditionalExpression(n);this.accept($,"=");){var o=n.pop(),v=[],P=n.length-1;if(o.type===w){if(!this.tokens.isOperatorEnabled("()="))throw new Error("function definition is not permitted");for(var F=0,j=o.value+1;F<j;F++){var _=P-F;n[_].type===i&&(n[_]=new R(f,n[_].value))}this.parseVariableAssignmentExpression(v),n.push(new R(y,v)),n.push(new R(E,o.value));continue}if(o.type!==i&&o.type!==d)throw new Error("expected variable for assignment");this.parseVariableAssignmentExpression(v),n.push(new R(f,o.value)),n.push(new R(y,v)),n.push(h("="))}},Y.prototype.parseConditionalExpression=function(n){for(this.parseOrExpression(n);this.accept($,"?");){var o=[],v=[];this.parseConditionalExpression(o),this.expect($,":"),this.parseConditionalExpression(v),n.push(new R(y,o)),n.push(new R(y,v)),n.push(p("?"))}},Y.prototype.parseOrExpression=function(n){for(this.parseAndExpression(n);this.accept($,"or");){var o=[];this.parseAndExpression(o),n.push(new R(y,o)),n.push(h("or"))}},Y.prototype.parseAndExpression=function(n){for(this.parseComparison(n);this.accept($,"and");){var o=[];this.parseComparison(o),n.push(new R(y,o)),n.push(h("and"))}};var Ee=["==","!=","<","<=",">=",">","in"];Y.prototype.parseComparison=function(n){for(this.parseAddSub(n);this.accept($,Ee);){var o=this.current;this.parseAddSub(n),n.push(h(o.value))}};var Q=["+","-","||"];Y.prototype.parseAddSub=function(n){for(this.parseTerm(n);this.accept($,Q);){var o=this.current;this.parseTerm(n),n.push(h(o.value))}};var ee=["*","/","%"];Y.prototype.parseTerm=function(n){for(this.parseFactor(n);this.accept($,ee);){var o=this.current;this.parseFactor(n),n.push(h(o.value))}},Y.prototype.parseFactor=function(n){var o=this.tokens.unaryOps;function v(F){return F.value in o}if(this.save(),this.accept($,v)){if(this.current.value!=="-"&&this.current.value!=="+"){if(this.nextToken.type===U&&this.nextToken.value==="("){this.restore(),this.parseExponential(n);return}else if(this.nextToken.type===ye||this.nextToken.type===ve||this.nextToken.type===re||this.nextToken.type===U&&this.nextToken.value===")"){this.restore(),this.parseAtom(n);return}}var P=this.current;this.parseFactor(n),n.push(A(P.value))}else this.parseExponential(n)},Y.prototype.parseExponential=function(n){for(this.parsePostfixExpression(n);this.accept($,"^");)this.parseFactor(n),n.push(h("^"))},Y.prototype.parsePostfixExpression=function(n){for(this.parseFunctionCall(n);this.accept($,"!");)n.push(A("!"))},Y.prototype.parseFunctionCall=function(n){var o=this.tokens.unaryOps;function v(j){return j.value in o}if(this.accept($,v)){var P=this.current;this.parseAtom(n),n.push(A(P.value))}else for(this.parseMemberExpression(n);this.accept(U,"(");)if(this.accept(U,")"))n.push(new R(w,0));else{var F=this.parseArgumentList(n);n.push(new R(w,F))}},Y.prototype.parseArgumentList=function(n){for(var o=0;!this.accept(U,")");)for(this.parseExpression(n),++o;this.accept(ve);)this.parseExpression(n),++o;return o},Y.prototype.parseMemberExpression=function(n){for(this.parseAtom(n);this.accept($,".")||this.accept(H,"[");){var o=this.current;if(o.value==="."){if(!this.allowMemberAccess)throw new Error('unexpected ".", member access is not permitted');this.expect(Ce),n.push(new R(d,this.current.value))}else if(o.value==="["){if(!this.tokens.isOperatorEnabled("["))throw new Error('unexpected "[]", arrays are disabled');this.parseExpression(n),this.expect(H,"]"),n.push(h("["))}else throw new Error("unexpected symbol: "+o.value)}};function Ne(n,o){return Number(n)+Number(o)}function _e(n,o){return n-o}function We(n,o){return n*o}function Fe(n,o){return n/o}function Se(n,o){return n%o}function ce(n,o){return Array.isArray(n)&&Array.isArray(o)?n.concat(o):""+n+o}function De(n,o){return n===o}function Ue(n,o){return n!==o}function je(n,o){return n>o}function Be(n,o){return n<o}function I(n,o){return n>=o}function e(n,o){return n<=o}function a(n,o){return!!(n&&o)}function b(n,o){return!!(n||o)}function C(n,o){return X(o,n)}function M(n){return(Math.exp(n)-Math.exp(-n))/2}function D(n){return(Math.exp(n)+Math.exp(-n))/2}function B(n){return n===1/0?1:n===-1/0?-1:(Math.exp(n)-Math.exp(-n))/(Math.exp(n)+Math.exp(-n))}function W(n){return n===-1/0?n:Math.log(n+Math.sqrt(n*n+1))}function G(n){return Math.log(n+Math.sqrt(n*n-1))}function ne(n){return Math.log((1+n)/(1-n))/2}function Ae(n){return Math.log(n)*Math.LOG10E}function ze(n){return-n}function se(n){return!n}function ie(n){return n<0?Math.ceil(n):Math.floor(n)}function oe(n){return Math.random()*(n||1)}function ke(n){return Pe(n+1)}function Ge(n){return isFinite(n)&&n===Math.round(n)}var pt=4.7421875,Le=[.9999999999999971,57.15623566586292,-59.59796035547549,14.136097974741746,-.4919138160976202,3399464998481189e-20,4652362892704858e-20,-9837447530487956e-20,.0001580887032249125,-.00021026444172410488,.00021743961811521265,-.0001643181065367639,8441822398385275e-20,-26190838401581408e-21,36899182659531625e-22];function Pe(n){var o,v;if(Ge(n)){if(n<=0)return isFinite(n)?1/0:NaN;if(n>171)return 1/0;for(var P=n-2,F=n-1;P>1;)F*=P,P--;return F===0&&(F=1),F}if(n<.5)return Math.PI/(Math.sin(Math.PI*n)*Pe(1-n));if(n>=171.35)return 1/0;if(n>85){var j=n*n,_=j*n,K=_*n,te=K*n;return Math.sqrt(2*Math.PI/n)*Math.pow(n/Math.E,n)*(1+1/(12*n)+1/(288*j)-139/(51840*_)-571/(2488320*K)+163879/(209018880*te)+5246819/(75246796800*te*n))}--n,v=Le[0];for(var ue=1;ue<Le.length;++ue)v+=Le[ue]/(n+ue);return o=n+pt+.5,Math.sqrt(2*Math.PI)*Math.pow(o,n+.5)*Math.exp(-o)*v}function dt(n){return Array.isArray(n)?n.length:String(n).length}function yt(){for(var n=0,o=0,v=0;v<arguments.length;v++){var P=Math.abs(arguments[v]),F;o<P?(F=o/P,n=n*F*F+1,o=P):P>0?(F=P/o,n+=F*F):n+=P}return o===1/0?1/0:o*Math.sqrt(n)}function qe(n,o,v){return n?o:v}function Gn(n,o){return typeof o=="undefined"||+o==0?Math.round(n):(n=+n,o=-+o,isNaN(n)||!(typeof o=="number"&&o%1===0)?NaN:(n=n.toString().split("e"),n=Math.round(+(n[0]+"e"+(n[1]?+n[1]-o:-o))),n=n.toString().split("e"),+(n[0]+"e"+(n[1]?+n[1]+o:o))))}function Kn(n,o,v){return v&&(v[n]=o),o}function Yn(n,o){return n[o|0]}function Jn(n){return arguments.length===1&&Array.isArray(n)?Math.max.apply(Math,n):Math.max.apply(Math,arguments)}function Xn(n){return arguments.length===1&&Array.isArray(n)?Math.min.apply(Math,n):Math.min.apply(Math,arguments)}function Qn(n,o){if(typeof n!="function")throw new Error("First argument to map is not a function");if(!Array.isArray(o))throw new Error("Second argument to map is not an array");return o.map(function(v,P){return n(v,P)})}function Zn(n,o,v){if(typeof n!="function")throw new Error("First argument to fold is not a function");if(!Array.isArray(v))throw new Error("Second argument to fold is not an array");return v.reduce(function(P,F,j){return n(P,F,j)},o)}function er(n,o){if(typeof n!="function")throw new Error("First argument to filter is not a function");if(!Array.isArray(o))throw new Error("Second argument to filter is not an array");return o.filter(function(v,P){return n(v,P)})}function tr(n,o){if(!(Array.isArray(o)||typeof o=="string"))throw new Error("Second argument to indexOf is not a string or array");return o.indexOf(n)}function nr(n,o){if(!Array.isArray(o))throw new Error("Second argument to join is not an array");return o.join(n)}function rr(n){return(n>0)-(n<0)||+n}var tn=1/3;function ir(n){return n<0?-Math.pow(-n,tn):Math.pow(n,tn)}function sr(n){return Math.exp(n)-1}function or(n){return Math.log(1+n)}function ar(n){return Math.log(n)/Math.LN2}function $e(n){this.options=n||{},this.unaryOps={sin:Math.sin,cos:Math.cos,tan:Math.tan,asin:Math.asin,acos:Math.acos,atan:Math.atan,sinh:Math.sinh||M,cosh:Math.cosh||D,tanh:Math.tanh||B,asinh:Math.asinh||W,acosh:Math.acosh||G,atanh:Math.atanh||ne,sqrt:Math.sqrt,cbrt:Math.cbrt||ir,log:Math.log,log2:Math.log2||ar,ln:Math.log,lg:Math.log10||Ae,log10:Math.log10||Ae,expm1:Math.expm1||sr,log1p:Math.log1p||or,abs:Math.abs,ceil:Math.ceil,floor:Math.floor,round:Math.round,trunc:Math.trunc||ie,"-":ze,"+":Number,exp:Math.exp,not:se,length:dt,"!":ke,sign:Math.sign||rr},this.binaryOps={"+":Ne,"-":_e,"*":We,"/":Fe,"%":Se,"^":Math.pow,"||":ce,"==":De,"!=":Ue,">":je,"<":Be,">=":I,"<=":e,and:a,or:b,in:C,"=":Kn,"[":Yn},this.ternaryOps={"?":qe},this.functions={random:oe,fac:ke,min:Xn,max:Jn,hypot:Math.hypot||yt,pyt:Math.hypot||yt,pow:Math.pow,atan2:Math.atan2,if:qe,gamma:Pe,roundTo:Gn,map:Qn,fold:Zn,filter:er,indexOf:tr,join:nr},this.consts={E:Math.E,PI:Math.PI,true:!0,false:!1}}$e.prototype.parse=function(n){var o=[],v=new Y(this,new Z(this,n),{allowMemberAccess:this.options.allowMemberAccess});return v.parseExpression(o),v.expect(re,"EOF"),new J(o,this)},$e.prototype.evaluate=function(n,o){return this.parse(n).evaluate(o)};var nn=new $e;$e.parse=function(n){return nn.parse(n)},$e.evaluate=function(n,o){return nn.parse(n).evaluate(o)};var rn={"+":"add","-":"subtract","*":"multiply","/":"divide","%":"remainder","^":"power","!":"factorial","<":"comparison",">":"comparison","<=":"comparison",">=":"comparison","==":"comparison","!=":"comparison","||":"concatenate",and:"logical",or:"logical",not:"logical","?":"conditional",":":"conditional","=":"assignment","[":"array","()=":"fndef"};function cr(n){return rn.hasOwnProperty(n)?rn[n]:n}$e.prototype.isOperatorEnabled=function(n){var o=cr(n),v=this.options.operators||{};return!(o in v)||!!v[o]};var lr={Parser:$e,Expression:J};r.Expression=J,r.Parser=$e,r.default=lr,Object.defineProperty(r,"__esModule",{value:!0})})});var Ot=he((In,Dt)=>{"use strict";var At=class{constructor(t,c){let u=t||{},l=Array.isArray(u.allowedVariables)&&u.allowedVariables.length>0?u.allowedVariables.slice():qt.slice();this.allowedVariables=l;let i=c||Mn();this.parser=new i({operators:{add:!0,subtract:!0,multiply:!0,divide:!0,remainder:!0,power:!1,factorial:!1,comparison:!0,logical:!0,conditional:!0,concatenate:!1,assignment:!1,array:!1,fndef:!1},allowMemberAccess:!1}),this.cache={}}validate(t){let c;try{c=this.getCacheEntry(t)}catch(u){return{ok:!1,error:u instanceof Error?u.message:"Invalid expression"}}return c?c.disallowedVariables.length>0?{ok:!1,error:"Unknown variables: "+c.disallowedVariables.join(", ")+". Allowed variables: "+this.allowedVariables.join(", ")}:{ok:!0,variables:c.variables.slice()}:{ok:!1,error:"Expression cannot be empty"}}evaluate(t,c){let u=this.getCacheEntry(t);if(!u)throw new Error("Expression cannot be empty");if(u.disallowedVariables.length>0)throw new Error("Unknown variables: "+u.disallowedVariables.join(", ")+". Allowed variables: "+this.allowedVariables.join(", "));let l={},i=c||{};for(let f of this.allowedVariables){let w=Object.prototype.hasOwnProperty.call(i,f)?i[f]:void 0;if(qt.indexOf(f)!==-1){l[f]=Ve(w);continue}typeof w=="number"?l[f]=Number.isFinite(w)?w:0:typeof w=="boolean"||typeof w=="string"?l[f]=w:w==null?l[f]=0:l[f]=w}return u.compiled.evaluate(l)}clearCache(){this.cache={}}getCacheEntry(t){let c=this.normalizeExpression(t);if(!c)return null;if(this.cache[c])return this.cache[c];let u;try{u=this.parser.parse(c)}catch(w){throw this.wrapParseError(w)}let l=u.variables({withMembers:!1})||[],i=l.filter(w=>this.allowedVariables.indexOf(w)===-1),f={expression:c,compiled:u,variables:l.slice(),disallowedVariables:i.slice()};return this.cache[c]=f,f}normalizeExpression(t){return typeof t!="string"?"":t.trim()}wrapParseError(t){let c=t&&typeof t=="object"&&t instanceof Error&&t.message?kr(t.message):"Invalid expression",u=new Error(c);return t&&typeof t=="object"&&(u.originalError=t),u}},qt=["value","high","low","changeDaily","changeDailyPercent","volume"];function wr(r){return r?r.slice():[]}function Ve(r){if(r==null)return 0;if(typeof r=="number")return Number.isFinite(r)?r:0;if(typeof r=="string"&&r.trim()!==""){let t=Number(r);if(!Number.isNaN(t)&&Number.isFinite(t))return t}return 0}function Rn(r){let t=r||{};return{value:Ve(t.last),high:Ve(t.high),low:Ve(t.low),changeDaily:Ve(t.changeDaily),changeDailyPercent:Ve(t.changeDailyPercent),volume:Ve(t.volume)}}function Cr(r,t){let c=Rn(r);if(t&&typeof t=="object")for(let u in t)Object.prototype.hasOwnProperty.call(t,u)&&(c[u]=t[u]);return c}function kr(r){return r?r.indexOf("member access is not permitted")>=0?r+'. Remove object-style prefixes (for example use "value" instead of "values.last").':r:"Invalid expression"}function Mn(){if(typeof He=="function")try{let c=Pn();if(c&&c.Parser)return c.Parser}catch{}let r=typeof globalThis!="undefined"?globalThis:{},t=r.exprEval&&r.exprEval.Parser;if(t)return t;throw new Error("expr-eval dependency is missing")}(function(t,c){let u=Mn(),l=c(u);typeof Dt=="object"&&Dt.exports&&(Dt.exports=l),t&&typeof t=="object"&&(t.CryptoTickerExpressionEvaluator=l)})(typeof self!="undefined"?self:In,function(t){return{createEvaluator:c=>new At(c,t),ExpressionEvaluator:At,normalizeNumericValue:Ve,buildBaseContext:Rn,buildContext:Cr,allowedVariables:wr(qt)}})});var Gt=he((Dn,rt)=>{"use strict";(function(r,t){let c=typeof rt=="object"&&rt.exports?Ot():r==null?void 0:r.CryptoTickerExpressionEvaluator,u=t(c);typeof rt=="object"&&rt.exports&&(rt.exports=u),r&&typeof r=="object"&&(r.CryptoTickerAlertManager=u)})(typeof self!="undefined"?self:Dn,function(r){if(!r)throw new Error("Expression evaluator dependency is missing");let t=r,c=t.createEvaluator(),u={},l={};function i(s){return u[s]||"off"}function f(s){return l[s]!=="off"}function w(s){l[s]="off"}function E(s){l[s]="on"}function y(s){return f(s)&&i(s)==="on"}function S(s){delete u[s],delete l[s]}function d(s){let g=s.context,R=s.settings||{},A=s.values||{},h=s.backgroundColor,p=s.textColor,k=!1,x=R.alertRule;if(!x)return u[g]="off",{alertMode:k,backgroundColor:h,textColor:p};try{let m=t.buildBaseContext(A);if(c.evaluate(x,m)){if(u[g]="on",f(g)){k=!0;let T=h;h=p,p=T}}else u[g]="off",E(g)}catch(m){u[g]="error",console.error("Error evaluating alertRule",{context:g,settings:R,values:A,error:m instanceof Error?m.message:m})}return{alertMode:k,backgroundColor:h,textColor:p}}return{evaluateAlert:d,shouldDisarmOnKeyPress:y,disarmAlert:w,armAlert:E,clearContext:S,getAlertStatus:i,isAlertArmed:f}})});var Kt=he((An,Nt)=>{"use strict";(function(t,c){let u=c();typeof Nt=="object"&&Nt.exports&&(Nt.exports=u),t&&typeof t=="object"&&(t.CryptoTickerState=u)})(typeof self!="undefined"?self:An,function(){let t={},c={},u={},l={},i={},f={};function w(N,X){t[N]={context:N,settings:X}}function E(N){return t[N]||null}function y(N){Object.keys(t).forEach(X=>{N(t[X],X)})}function S(N){delete t[N],delete f[N]}function d(N,X){N&&(c[N]=X||null)}function s(N){return N&&c[N]||null}function g(N){N&&delete c[N]}function R(N,X){N&&X&&(u[N]=X)}function A(N){return N&&u[N]||null}function h(N){N&&(delete u[N],delete f[N])}function p(N){return l[N]||(l[N]={}),l[N]}function k(N,X){l[N]=X}function x(N){return i[N]}function m(N,X){i[N]=X}function O(){Object.keys(t).forEach(N=>{delete t[N]}),Object.keys(c).forEach(N=>{let X=c[N];if(X&&typeof X.unsubscribe=="function")try{X.unsubscribe()}catch{}delete c[N]}),Object.keys(u).forEach(N=>{delete u[N]}),Object.keys(l).forEach(N=>{delete l[N]}),Object.keys(i).forEach(N=>{delete i[N]}),Object.keys(f).forEach(N=>{delete f[N]})}function T(N,X,ae){if(!N||!X)return;let J=typeof ae=="number"?ae:Date.now();f[N]={values:Object.assign({},X),timestamp:J}}function L(N){return N&&f[N]||null}function V(N){N&&delete f[N]}return{setContextDetails:w,getContextDetails:E,forEachContext:y,clearContextDetails:S,setSubscription:d,getSubscription:s,clearSubscription:g,setConnectionState:R,getConnectionState:A,clearConnectionState:h,getOrCreateConversionRateEntry:p,setConversionRateEntry:k,getCandlesCacheEntry:x,setCandlesCacheEntry:m,resetAllState:O,setLastGoodTicker:T,getLastGoodTicker:L,clearLastGoodTicker:V}})});var Nn=he((On,it)=>{"use strict";(function(r,t){let c=typeof globalThis!="undefined"?globalThis:r,u=typeof it=="object"&&it.exports?Kt():r==null?void 0:r.CryptoTickerState,l=t(u,c);typeof it=="object"&&it.exports&&(it.exports=l),r&&typeof r=="object"&&(r.CryptoTickerSettingsManager=l)})(typeof self!="undefined"?self:On,function(t,c){function u(s){if(typeof He=="function")try{return He(s)}catch{return null}return null}function l(){return c&&typeof c.CryptoTickerDefaults!="undefined"?c.CryptoTickerDefaults:u("./default-settings")}let i=l();function f(){if(!i)throw new Error("Default settings module is not available");return i}function w(s){let g=f();return typeof g.applyDefaults=="function"?g.applyDefaults(s):g.defaultSettings?Object.assign({},g.defaultSettings,s||{}):Object.assign({},s||{})}function E(){let s=f();return typeof s.getDefaultSettings=="function"?s.getDefaultSettings():s.defaultSettings?JSON.parse(JSON.stringify(s.defaultSettings)):{}}let y=E();function S(s){let g=s.context,R=s.settings,A=s.updateSubscription,h=w(R);return t.setContextDetails(g,h),typeof A=="function"&&A(h),h}let d=i&&i.settingsSchema?i.settingsSchema:null;return{applyDefaultSettings:w,getDefaultSettingsSnapshot:E,defaultSettings:y,settingsSchema:d,refreshSettings:S}})});var Fn=he((Yr,Ft)=>{"use strict";var Sr={TIMESTAMP_SECONDS_THRESHOLD:9999999999,DEFAULT_PRICE_BAR_POSITION:.5};(function(t,c){let u=c();if(typeof Ft=="object"&&Ft.exports)Ft.exports=u;else{let l=t.CryptoTickerConstants||{};t.CryptoTickerConstants=Object.assign({},l,u)}})(typeof globalThis!="undefined"?globalThis:self,function(){return Sr})});var Bn=he((Un,Ut)=>{"use strict";(function(r,t){let c=t();typeof Ut=="object"&&Ut.exports&&(Ut.exports=c),r&&typeof r=="object"&&(r.CryptoTickerConnectionStatusIcons=c)})(typeof self!="undefined"?self:Un,function(){function t(){return{LIVE:"live",DETACHED:"detached",BACKUP:"backup",BROKEN:"broken"}}function c(l){if(!l||typeof l!="object")return t();let i=t(),f={};for(let w in i){if(!Object.prototype.hasOwnProperty.call(i,w))continue;let E=i[w],y=l[w];f[w]=typeof y=="string"&&y?y:E}return f}function u(l){let i=l.canvasContext,f=l.canvas,w=l.state,E=l.color,y=l.sizeMultiplier,S=l.position,d=l.connectionStates;if(!f||!i||!w)return;let s=c(d),g=(S||"OFF").toUpperCase();if(g==="OFF")return;let R=String(w).toLowerCase(),A=typeof y=="number"&&Number.isFinite(y)&&y>0?y:1,h=20*A,p=4*A,k=f.width-h-p,x=p;g==="BOTTOM_LEFT"&&(k=p,x=f.height-h-p),i.save(),i.translate(k,x),i.lineWidth=Math.max(1.5*A,1),i.strokeStyle=E,i.fillStyle=E;function m(O){if(!(!Array.isArray(O)||O.length===0)){i.beginPath();for(let T=0;T<O.length;T++){let L=O[T],V=L[0]*h,N=L[1]*h;T===0?i.moveTo(V,N):i.lineTo(V,N)}i.closePath(),i.fill()}}R===s.LIVE?m([[.7545784909869392,0],[.18263591551829597,.5685964091677761],[.3947756629367107,.5685964091677761],[.23171302126434715,1],[.8173281041988991,.43136761054941897],[.6051523764976793,.43136761054941897]]):R===s.DETACHED?(m([[0,.45],[.4,.45],[.4,.6],[0,.6]]),m([[.6,.45],[1,.45],[1,.6],[.6,.6]])):R===s.BACKUP?(m([[0,.3],[.4,.3],[.4,.38],[0,.38]]),m([[.6,.3],[1,.3],[1,.38],[.6,.38]]),m([[0,.62],[.4,.62],[.4,.7],[0,.7]]),m([[.6,.62],[1,.62],[1,.7],[.6,.7]])):R===s.BROKEN&&(i.save(),i.fillStyle="#ff0000",i.beginPath(),i.moveTo(h*.46,h*.32),i.lineTo(h*.42,h*.38),i.lineTo(h*.46,h*.44),i.lineTo(h*.41,h*.5),i.lineTo(h*.43,h*.88),i.lineTo(h*.3,h*.73),i.lineTo(h*.18,h*.62),i.bezierCurveTo(h*.08,h*.52,h*.08,h*.38,h*.15,h*.28),i.bezierCurveTo(h*.25,h*.16,h*.4,h*.2,h*.46,h*.32),i.closePath(),i.fill(),i.beginPath(),i.moveTo(h*.54,h*.28),i.lineTo(h*.58,h*.34),i.lineTo(h*.54,h*.4),i.lineTo(h*.59,h*.46),i.lineTo(h*.57,h*.84),i.lineTo(h*.7,h*.69),i.lineTo(h*.82,h*.58),i.bezierCurveTo(h*.92,h*.48,h*.92,h*.34,h*.85,h*.24),i.bezierCurveTo(h*.75,h*.12,h*.6,h*.16,h*.54,h*.28),i.closePath(),i.fill(),i.restore()),i.restore()}return{renderConnectionStatusIcon:u}})});var _n=he((Ln,st)=>{"use strict";(function(r,t){let c=typeof st=="object"&&st.exports?[Gt(),zt(),Ot(),Fn(),Bn()]:[r==null?void 0:r.CryptoTickerAlertManager,r==null?void 0:r.CryptoTickerFormatters,r==null?void 0:r.CryptoTickerExpressionEvaluator,r==null?void 0:r.CryptoTickerConstants,r==null?void 0:r.CryptoTickerConnectionStatusIcons],u=t(c[0],c[1],c[2],c[3],c[4]);typeof st=="object"&&st.exports&&(st.exports=u),r&&typeof r=="object"&&(r.CryptoTickerCanvasRenderer=u)})(typeof self!="undefined"?self:Ln,function(r,t,c,u,l){if(!r)throw new Error("Alert manager dependency is missing");if(!t)throw new Error("Formatters dependency is missing");if(!c)throw new Error("Expression evaluator dependency is missing");let i=u||{},f=typeof i.TIMESTAMP_SECONDS_THRESHOLD=="number"?i.TIMESTAMP_SECONDS_THRESHOLD:9999999999,w=typeof i.DEFAULT_PRICE_BAR_POSITION=="number"?i.DEFAULT_PRICE_BAR_POSITION:.5;function E(){let m=c.allowedVariables.slice(0),O=["alert","backgroundColor","textColor","defaultBackgroundColor","defaultTextColor"];for(let T=0;T<O.length;T++)m.indexOf(O[T])===-1&&m.push(O[T]);return c.createEvaluator({allowedVariables:m})}let y=E(),S=l&&typeof l=="object"?l:null,d=S&&typeof S.renderConnectionStatusIcon=="function"?S.renderConnectionStatusIcon:function(){};function s(m,O){return Math.max(m/144,O/144)}function g(m){let O=parseInt(m.candlesDisplayed);return isNaN(O)?20:Math.min(60,Math.max(5,O))}function R(m,O,T,L,V){let N=Math.sqrt(.75*Math.pow(L,2));m.beginPath(),m.moveTo(O-L/2,T-N/3),m.lineTo(O+L/2,T-N/3),m.lineTo(O,T+N*2/3),m.fillStyle=V,m.fill()}function A(m,O,T,L){if(!O&&O!==0)return[""];let V=String(O).split(/\r?\n/),N=[];function X(ae){let J=ae.split(""),re=[],$="";for(let z=0;z<J.length;z++){let fe=$+J[z];m.measureText(fe).width>T&&$?(re.push($),$=J[z]):$=fe}return $&&re.push($),re}m.font=L;for(let ae=0;ae<V.length;ae++){let J=V[ae];if(!J||J.trim()===""){N.push("");continue}let re=J.trim().split(/\s+/),$=re.shift()||"";for(;re.length>0;){let z=re.shift(),fe=$?$+" "+z:z;if(m.measureText(fe).width<=T){$=fe;continue}if($&&N.push($),m.measureText(z).width<=T)$=z;else{let U=X(z);for(let H=0;H<U.length-1;H++)N.push(U[H]);$=U.length>0?U[U.length-1]:""}}$&&N.push($)}return N.length===0&&N.push(""),N}function h(m){if(m==null)return null;let O=typeof m=="number"?m:parseFloat(m);if(!Number.isFinite(O))return null;let T=O>f?O:O*1e3,L=new Date(T);if(isNaN(L.getTime()))return null;try{return L.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}catch{return L.toISOString()}}function p(m){let O=m.canvas,T=m.canvasContext,L=m.message,V=m.backgroundColor||"#000000",N=m.textColor||"#ffffff",X=m.font||"Lato",ae=m.fontSize,J=m.connectionStates,re=m.connectionState,$=(m.displayConnectionStatusIcon||"OFF").toUpperCase(),z=O.width,fe=O.height,U=s(z,fe),H=12*U,ve=ae?ae*U:Math.max(22*U,14),Ce="bold "+ve+"px "+X,ye=ve*1.25;T.clearRect(0,0,z,fe),T.fillStyle=V,T.fillRect(0,0,z,fe);let pe=z-H*2,Z=A(T,L,pe,Ce),Te=fe-H*2;$!=="OFF"&&J&&(Te-=28*U);let Y=ye*Z.length,Ee=H+(Te-Y)/2+ye/2;Ee<H+ye/2&&(Ee=H+ye/2),T.fillStyle=N,T.textAlign="center",T.textBaseline="middle",T.font=Ce;for(let Q=0;Q<Z.length;Q++){let ee=Z[Q];ee&&T.fillText(ee,z/2,Ee+Q*ye)}$!=="OFF"&&J&&d({canvas:O,canvasContext:T,state:re,color:N,sizeMultiplier:U,position:$,connectionStates:J})}function k(m){let O=m.canvas,T=m.canvasContext,L=m.settings||{},V=m.values||{},N=m.context,X=m.connectionStates,ae=m.connectionState,J=m.dataState||"live",re=m.infoMessage||"",$=m.lastValidTimestamp||V.lastUpdated||null,z=O.width,fe=O.height,U=s(z,fe),H=10*U,ve=L.pair,Ce=L.title||V.pairDisplay||V.pair||ve||"",ye=L.multiplier||1,pe=L.priceFormat||"compact";function Z(se,ie){let oe=parseFloat(se);return isNaN(oe)||oe<=0?ie:oe}function Te(se,ie){let oe=parseInt(se,10);return isNaN(oe)||oe<0?ie:oe}let Y=Te(L.digits,2),Ee=Te(L.highLowDigits,Y),Q=Z(L.fontSizeBase,25),ee=Z(L.fontSizePrice,Q*35/25),Ne=Z(L.fontSizeHighLow,Q),_e=Z(L.fontSizeChange,Q*19/25),We=L.backgroundColor||"#000000",Fe=L.textColor||"#ffffff",Se=We,ce=Fe,De=ae||V.connectionState||null,Ue=typeof V.last=="number"&&Number.isFinite(V.last)?V.last:null,je=typeof V.high=="number"&&Number.isFinite(V.high)?V.high:null,Be=typeof V.low=="number"&&Number.isFinite(V.low)?V.low:null,I=typeof V.changeDailyPercent=="number"&&Number.isFinite(V.changeDailyPercent)?V.changeDailyPercent:null,e=I!==null?I*100:null,a=typeof J=="string"?J.toLowerCase():"live",b=a==="stale"?"#f6a623":a==="missing"?"#d9534f":null,C=r.evaluateAlert({context:N,settings:L,values:V,backgroundColor:Se,textColor:ce}),M=C.alertMode;Se=C.backgroundColor,ce=C.textColor;let D=c.buildContext(V,{alert:M,backgroundColor:Se,textColor:ce,defaultBackgroundColor:We,defaultTextColor:Fe});if(L.backgroundColorRule)try{let se=y.evaluate(L.backgroundColorRule,D),ie=String(se||"").trim();ie&&(Se=ie,D.backgroundColor=Se)}catch(se){console.error("Error evaluating backgroundColorRule",{context:N,expression:L.backgroundColorRule,values:V,error:se instanceof Error?se.message:se})}if(L.textColorRule)try{D.textColor=ce;let se=y.evaluate(L.textColorRule,D),ie=String(se||"").trim();ie&&(ce=ie,D.textColor=ce)}catch(se){console.error("Error evaluating textColorRule",{context:N,expression:L.textColorRule,values:V,error:se instanceof Error?se.message:se})}T.clearRect(0,0,z,fe),T.fillStyle=Se,T.fillRect(0,0,z,fe);let B=L.font||"Lato",W=Q*U+"px "+B;T.font=W,T.fillStyle=ce,T.textAlign="left",T.textBaseline="alphabetic";let G=25*U,ne=H;if(b){let se=5*U,ie=H+se,oe=G-Q*U*.4;T.beginPath(),T.fillStyle=b,T.arc(ie,oe,se,0,Math.PI*2),T.fill(),T.fillStyle=ce,ne+=se*2+6*U}if(Ce&&T.fillText(Ce,ne,G),a==="stale"){let se=re?re.toUpperCase():"STALE",ie=h($),oe=ie?se+" \u2022 "+ie:se,ke=Math.max(14,Q*.6)*U;T.font=ke+"px "+B,T.fillStyle=b||ce,T.fillText(oe,ne,G+ke+4*U),T.font=W,T.fillStyle=ce}if(a!=="missing"){let se=Ue!==null?t.getRoundedValue(Ue,Y,ye,pe):"--";if(T.font="bold "+ee*U+"px "+B,T.fillStyle=ce,T.textAlign="left",T.fillText(se,H,60*U),L.displayHighLow!=="off"){T.font=Ne*U+"px "+B,T.fillStyle=ce,T.textAlign="left";let ie=Be!==null?t.getRoundedValue(Be,Ee,ye,pe):"--";T.fillText(ie,H,90*U),T.textAlign="right";let oe=je!==null?t.getRoundedValue(je,Ee,ye,pe):"--";T.fillText(oe,z-H,135*U)}if(L.displayDailyChange!=="off"&&e!==null){let ie=T.fillStyle,oe=2;Math.abs(e)>=100?oe=0:Math.abs(e)>=10&&(oe=1);let ke=t.getRoundedValue(e,oe,1,"plain");e>0?(ke="+"+ke,T.fillStyle="green"):e<0?T.fillStyle="red":T.fillStyle=ie,T.font=_e*U+"px "+B,T.textAlign="right",T.fillText(ke,z-H,90*U),T.fillStyle=ie}if(L.displayHighLowBar!=="off"&&je!==null&&Be!==null&&Ue!==null){let ie=104*U,oe=5*U,ke=6*U,Ge=je-Be,pt=Ge>0?Math.min(Math.max((Ue-Be)/Ge,0),1):w,Le=z-oe*2,Pe=oe+Math.round(Le*pt),dt=12*U;T.beginPath(),T.moveTo(oe,ie),T.lineTo(Pe,ie),T.lineWidth=ke,T.strokeStyle="green",T.stroke(),T.beginPath(),T.moveTo(Pe,ie),T.lineTo(z-oe,ie),T.lineWidth=ke,T.strokeStyle="red",T.stroke(),R(T,Pe,ie,dt,ce)}}else{let se=re?re.toUpperCase():"NO DATA",ie=Math.max(26,Q)*U,oe="bold "+ie+"px "+B;T.font=oe,T.fillStyle=b||ce;let ke=T.textAlign,Ge=T.textBaseline;T.textAlign="center",T.textBaseline="middle";let pt=z-H*2,Le=A(T,se,pt,oe),Pe=ie*1.1,dt=Pe*Le.length,yt=(fe-dt)/2+Pe/2;for(let qe=0;qe<Le.length;qe++)T.fillText(Le[qe],z/2,yt+qe*Pe);T.textAlign=ke,T.textBaseline=Ge,T.font=W,T.fillStyle=ce}let ze=(L.displayConnectionStatusIcon||"OFF").toUpperCase();ze!=="OFF"&&d({canvas:O,canvasContext:T,state:De,color:ce,sizeMultiplier:U,position:ze,connectionStates:X})}function x(m){let O=m.canvas,T=m.canvasContext,L=m.settings||{},V=m.candlesNormalized||[],N=m.connectionStates,X=m.connectionState,ae=O.width,J=O.height,re=s(ae,J),$=10*re,z=(L.displayConnectionStatusIcon||"OFF").toUpperCase(),fe=X||null,U=L.backgroundColor||"#000000",H=L.textColor||"#ffffff",ve=V.slice(-g(L)),Ce=ve.length,ye=ae-2*$,pe=J-2*$,Z=Ce>0?ye/Ce:ye,Te=Math.max(2*re,Z*.15),Y=Math.max(4*re,Z*.6);T.clearRect(0,0,ae,J),T.fillStyle=U,T.fillRect(0,0,ae,J);let Ee=L.font||"Lato";T.font=15*re+"px "+Ee,T.fillStyle=H;let Q=L.candlesInterval||"1h";T.textAlign="right",T.fillText(Q,ae-10*re,J-5*re),ve.forEach(function(ee){let Ne=Math.round($+Math.round(ee.timePercent*ye)),_e=Math.round($+pe-ee.highPercent*pe),We=Math.round($+pe-ee.lowPercent*pe);T.beginPath(),T.moveTo(Ne,_e),T.lineTo(Ne,We),T.lineWidth=Te,T.strokeStyle=ee.closePercent>ee.openPercent?"#1c9900":"#a10",T.stroke();let Fe=Math.round($+pe-ee.openPercent*pe),Se=Math.round($+pe-ee.closePercent*pe),ce=Math.min(Fe,Se),De=Math.max(Fe,Se);T.beginPath(),T.rect(Math.round(Ne-Y/2),ce,Math.round(Y),Math.max(1,De-ce)),T.fillStyle=ee.closePercent>ee.openPercent?"#1c9900":"#a10",T.fill()}),z!=="OFF"&&d({canvas:O,canvasContext:T,state:fe,color:H,sizeMultiplier:re,position:z,connectionStates:N})}return{getCanvasSizeMultiplier:s,getCandlesDisplayCount:g,renderConnectionStatusIcon:d,renderTickerCanvas:k,renderCandlesCanvas:x,renderMessageCanvas:p}})});var Hn=he((Jr,en)=>{"use strict";var jn={tProxyBase:"https://tproxyv8.opendle.com",fallbackPollIntervalMs:6e4,staleTickerTimeoutMs:36e4,messages:{loading:"LOADING...",stale:"STALE",noData:"NO DATA",misconfigured:"INVALID PAIR",conversionError:"CONVERSION ERROR"}};function Oe(r){if(typeof He=="function")try{return He(r)}catch{return null}return null}function Tr(){return typeof CryptoTickerConfig!="undefined"?CryptoTickerConfig:null}function ot(r){if(typeof r=="string"){let t=r.trim();return t.length===0?null:t.toUpperCase()}return r==null?null:String(r).trim().toUpperCase()||null}var Er=Oe("./config"),xr=Oe("./constants"),Pr=Tr(),Ie=Object.assign({},jn,Er||{},Pr||{}),Wn=xr||(typeof CryptoTickerConstants!="undefined"?CryptoTickerConstants:null)||{},Rr=typeof Wn.TIMESTAMP_SECONDS_THRESHOLD=="number"?Wn.TIMESTAMP_SECONDS_THRESHOLD:9999999999,Yt=Ie.tProxyBase,Mr=jn.messages,Re=Object.assign({},Mr,Ie&&Ie.messages||{}),Jt=Oe("./providers/subscription-key"),ut=typeof CryptoTickerProviders!="undefined"?CryptoTickerProviders:null,Ir=Jt&&Jt.buildSubscriptionKey?Jt.buildSubscriptionKey:ut&&typeof ut.buildSubscriptionKey=="function"?ut.buildSubscriptionKey:function(r,t,c,u){let l=r||"",i=t||"",f=c||null,w=u||null,E="";return f!==null&&w!==null&&f!==w&&(E="__"+f+"_"+w),l+"__"+i+E},Dr=Oe("./providers/connection-states"),Me=Dr||(typeof CryptoTickerConnectionStates!="undefined"?CryptoTickerConnectionStates:{LIVE:"live",DETACHED:"detached",BACKUP:"backup",BROKEN:"broken"}),Ar=Oe("./canvas-renderer"),Or=Oe("./alert-manager"),Nr=Oe("./formatters"),Fr=Oe("./ticker-state"),Ur=Oe("./settings-manager"),ct=Ar||(typeof CryptoTickerCanvasRenderer!="undefined"?CryptoTickerCanvasRenderer:null),Qt=Or||(typeof CryptoTickerAlertManager!="undefined"?CryptoTickerAlertManager:null),Zt=Nr||(typeof CryptoTickerFormatters!="undefined"?CryptoTickerFormatters:null),we=Fr||(typeof CryptoTickerState!="undefined"?CryptoTickerState:null),ht=Ur||(typeof CryptoTickerSettingsManager!="undefined"?CryptoTickerSettingsManager:null);if(!ct||!Qt||!Zt||!we||!ht)throw new Error("CryptoTicker dependencies are not available");var $n=!1,lt=null,at,Bt,Br=!1,Lr=60*60*1e3,Xt=null,Lt=ht.applyDefaultSettings,_r=ht.defaultSettings,Wr=ht.getDefaultSettingsSnapshot,jr=ht.settingsSchema,me={type:"com.courcelle.cryptoticker.ticker",log:function(...r){$n&&console.log(...r)},setContextConnectionState:function(r,t){we.setConnectionState(r,t)},getContextConnectionState:function(r){return we.getConnectionState(r)},clearContextConnectionState:function(r){we.clearConnectionState(r)},getProviderRegistry:function(){if(!Xt){let r=Oe("./providers/provider-registry"),t=r&&r.ProviderRegistry?r.ProviderRegistry:ut&&ut.ProviderRegistry?ut.ProviderRegistry:null;if(!t)throw new Error("ProviderRegistry is not available");Xt=new t({baseUrl:Yt,logger:(...c)=>{this.log(...c)},fallbackPollIntervalMs:Ie.fallbackPollIntervalMs,staleTickerTimeoutMs:Ie.staleTickerTimeoutMs,binanceRestBaseUrl:Ie.binanceRestBaseUrl,binanceWsBaseUrl:Ie.binanceWsBaseUrl,binanceSymbolOverrides:Ie.binanceSymbolOverrides,bitfinexRestBaseUrl:Ie.bitfinexRestBaseUrl,bitfinexWsBaseUrl:Ie.bitfinexWsBaseUrl,bitfinexSymbolOverrides:Ie.bitfinexSymbolOverrides})}return Xt},websocketSend:function(r){lt&&lt.send(r)},onKeyDown:async function(r,t,c,u){switch(t.mode){case"candles":t.mode="ticker";break;case"ticker":default:Qt.shouldDisarmOnKeyPress(r)?Qt.disarmAlert(r):t.mode="candles";break}this.websocketSend(JSON.stringify({event:"setSettings",context:r,payload:t})),this.refreshTimer(r,t)},onKeyUp:function(r,t,c,u){},onWillAppear:async function(r,t,c){this.initCanvas(),this.refreshTimer(r,t)},refreshTimers:async function(){we.forEachContext(r=>{this.refreshTimer(r.context,r.settings)})},refreshTimer:async function(r,t){let c=this.refreshSettings(r,t);this.updateTicker(r,c)},connect:function(){let r=this.getProviderRegistry();r&&typeof r.ensureAllConnections=="function"&&r.ensureAllConnections()},updateSubscription:function(r,t){let c=t.exchange,u=t.pair,l=this.resolveConversionCurrencies(t.fromCurrency,t.currency),i=this.getSubscriptionContextKey(c,u,l.from,null),f=we.getSubscription(r);if(f&&f.key===i)return f;if(f&&typeof f.unsubscribe=="function"){try{f.unsubscribe()}catch(d){this.log("Error unsubscribing from provider",d)}we.clearSubscription(r),this.clearContextConnectionState(r)}let E=this.getProviderRegistry().getProvider(c),y={exchange:c,symbol:u,fromCurrency:l.from,toCurrency:null},S=this;try{let d=E.subscribeTicker(y,{onData:async function(s){let g=we.getContextDetails(r);if(g){S.setContextConnectionState(g.context,s&&s.connectionState);try{let R=await S.convertTickerValues(s,g.settings&&g.settings.fromCurrency,g.settings&&g.settings.currency);await S.updateCanvas(g.context,g.settings,R)}catch(R){S.log("Error updating canvas from subscription",R)}}},onError:function(s){S.log("Provider subscription error",s),S.setContextConnectionState(r,Me.BROKEN)}});return we.setSubscription(r,{key:i,unsubscribe:d&&typeof d.unsubscribe=="function"?d.unsubscribe:function(){},providerId:E.getId?E.getId():null}),we.getSubscription(r)}catch(d){this.log("Error subscribing to provider",d)}return null},refreshSettings:function(r,t){return ht.refreshSettings({context:r,settings:t,updateSubscription:c=>{this.updateSubscription(r,c)}})},getSubscriptionContextKey:function(r,t,c,u){return Ir(r,t,c,u)},resolveConversionCurrencies:function(r,t){let c=ot(r)||"USD",u=ot(t);return!u||u===c?{from:c,to:null}:{from:c,to:u}},getConversionRate:async function(r,t){let c=ot(r),u=ot(t);if(!c||!u||c===u)return 1;let l=c+"_"+u,i=Date.now(),f=we.getOrCreateConversionRateEntry(l);if(typeof f.rate=="number"&&f.rate>0&&f.fetchedAt&&i-f.fetchedAt<Lr)return f.rate;if(f.promise)try{return await f.promise}catch(d){this.log("Conversion rate promise failed",d)}let w=typeof fetch=="function"?fetch:null;if(!w)return typeof f.rate=="number"&&f.rate>0?f.rate:1;let E=(Yt||"").replace(/\/$/,"");if(!E)return typeof f.rate=="number"&&f.rate>0?f.rate:1;let y=E+"/api/ticker/json/currency/"+encodeURIComponent(c)+"/"+encodeURIComponent(u),S=this;f.promise=async function(){try{let d=await w(y);if(!d||!d.ok)throw new Error("Conversion rate response not ok");let s=await d.json(),g=s&&s.rate!==void 0?parseFloat(s.rate):NaN;if(!g||!isFinite(g)||g<=0)throw new Error("Invalid conversion rate");return f.rate=g,f.fetchedAt=Date.now(),g}catch(d){throw S.log("Error fetching conversion rate",d),d}finally{delete f.promise}}();try{return await f.promise}catch{return typeof f.rate=="number"&&f.rate>0?f.rate:1}},convertTickerValues:async function(r,t,c){if(!r)return r;let u=this.resolveConversionCurrencies(t,c);if(!u.to)return r;let l=ot(r.conversionToCurrency),i=ot(r.conversionFromCurrency);if(l===u.to&&i===u.from)return r;let f=null;try{f=await this.getConversionRate(u.from,u.to)}catch(w){return this.log("Conversion rate error",w),this.createConversionErrorValues(r)}return!f||!isFinite(f)||f<=0?this.createConversionErrorValues(r):this.applyTickerConversion(r,f,u.from,u.to)},createConversionErrorValues:function(r){let t=Object.assign({},r),c=["last","high","low","open","close","changeDaily","changeDailyPercent","volume"];for(let u=0;u<c.length;u++){let l=c[u];Object.prototype.hasOwnProperty.call(t,l)&&delete t[l]}return t.conversionRate=null,t.conversionError=!0,t},applyTickerConversion:function(r,t,c,u){if(!r||typeof r!="object")return r;let l=Object.assign({},r),i=["last","high","low","open","close","changeDaily"];for(let f=0;f<i.length;f++){let w=i[f];if(!Object.prototype.hasOwnProperty.call(r,w))continue;let E=r[w],y=typeof E=="number"?E:parseFloat(E);isNaN(y)||(l[w]=y*t)}return l.conversionRate=t,l.conversionFromCurrency=c,l.conversionToCurrency=u,l},applyCandlesConversion:function(r,t){return!Array.isArray(r)||!t||!isFinite(t)||t<=0?r:r.map(function(c){if(!c||typeof c!="object")return c;let u=Object.assign({},c),l=["open","close","high","low"];for(let i=0;i<l.length;i++){let f=l[i];if(!Object.prototype.hasOwnProperty.call(c,f))continue;let w=c[f],E=typeof w=="number"?w:parseFloat(w);isNaN(E)||(u[f]=E*t)}if(Object.prototype.hasOwnProperty.call(c,"volumeQuote")){let i=c.volumeQuote,f=typeof i=="number"?i:parseFloat(i);isNaN(f)||(u.volumeQuote=f*t)}return u})},updateTicker:async function(r,t){let c=t.pair,u=await this.getTickerValue(c,t.currency,t.exchange,t.fromCurrency);this.setContextConnectionState(r,u&&u.connectionState),this.updateCanvas(r,t,u)},initCanvas:function(){at=document.getElementById("ticker"),Bt=at.getContext("2d")},updateCanvas:async function(r,t,c){this.log("updateCanvas",r,t,c);let u=c&&c.connectionState||this.getContextConnectionState(r);switch(t.mode){case"candles":{let l=await this.getCandles(t);this.updateCanvasCandles(r,t,l,u);break}case"ticker":default:this.updateCanvasTicker(r,t,c,u);break}},sanitizeTickerValues:function(r){if(!r||typeof r!="object")return{values:{},hasAny:!1,hasCritical:!1,timestamp:null};let t=Object.assign({},r);function c(w,E,y){if(typeof w=="number"&&Number.isFinite(w))return y?Math.round(w):w;if(typeof w=="string"){let S=w.trim();if(S){let d=y?parseInt(S,10):parseFloat(S);if(!isNaN(d)&&Number.isFinite(d))return y?Math.round(d):d}}return E}let u=c(r.last,null,!1);u===null?delete t.last:t.last=u;let l={high:null,low:null,volume:0,changeDaily:0,changeDailyPercent:0};Object.keys(l).forEach(w=>{let E=l[w],y=c(r[w],E,!1);y==null||!Number.isFinite(y)?delete t[w]:y===E&&r[w]===void 0?E===null?delete t[w]:t[w]=E:t[w]=y});let i=["lastUpdated","timestamp","time","updatedAt"],f=null;for(let w=0;w<i.length;w++){let E=i[w];if(!Object.prototype.hasOwnProperty.call(r,E))continue;let S=c(r[E],null,!0);if(S!=null){let d=S>Rr?S:S*1e3;f=d,t.lastUpdated=d;break}}return typeof t.pairDisplay!="string"&&delete t.pairDisplay,{values:t,hasAny:Object.keys(r).length>0,hasCritical:u!==null,timestamp:f}},buildTickerRenderContext:function(r,t,c,u){let l=this.sanitizeTickerValues(c),i=l.values,f=Date.now(),w="missing",E=null,y=null,S=i,d=null,s=u||i.connectionState||null,g=we.getLastGoodTicker(r),R=s===Me.BROKEN,h=[Me.LIVE,Me.BACKUP,Me.DETACHED].indexOf(s)!==-1,p=l.hasCritical&&Number.isFinite(i.last)&&i.last===0&&(!Number.isFinite(i.high)||i.high===0)&&(!Number.isFinite(i.low)||i.low===0)&&(!Number.isFinite(i.volume)||i.volume===0)&&l.timestamp===null,k=l.hasCritical&&(!h||R)&&p;if(!!i.conversionError){w="missing",S=Object.assign({},i);let m=t.title||i.pairDisplay||i.pair||t.pair||"";return!S.pairDisplay&&m&&(S.pairDisplay=m),E=Re.conversionError||"CONVERSION ERROR",d="conversion_error",{values:S,dataState:w,infoMessage:E,lastValidTimestamp:y,degradedReason:d}}if(l.hasCritical&&!R&&!k){let m=l.timestamp||f;i.lastUpdated=m,we.setLastGoodTicker(r,i,m),y=m,w="live",S=Object.assign({},i)}else if(g&&g.values&&typeof g.values=="object"&&Number.isFinite(g.values.last))w="stale",S=Object.assign({},g.values),y=g.timestamp,S.lastUpdated||(S.lastUpdated=g.timestamp),E=Re.stale,d=l.hasAny?"partial":"missing";else{w="missing",S=Object.assign({},i);let m=t.title||i.pairDisplay||i.pair||t.pair||"";!S.pairDisplay&&m&&(S.pairDisplay=m),k||R?(E=Re.misconfigured||Re.noData,d="misconfigured"):(E=Re.loading,d=l.hasAny?"partial":"none")}return!E&&w==="missing"&&(E=R?Re.misconfigured||Re.noData:Re.loading),!E&&w==="live"&&R&&(E=Re.misconfigured||Re.noData),!E&&w==="stale"&&!Re.stale&&(E="STALE"),{values:S,dataState:w,infoMessage:E,lastValidTimestamp:y,degradedReason:d}},displayMessage:function(r,t,c){this.initCanvas();let u=c||{},l=Lt(u.settings||{}),i=u.backgroundColor||l.backgroundColor||"#000000",f=u.textColor||l.textColor||"#ffffff",w=u.font||l.font||"Lato",E=u.fontSize||null,y=u.connectionState||null,S=u.displayConnectionStatusIcon||l.displayConnectionStatusIcon||"OFF";y&&this.setContextConnectionState(r,y),ct.renderMessageCanvas({canvas:at,canvasContext:Bt,message:t,backgroundColor:i,textColor:f,font:w,fontSize:E,connectionStates:Me,connectionState:y||this.getContextConnectionState(r),displayConnectionStatusIcon:S}),this.sendCanvas(r)},getCanvasSizeMultiplier:function(r,t){return ct.getCanvasSizeMultiplier(r,t)},getCandlesDisplayCount:function(r){return ct.getCandlesDisplayCount(r)},updateCanvasTicker:function(r,t,c,u){this.log("updateCanvasTicker",r,t,c);let l=this.buildTickerRenderContext(r,t,c,u);ct.renderTickerCanvas({canvas:at,canvasContext:Bt,settings:t,values:l.values,context:r,connectionStates:Me,connectionState:u||c&&c.connectionState||null,dataState:l.dataState,infoMessage:l.infoMessage,lastValidTimestamp:l.lastValidTimestamp,degradedReason:l.degradedReason}),this.sendCanvas(r)},updateCanvasCandles:function(r,t,c,u){this.log("updateCanvasCandles",r,t,c),ct.renderCandlesCanvas({canvas:at,canvasContext:Bt,settings:t,candlesNormalized:c,connectionStates:Me,connectionState:u||this.getContextConnectionState(r)}),this.sendCanvas(r)},sendCanvas:function(r){var t={event:"setImage",context:r,payload:{image:at.toDataURL(),target:DestinationEnum.HARDWARE_AND_SOFTWARE}};this.websocketSend(JSON.stringify(t))},getRoundedValue:function(r,t,c,u){return Zt.getRoundedValue(r,t,c,u)},getTickerValue:async function(r,t,c,u){let i=this.getProviderRegistry().getProvider(c),f=this.resolveConversionCurrencies(u,t),w={exchange:c,symbol:r,fromCurrency:f.from,toCurrency:null};try{let E=await i.fetchTicker(w),S=await this.convertTickerValues(E,f.from,f.to)||E;return S&&typeof S=="object"&&!S.connectionState&&(S.connectionState=Me.DETACHED),S}catch(E){this.log("Error fetching ticker",E);let y=this.getSubscriptionContextKey(c,r,f.from,null);if(i&&typeof i.getCachedTicker=="function"){let S=i.getCachedTicker(y);if(S){let s=await this.convertTickerValues(S,f.from,f.to)||S;return s&&!s.connectionState&&(s.connectionState=Me.BACKUP),s}}return{changeDaily:0,changeDailyPercent:0,last:0,volume:0,high:0,low:0,pair:r,pairDisplay:r,connectionState:Me.BROKEN}}},getCandles:async function(r){this.log("getCandles");let t=r.exchange,c=r.pair,u=this.convertCandlesInterval(r.candlesInterval||"1h"),l=this.getCandlesDisplayCount(r),i=this.resolveConversionCurrencies(r.fromCurrency,r.currency),f=i.to||i.from||"",w=t+"_"+c+"_"+u+"_"+l+"_"+f,E=we.getCandlesCacheEntry(w);E||(E={},we.setCandlesCacheEntry(w,E));let y=new Date().getTime(),S="time",d="candles";if(E[S]&&E[S]>y-60*1e3)return E[d];let s={exchange:t,symbol:c,interval:u,limit:24},g=null;try{let p=this.getProviderRegistry(),k=p.getProvider(t);if(k&&typeof k.fetchCandles=="function"&&(g=await k.fetchCandles(s)),Array.isArray(g)||(g=null),g===null){let x=p.getGenericProvider();x&&typeof x.fetchCandles=="function"&&(g=await x.fetchCandles(s),Array.isArray(g)||(g=null))}}catch(p){this.log("Error fetching provider candles",p),g=null}if(g===null)try{let k=await(await fetch(Yt+"/api/Candles/json/"+t+"/"+c+"/"+u+"?limit=24")).json();k&&Array.isArray(k.candles)&&(g=k.candles)}catch(p){this.log("Error fetching candles from proxy",p)}if(!Array.isArray(g))return E[d]||[];let R=this.prepareCandlesForDisplay(g,l),A=R;if(i.to)try{let p=await this.getConversionRate(i.from,i.to);p&&isFinite(p)&&p>0&&(A=this.applyCandlesConversion(R,p))}catch(p){this.log("Conversion rate error for candles",p)}let h=this.getCandlesNormalized(A);return E[S]=y,E[d]=h,E[d]},convertCandlesInterval:function(r){switch(r){case"1m":return"MINUTES_1";case"5m":return"MINUTES_5";case"15m":return"MINUTES_15";case"1h":return"HOURS_1";case"6h":return"HOURS_6";case"12h":return"HOURS_12";case"1D":return"DAYS_1";case"7D":return"DAYS_7";case"1M":return"MONTHS_1"}return r},prepareCandlesForDisplay:function(r,t){if(!Array.isArray(r)||r.length===0)return[];let c=r.map(function(u){if(!u)return null;let l=u.ts;if(typeof l!="number"){let i=u.openTime;if(i){let f=Date.parse(i);isNaN(f)||(l=Math.floor(f/1e3))}}return typeof l!="number"||isNaN(l)?null:{candle:u,ts:l}}).filter(function(u){return u!==null}).sort(function(u,l){return u.ts-l.ts}).map(function(u){return u.candle.ts===u.ts?u.candle:Object.assign({},u.candle,{ts:u.ts})});return typeof t=="number"&&t>0&&c.length>t?c.slice(-t):c},getCandlesNormalized:function(r){let t=Number.POSITIVE_INFINITY,c=0,u=Number.POSITIVE_INFINITY,l=0,i=Number.POSITIVE_INFINITY,f=0;(r||[]).forEach(function(y){i=Math.min(i,y.ts),f=Math.max(f,y.ts),t=Math.min(t,y.open),t=Math.min(t,y.close),t=Math.min(t,y.high),t=Math.min(t,y.low),c=Math.max(c,y.open),c=Math.max(c,y.close),c=Math.max(c,y.high),c=Math.max(c,y.low),u=Math.min(u,y.volumeQuote),l=Math.max(l,y.volumeQuote)});let w=this,E=[];return(r||[]).forEach(function(y){E.push({timePercent:w.normalizeValue(y.ts,i,f),openPercent:w.normalizeValue(y.open,t,c),closePercent:w.normalizeValue(y.close,t,c),highPercent:w.normalizeValue(y.high,t,c),lowPercent:w.normalizeValue(y.low,t,c),volumePercent:w.normalizeValue(y.volumeQuote,u,l)})}),this.log("getCandlesNormalized",E),E},normalizeValue:function(r,t,c){return Zt.normalizeValue(r,t,c)}};me.defaultSettings=_r;me.applyDefaultSettings=Lt;me.getDefaultSettings=function(){return Wr()};me.settingsSchema=jr;function $r(r,t,c,u,l){lt=new WebSocket("ws://127.0.0.1:"+r);function i(f){var w={event:c,uuid:f};me.websocketSend(JSON.stringify(w))}lt.onopen=function(){i(t)},lt.onmessage=async function(f){var w=JSON.parse(f.data);let E=w.event,y=w.context,S=w.payload||{},d=S.settings;!d&&E==="sendToPlugin"&&(d=S);let s=d,g=S.coordinates,R=S.userDesiredState;["deviceDidConnect","titleParametersDidChange"].indexOf(E)>=0||(s!=null&&(s=Lt(s)),E=="keyDown"?await me.onKeyDown(y,s,g,R):E=="keyUp"?await me.onKeyUp(y,s,g,R):E=="willAppear"?await me.onWillAppear(y,s,g):s!=null&&(me.refreshSettings(y,s),me.refreshTimer(y,s)))},lt.onclose=function(){},setInterval(async function(){await me.refreshTimers()},3e5)}if(Br){$n=!0,me.connect();let r=Lt({digits:0,pair:"LTCUSD",mode:"ticker"}),t="test",c={column:1,row:1},u=null;setTimeout(function(){me.onWillAppear(t,r,c),setInterval(async function(){await me.onKeyDown(t,r,c,u),await me.onKeyUp(t,r,c,u)},5e3)},1e3)}typeof en!="undefined"&&(en.exports=me);typeof window!="undefined"&&(window.connectElgatoStreamDeckSocket=$r)});var Qr=be(ln()),Zr=be(hn()),ei=be(Ke()),ti=be(Tt()),ni=be(Ye()),ri=be(bt()),ii=be(Qe()),si=be(mn()),oi=be(Rt()),ai=be($t()),ci=be(Ht()),li=be(Vt()),ui=be(Tn()),hi=be(zt()),fi=be(Ot()),pi=be(Gt()),di=be(Kt()),gi=be(Nn()),bi=be(_n()),yi=be(Hn());var Vn=typeof window!="undefined"?window:globalThis,ft=typeof CryptoTickerDefaults!="undefined"?CryptoTickerDefaults:null,xe=typeof tickerAction!="undefined"?tickerAction:null;if(!xe)throw new Error("Ticker action dependency is missing for the preview page");var Hr=ft&&typeof ft.getDefaultSettings=="function"?ft.getDefaultSettings():typeof xe.getDefaultSettings=="function"?xe.getDefaultSettings():{},Vr=ft&&typeof ft.applyDefaults=="function"?function(r){return ft.applyDefaults(r||{})}:function(r){return Object.assign({},Hr,r||{})};xe.sendCanvas=function(){};function zn(r){if(Vn.canvas=r,Vn.canvasContext=r.getContext("2d"),xe&&typeof xe.initCanvas=="function"&&typeof document!="undefined"){let t=document.getElementById.bind(document);document.getElementById=function(c){return c==="ticker"?r:t(c)};try{xe.initCanvas()}finally{document.getElementById=t}}}function zr(r){let t=[],c=r.high||0,u=r.low||0,l=r.volume||0,i=c-u||1,f=20;for(let w=0;w<f;w++){let E=u+i*w/f,y=u+i*(w+.5)/f,S=Math.max(E,y)+i*.05,d=Math.min(E,y)-i*.05;t.push({ts:w,open:E,close:y,high:S,low:d,volumeQuote:l})}return xe.getCandlesNormalized(t)}async function qn(){let r=document.getElementById("precomputedToggle").checked,c=await(await fetch("/dev/options.json")).json(),u=document.getElementById("previews");u.innerHTML="";for(let l=0;l<c.length;l++){let i=c[l],f=document.createElement("div");f.className="preview-group";let w=document.createElement("div");w.className="canvas-row";let E=document.createElement("canvas");E.width=288,E.height=288,w.appendChild(E);let y=document.createElement("canvas");y.width=288,y.height=288,w.appendChild(y),f.appendChild(w);let S=document.createElement("div");S.className="label",S.textContent=i.name||"Option "+(l+1),f.appendChild(S);let d=Vr(i.settings),s=document.createElement("pre");s.className="settings",s.textContent=JSON.stringify(d,null,4),f.appendChild(s),u.appendChild(f),zn(E);let g;r&&i.values?g=i.values:g=await xe.getTickerValue(d.pair,d.currency,d.exchange),xe.updateCanvasTicker(l+"-ticker",d,g,g&&g.connectionState),zn(y);let R;r&&i.values?R=zr(i.values):R=await xe.getCandles(d),xe.updateCanvasCandles(l+"-candles",d,R,g&&g.connectionState)}}document.getElementById("precomputedToggle").addEventListener("change",qn);qn();})();
