"use strict";(()=>{var hr=Object.create;var sn=Object.defineProperty;var fr=Object.getOwnPropertyDescriptor;var pr=Object.getOwnPropertyNames;var dr=Object.getPrototypeOf,gr=Object.prototype.hasOwnProperty;var je=(r=>typeof require!="undefined"?require:typeof Proxy!="undefined"?new Proxy(r,{get:(t,a)=>(typeof require!="undefined"?require:t)[a]}):r)(function(r){if(typeof require!="undefined")return require.apply(this,arguments);throw Error('Dynamic require of "'+r+'" is not supported')});var he=(r,t)=>()=>(t||r((t={exports:{}}).exports,t),t.exports);var br=(r,t,a,u)=>{if(t&&typeof t=="object"||typeof t=="function")for(let c of pr(t))!gr.call(r,c)&&c!==a&&sn(r,c,{get:()=>t[c],enumerable:!(u=fr(t,c))||u.enumerable});return r};var be=(r,t,a)=>(a=r!=null?hr(dr(r)):{},br(t||!r||!r.__esModule?sn(a,"default",{value:r,enumerable:!0}):a,r));var an=he((wt,$t)=>{"use strict";var on,dt;on=self,dt=()=>(()=>{var r={d:(D,e)=>{for(var o in e)r.o(e,o)&&!r.o(D,o)&&Object.defineProperty(D,o,{enumerable:!0,get:e[o]})}};r.g=function(){if(typeof globalThis=="object")return globalThis;try{return this||new Function("return this")()}catch{if(typeof window=="object")return window}}(),r.o=(D,e)=>Object.prototype.hasOwnProperty.call(D,e),r.r=D=>{typeof Symbol!="undefined"&&Symbol.toStringTag&&Object.defineProperty(D,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(D,"t",{value:!0})};var t,a={};r.r(a),r.d(a,{AbortError:()=>i,DefaultHttpClient:()=>j,HttpClient:()=>f,HttpError:()=>u,HttpResponse:()=>p,HttpTransportType:()=>Q,HubConnection:()=>pe,HubConnectionBuilder:()=>Ue,HubConnectionState:()=>q,JsonHubProtocol:()=>Fe,LogLevel:()=>t,MessageType:()=>U,NullLogger:()=>k,Subject:()=>ve,TimeoutError:()=>c,TransferFormat:()=>ee,VERSION:()=>d});class u extends Error{constructor(e,o){let b=new.target.prototype;super(`${e}: Status code '${o}'`),this.statusCode=o,this.__proto__=b}}class c extends Error{constructor(e="A timeout occurred."){let o=new.target.prototype;super(e),this.__proto__=o}}class i extends Error{constructor(e="An abort occurred."){let o=new.target.prototype;super(e),this.__proto__=o}}class g extends Error{constructor(e,o){let b=new.target.prototype;super(e),this.transport=o,this.errorType="UnsupportedTransportError",this.__proto__=b}}class S extends Error{constructor(e,o){let b=new.target.prototype;super(e),this.transport=o,this.errorType="DisabledTransportError",this.__proto__=b}}class R extends Error{constructor(e,o){let b=new.target.prototype;super(e),this.transport=o,this.errorType="FailedToStartTransportError",this.__proto__=b}}class v extends Error{constructor(e){let o=new.target.prototype;super(e),this.errorType="FailedToNegotiateWithServerError",this.__proto__=o}}class T extends Error{constructor(e,o){let b=new.target.prototype;super(e),this.innerErrors=o,this.__proto__=b}}class p{constructor(e,o,b){this.statusCode=e,this.statusText=o,this.content=b}}class f{get(e,o){return this.send({...o,method:"GET",url:e})}post(e,o){return this.send({...o,method:"POST",url:e})}delete(e,o){return this.send({...o,method:"DELETE",url:e})}getCookieString(e){return""}}(function(D){D[D.Trace=0]="Trace",D[D.Debug=1]="Debug",D[D.Information=2]="Information",D[D.Warning=3]="Warning",D[D.Error=4]="Error",D[D.Critical=5]="Critical",D[D.None=6]="None"})(t||(t={}));class k{constructor(){}log(e,o){}}k.instance=new k;let d="8.0.0";class x{static isRequired(e,o){if(e==null)throw new Error(`The '${o}' argument is required.`)}static isNotEmpty(e,o){if(!e||e.match(/^\s*$/))throw new Error(`The '${o}' argument should not be empty.`)}static isIn(e,o,b){if(!(e in o))throw new Error(`Unknown ${b} value: ${e}.`)}}class l{static get isBrowser(){return!l.isNode&&typeof window=="object"&&typeof window.document=="object"}static get isWebWorker(){return!l.isNode&&typeof self=="object"&&"importScripts"in self}static get isReactNative(){return!l.isNode&&typeof window=="object"&&window.document===void 0}static get isNode(){return typeof process!="undefined"&&process.release&&process.release.name==="node"}}function h(D,e){let o="";return C(D)?(o=`Binary data of length ${D.byteLength}`,e&&(o+=`. Content: '${function(b){let w=new Uint8Array(b),I="";return w.forEach(A=>{I+=`0x${A<16?"0":""}${A.toString(16)} `}),I.substr(0,I.length-1)}(D)}'`)):typeof D=="string"&&(o=`String data of length ${D.length}`,e&&(o+=`. Content: '${D}'`)),o}function C(D){return D&&typeof ArrayBuffer!="undefined"&&(D instanceof ArrayBuffer||D.constructor&&D.constructor.name==="ArrayBuffer")}async function M(D,e,o,b,w,I){let A={},[L,$]=E();A[L]=$,D.log(t.Trace,`(${e} transport) sending data. ${h(w,I.logMessageContent)}.`);let G=C(w)?"arraybuffer":"text",ne=await o.post(b,{content:w,headers:{...A,...I.headers},responseType:G,timeout:I.timeout,withCredentials:I.withCredentials});D.log(t.Trace,`(${e} transport) request complete. Response status: ${ne.statusCode}.`)}class y{constructor(e,o){this.i=e,this.h=o}dispose(){let e=this.i.observers.indexOf(this.h);e>-1&&this.i.observers.splice(e,1),this.i.observers.length===0&&this.i.cancelCallback&&this.i.cancelCallback().catch(o=>{})}}class O{constructor(e){this.l=e,this.out=console}log(e,o){if(e>=this.l){let b=`[${new Date().toISOString()}] ${t[e]}: ${o}`;switch(e){case t.Critical:case t.Error:this.out.error(b);break;case t.Warning:this.out.warn(b);break;case t.Information:this.out.info(b);break;default:this.out.log(b)}}}}function E(){let D="X-SignalR-User-Agent";return l.isNode&&(D="User-Agent"),[D,B(d,H(),l.isNode?"NodeJS":"Browser",N())]}function B(D,e,o,b){let w="Microsoft SignalR/",I=D.split(".");return w+=`${I[0]}.${I[1]}`,w+=` (${D}; `,w+=e&&e!==""?`${e}; `:"Unknown OS; ",w+=`${o}`,w+=b?`; ${b}`:"; Unknown Runtime Version",w+=")",w}function H(){if(!l.isNode)return"";switch(process.platform){case"win32":return"Windows NT";case"darwin":return"macOS";case"linux":return"Linux";default:return process.platform}}function N(){if(l.isNode)return process.versions.node}function Y(D){return D.stack?D.stack:D.message?D.message:`${D}`}class re extends f{constructor(e){super(),this.u=e,this.p=fetch.bind(function(){if(typeof globalThis!="undefined")return globalThis;if(typeof self!="undefined")return self;if(typeof window!="undefined")return window;if(r.g!==void 0)return r.g;throw new Error("could not find global")}()),this.m=AbortController,this.m}async send(e){if(e.abortSignal&&e.abortSignal.aborted)throw new i;if(!e.method)throw new Error("No method defined.");if(!e.url)throw new Error("No url defined.");let o=new this.m,b;e.abortSignal&&(e.abortSignal.onabort=()=>{o.abort(),b=new i});let w,I=null;if(e.timeout){let $=e.timeout;I=setTimeout(()=>{o.abort(),this.u.log(t.Warning,"Timeout from HTTP request."),b=new c},$)}e.content===""&&(e.content=void 0),e.content&&(e.headers=e.headers||{},C(e.content)?e.headers["Content-Type"]="application/octet-stream":e.headers["Content-Type"]="text/plain;charset=UTF-8");try{w=await this.p(e.url,{body:e.content,cache:"no-cache",credentials:e.withCredentials===!0?"include":"same-origin",headers:{"X-Requested-With":"XMLHttpRequest",...e.headers},method:e.method,mode:"cors",redirect:"follow",signal:o.signal})}catch($){throw b||(this.u.log(t.Warning,`Error from HTTP request. ${$}.`),$)}finally{I&&clearTimeout(I),e.abortSignal&&(e.abortSignal.onabort=null)}if(!w.ok){let $=await J(w,"text");throw new u($||w.statusText,w.status)}let A=J(w,e.responseType),L=await A;return new p(w.status,w.statusText,L)}getCookieString(e){let o="";return l.isNode&&this.v&&this.v.getCookies(e,(b,w)=>o=w.join("; ")),o}}function J(D,e){let o;switch(e){case"arraybuffer":o=D.arrayBuffer();break;case"text":default:o=D.text();break;case"blob":case"document":case"json":throw new Error(`${e} is not supported.`)}return o}class ie extends f{constructor(e){super(),this.u=e}send(e){return e.abortSignal&&e.abortSignal.aborted?Promise.reject(new i):e.method?e.url?new Promise((o,b)=>{let w=new XMLHttpRequest;w.open(e.method,e.url,!0),w.withCredentials=e.withCredentials===void 0||e.withCredentials,w.setRequestHeader("X-Requested-With","XMLHttpRequest"),e.content===""&&(e.content=void 0),e.content&&(C(e.content)?w.setRequestHeader("Content-Type","application/octet-stream"):w.setRequestHeader("Content-Type","text/plain;charset=UTF-8"));let I=e.headers;I&&Object.keys(I).forEach(A=>{w.setRequestHeader(A,I[A])}),e.responseType&&(w.responseType=e.responseType),e.abortSignal&&(e.abortSignal.onabort=()=>{w.abort(),b(new i)}),e.timeout&&(w.timeout=e.timeout),w.onload=()=>{e.abortSignal&&(e.abortSignal.onabort=null),w.status>=200&&w.status<300?o(new p(w.status,w.statusText,w.response||w.responseText)):b(new u(w.response||w.responseText||w.statusText,w.status))},w.onerror=()=>{this.u.log(t.Warning,`Error from HTTP request. ${w.status}: ${w.statusText}.`),b(new u(w.statusText,w.status))},w.ontimeout=()=>{this.u.log(t.Warning,"Timeout from HTTP request."),b(new c)},w.send(e.content)}):Promise.reject(new Error("No url defined.")):Promise.reject(new Error("No method defined."))}}class j extends f{constructor(e){if(super(),typeof fetch!="undefined"||l.isNode)this.$=new re(e);else{if(typeof XMLHttpRequest=="undefined")throw new Error("No usable HttpClient found.");this.$=new ie(e)}}send(e){return e.abortSignal&&e.abortSignal.aborted?Promise.reject(new i):e.method?e.url?this.$.send(e):Promise.reject(new Error("No url defined.")):Promise.reject(new Error("No method defined."))}getCookieString(e){return this.$.getCookieString(e)}}class z{static write(e){return`${e}${z.RecordSeparator}`}static parse(e){if(e[e.length-1]!==z.RecordSeparator)throw new Error("Message is incomplete.");let o=e.split(z.RecordSeparator);return o.pop(),o}}z.RecordSeparatorCode=30,z.RecordSeparator=String.fromCharCode(z.RecordSeparatorCode);class fe{writeHandshakeRequest(e){return z.write(JSON.stringify(e))}parseHandshakeResponse(e){let o,b;if(C(e)){let A=new Uint8Array(e),L=A.indexOf(z.RecordSeparatorCode);if(L===-1)throw new Error("Message is incomplete.");let $=L+1;o=String.fromCharCode.apply(null,Array.prototype.slice.call(A.slice(0,$))),b=A.byteLength>$?A.slice($).buffer:null}else{let A=e,L=A.indexOf(z.RecordSeparator);if(L===-1)throw new Error("Message is incomplete.");let $=L+1;o=A.substring(0,$),b=A.length>$?A.substring($):null}let w=z.parse(o),I=JSON.parse(w[0]);if(I.type)throw new Error("Expected a handshake response from the server.");return[b,I]}}var U,q;(function(D){D[D.Invocation=1]="Invocation",D[D.StreamItem=2]="StreamItem",D[D.Completion=3]="Completion",D[D.StreamInvocation=4]="StreamInvocation",D[D.CancelInvocation=5]="CancelInvocation",D[D.Ping=6]="Ping",D[D.Close=7]="Close",D[D.Ack=8]="Ack",D[D.Sequence=9]="Sequence"})(U||(U={}));class ve{constructor(){this.observers=[]}next(e){for(let o of this.observers)o.next(e)}error(e){for(let o of this.observers)o.error&&o.error(e)}complete(){for(let e of this.observers)e.complete&&e.complete()}subscribe(e){return this.observers.push(e),new y(this,e)}}class Ce{constructor(e,o,b){this.C=1e5,this.S=[],this.k=0,this.P=!1,this.T=1,this.I=0,this._=0,this.H=!1,this.D=e,this.R=o,this.C=b}async A(e){let o=this.D.writeMessage(e),b=Promise.resolve();if(this.U(e)){this.k++;let w=()=>{},I=()=>{};C(o)?this._+=o.byteLength:this._+=o.length,this._>=this.C&&(b=new Promise((A,L)=>{w=A,I=L})),this.S.push(new ye(o,this.k,w,I))}try{this.H||await this.R.send(o)}catch{this.L()}await b}N(e){let o=-1;for(let b=0;b<this.S.length;b++){let w=this.S[b];if(w.q<=e.sequenceId)o=b,C(w.M)?this._-=w.M.byteLength:this._-=w.M.length,w.j();else{if(!(this._<this.C))break;w.j()}}o!==-1&&(this.S=this.S.slice(o+1))}W(e){if(this.P)return e.type===U.Sequence&&(this.P=!1,!0);if(!this.U(e))return!0;let o=this.T;return this.T++,o<=this.I?(o===this.I&&this.O(),!1):(this.I=o,this.O(),!0)}F(e){e.sequenceId>this.T?this.R.stop(new Error("Sequence ID greater than amount of messages we've received.")):this.T=e.sequenceId}L(){this.H=!0,this.P=!0}async B(){let e=this.S.length!==0?this.S[0].q:this.k+1;await this.R.send(this.D.writeMessage({type:U.Sequence,sequenceId:e}));let o=this.S;for(let b of o)await this.R.send(b.M);this.H=!1}X(e){e!=null||(e=new Error("Unable to reconnect to server."));for(let o of this.S)o.J(e)}U(e){switch(e.type){case U.Invocation:case U.StreamItem:case U.Completion:case U.StreamInvocation:case U.CancelInvocation:return!0;case U.Close:case U.Sequence:case U.Ping:case U.Ack:return!1}}O(){this.V===void 0&&(this.V=setTimeout(async()=>{try{this.H||await this.R.send(this.D.writeMessage({type:U.Ack,sequenceId:this.I}))}catch{}clearTimeout(this.V),this.V=void 0},1e3))}}class ye{constructor(e,o,b,w){this.M=e,this.q=o,this.j=b,this.J=w}}(function(D){D.Disconnected="Disconnected",D.Connecting="Connecting",D.Connected="Connected",D.Disconnecting="Disconnecting",D.Reconnecting="Reconnecting"})(q||(q={}));class pe{static create(e,o,b,w,I,A,L){return new pe(e,o,b,w,I,A,L)}constructor(e,o,b,w,I,A,L){this.K=0,this.G=()=>{this.u.log(t.Warning,"The page is being frozen, this will likely lead to the connection being closed and messages being lost. For more information see the docs at https://learn.microsoft.com/aspnet/core/signalr/javascript-client#bsleep")},x.isRequired(e,"connection"),x.isRequired(o,"logger"),x.isRequired(b,"protocol"),this.serverTimeoutInMilliseconds=I!=null?I:3e4,this.keepAliveIntervalInMilliseconds=A!=null?A:15e3,this.Y=L!=null?L:1e5,this.u=o,this.D=b,this.connection=e,this.Z=w,this.tt=new fe,this.connection.onreceive=$=>this.et($),this.connection.onclose=$=>this.st($),this.it={},this.nt={},this.rt=[],this.ot=[],this.ht=[],this.ct=0,this.lt=!1,this.ut=q.Disconnected,this.dt=!1,this.ft=this.D.writeMessage({type:U.Ping})}get state(){return this.ut}get connectionId(){return this.connection&&this.connection.connectionId||null}get baseUrl(){return this.connection.baseUrl||""}set baseUrl(e){if(this.ut!==q.Disconnected&&this.ut!==q.Reconnecting)throw new Error("The HubConnection must be in the Disconnected or Reconnecting state to change the url.");if(!e)throw new Error("The HubConnection url must be a valid url.");this.connection.baseUrl=e}start(){return this.wt=this.gt(),this.wt}async gt(){if(this.ut!==q.Disconnected)return Promise.reject(new Error("Cannot start a HubConnection that is not in the 'Disconnected' state."));this.ut=q.Connecting,this.u.log(t.Debug,"Starting HubConnection.");try{await this.yt(),l.isBrowser&&window.document.addEventListener("freeze",this.G),this.ut=q.Connected,this.dt=!0,this.u.log(t.Debug,"HubConnection connected successfully.")}catch(e){return this.ut=q.Disconnected,this.u.log(t.Debug,`HubConnection failed to start successfully because of error '${e}'.`),Promise.reject(e)}}async yt(){this.bt=void 0,this.lt=!1;let e=new Promise((o,b)=>{this.vt=o,this.Et=b});await this.connection.start(this.D.transferFormat);try{let o=this.D.version;this.connection.features.reconnect||(o=1);let b={protocol:this.D.name,version:o};if(this.u.log(t.Debug,"Sending handshake request."),await this.$t(this.tt.writeHandshakeRequest(b)),this.u.log(t.Information,`Using HubProtocol '${this.D.name}'.`),this.Ct(),this.St(),this.kt(),await e,this.bt)throw this.bt;this.connection.features.reconnect&&(this.Pt=new Ce(this.D,this.connection,this.Y),this.connection.features.disconnected=this.Pt.L.bind(this.Pt),this.connection.features.resend=()=>{if(this.Pt)return this.Pt.B()}),this.connection.features.inherentKeepAlive||await this.$t(this.ft)}catch(o){throw this.u.log(t.Debug,`Hub handshake failed with error '${o}' during start(). Stopping HubConnection.`),this.Ct(),this.Tt(),await this.connection.stop(o),o}}async stop(){let e=this.wt;this.connection.features.reconnect=!1,this.It=this._t(),await this.It;try{await e}catch{}}_t(e){if(this.ut===q.Disconnected)return this.u.log(t.Debug,`Call to HubConnection.stop(${e}) ignored because it is already in the disconnected state.`),Promise.resolve();if(this.ut===q.Disconnecting)return this.u.log(t.Debug,`Call to HttpConnection.stop(${e}) ignored because the connection is already in the disconnecting state.`),this.It;let o=this.ut;return this.ut=q.Disconnecting,this.u.log(t.Debug,"Stopping HubConnection."),this.Ht?(this.u.log(t.Debug,"Connection stopped during reconnect delay. Done reconnecting."),clearTimeout(this.Ht),this.Ht=void 0,this.Dt(),Promise.resolve()):(o===q.Connected&&this.Rt(),this.Ct(),this.Tt(),this.bt=e||new i("The connection was stopped before the hub handshake could complete."),this.connection.stop(e))}async Rt(){try{await this.xt(this.At())}catch{}}stream(e,...o){let[b,w]=this.Ut(o),I=this.Lt(e,o,w),A,L=new ve;return L.cancelCallback=()=>{let $=this.Nt(I.invocationId);return delete this.it[I.invocationId],A.then(()=>this.xt($))},this.it[I.invocationId]=($,G)=>{G?L.error(G):$&&($.type===U.Completion?$.error?L.error(new Error($.error)):L.complete():L.next($.item))},A=this.xt(I).catch($=>{L.error($),delete this.it[I.invocationId]}),this.qt(b,A),L}$t(e){return this.kt(),this.connection.send(e)}xt(e){return this.Pt?this.Pt.A(e):this.$t(this.D.writeMessage(e))}send(e,...o){let[b,w]=this.Ut(o),I=this.xt(this.Mt(e,o,!0,w));return this.qt(b,I),I}invoke(e,...o){let[b,w]=this.Ut(o),I=this.Mt(e,o,!1,w);return new Promise((A,L)=>{this.it[I.invocationId]=(G,ne)=>{ne?L(ne):G&&(G.type===U.Completion?G.error?L(new Error(G.error)):A(G.result):L(new Error(`Unexpected message type: ${G.type}`)))};let $=this.xt(I).catch(G=>{L(G),delete this.it[I.invocationId]});this.qt(b,$)})}on(e,o){e&&o&&(e=e.toLowerCase(),this.nt[e]||(this.nt[e]=[]),this.nt[e].indexOf(o)===-1&&this.nt[e].push(o))}off(e,o){if(!e)return;e=e.toLowerCase();let b=this.nt[e];if(b)if(o){let w=b.indexOf(o);w!==-1&&(b.splice(w,1),b.length===0&&delete this.nt[e])}else delete this.nt[e]}onclose(e){e&&this.rt.push(e)}onreconnecting(e){e&&this.ot.push(e)}onreconnected(e){e&&this.ht.push(e)}et(e){if(this.Ct(),this.lt||(e=this.jt(e),this.lt=!0),e){let o=this.D.parseMessages(e,this.u);for(let b of o)if(!this.Pt||this.Pt.W(b))switch(b.type){case U.Invocation:this.Wt(b);break;case U.StreamItem:case U.Completion:{let w=this.it[b.invocationId];if(w){b.type===U.Completion&&delete this.it[b.invocationId];try{w(b)}catch(I){this.u.log(t.Error,`Stream callback threw error: ${Y(I)}`)}}break}case U.Ping:break;case U.Close:{this.u.log(t.Information,"Close message received from server.");let w=b.error?new Error("Server returned an error on close: "+b.error):void 0;b.allowReconnect===!0?this.connection.stop(w):this.It=this._t(w);break}case U.Ack:this.Pt&&this.Pt.N(b);break;case U.Sequence:this.Pt&&this.Pt.F(b);break;default:this.u.log(t.Warning,`Invalid message type: ${b.type}.`)}}this.St()}jt(e){let o,b;try{[b,o]=this.tt.parseHandshakeResponse(e)}catch(w){let I="Error parsing handshake response: "+w;this.u.log(t.Error,I);let A=new Error(I);throw this.Et(A),A}if(o.error){let w="Server returned handshake error: "+o.error;this.u.log(t.Error,w);let I=new Error(w);throw this.Et(I),I}return this.u.log(t.Debug,"Server handshake complete."),this.vt(),b}kt(){this.connection.features.inherentKeepAlive||(this.K=new Date().getTime()+this.keepAliveIntervalInMilliseconds,this.Tt())}St(){if(!(this.connection.features&&this.connection.features.inherentKeepAlive||(this.Ot=setTimeout(()=>this.serverTimeout(),this.serverTimeoutInMilliseconds),this.Ft!==void 0))){let e=this.K-new Date().getTime();e<0&&(e=0),this.Ft=setTimeout(async()=>{if(this.ut===q.Connected)try{await this.$t(this.ft)}catch{this.Tt()}},e)}}serverTimeout(){this.connection.stop(new Error("Server timeout elapsed without receiving a message from the server."))}async Wt(e){let o=e.target.toLowerCase(),b=this.nt[o];if(!b)return this.u.log(t.Warning,`No client method with the name '${o}' found.`),void(e.invocationId&&(this.u.log(t.Warning,`No result given for '${o}' method and invocation ID '${e.invocationId}'.`),await this.xt(this.Bt(e.invocationId,"Client didn't provide a result.",null))));let w=b.slice(),I=!!e.invocationId,A,L,$;for(let G of w)try{let ne=A;A=await G.apply(this,e.arguments),I&&A&&ne&&(this.u.log(t.Error,`Multiple results provided for '${o}'. Sending error to server.`),$=this.Bt(e.invocationId,"Client provided multiple results.",null)),L=void 0}catch(ne){L=ne,this.u.log(t.Error,`A callback for the method '${o}' threw error '${ne}'.`)}$?await this.xt($):I?(L?$=this.Bt(e.invocationId,`${L}`,null):A!==void 0?$=this.Bt(e.invocationId,null,A):(this.u.log(t.Warning,`No result given for '${o}' method and invocation ID '${e.invocationId}'.`),$=this.Bt(e.invocationId,"Client didn't provide a result.",null)),await this.xt($)):A&&this.u.log(t.Error,`Result given for '${o}' method but server is not expecting a result.`)}st(e){this.u.log(t.Debug,`HubConnection.connectionClosed(${e}) called while in state ${this.ut}.`),this.bt=this.bt||e||new i("The underlying connection was closed before the hub handshake could complete."),this.vt&&this.vt(),this.Xt(e||new Error("Invocation canceled due to the underlying connection being closed.")),this.Ct(),this.Tt(),this.ut===q.Disconnecting?this.Dt(e):this.ut===q.Connected&&this.Z?this.Jt(e):this.ut===q.Connected&&this.Dt(e)}Dt(e){if(this.dt){this.ut=q.Disconnected,this.dt=!1,this.Pt&&(this.Pt.X(e!=null?e:new Error("Connection closed.")),this.Pt=void 0),l.isBrowser&&window.document.removeEventListener("freeze",this.G);try{this.rt.forEach(o=>o.apply(this,[e]))}catch(o){this.u.log(t.Error,`An onclose callback called with error '${e}' threw error '${o}'.`)}}}async Jt(e){let o=Date.now(),b=0,w=e!==void 0?e:new Error("Attempting to reconnect due to a unknown error."),I=this.zt(b++,0,w);if(I===null)return this.u.log(t.Debug,"Connection not reconnecting because the IRetryPolicy returned null on the first reconnect attempt."),void this.Dt(e);if(this.ut=q.Reconnecting,e?this.u.log(t.Information,`Connection reconnecting because of error '${e}'.`):this.u.log(t.Information,"Connection reconnecting."),this.ot.length!==0){try{this.ot.forEach(A=>A.apply(this,[e]))}catch(A){this.u.log(t.Error,`An onreconnecting callback called with error '${e}' threw error '${A}'.`)}if(this.ut!==q.Reconnecting)return void this.u.log(t.Debug,"Connection left the reconnecting state in onreconnecting callback. Done reconnecting.")}for(;I!==null;){if(this.u.log(t.Information,`Reconnect attempt number ${b} will start in ${I} ms.`),await new Promise(A=>{this.Ht=setTimeout(A,I)}),this.Ht=void 0,this.ut!==q.Reconnecting)return void this.u.log(t.Debug,"Connection left the reconnecting state during reconnect delay. Done reconnecting.");try{if(await this.yt(),this.ut=q.Connected,this.u.log(t.Information,"HubConnection reconnected successfully."),this.ht.length!==0)try{this.ht.forEach(A=>A.apply(this,[this.connection.connectionId]))}catch(A){this.u.log(t.Error,`An onreconnected callback called with connectionId '${this.connection.connectionId}; threw error '${A}'.`)}return}catch(A){if(this.u.log(t.Information,`Reconnect attempt failed because of error '${A}'.`),this.ut!==q.Reconnecting)return this.u.log(t.Debug,`Connection moved to the '${this.ut}' from the reconnecting state during reconnect attempt. Done reconnecting.`),void(this.ut===q.Disconnecting&&this.Dt());w=A instanceof Error?A:new Error(A.toString()),I=this.zt(b++,Date.now()-o,w)}}this.u.log(t.Information,`Reconnect retries have been exhausted after ${Date.now()-o} ms and ${b} failed attempts. Connection disconnecting.`),this.Dt()}zt(e,o,b){try{return this.Z.nextRetryDelayInMilliseconds({elapsedMilliseconds:o,previousRetryCount:e,retryReason:b})}catch(w){return this.u.log(t.Error,`IRetryPolicy.nextRetryDelayInMilliseconds(${e}, ${o}) threw error '${w}'.`),null}}Xt(e){let o=this.it;this.it={},Object.keys(o).forEach(b=>{let w=o[b];try{w(null,e)}catch(I){this.u.log(t.Error,`Stream 'error' callback called with '${e}' threw error: ${Y(I)}`)}})}Tt(){this.Ft&&(clearTimeout(this.Ft),this.Ft=void 0)}Ct(){this.Ot&&clearTimeout(this.Ot)}Mt(e,o,b,w){if(b)return w.length!==0?{arguments:o,streamIds:w,target:e,type:U.Invocation}:{arguments:o,target:e,type:U.Invocation};{let I=this.ct;return this.ct++,w.length!==0?{arguments:o,invocationId:I.toString(),streamIds:w,target:e,type:U.Invocation}:{arguments:o,invocationId:I.toString(),target:e,type:U.Invocation}}}qt(e,o){if(e.length!==0){o||(o=Promise.resolve());for(let b in e)e[b].subscribe({complete:()=>{o=o.then(()=>this.xt(this.Bt(b)))},error:w=>{let I;I=w instanceof Error?w.message:w&&w.toString?w.toString():"Unknown error",o=o.then(()=>this.xt(this.Bt(b,I)))},next:w=>{o=o.then(()=>this.xt(this.Vt(b,w)))}})}}Ut(e){let o=[],b=[];for(let w=0;w<e.length;w++){let I=e[w];if(this.Kt(I)){let A=this.ct;this.ct++,o[A]=I,b.push(A.toString()),e.splice(w,1)}}return[o,b]}Kt(e){return e&&e.subscribe&&typeof e.subscribe=="function"}Lt(e,o,b){let w=this.ct;return this.ct++,b.length!==0?{arguments:o,invocationId:w.toString(),streamIds:b,target:e,type:U.StreamInvocation}:{arguments:o,invocationId:w.toString(),target:e,type:U.StreamInvocation}}Nt(e){return{invocationId:e,type:U.CancelInvocation}}Vt(e,o){return{invocationId:e,item:o,type:U.StreamItem}}Bt(e,o,b){return o?{error:o,invocationId:e,type:U.Completion}:{invocationId:e,result:b,type:U.Completion}}At(){return{type:U.Close}}}let Z=[0,2e3,1e4,3e4,null];class Te{constructor(e){this.Gt=e!==void 0?[...e,null]:Z}nextRetryDelayInMilliseconds(e){return this.Gt[e.previousRetryCount]}}class X{}X.Authorization="Authorization",X.Cookie="Cookie";class Ee extends f{constructor(e,o){super(),this.Qt=e,this.Yt=o}async send(e){let o=!0;this.Yt&&(!this.Zt||e.url&&e.url.indexOf("/negotiate?")>0)&&(o=!1,this.Zt=await this.Yt()),this.te(e);let b=await this.Qt.send(e);return o&&b.statusCode===401&&this.Yt?(this.Zt=await this.Yt(),this.te(e),await this.Qt.send(e)):b}te(e){e.headers||(e.headers={}),this.Zt?e.headers[X.Authorization]=`Bearer ${this.Zt}`:this.Yt&&e.headers[X.Authorization]&&delete e.headers[X.Authorization]}getCookieString(e){return this.Qt.getCookieString(e)}}var Q,ee;(function(D){D[D.None=0]="None",D[D.WebSockets=1]="WebSockets",D[D.ServerSentEvents=2]="ServerSentEvents",D[D.LongPolling=4]="LongPolling"})(Q||(Q={})),function(D){D[D.Text=1]="Text",D[D.Binary=2]="Binary"}(ee||(ee={}));class Oe{constructor(){this.ee=!1,this.onabort=null}abort(){this.ee||(this.ee=!0,this.onabort&&this.onabort())}get signal(){return this}get aborted(){return this.ee}}class Le{get pollAborted(){return this.se.aborted}constructor(e,o,b){this.$=e,this.u=o,this.se=new Oe,this.ie=b,this.ne=!1,this.onreceive=null,this.onclose=null}async connect(e,o){if(x.isRequired(e,"url"),x.isRequired(o,"transferFormat"),x.isIn(o,ee,"transferFormat"),this.re=e,this.u.log(t.Trace,"(LongPolling transport) Connecting."),o===ee.Binary&&typeof XMLHttpRequest!="undefined"&&typeof new XMLHttpRequest().responseType!="string")throw new Error("Binary protocols over XmlHttpRequest not implementing advanced features are not supported.");let[b,w]=E(),I={[b]:w,...this.ie.headers},A={abortSignal:this.se.signal,headers:I,timeout:1e5,withCredentials:this.ie.withCredentials};o===ee.Binary&&(A.responseType="arraybuffer");let L=`${e}&_=${Date.now()}`;this.u.log(t.Trace,`(LongPolling transport) polling: ${L}.`);let $=await this.$.get(L,A);$.statusCode!==200?(this.u.log(t.Error,`(LongPolling transport) Unexpected response code: ${$.statusCode}.`),this.oe=new u($.statusText||"",$.statusCode),this.ne=!1):this.ne=!0,this.he=this.ce(this.re,A)}async ce(e,o){try{for(;this.ne;)try{let b=`${e}&_=${Date.now()}`;this.u.log(t.Trace,`(LongPolling transport) polling: ${b}.`);let w=await this.$.get(b,o);w.statusCode===204?(this.u.log(t.Information,"(LongPolling transport) Poll terminated by server."),this.ne=!1):w.statusCode!==200?(this.u.log(t.Error,`(LongPolling transport) Unexpected response code: ${w.statusCode}.`),this.oe=new u(w.statusText||"",w.statusCode),this.ne=!1):w.content?(this.u.log(t.Trace,`(LongPolling transport) data received. ${h(w.content,this.ie.logMessageContent)}.`),this.onreceive&&this.onreceive(w.content)):this.u.log(t.Trace,"(LongPolling transport) Poll timed out, reissuing.")}catch(b){this.ne?b instanceof c?this.u.log(t.Trace,"(LongPolling transport) Poll timed out, reissuing."):(this.oe=b,this.ne=!1):this.u.log(t.Trace,`(LongPolling transport) Poll errored after shutdown: ${b.message}`)}}finally{this.u.log(t.Trace,"(LongPolling transport) Polling complete."),this.pollAborted||this.ae()}}async send(e){return this.ne?M(this.u,"LongPolling",this.$,this.re,e,this.ie):Promise.reject(new Error("Cannot send until the transport is connected"))}async stop(){this.u.log(t.Trace,"(LongPolling transport) Stopping polling."),this.ne=!1,this.se.abort();try{await this.he,this.u.log(t.Trace,`(LongPolling transport) sending DELETE request to ${this.re}.`);let e={},[o,b]=E();e[o]=b;let w={headers:{...e,...this.ie.headers},timeout:this.ie.timeout,withCredentials:this.ie.withCredentials},I;try{await this.$.delete(this.re,w)}catch(A){I=A}I?I instanceof u&&(I.statusCode===404?this.u.log(t.Trace,"(LongPolling transport) A 404 response was returned from sending a DELETE request."):this.u.log(t.Trace,`(LongPolling transport) Error sending a DELETE request: ${I}`)):this.u.log(t.Trace,"(LongPolling transport) DELETE request accepted.")}finally{this.u.log(t.Trace,"(LongPolling transport) Stop finished."),this.ae()}}ae(){if(this.onclose){let e="(LongPolling transport) Firing onclose event.";this.oe&&(e+=" Error: "+this.oe),this.u.log(t.Trace,e),this.onclose(this.oe)}}}class _e{constructor(e,o,b,w){this.$=e,this.Zt=o,this.u=b,this.ie=w,this.onreceive=null,this.onclose=null}async connect(e,o){return x.isRequired(e,"url"),x.isRequired(o,"transferFormat"),x.isIn(o,ee,"transferFormat"),this.u.log(t.Trace,"(SSE transport) Connecting."),this.re=e,this.Zt&&(e+=(e.indexOf("?")<0?"?":"&")+`access_token=${encodeURIComponent(this.Zt)}`),new Promise((b,w)=>{let I,A=!1;if(o===ee.Text){if(l.isBrowser||l.isWebWorker)I=new this.ie.EventSource(e,{withCredentials:this.ie.withCredentials});else{let L=this.$.getCookieString(e),$={};$.Cookie=L;let[G,ne]=E();$[G]=ne,I=new this.ie.EventSource(e,{withCredentials:this.ie.withCredentials,headers:{...$,...this.ie.headers}})}try{I.onmessage=L=>{if(this.onreceive)try{this.u.log(t.Trace,`(SSE transport) data received. ${h(L.data,this.ie.logMessageContent)}.`),this.onreceive(L.data)}catch($){return void this.le($)}},I.onerror=L=>{A?this.le():w(new Error("EventSource failed to connect. The connection could not be found on the server, either the connection ID is not present on the server, or a proxy is refusing/buffering the connection. If you have multiple servers check that sticky sessions are enabled."))},I.onopen=()=>{this.u.log(t.Information,`SSE connected to ${this.re}`),this.ue=I,A=!0,b()}}catch(L){return void w(L)}}else w(new Error("The Server-Sent Events transport only supports the 'Text' transfer format"))})}async send(e){return this.ue?M(this.u,"SSE",this.$,this.re,e,this.ie):Promise.reject(new Error("Cannot send until the transport is connected"))}stop(){return this.le(),Promise.resolve()}le(e){this.ue&&(this.ue.close(),this.ue=void 0,this.onclose&&this.onclose(e))}}class Ne{constructor(e,o,b,w,I,A){this.u=b,this.Yt=o,this.de=w,this.fe=I,this.$=e,this.onreceive=null,this.onclose=null,this.pe=A}async connect(e,o){let b;return x.isRequired(e,"url"),x.isRequired(o,"transferFormat"),x.isIn(o,ee,"transferFormat"),this.u.log(t.Trace,"(WebSockets transport) Connecting."),this.Yt&&(b=await this.Yt()),new Promise((w,I)=>{let A;e=e.replace(/^http/,"ws");let L=this.$.getCookieString(e),$=!1;if(l.isNode||l.isReactNative){let G={},[ne,De]=E();G[ne]=De,b&&(G[X.Authorization]=`Bearer ${b}`),L&&(G[X.Cookie]=L),A=new this.fe(e,void 0,{headers:{...G,...this.pe}})}else b&&(e+=(e.indexOf("?")<0?"?":"&")+`access_token=${encodeURIComponent(b)}`);A||(A=new this.fe(e)),o===ee.Binary&&(A.binaryType="arraybuffer"),A.onopen=G=>{this.u.log(t.Information,`WebSocket connected to ${e}.`),this.we=A,$=!0,w()},A.onerror=G=>{let ne=null;ne=typeof ErrorEvent!="undefined"&&G instanceof ErrorEvent?G.error:"There was an error with the transport",this.u.log(t.Information,`(WebSockets transport) ${ne}.`)},A.onmessage=G=>{if(this.u.log(t.Trace,`(WebSockets transport) data received. ${h(G.data,this.de)}.`),this.onreceive)try{this.onreceive(G.data)}catch(ne){return void this.le(ne)}},A.onclose=G=>{if($)this.le(G);else{let ne=null;ne=typeof ErrorEvent!="undefined"&&G instanceof ErrorEvent?G.error:"WebSocket failed to connect. The connection could not be found on the server, either the endpoint may not be a SignalR endpoint, the connection ID is not present on the server, or there is a proxy blocking WebSockets. If you have multiple servers check that sticky sessions are enabled.",I(new Error(ne))}}})}send(e){return this.we&&this.we.readyState===this.fe.OPEN?(this.u.log(t.Trace,`(WebSockets transport) sending data. ${h(e,this.de)}.`),this.we.send(e),Promise.resolve()):Promise.reject("WebSocket is not in the OPEN state")}stop(){return this.we&&this.le(void 0),Promise.resolve()}le(e){this.we&&(this.we.onclose=()=>{},this.we.onmessage=()=>{},this.we.onerror=()=>{},this.we.close(),this.we=void 0),this.u.log(t.Trace,"(WebSockets transport) socket closed."),this.onclose&&(!this.ge(e)||e.wasClean!==!1&&e.code===1e3?e instanceof Error?this.onclose(e):this.onclose():this.onclose(new Error(`WebSocket closed with status code: ${e.code} (${e.reason||"no reason given"}).`)))}ge(e){return e&&typeof e.wasClean=="boolean"&&typeof e.code=="number"}}class Se{constructor(e,o={}){var b;if(this.me=()=>{},this.features={},this.ye=1,x.isRequired(e,"url"),this.u=(b=o.logger)===void 0?new O(t.Information):b===null?k.instance:b.log!==void 0?b:new O(b),this.baseUrl=this.be(e),(o=o||{}).logMessageContent=o.logMessageContent!==void 0&&o.logMessageContent,typeof o.withCredentials!="boolean"&&o.withCredentials!==void 0)throw new Error("withCredentials option was not a 'boolean' or 'undefined' value");o.withCredentials=o.withCredentials===void 0||o.withCredentials,o.timeout=o.timeout===void 0?1e5:o.timeout;let w=null,I=null;l.isNode&&(w=function(){throw new Error("Trying to import 'ws' in the browser.")}(),I=function(){throw new Error("Trying to import 'eventsource' in the browser.")}()),l.isNode||typeof WebSocket=="undefined"||o.WebSocket?l.isNode&&!o.WebSocket&&w&&(o.WebSocket=w):o.WebSocket=WebSocket,l.isNode||typeof EventSource=="undefined"||o.EventSource?l.isNode&&!o.EventSource&&I!==void 0&&(o.EventSource=I):o.EventSource=EventSource,this.$=new Ee(o.httpClient||new j(this.u),o.accessTokenFactory),this.ut="Disconnected",this.dt=!1,this.ie=o,this.onreceive=null,this.onclose=null}async start(e){if(e=e||ee.Binary,x.isIn(e,ee,"transferFormat"),this.u.log(t.Debug,`Starting connection with transfer format '${ee[e]}'.`),this.ut!=="Disconnected")return Promise.reject(new Error("Cannot start an HttpConnection that is not in the 'Disconnected' state."));if(this.ut="Connecting",this.ve=this.yt(e),await this.ve,this.ut==="Disconnecting"){let o="Failed to start the HttpConnection before stop() was called.";return this.u.log(t.Error,o),await this.It,Promise.reject(new i(o))}if(this.ut!=="Connected"){let o="HttpConnection.startInternal completed gracefully but didn't enter the connection into the connected state!";return this.u.log(t.Error,o),Promise.reject(new i(o))}this.dt=!0}send(e){return this.ut!=="Connected"?Promise.reject(new Error("Cannot send data if the connection is not in the 'Connected' State.")):(this.Ee||(this.Ee=new ce(this.transport)),this.Ee.send(e))}async stop(e){return this.ut==="Disconnected"?(this.u.log(t.Debug,`Call to HttpConnection.stop(${e}) ignored because the connection is already in the disconnected state.`),Promise.resolve()):this.ut==="Disconnecting"?(this.u.log(t.Debug,`Call to HttpConnection.stop(${e}) ignored because the connection is already in the disconnecting state.`),this.It):(this.ut="Disconnecting",this.It=new Promise(o=>{this.me=o}),await this._t(e),void await this.It)}async _t(e){this.$e=e;try{await this.ve}catch{}if(this.transport){try{await this.transport.stop()}catch(o){this.u.log(t.Error,`HttpConnection.transport.stop() threw error '${o}'.`),this.Ce()}this.transport=void 0}else this.u.log(t.Debug,"HttpConnection.transport is undefined in HttpConnection.stop() because start() failed.")}async yt(e){let o=this.baseUrl;this.Yt=this.ie.accessTokenFactory,this.$.Yt=this.Yt;try{if(this.ie.skipNegotiation){if(this.ie.transport!==Q.WebSockets)throw new Error("Negotiation can only be skipped when using the WebSocket transport directly.");this.transport=this.Se(Q.WebSockets),await this.ke(o,e)}else{let b=null,w=0;do{if(b=await this.Pe(o),this.ut==="Disconnecting"||this.ut==="Disconnected")throw new i("The connection was stopped during negotiation.");if(b.error)throw new Error(b.error);if(b.ProtocolVersion)throw new Error("Detected a connection attempt to an ASP.NET SignalR Server. This client only supports connecting to an ASP.NET Core SignalR Server. See https://aka.ms/signalr-core-differences for details.");if(b.url&&(o=b.url),b.accessToken){let I=b.accessToken;this.Yt=()=>I,this.$.Zt=I,this.$.Yt=void 0}w++}while(b.url&&w<100);if(w===100&&b.url)throw new Error("Negotiate redirection limit exceeded.");await this.Te(o,this.ie.transport,b,e)}this.transport instanceof Le&&(this.features.inherentKeepAlive=!0),this.ut==="Connecting"&&(this.u.log(t.Debug,"The HttpConnection connected successfully."),this.ut="Connected")}catch(b){return this.u.log(t.Error,"Failed to start the connection: "+b),this.ut="Disconnected",this.transport=void 0,this.me(),Promise.reject(b)}}async Pe(e){let o={},[b,w]=E();o[b]=w;let I=this.Ie(e);this.u.log(t.Debug,`Sending negotiation request: ${I}.`);try{let A=await this.$.post(I,{content:"",headers:{...o,...this.ie.headers},timeout:this.ie.timeout,withCredentials:this.ie.withCredentials});if(A.statusCode!==200)return Promise.reject(new Error(`Unexpected status code returned from negotiate '${A.statusCode}'`));let L=JSON.parse(A.content);return(!L.negotiateVersion||L.negotiateVersion<1)&&(L.connectionToken=L.connectionId),L.useStatefulReconnect&&this.ie._e!==!0?Promise.reject(new v("Client didn't negotiate Stateful Reconnect but the server did.")):L}catch(A){let L="Failed to complete negotiation with the server: "+A;return A instanceof u&&A.statusCode===404&&(L+=" Either this is not a SignalR endpoint or there is a proxy blocking the connection."),this.u.log(t.Error,L),Promise.reject(new v(L))}}He(e,o){return o?e+(e.indexOf("?")===-1?"?":"&")+`id=${o}`:e}async Te(e,o,b,w){let I=this.He(e,b.connectionToken);if(this.De(o))return this.u.log(t.Debug,"Connection was provided an instance of ITransport, using that directly."),this.transport=o,await this.ke(I,w),void(this.connectionId=b.connectionId);let A=[],L=b.availableTransports||[],$=b;for(let G of L){let ne=this.Re(G,o,w,($==null?void 0:$.useStatefulReconnect)===!0);if(ne instanceof Error)A.push(`${G.transport} failed:`),A.push(ne);else if(this.De(ne)){if(this.transport=ne,!$){try{$=await this.Pe(e)}catch(De){return Promise.reject(De)}I=this.He(e,$.connectionToken)}try{return await this.ke(I,w),void(this.connectionId=$.connectionId)}catch(De){if(this.u.log(t.Error,`Failed to start the transport '${G.transport}': ${De}`),$=void 0,A.push(new R(`${G.transport} failed: ${De}`,Q[G.transport])),this.ut!=="Connecting"){let qe="Failed to select transport before stop() was called.";return this.u.log(t.Debug,qe),Promise.reject(new i(qe))}}}}return A.length>0?Promise.reject(new T(`Unable to connect to the server with any of the available transports. ${A.join(" ")}`,A)):Promise.reject(new Error("None of the transports supported by the client are supported by the server."))}Se(e){switch(e){case Q.WebSockets:if(!this.ie.WebSocket)throw new Error("'WebSocket' is not supported in your environment.");return new Ne(this.$,this.Yt,this.u,this.ie.logMessageContent,this.ie.WebSocket,this.ie.headers||{});case Q.ServerSentEvents:if(!this.ie.EventSource)throw new Error("'EventSource' is not supported in your environment.");return new _e(this.$,this.$.Zt,this.u,this.ie);case Q.LongPolling:return new Le(this.$,this.u,this.ie);default:throw new Error(`Unknown transport: ${e}.`)}}ke(e,o){return this.transport.onreceive=this.onreceive,this.features.reconnect?this.transport.onclose=async b=>{let w=!1;if(this.features.reconnect){try{this.features.disconnected(),await this.transport.connect(e,o),await this.features.resend()}catch{w=!0}w&&this.Ce(b)}else this.Ce(b)}:this.transport.onclose=b=>this.Ce(b),this.transport.connect(e,o)}Re(e,o,b,w){let I=Q[e.transport];if(I==null)return this.u.log(t.Debug,`Skipping transport '${e.transport}' because it is not supported by this client.`),new Error(`Skipping transport '${e.transport}' because it is not supported by this client.`);if(!function(A,L){return!A||(L&A)!=0}(o,I))return this.u.log(t.Debug,`Skipping transport '${Q[I]}' because it was disabled by the client.`),new S(`'${Q[I]}' is disabled by the client.`,I);if(!(e.transferFormats.map(A=>ee[A]).indexOf(b)>=0))return this.u.log(t.Debug,`Skipping transport '${Q[I]}' because it does not support the requested transfer format '${ee[b]}'.`),new Error(`'${Q[I]}' does not support ${ee[b]}.`);if(I===Q.WebSockets&&!this.ie.WebSocket||I===Q.ServerSentEvents&&!this.ie.EventSource)return this.u.log(t.Debug,`Skipping transport '${Q[I]}' because it is not supported in your environment.'`),new g(`'${Q[I]}' is not supported in your environment.`,I);this.u.log(t.Debug,`Selecting transport '${Q[I]}'.`);try{return this.features.reconnect=I===Q.WebSockets?w:void 0,this.Se(I)}catch(A){return A}}De(e){return e&&typeof e=="object"&&"connect"in e}Ce(e){if(this.u.log(t.Debug,`HttpConnection.stopConnection(${e}) called while in state ${this.ut}.`),this.transport=void 0,e=this.$e||e,this.$e=void 0,this.ut!=="Disconnected"){if(this.ut==="Connecting")throw this.u.log(t.Warning,`Call to HttpConnection.stopConnection(${e}) was ignored because the connection is still in the connecting state.`),new Error(`HttpConnection.stopConnection(${e}) was called while the connection is still in the connecting state.`);if(this.ut==="Disconnecting"&&this.me(),e?this.u.log(t.Error,`Connection disconnected with error '${e}'.`):this.u.log(t.Information,"Connection disconnected."),this.Ee&&(this.Ee.stop().catch(o=>{this.u.log(t.Error,`TransportSendQueue.stop() threw error '${o}'.`)}),this.Ee=void 0),this.connectionId=void 0,this.ut="Disconnected",this.dt){this.dt=!1;try{this.onclose&&this.onclose(e)}catch(o){this.u.log(t.Error,`HttpConnection.onclose(${e}) threw error '${o}'.`)}}}else this.u.log(t.Debug,`Call to HttpConnection.stopConnection(${e}) was ignored because the connection is already in the disconnected state.`)}be(e){if(e.lastIndexOf("https://",0)===0||e.lastIndexOf("http://",0)===0)return e;if(!l.isBrowser)throw new Error(`Cannot resolve '${e}'.`);let o=window.document.createElement("a");return o.href=e,this.u.log(t.Information,`Normalizing '${e}' to '${o.href}'.`),o.href}Ie(e){let o=new URL(e);o.pathname.endsWith("/")?o.pathname+="negotiate":o.pathname+="/negotiate";let b=new URLSearchParams(o.searchParams);return b.has("negotiateVersion")||b.append("negotiateVersion",this.ye.toString()),b.has("useStatefulReconnect")?b.get("useStatefulReconnect")==="true"&&(this.ie._e=!0):this.ie._e===!0&&b.append("useStatefulReconnect","true"),o.search=b.toString(),o.toString()}}class ce{constructor(e){this.xe=e,this.Ae=[],this.Ue=!0,this.Le=new Ie,this.Ne=new Ie,this.qe=this.Me()}send(e){return this.je(e),this.Ne||(this.Ne=new Ie),this.Ne.promise}stop(){return this.Ue=!1,this.Le.resolve(),this.qe}je(e){if(this.Ae.length&&typeof this.Ae[0]!=typeof e)throw new Error(`Expected data to be of type ${typeof this.Ae} but was of type ${typeof e}`);this.Ae.push(e),this.Le.resolve()}async Me(){for(;;){if(await this.Le.promise,!this.Ue){this.Ne&&this.Ne.reject("Connection stopped.");break}this.Le=new Ie;let e=this.Ne;this.Ne=void 0;let o=typeof this.Ae[0]=="string"?this.Ae.join(""):ce.We(this.Ae);this.Ae.length=0;try{await this.xe.send(o),e.resolve()}catch(b){e.reject(b)}}}static We(e){let o=e.map(I=>I.byteLength).reduce((I,A)=>I+A),b=new Uint8Array(o),w=0;for(let I of e)b.set(new Uint8Array(I),w),w+=I.byteLength;return b.buffer}}class Ie{constructor(){this.promise=new Promise((e,o)=>[this.j,this.Oe]=[e,o])}resolve(){this.j()}reject(e){this.Oe(e)}}class Fe{constructor(){this.name="json",this.version=2,this.transferFormat=ee.Text}parseMessages(e,o){if(typeof e!="string")throw new Error("Invalid input for JSON hub protocol. Expected a string.");if(!e)return[];o===null&&(o=k.instance);let b=z.parse(e),w=[];for(let I of b){let A=JSON.parse(I);if(typeof A.type!="number")throw new Error("Invalid payload.");switch(A.type){case U.Invocation:this.U(A);break;case U.StreamItem:this.Fe(A);break;case U.Completion:this.Be(A);break;case U.Ping:case U.Close:break;case U.Ack:this.Xe(A);break;case U.Sequence:this.Je(A);break;default:o.log(t.Information,"Unknown message type '"+A.type+"' ignored.");continue}w.push(A)}return w}writeMessage(e){return z.write(JSON.stringify(e))}U(e){this.ze(e.target,"Invalid payload for Invocation message."),e.invocationId!==void 0&&this.ze(e.invocationId,"Invalid payload for Invocation message.")}Fe(e){if(this.ze(e.invocationId,"Invalid payload for StreamItem message."),e.item===void 0)throw new Error("Invalid payload for StreamItem message.")}Be(e){if(e.result&&e.error)throw new Error("Invalid payload for Completion message.");!e.result&&e.error&&this.ze(e.error,"Invalid payload for Completion message."),this.ze(e.invocationId,"Invalid payload for Completion message.")}Xe(e){if(typeof e.sequenceId!="number")throw new Error("Invalid SequenceId for Ack message.")}Je(e){if(typeof e.sequenceId!="number")throw new Error("Invalid SequenceId for Sequence message.")}ze(e,o){if(typeof e!="string"||e==="")throw new Error(o)}}let $e={trace:t.Trace,debug:t.Debug,info:t.Information,information:t.Information,warn:t.Warning,warning:t.Warning,error:t.Error,critical:t.Critical,none:t.None};class Ue{configureLogging(e){if(x.isRequired(e,"logging"),e.log!==void 0)this.logger=e;else if(typeof e=="string"){let o=function(b){let w=$e[b.toLowerCase()];if(w!==void 0)return w;throw new Error(`Unknown log level: ${b}`)}(e);this.logger=new O(o)}else this.logger=new O(e);return this}withUrl(e,o){return x.isRequired(e,"url"),x.isNotEmpty(e,"url"),this.url=e,this.httpConnectionOptions=typeof o=="object"?{...this.httpConnectionOptions,...o}:{...this.httpConnectionOptions,transport:o},this}withHubProtocol(e){return x.isRequired(e,"protocol"),this.protocol=e,this}withAutomaticReconnect(e){if(this.reconnectPolicy)throw new Error("A reconnectPolicy has already been set.");return e?Array.isArray(e)?this.reconnectPolicy=new Te(e):this.reconnectPolicy=e:this.reconnectPolicy=new Te,this}withServerTimeout(e){return x.isRequired(e,"milliseconds"),this.Ve=e,this}withKeepAliveInterval(e){return x.isRequired(e,"milliseconds"),this.Ke=e,this}withStatefulReconnect(e){return this.httpConnectionOptions===void 0&&(this.httpConnectionOptions={}),this.httpConnectionOptions._e=!0,this.Y=e==null?void 0:e.bufferSize,this}build(){let e=this.httpConnectionOptions||{};if(e.logger===void 0&&(e.logger=this.logger),!this.url)throw new Error("The 'HubConnectionBuilder.withUrl' method must be called before building the connection.");let o=new Se(this.url,e);return pe.create(o,this.logger||k.instance,this.protocol||new Fe,this.reconnectPolicy,this.Ve,this.Ke,this.Y)}}return Uint8Array.prototype.indexOf||Object.defineProperty(Uint8Array.prototype,"indexOf",{value:Array.prototype.indexOf,writable:!0}),Uint8Array.prototype.slice||Object.defineProperty(Uint8Array.prototype,"slice",{value:function(D,e){return new Uint8Array(Array.prototype.slice.call(this,D,e))},writable:!0}),Uint8Array.prototype.forEach||Object.defineProperty(Uint8Array.prototype,"forEach",{value:Array.prototype.forEach,writable:!0}),a})(),typeof wt=="object"&&typeof $t=="object"?$t.exports=dt():typeof define=="function"&&define.amd?define([],dt):typeof wt=="object"?wt.signalR=dt():on.signalR=dt()});var ln=he((cn,Ct)=>{"use strict";(function(r,t){if(typeof Ct=="object"&&Ct.exports)Ct.exports=t();else{let a=t();r.CryptoTickerConfig=Object.assign({},r.CryptoTickerConfig||{},a)}})(typeof self!="undefined"?self:cn,function(){return{tProxyBase:"https://tproxyv8.opendle.com",fallbackPollIntervalMs:6e4,staleTickerTimeoutMs:5*60*1e3,binanceRestBaseUrl:"https://api.binance.com",binanceWsBaseUrl:"wss://stream.binance.com:9443/ws",binanceSymbolOverrides:{},bitfinexRestBaseUrl:"https://api-pub.bitfinex.com",bitfinexWsBaseUrl:"wss://api-pub.bitfinex.com/ws/2",bitfinexSymbolOverrides:{},messages:{loading:"LOADING...",stale:"STALE",noData:"NO DATA",misconfigured:"INVALID PAIR",conversionError:"CONVERT ERROR"}}})});var Ge=he((un,kt)=>{"use strict";var yr={LIVE:"live",DETACHED:"detached",BACKUP:"backup",BROKEN:"broken"};(function(r,t){let a=typeof globalThis!="undefined"?globalThis:r,u=t();typeof kt=="object"&&kt.exports&&(kt.exports=u),a&&(a.CryptoTickerConnectionStates=u)})(typeof self!="undefined"?self:un,function(){return yr})});var gt=he((hn,St)=>{"use strict";(function(r,t){let a=typeof globalThis!="undefined"?globalThis:r,u=t();typeof St=="object"&&St.exports&&(St.exports=u),a&&(a.CryptoTickerProviders=a.CryptoTickerProviders||{},a.CryptoTickerProviders.buildSubscriptionKey=u.buildSubscriptionKey)})(typeof self!="undefined"?self:hn,function(){function t(a,u,c,i){let g=a||"",S=u||"",R=c||null,v=i||null,T="";return R!==null&&v!==null&&R!==v&&(T="__"+R+"_"+v),g+"__"+S+T}return{buildSubscriptionKey:t}})});var Ke=he((fn,Tt)=>{"use strict";(function(r,t){let a=typeof globalThis!="undefined"?globalThis:r,u=t();typeof Tt=="object"&&Tt.exports&&(Tt.exports=u),a&&(a.CryptoTickerProviders=a.CryptoTickerProviders||{},a.CryptoTickerProviders.ProviderInterface=u.ProviderInterface)})(typeof self!="undefined"?self:fn,function(){function t(){}class a{constructor(c){let i=c||{};this.baseUrl=typeof i.baseUrl=="string"?i.baseUrl:"",this.logger=typeof i.logger=="function"?i.logger:t}getId(){throw new Error("Provider must implement getId()")}subscribeTicker(c,i){throw new Error("Provider must implement subscribeTicker()")}async fetchTicker(c){throw new Error("Provider must implement fetchTicker()")}getCachedTicker(c){return null}async fetchCandles(c){throw new Error("Provider must implement fetchCandles()")}ensureConnection(){}async fetchConversionRate(c,i){return 1}}return{ProviderInterface:a}})});var Je=he((pn,Ye)=>{"use strict";(function(r,t){let a=typeof globalThis!="undefined"?globalThis:r,u=typeof Ye=="object"&&Ye.exports?[gt(),Ge()]:[r==null?void 0:r.CryptoTickerProviders,r==null?void 0:r.CryptoTickerConnectionStates],c=t(u[0],u[1]);typeof Ye=="object"&&Ye.exports&&(Ye.exports=c),a&&(a.CryptoTickerProviders=a.CryptoTickerProviders||{},a.CryptoTickerProviders.TickerSubscriptionManager=c.TickerSubscriptionManager)})(typeof self!="undefined"?self:pn,function(r,t){let a=r.buildSubscriptionKey||r,u=t||{LIVE:"live",DETACHED:"detached",BACKUP:"backup",BROKEN:"broken"},c=6e4,i=5*60*1e3;function g(){}function S(T){let p=T||{};return{onData:typeof p.onData=="function"?p.onData:null,onError:typeof p.onError=="function"?p.onError:null}}function R(T){let p=T||{},f=p.fromCurrency||null,k=p.toCurrency||null;return{exchange:p.exchange,symbol:p.symbol,fromCurrency:f,toCurrency:k}}class v{constructor(p){let f=p||{};this.logger=typeof f.logger=="function"?f.logger:g,this.fetchTickerFn=typeof f.fetchTicker=="function"?f.fetchTicker:null,this.subscribeStreamingFn=typeof f.subscribeStreaming=="function"?f.subscribeStreaming:null,this.unsubscribeStreamingFn=typeof f.unsubscribeStreaming=="function"?f.unsubscribeStreaming:null,this.ensureConnectionFn=typeof f.ensureConnection=="function"?f.ensureConnection:null,this.subscriptionKeyBuilder=typeof f.buildSubscriptionKey=="function"?f.buildSubscriptionKey:a,this.fallbackPollIntervalMs=typeof f.fallbackPollIntervalMs=="number"?f.fallbackPollIntervalMs:c,this.staleTickerTimeoutMs=typeof f.staleTickerTimeoutMs=="number"?f.staleTickerTimeoutMs:i,this.connectionStates=u,this.entries={},this.cache={}}subscribe(p,f){let k=S(f),d=this.getOrCreateEntry(p);if(d.subscribers.push(k),this.ensureConnectionFn)try{this.ensureConnectionFn()}catch(l){this.logger("TickerSubscriptionManager: ensureConnection error",l)}this.ensureStreaming(d),this.startFallbackPolling(d);let x=this;return this.fetchTickerFn&&this.fetchTickerFn(d.params).then(function(l){x.applyTickerStateFromFetch(d,l),x.cache[d.key]=l,x.notifySubscribers(d,l)}).catch(function(l){if(x.logger("TickerSubscriptionManager: fetchTicker error",l),k.onError)try{k.onError(l)}catch(h){x.logger("TickerSubscriptionManager: onError handler threw",h)}}),{key:d.key,unsubscribe:()=>{this.unsubscribe(d.key,k)}}}unsubscribe(p,f){let k=this.entries[p];if(!k)return;let d=k.subscribers.indexOf(f);d>=0&&k.subscribers.splice(d,1),k.subscribers.length===0&&(this.stopFallbackPolling(k),this.stopStreaming(k),delete this.entries[p])}getCachedTicker(p){return this.cache[p]||null}handleStreamingUpdate(p,f){let k=this.entries[p];k&&(k.lastStreamUpdate=Date.now(),this.setEntryConnectionState(k,this.connectionStates.LIVE,f),this.cache[p]=f,this.notifySubscribers(k,f))}getEntry(p){return this.entries[p]||null}handleStreamingUpdateFromParts(p,f,k,d,x){let l=this.buildKey(p,f,k,d);this.handleStreamingUpdate(l,x)}buildKey(p,f,k,d){return this.subscriptionKeyBuilder(p,f,k,d)}buildKeyFromParams(p){let f=p||{};return this.buildKey(f.exchange,f.symbol,f.fromCurrency,f.toCurrency)}forEachEntry(p){if(typeof p!="function")return;let f=Object.keys(this.entries);for(let k=0;k<f.length;k++){let d=f[k];p(this.entries[d])}}ensureStreaming(p){if(!p||p.streamingActive||!this.subscribeStreamingFn){p&&!p.streamingActive&&(p.streamingActive=!!this.subscribeStreamingFn);return}try{let f=this.subscribeStreamingFn(p);f&&typeof f.then=="function"?f.then(()=>{p.streamingActive=!0}).catch(k=>{p.streamingActive=!1,this.logger("TickerSubscriptionManager: subscribeStreaming promise rejected",k)}):f===!1?p.streamingActive=!1:p.streamingActive=!0}catch(f){p.streamingActive=!1,this.logger("TickerSubscriptionManager: subscribeStreaming error",f)}}stopStreaming(p){if(!(!p||!this.unsubscribeStreamingFn||!p.streamingActive))try{let f=this.unsubscribeStreamingFn(p);f&&typeof f.then=="function"?f.then(()=>{p.streamingActive=!1}).catch(k=>{this.logger("TickerSubscriptionManager: unsubscribeStreaming promise rejected",k)}):p.streamingActive=!1}catch(f){p.streamingActive=!1,this.logger("TickerSubscriptionManager: unsubscribeStreaming error",f)}}notifySubscribers(p,f){if(!p)return;let k=p.subscribers;for(let d=0;d<k.length;d++){let x=k[d];if(x&&x.onData)try{x.onData(f)}catch(l){this.logger("TickerSubscriptionManager: onData handler threw",l)}}}startFallbackPolling(p){if(!p||p.fallbackTimerId||!this.fetchTickerFn)return;let f=this;p.fallbackTimerId=setInterval(function(){f.pollEntryIfNeeded(p)},this.fallbackPollIntervalMs)}stopFallbackPolling(p){!p||!p.fallbackTimerId||(clearInterval(p.fallbackTimerId),p.fallbackTimerId=null)}pollEntryIfNeeded(p){if(!p||!this.fetchTickerFn||!this.shouldPollEntry(p))return;let f=this;this.fetchTickerFn(p.params).then(function(k){f.applyTickerStateFromFetch(p,k),f.cache[p.key]=k,f.notifySubscribers(p,k)}).catch(function(k){f.logger("TickerSubscriptionManager: fallback fetch error",k),f.handleFetchError(p)})}shouldPollEntry(p){if(!p)return!1;if(!p.streamingActive)return!0;let f=p.lastStreamUpdate||0;return f?Date.now()-f>this.staleTickerTimeoutMs:!0}getOrCreateEntry(p){let f=this.buildKeyFromParams(p),k=this.entries[f];return k||(k={key:f,params:R(p),subscribers:[],streamingActive:!1,lastStreamUpdate:0,fallbackTimerId:null,meta:{},connectionState:null},this.entries[f]=k),k}setEntryConnectionState(p,f,k){p&&(p.connectionState=f,k&&typeof k=="object"&&(k.connectionState=f))}applyTickerStateFromFetch(p,f){if(!p||!f)return;let k=f.connectionState||(p.streamingActive?this.connectionStates.LIVE:this.connectionStates.DETACHED);this.setEntryConnectionState(p,k,f)}handleFetchError(p){if(!p)return;this.setEntryConnectionState(p,this.connectionStates.BROKEN);let f=p.key,k=this.cache[f];if(k){k.connectionState=this.connectionStates.BROKEN,this.notifySubscribers(p,k);return}let d={changeDaily:0,changeDailyPercent:0,last:0,volume:0,high:0,low:0,pair:p.params.symbol,pairDisplay:p.params.symbol,connectionState:this.connectionStates.BROKEN};this.cache[f]=d,this.notifySubscribers(p,d)}}return{TickerSubscriptionManager:v}})});var Qe=he((dn,Xe)=>{"use strict";(function(r,t){let a=typeof globalThis!="undefined"?globalThis:r,u=typeof Xe=="object"&&Xe.exports?[Ke(),gt(),Je(),Ge()]:[r==null?void 0:r.CryptoTickerProviders,r==null?void 0:r.CryptoTickerProviders,r==null?void 0:r.CryptoTickerProviders,r==null?void 0:r.CryptoTickerConnectionStates],c=t(u[0],u[1],u[2],u[3]);typeof Xe=="object"&&Xe.exports&&(Xe.exports=c),a&&(a.CryptoTickerProviders=a.CryptoTickerProviders||{},a.CryptoTickerProviders.GenericProvider=c.GenericProvider)})(typeof self!="undefined"?self:dn,function(r,t,a,u){let c=r.ProviderInterface||r,i=t.buildSubscriptionKey||t,g=a.TickerSubscriptionManager||a,S=u||{LIVE:"live",DETACHED:"detached",BACKUP:"backup",BROKEN:"broken"},R="Connected",v=5e3,T="_ctBust";function p(k){if(!k||typeof k!="string")return k;try{let d=new URL(k);return d.searchParams.set(T,Date.now().toString()),d.toString()}catch{let x=k.indexOf("?")===-1?"?":"&";return k+x+T+"="+Date.now()}}class f extends c{constructor(d){super(d);let x=d||{};this.retryDelayMs=typeof x.retryDelayMs=="number"?x.retryDelayMs:v,this.connection=null,this.shouldReconnect=!0,this.connectionState="Disconnected",this.startingConnection=!1,this.normalizedBaseUrl=(this.baseUrl||"").replace(/\/$/,"");let l={logger:(...h)=>{this.logger(...h)},fetchTicker:this.rawFetchTicker.bind(this),subscribeStreaming:this.subscribeEntry.bind(this),unsubscribeStreaming:this.unsubscribeEntry.bind(this),ensureConnection:this.ensureConnection.bind(this),buildSubscriptionKey:function(h,C,M,y){return i(h,C,M,y)},fallbackPollIntervalMs:x.fallbackPollIntervalMs,staleTickerTimeoutMs:x.staleTickerTimeoutMs};this.subscriptionManager=new g(l)}getId(){return"GENERIC"}subscribeTicker(d,x){return this.subscriptionManager.subscribe(d,x)}getCachedTicker(d){return this.subscriptionManager.getCachedTicker(d)}ensureConnection(){if(!(this.connection&&(this.connectionState===R||this.startingConnection))){if(typeof signalR=="undefined"||!signalR.HubConnectionBuilder){this.logger("GenericProvider: SignalR not available, skipping WebSocket connection.");return}if(!this.connection){this.connection=new signalR.HubConnectionBuilder().withUrl(this.baseUrl+"/tickerhub").withAutomaticReconnect().configureLogging(signalR.LogLevel.Warning).build();let d=this;this.connection.on("ticker",function(x){d.handleTickerMessage(x)}),this.connection.onreconnected(function(){d.logger("GenericProvider: connection re-established, resubscribing."),d.onConnectionEstablished()}),this.connection.onclose(function(){d.connectionState="Disconnected",d.shouldReconnect&&setTimeout(function(){d.startConnection()},d.retryDelayMs)})}this.startConnection()}}startConnection(){if(!this.connection||this.startingConnection||this.connectionState===R)return;let d=this;this.startingConnection=!0,this.connection.start().then(function(){d.connectionState=R,d.startingConnection=!1,d.onConnectionEstablished()}).catch(function(x){d.connectionState="Disconnected",d.startingConnection=!1,d.logger("GenericProvider: error starting connection",x),setTimeout(function(){d.startConnection()},d.retryDelayMs)})}isConnected(){return this.connection&&this.connectionState===R}onConnectionEstablished(){let d=this;this.subscriptionManager.forEachEntry(function(x){x&&(x.streamingActive=!1,x.meta&&(x.meta.isSubscribed=!1,x.meta.pending=!0),d.subscriptionManager.ensureStreaming(x))})}subscribeEntry(d){if(!d)return!1;if(d.meta=d.meta||{},!this.connection)return this.ensureConnection(),d.meta.pending=!0,d.streamingActive=!1,!1;if(!this.isConnected())return this.startConnection(),d.meta.pending=!0,d.streamingActive=!1,!1;if(d.meta.isSubscribed)return d.meta.pending=!1,!0;d.meta.pending=!0;let x=d.params,l=this;return this.connection.invoke("Subscribe",x.exchange,x.symbol,x.fromCurrency,x.toCurrency).then(function(){return d.meta.isSubscribed=!0,d.meta.pending=!1,d.streamingActive=!0,!0}).catch(function(h){return d.meta.isSubscribed=!1,d.meta.pending=!1,d.streamingActive=!1,l.logger("GenericProvider: error invoking Subscribe",h),!1})}unsubscribeEntry(d){if(!d)return!0;if(d.meta=d.meta||{},!this.connection||!d.meta.isSubscribed)return d.meta.isSubscribed=!1,d.streamingActive=!1,!0;let x=d.params,l=this;return this.connection.invoke("Unsubscribe",x.exchange,x.symbol,x.fromCurrency,x.toCurrency).then(function(){return d.meta.isSubscribed=!1,d.streamingActive=!1,!0}).catch(function(h){return d.meta.isSubscribed=!1,d.streamingActive=!1,l.logger("GenericProvider: error invoking Unsubscribe",h),!1})}fetchTicker(d){return this.rawFetchTicker(d)}rawFetchTicker(d){let x=d.exchange||"",l=d.symbol||"",h=d.fromCurrency||"USD",C=d.toCurrency||null,M=(this.baseUrl||"").replace(/\/$/,""),y=encodeURIComponent(x),O=encodeURIComponent(l),E=M+"/api/Ticker/json/"+y+"/"+O+"?fromCurrency="+encodeURIComponent(h);C!==null&&(E+="&toCurrency="+encodeURIComponent(C));let B=this,H=this.buildProxyRequestConfig(E);return fetch(H.url,H.options).then(function(N){return N.json()}).then(function(N){let Y=B.transformTickerResponse(N);return Y.connectionState=S.BACKUP,Y}).catch(function(N){B.logger("GenericProvider: error fetching ticker",N);let Y=B.subscriptionManager.buildKey(x,l,h,C),re=B.subscriptionManager.getCachedTicker(Y);if(re)return re.connectionState=re.connectionState||S.BACKUP,re;let J=B.buildEmptyTicker(l);return J.connectionState=S.BROKEN,J})}handleTickerMessage(d){if(!d)return;let x=d.provider||d.provider,l=d.symbol||d.symbol,h=d.conversionFromCurrency||d.conversionFromCurrency||null,C=d.conversionToCurrency||d.conversionToCurrency||null,M=this.subscriptionManager.buildKey(x,l,h,C),y=this.transformTickerResponse(d),O=this.subscriptionManager.getEntry(M);O&&O.meta&&(O.meta.isSubscribed=!0,O.meta.pending=!1,O.streamingActive=!0),this.subscriptionManager.handleStreamingUpdate(M,y)}async fetchCandles(d){let x=d.exchange,l=d.symbol,h=d.interval,C=typeof d.limit=="number"&&d.limit>0?d.limit:24,y=this.baseUrl.replace(/\/$/,"")+"/api/Candles/json/"+encodeURIComponent(x)+"/"+encodeURIComponent(l)+"/"+h+"?limit="+C;try{let O=this.buildProxyRequestConfig(y),E=await fetch(O.url,O.options);if(!E||!E.ok)throw new Error("GenericProvider: candles response not ok");let B=await E.json();return Array.isArray(B.candles)?B.candles:[]}catch(O){throw this.logger("GenericProvider: error fetching candles",O),O}}buildProxyRequestConfig(d,x){if(!d||typeof d!="string")return{url:d,options:x};let l=this.normalizedBaseUrl,h=d.replace(/\/$/,"");if(!l||h.indexOf(l)!==0)return{url:d,options:x};let C=Object.assign({},x||{});C.cache="no-store";let M=Object.assign({},C.headers||{});return M["cache-control"]="no-cache",M.pragma="no-cache",C.headers=M,{url:p(d),options:C}}transformTickerResponse(d){let x=d||{};return{changeDaily:x.dailyChange||0,changeDailyPercent:x.dailyChangeRelative||0,last:x.last||0,volume:x.volume||0,high:x.high24h||0,low:x.low24h||0,pair:x.symbol||x.pair||"",pairDisplay:x.symbolDisplay||x.symbol||x.pair||""}}buildEmptyTicker(d){let x=d||"";return{changeDaily:0,changeDailyPercent:0,last:0,volume:0,high:0,low:0,pair:x,pairDisplay:x,connectionState:S.BROKEN}}}return{GenericProvider:f}})});var bn=he((gn,Et)=>{"use strict";(function(t,a){let u=a();typeof Et=="object"&&Et.exports&&(Et.exports=u),t&&typeof t=="object"&&(t.CryptoTickerDefaults=u)})(typeof self!="undefined"?self:gn,function(){function t(v){if(v===null||typeof v!="object")return v;if(Array.isArray(v))return v.map(p=>t(p));let T={};for(let p in v)Object.prototype.hasOwnProperty.call(v,p)&&(T[p]=t(v[p]));return T}function a(v){let T=v==null?void 0:v.case,p=(v==null?void 0:v.allowEmptyString)===!0,f=(v==null?void 0:v.allowNull)===!0,k=Object.prototype.hasOwnProperty.call(v||{},"trim")?!!(v!=null&&v.trim):!0,d=Array.isArray(v==null?void 0:v.allowedValues)?v==null?void 0:v.allowedValues:null;return function(l){if(l===void 0)return null;if(l===null)return f?null:"";let h=String(l);if(k&&(h=h.trim()),!h&&!p)return null;if(T==="upper"?h=h.toUpperCase():T==="lower"&&(h=h.toLowerCase()),d&&d.length>0){let C=T==="lower"?h.toLowerCase():T==="upper"?h.toUpperCase():h;return d.some(y=>T==="lower"?y.toLowerCase()===C:T==="upper"?y.toUpperCase()===C:y===C)?T==="lower"||T==="upper"?C:h:null}return h}}function u(v){let T=typeof(v==null?void 0:v.min)=="number"?v.min:null,p=typeof(v==null?void 0:v.max)=="number"?v.max:null,f=(v==null?void 0:v.integer)===!0;return function(d){if(d==null||d==="")return null;let x=typeof d=="number"?d:parseFloat(String(d));return Number.isNaN(x)?null:(f&&(x=Math.round(x)),T!==null&&x<T&&(x=T),p!==null&&x>p&&(x=p),x)}}let c={title:{type:"string",default:"",normalize:a({allowEmptyString:!0,allowNull:!0,trim:!0})},exchange:{type:"string",default:"BINANCE",normalize:a({trim:!0,allowEmptyString:!1,case:"upper"})},pair:{type:"string",default:"BTCUSD",normalize:a({trim:!0,allowEmptyString:!1,case:"upper"})},fromCurrency:{type:"string",default:"USD",normalize:a({trim:!0,allowEmptyString:!1,case:"upper"})},currency:{type:"string",default:"",normalize:a({trim:!0,allowEmptyString:!0,case:"upper",allowNull:!0})},candlesInterval:{type:"string",default:"1h",normalize:a({trim:!0,allowEmptyString:!1})},candlesDisplayed:{type:"number",default:20,normalize:u({min:5,max:60,integer:!0})},multiplier:{type:"number",default:1,normalize:u({min:0})},digits:{type:"number",default:2,normalize:u({min:0,max:10,integer:!0})},highLowDigits:{type:"string",default:"",normalize:a({trim:!0,allowEmptyString:!0})},font:{type:"string",default:"Lato,'Roboto Condensed',Helvetica,Calibri,sans-serif",normalize:a({trim:!0,allowEmptyString:!1})},fontSizeBase:{type:"number",default:25,normalize:u({min:1,max:200,integer:!0})},fontSizePrice:{type:"number",default:35,normalize:u({min:1,max:200,integer:!0})},fontSizeHighLow:{type:"string",default:"",normalize:a({trim:!0,allowEmptyString:!0})},fontSizeChange:{type:"number",default:19,normalize:u({min:1,max:200,integer:!0})},priceFormat:{type:"string",default:"compact",normalize:a({trim:!0,allowEmptyString:!1,case:"lower"})},backgroundColor:{type:"string",default:"#000000",normalize:a({trim:!0,allowEmptyString:!1})},textColor:{type:"string",default:"#ffffff",normalize:a({trim:!0,allowEmptyString:!1})},displayHighLow:{type:"string",default:"on",normalize:a({trim:!0,allowEmptyString:!1,case:"lower",allowedValues:["on","off"]})},displayHighLowBar:{type:"string",default:"on",normalize:a({trim:!0,allowEmptyString:!1,case:"lower",allowedValues:["on","off"]})},displayDailyChange:{type:"string",default:"on",normalize:a({trim:!0,allowEmptyString:!1,case:"lower",allowedValues:["on","off"]})},displayConnectionStatusIcon:{type:"string",default:"OFF",normalize:a({trim:!0,allowEmptyString:!1,case:"upper",allowedValues:["OFF","TOP_RIGHT","BOTTOM_LEFT"]})},alertRule:{type:"string",default:"",normalize:a({trim:!0,allowEmptyString:!0})},backgroundColorRule:{type:"string",default:"",normalize:a({trim:!0,allowEmptyString:!0})},textColorRule:{type:"string",default:"",normalize:a({trim:!0,allowEmptyString:!0})},mode:{type:"string",default:"ticker",normalize:a({trim:!0,allowEmptyString:!1,case:"lower",allowedValues:["ticker","candles"]})}};function i(v,T,p){if(!v||typeof v!="object")return{value:T,error:null};let f=v.normalize,k=v.default;if(typeof f!="function")return{value:T===void 0?t(k):T,error:null};let d=f(T);if(d==null){let x=f(k);return{value:x==null?t(k):x,error:p?"Invalid "+v.type:null}}return{value:d,error:null}}function g(v){let T=v&&typeof v=="object"?v:{},p={},f=[];for(let k in c){if(!Object.prototype.hasOwnProperty.call(c,k))continue;let d=c[k],x=Object.prototype.hasOwnProperty.call(T,k),l=x?T[k]:void 0,h=i(d,l,x);p[k]=h.value,h.error&&f.push({key:k,message:h.error})}for(let k in T)!Object.prototype.hasOwnProperty.call(c,k)&&Object.prototype.hasOwnProperty.call(T,k)&&(p[k]=T[k]);return{settings:p,errors:f}}function S(v){return g(v).settings}let R=S(null);return{settingsSchema:c,defaultSettings:R,getDefaultSettings:function(){return t(R)},validateSettings:function(v){let T=g(v);return{settings:T.settings,errors:T.errors.slice(0)}},applyDefaults:S}})});var Pt=he((yn,xt)=>{"use strict";(function(r,t){let a=typeof globalThis!="undefined"?globalThis:r,u=t();typeof xt=="object"&&xt.exports&&(xt.exports=u),a&&(a.CryptoTickerProviders=a.CryptoTickerProviders||{},a.CryptoTickerProviders.WebSocketConnectionPool=u.WebSocketConnectionPool)})(typeof self!="undefined"?self:yn,function(){function r(){}function t(u,c){if(!c||typeof c!="object")return u;let i=Object.keys(c);for(let g=0;g<i.length;g++){let S=i[g];u[S]=c[S]}return u}class a{constructor(c){let i=c||{};this.logger=typeof i.logger=="function"?i.logger:r,this.createWebSocket=typeof i.createWebSocket=="function"?i.createWebSocket:null,this.subscribeHandler=typeof i.subscribe=="function"?i.subscribe:null,this.unsubscribeHandler=typeof i.unsubscribe=="function"?i.unsubscribe:null,this.handleMessageFn=typeof i.handleMessage=="function"?i.handleMessage:null,this.onOpen=typeof i.onOpen=="function"?i.onOpen:null,this.onError=typeof i.onError=="function"?i.onError:null,this.onClose=typeof i.onClose=="function"?i.onClose:null,this.reconnectDelayMs=typeof i.reconnectDelayMs=="number"?i.reconnectDelayMs:5e3,this.autoCloseDelayMs=typeof i.autoCloseDelayMs=="number"?i.autoCloseDelayMs:0,this.shouldResubscribeOnReconnect=i.shouldResubscribeOnReconnect!==!1,this.symbolEntries={},this.ws=null,this.wsClosedByUser=!1,this.reconnectTimer=null,this.closeTimer=null,this.isConnecting=!1}subscribe(c,i){let g=typeof c=="string"?c:"";if(!g)return this.logger("WebSocketConnectionPool: subscribe called without symbol"),null;if(!this.createWebSocket)return this.logger("WebSocketConnectionPool: createWebSocket not configured"),null;let S=this.buildSubscriber(i);if(!S.onData)return this.logger("WebSocketConnectionPool: subscriber missing onData handler for",g),null;let R=this.symbolEntries[g];R||(R={symbol:g,subscribers:[],subscribed:!1,subscriptionRequested:!1,meta:{}},this.symbolEntries[g]=R),R.subscribers.push(S),this.clearCloseTimer(),this.ensureConnection(),this.isSocketOpen()&&!R.subscribed&&!R.subscriptionRequested&&this.requestSubscribe(R);let v=this;return{symbol:g,unsubscribe:function(){v.removeSubscriber(g,S)},updateMetadata:function(T){v.updateSymbolMetadata(g,T)},getMetadata:function(){let T=v.symbolEntries[g];return T?T.meta:null}}}removeSubscriber(c,i){let g=this.symbolEntries[c];if(!g)return;let S=g.subscribers.indexOf(i);if(S>=0&&g.subscribers.splice(S,1),!(g.subscribers.length>0)){if(this.isSocketOpen()&&this.unsubscribeHandler&&(g.subscribed||g.subscriptionRequested))try{this.unsubscribeHandler(this.ws,c,g.meta)}catch(R){this.logger("WebSocketConnectionPool: unsubscribe handler error",R)}delete this.symbolEntries[c],this.maybeCloseConnection()}}ensureConnection(){if(this.ws||this.isConnecting)return;let c=null;try{c=this.createWebSocket()}catch(i){this.logger("WebSocketConnectionPool: failed to create WebSocket",i);return}if(!c){this.logger("WebSocketConnectionPool: createWebSocket returned falsy value"),this.scheduleReconnect();return}this.ws=c,this.wsClosedByUser=!1,this.isConnecting=!0,this.attachSocketHandlers(c)}attachSocketHandlers(c){let i=this;c.onopen=function(){if(i.isConnecting=!1,i.onOpen)try{i.onOpen(i.ws)}catch(g){i.logger("WebSocketConnectionPool: onOpen handler error",g)}i.flushPendingSubscriptions()},c.onmessage=function(g){if(i.handleMessageFn)try{i.handleMessageFn(g,i.buildMessageHelpers())}catch(S){i.logger("WebSocketConnectionPool: handleMessage error",S)}},c.onerror=function(g){if(i.onError)try{i.onError(g)}catch(S){i.logger("WebSocketConnectionPool: onError handler error",S)}},c.onclose=function(g){i.handleSocketClose(g)}}handleSocketClose(c){if(this.onClose)try{this.onClose(c)}catch(g){this.logger("WebSocketConnectionPool: onClose handler error",g)}let i=this.hasSubscribers();if(this.isConnecting=!1,this.ws=null,!this.wsClosedByUser&&i){this.resetSubscriptionState(),this.notifyAllDisconnected(),this.scheduleReconnect();return}this.wsClosedByUser=!1,this.resetSubscriptionState()}resetSubscriptionState(){let c=Object.keys(this.symbolEntries);for(let i=0;i<c.length;i++){let g=this.symbolEntries[c[i]];g.subscribed=!1,g.subscriptionRequested=!1}}scheduleReconnect(){if(this.reconnectTimer||!this.hasSubscribers())return;let c=this;this.reconnectTimer=setTimeout(function(){c.reconnectTimer=null,c.hasSubscribers()&&c.ensureConnection()},this.reconnectDelayMs)}clearReconnectTimer(){this.reconnectTimer&&(clearTimeout(this.reconnectTimer),this.reconnectTimer=null)}flushPendingSubscriptions(){let c=Object.keys(this.symbolEntries);for(let i=0;i<c.length;i++){let g=this.symbolEntries[c[i]];!g.subscribed&&!g.subscriptionRequested&&this.requestSubscribe(g)}}requestSubscribe(c){if(!(!c||!this.isSocketOpen())){if(!this.subscribeHandler){c.subscribed=!0,this.notifySubscribed(c.symbol,null);return}try{c.subscriptionRequested=!0,this.subscribeHandler(this.ws,c.symbol,c.meta)}catch(i){c.subscriptionRequested=!1,this.logger("WebSocketConnectionPool: subscribe handler error",i),this.notifySubscribeError(c.symbol,i)}}}notifySubscribed(c,i){let g=this.symbolEntries[c];if(!g)return;if(g.subscribed){i&&t(g.meta,i);return}g.subscribed=!0,g.subscriptionRequested=!1,i&&t(g.meta,i);let S=g.subscribers;for(let R=0;R<S.length;R++){let v=S[R];if(v.onSubscribed)try{v.onSubscribed(v.context)}catch(T){this.logger("WebSocketConnectionPool: onSubscribed handler error",T)}}}notifySubscribeError(c,i){let g=this.symbolEntries[c];if(!g)return;let S=g.subscribers;for(let R=0;R<S.length;R++){let v=S[R];if(v.onError)try{v.onError(i,v.context)}catch(T){this.logger("WebSocketConnectionPool: onError handler error",T)}}}notifyAllDisconnected(){let c=Object.keys(this.symbolEntries);for(let i=0;i<c.length;i++)this.notifyDisconnected(c[i])}notifyDisconnected(c){let i=this.symbolEntries[c];if(!i)return;let g=i.subscribers;for(let S=0;S<g.length;S++){let R=g[S];if(R.onDisconnected)try{R.onDisconnected(R.context)}catch(v){this.logger("WebSocketConnectionPool: onDisconnected handler error",v)}}}dispatch(c,i,g){let S=this.symbolEntries[c];if(!S)return;let R=S.subscribers;for(let v=0;v<R.length;v++){let T=R[v];if(T.onData)try{T.onData(i,g,T.context)}catch(p){this.logger("WebSocketConnectionPool: subscriber onData error",p)}}}dispatchToAll(c,i){let g=Object.keys(this.symbolEntries);for(let S=0;S<g.length;S++)this.dispatch(g[S],c,i)}markSymbolSubscribed(c,i){this.notifySubscribed(c,i)}markSymbolUnsubscribed(c){let i=this.symbolEntries[c];i&&(i.subscribed=!1,i.subscriptionRequested=!1)}updateSymbolMetadata(c,i){let g=this.symbolEntries[c];g&&t(g.meta,i)}getSymbolMetadata(c){let i=this.symbolEntries[c];return i?i.meta:null}findSymbolByMeta(c){if(typeof c!="function")return null;let i=Object.keys(this.symbolEntries);for(let g=0;g<i.length;g++){let S=this.symbolEntries[i[g]];if(c(S.meta,S.symbol))return S.symbol}return null}hasSubscribers(){let c=Object.keys(this.symbolEntries);for(let i=0;i<c.length;i++)if(this.symbolEntries[c[i]].subscribers.length>0)return!0;return!1}maybeCloseConnection(){this.hasSubscribers()||(this.autoCloseDelayMs>0?this.scheduleCloseTimer():this.closeConnection())}scheduleCloseTimer(){if(this.closeTimer)return;let c=this;this.closeTimer=setTimeout(function(){c.closeTimer=null,c.hasSubscribers()||c.closeConnection()},this.autoCloseDelayMs)}clearCloseTimer(){this.closeTimer&&(clearTimeout(this.closeTimer),this.closeTimer=null)}closeConnection(){if(this.clearReconnectTimer(),!!this.ws){this.wsClosedByUser=!0;try{this.ws.close()}catch(c){this.logger("WebSocketConnectionPool: error closing WebSocket",c)}this.ws=null}}buildSubscriber(c){let i=c||{};return{context:i.context||null,onData:typeof i.onData=="function"?i.onData:null,onError:typeof i.onError=="function"?i.onError:null,onSubscribed:typeof i.onSubscribed=="function"?i.onSubscribed:null,onDisconnected:typeof i.onDisconnected=="function"?i.onDisconnected:null}}buildMessageHelpers(){let c=this;return{dispatch:function(i,g,S){c.dispatch(i,g,S)},dispatchToAll:function(i,g){c.dispatchToAll(i,g)},markSubscribed:function(i,g){c.markSymbolSubscribed(i,g)},markUnsubscribed:function(i){c.markSymbolUnsubscribed(i)},updateMetadata:function(i,g){c.updateSymbolMetadata(i,g)},getMetadata:function(i){return c.getSymbolMetadata(i)},findSymbol:function(i){return c.findSymbolByMeta(i)},getActiveSymbols:function(){return Object.keys(c.symbolEntries)}}}isSocketOpen(){return this.ws&&this.ws.readyState===1}}return{WebSocketConnectionPool:a}})});var Wt=he((mn,Ze)=>{"use strict";(function(r,t){let a=typeof globalThis!="undefined"?globalThis:r,u=typeof Ze=="object"&&Ze.exports?[Ke(),Qe(),Je(),Ge(),Pt()]:[r==null?void 0:r.CryptoTickerProviders,r==null?void 0:r.CryptoTickerProviders,r==null?void 0:r.CryptoTickerProviders,r==null?void 0:r.CryptoTickerConnectionStates,r==null?void 0:r.CryptoTickerProviders],c=t(u[0],u[1],u[2],u[3],u[4]);typeof Ze=="object"&&Ze.exports&&(Ze.exports=c),a&&(a.CryptoTickerProviders=a.CryptoTickerProviders||{},a.CryptoTickerProviders.BinanceProvider=c.BinanceProvider)})(typeof self!="undefined"?self:mn,function(r,t,a,u,c){let i=r.ProviderInterface||r,g=t.GenericProvider||t,S=a.TickerSubscriptionManager||a,R=u||{LIVE:"live",DETACHED:"detached",BACKUP:"backup",BROKEN:"broken"},v=c.WebSocketConnectionPool||c,T=5e3;function p(){return typeof WebSocket!="undefined"?WebSocket:typeof window!="undefined"&&window.WebSocket?window.WebSocket:typeof global!="undefined"&&global.WebSocket?global.WebSocket:null}function f(l){let h=parseFloat(l);return isNaN(h)?0:h}function k(l){return f(l)/100}function d(l){switch(l){case"MINUTES_1":return"1m";case"MINUTES_5":return"5m";case"MINUTES_15":return"15m";case"HOURS_1":return"1h";case"HOURS_6":return"6h";case"HOURS_12":return"12h";case"DAYS_1":return"1d";case"DAYS_7":return"1w";case"MONTHS_1":return"1M"}return null}class x extends i{constructor(h){super(h);let C=h||{};this.genericFallback=C.genericFallback instanceof g?C.genericFallback:new g(h),this.restBaseUrl=typeof C.binanceRestBaseUrl=="string"&&C.binanceRestBaseUrl.length>0?C.binanceRestBaseUrl:"https://api.binance.com",this.wsBaseUrl=typeof C.binanceWsBaseUrl=="string"&&C.binanceWsBaseUrl.length>0?C.binanceWsBaseUrl:"wss://stream.binance.com:9443/ws",this.symbolOverrides=C.binanceSymbolOverrides||{},this.wsReconnectDelayMs=typeof C.retryDelayMs=="number"?C.retryDelayMs:T;let M={logger:(...y)=>{this.logger(...y)},fetchTicker:this.fetchTickerDirect.bind(this),subscribeStreaming:this.subscribeStream.bind(this),unsubscribeStreaming:this.unsubscribeStream.bind(this),fallbackPollIntervalMs:C.fallbackPollIntervalMs,staleTickerTimeoutMs:C.staleTickerTimeoutMs};this.subscriptionManager=new S(M),this.wsRequestId=0,this.webSocketPool=new v({logger:(...y)=>{this.logger(...y)},reconnectDelayMs:this.wsReconnectDelayMs,createWebSocket:()=>{let y=p();if(!y)return this.logger("BinanceProvider: WebSocket not available in this environment"),null;let O=this.wsBaseUrl.replace(/\/$/,"");try{return new y(O)}catch(E){return this.logger("BinanceProvider: error creating pooled WebSocket",E),null}},subscribe:(y,O)=>{this.sendBinanceSubscription(y,O,!0)},unsubscribe:(y,O)=>{this.sendBinanceSubscription(y,O,!1)},handleMessage:(y,O)=>{this.handlePoolMessage(y,O)},onError:y=>{this.logger("BinanceProvider: pooled WebSocket error",y)},onClose:()=>{this.wsRequestId=0}})}getId(){return"BINANCE"}subscribeTicker(h,C){return this.subscriptionManager.subscribe(h,C)}getCachedTicker(h){let C=this.subscriptionManager.getCachedTicker(h);return C||(this.genericFallback&&typeof this.genericFallback.getCachedTicker=="function"?this.genericFallback.getCachedTicker(h):null)}ensureConnection(){let h=this;this.subscriptionManager.forEachEntry(function(C){h.subscriptionManager.ensureStreaming(C)})}async fetchTicker(h){try{return await this.fetchTickerDirect(h)}catch(C){if(this.logger("BinanceProvider: direct fetch failed, using fallback",C),this.genericFallback&&typeof this.genericFallback.fetchTicker=="function")return this.genericFallback.fetchTicker(h);throw C}}async fetchTickerDirect(h){let C=this.resolveSymbol(h);if(!C)throw new Error("BinanceProvider: unable to resolve symbol for "+(h.symbol||""));let M=this.buildRestUrl(C);try{let y=await fetch(M);if(!y||!y.ok)throw new Error("BinanceProvider: REST response not ok for "+C);let O=await y.json(),E=this.transformRestTicker(O,h,C);return E.connectionState=R.DETACHED,E}catch(y){if(this.logger("BinanceProvider: REST fetch error",y),this.genericFallback&&typeof this.genericFallback.fetchTicker=="function"){let O=await this.genericFallback.fetchTicker(h);return O&&typeof O=="object"&&!O.connectionState&&(O.connectionState=R.BACKUP),O}throw y}}subscribeStream(h){if(!h)return!1;let C=this.ensureEntryMeta(h);if(C.binanceSymbol=this.resolveSymbol(h.params),!C.binanceSymbol)return this.logger("BinanceProvider: cannot subscribe, unresolved symbol",h.params),!1;let M=this.webSocketPool.subscribe(C.binanceSymbol,{context:h,onData:y=>{let O=this.transformStreamTicker(y,h,C.binanceSymbol);this.subscriptionManager.handleStreamingUpdate(h.key,O)},onSubscribed:()=>{h.streamingActive=!0},onDisconnected:()=>{h.streamingActive=!1},onError:y=>{this.logger("BinanceProvider: subscription error",y)}});return M?(C.poolSubscription=M,h.streamingActive=!0,!0):(h.streamingActive=!1,!1)}unsubscribeStream(h){if(!h)return!0;let C=this.ensureEntryMeta(h);return C.poolSubscription&&typeof C.poolSubscription.unsubscribe=="function"&&C.poolSubscription.unsubscribe(),C.poolSubscription=null,h.streamingActive=!1,!0}resolveSymbol(h){if(!h)return null;let C=(h.symbol||"").toUpperCase();return C?this.symbolOverrides&&this.symbolOverrides[C]?(this.symbolOverrides[C]||"").toUpperCase():C.endsWith("USD")?C.slice(0,-3)+"USDT":C:null}buildRestUrl(h){return this.restBaseUrl.replace(/\/$/,"")+"/api/v3/ticker/24hr?symbol="+encodeURIComponent(h)}sendBinanceSubscription(h,C,M){if(!h||!C)return;let y=C.toLowerCase()+"@ticker",O={method:M?"SUBSCRIBE":"UNSUBSCRIBE",params:[y],id:this.nextWsRequestId()};try{h.send(JSON.stringify(O))}catch(E){this.logger("BinanceProvider: error sending subscription message",E)}}nextWsRequestId(){return this.wsRequestId+=1,this.wsRequestId>1e6&&(this.wsRequestId=1),this.wsRequestId}handlePoolMessage(h,C){if(!h)return;let M=h.data;if(!M)return;if(typeof M=="string")try{M=JSON.parse(M)}catch(E){this.logger("BinanceProvider: failed to parse WebSocket message",E);return}if(!M||Array.isArray(M))return;if(M.error){this.logger("BinanceProvider: WebSocket error message",M.error);return}if(typeof M.result!="undefined")return;let y=M;if(M.data&&typeof M.data=="object"&&(y=M.data),!y||typeof y!="object")return;let O=(y.s||y.symbol||"").toUpperCase();O&&(C.markSubscribed(O),C.dispatch(O,y,M))}transformRestTicker(h,C,M){let y=C&&C.symbol?C.symbol:M;return{changeDaily:f(h.priceChange),changeDailyPercent:k(h.priceChangePercent),last:f(h.lastPrice),volume:f(h.volume),high:f(h.highPrice),low:f(h.lowPrice),pair:y,pairDisplay:y}}transformStreamTicker(h,C,M){let y=C?C.params:null,O=y&&y.symbol?y.symbol:M;return{changeDaily:f(h.p||h.priceChange),changeDailyPercent:k(h.P||h.priceChangePercent),last:f(h.c||h.lastPrice),volume:f(h.v||h.volume),high:f(h.h||h.highPrice),low:f(h.l||h.lowPrice),pair:O,pairDisplay:O}}ensureEntryMeta(h){return h.meta=h.meta||{},h.meta}async fetchCandles(h){let C=this.resolveSymbol(h);if(!C)throw new Error("BinanceProvider: unable to resolve symbol for candles");let M=d(h.interval);if(!M)throw new Error("BinanceProvider: unsupported interval "+h.interval);let y=Math.min(Math.max(parseInt(h.limit,10)||24,1),1e3),E=this.restBaseUrl.replace(/\/$/,"")+"/api/v3/klines?symbol="+encodeURIComponent(C)+"&interval="+encodeURIComponent(M)+"&limit="+y;try{let B=await fetch(E);if(!B||!B.ok)throw new Error("BinanceProvider: candles response not ok");let H=await B.json();if(!Array.isArray(H))throw new Error("BinanceProvider: unexpected candles payload");return H.map(function(N){return{ts:Math.floor((N[0]||0)/1e3),open:f(N[1]),high:f(N[2]),low:f(N[3]),close:f(N[4]),volume:f(N[5]),volumeQuote:f(N[7])}})}catch(B){if(this.logger("BinanceProvider: error fetching candles",B),this.genericFallback&&typeof this.genericFallback.fetchCandles=="function")return this.genericFallback.fetchCandles(h);throw B}}}return{BinanceProvider:x}})});var jt=he((vn,et)=>{"use strict";(function(r,t){let a=typeof globalThis!="undefined"?globalThis:r,u=typeof et=="object"&&et.exports?[Ke(),Qe(),Je(),Ge(),Pt()]:[r==null?void 0:r.CryptoTickerProviders,r==null?void 0:r.CryptoTickerProviders,r==null?void 0:r.CryptoTickerProviders,r==null?void 0:r.CryptoTickerConnectionStates,r==null?void 0:r.CryptoTickerProviders],c=t(u[0],u[1],u[2],u[3],u[4]);typeof et=="object"&&et.exports&&(et.exports=c),a&&(a.CryptoTickerProviders=a.CryptoTickerProviders||{},a.CryptoTickerProviders.BitfinexProvider=c.BitfinexProvider)})(typeof self!="undefined"?self:vn,function(r,t,a,u,c){let i=r.ProviderInterface||r,g=t.GenericProvider||t,S=a.TickerSubscriptionManager||a,R=u||{LIVE:"live",DETACHED:"detached",BACKUP:"backup",BROKEN:"broken"},v=c.WebSocketConnectionPool||c,T=5e3;function p(){return typeof WebSocket!="undefined"?WebSocket:typeof window!="undefined"&&window.WebSocket?window.WebSocket:typeof global!="undefined"&&global.WebSocket?global.WebSocket:null}function f(x){let l=parseFloat(x);return isNaN(l)?0:l}function k(x){switch(x){case"MINUTES_1":return"1m";case"MINUTES_5":return"5m";case"MINUTES_15":return"15m";case"HOURS_1":return"1h";case"HOURS_6":return"6h";case"HOURS_12":return"12h";case"DAYS_1":return"1D";case"DAYS_7":return"1W";case"MONTHS_1":return"1M"}return null}class d extends i{constructor(l){super(l);let h=l||{};this.genericFallback=h.genericFallback instanceof g?h.genericFallback:new g(l),this.restBaseUrl=typeof h.bitfinexRestBaseUrl=="string"&&h.bitfinexRestBaseUrl.length>0?h.bitfinexRestBaseUrl:"https://api-pub.bitfinex.com",this.wsBaseUrl=typeof h.bitfinexWsBaseUrl=="string"&&h.bitfinexWsBaseUrl.length>0?h.bitfinexWsBaseUrl:"wss://api-pub.bitfinex.com/ws/2",this.symbolOverrides=h.bitfinexSymbolOverrides||{},this.wsReconnectDelayMs=typeof h.retryDelayMs=="number"?h.retryDelayMs:T;let C={logger:(...M)=>{this.logger(...M)},fetchTicker:this.fetchTickerDirect.bind(this),subscribeStreaming:this.subscribeStream.bind(this),unsubscribeStreaming:this.unsubscribeStream.bind(this),fallbackPollIntervalMs:h.fallbackPollIntervalMs,staleTickerTimeoutMs:h.staleTickerTimeoutMs};this.subscriptionManager=new S(C),this.channelIdToSymbol={},this.webSocketPool=new v({logger:(...M)=>{this.logger(...M)},reconnectDelayMs:this.wsReconnectDelayMs,createWebSocket:()=>{let M=p();if(!M)return this.logger("BitfinexProvider: WebSocket not available in this environment"),null;let y=this.wsBaseUrl.replace(/\/$/,"");try{return new M(y)}catch(O){return this.logger("BitfinexProvider: error creating pooled WebSocket",O),null}},subscribe:(M,y)=>{this.sendBitfinexSubscribe(M,y)},unsubscribe:(M,y,O)=>{this.sendBitfinexUnsubscribe(M,y,O)},handleMessage:(M,y)=>{this.handlePoolMessage(M,y)},onError:M=>{this.logger("BitfinexProvider: pooled WebSocket error",M)},onClose:()=>{this.channelIdToSymbol={}}})}getId(){return"BITFINEX"}subscribeTicker(l,h){return this.subscriptionManager.subscribe(l,h)}getCachedTicker(l){let h=this.subscriptionManager.getCachedTicker(l);return h||(this.genericFallback&&typeof this.genericFallback.getCachedTicker=="function"?this.genericFallback.getCachedTicker(l):null)}ensureConnection(){let l=this;this.subscriptionManager.forEachEntry(function(h){l.subscriptionManager.ensureStreaming(h)})}async fetchTicker(l){try{return await this.fetchTickerDirect(l)}catch(h){if(this.logger("BitfinexProvider: direct fetch failed, using fallback",h),this.genericFallback&&typeof this.genericFallback.fetchTicker=="function")return this.genericFallback.fetchTicker(l);throw h}}async fetchTickerDirect(l){let h=this.resolveSymbol(l);if(!h)throw new Error("BitfinexProvider: unable to resolve symbol for "+(l.symbol||""));let C=this.buildRestUrl(h);try{let M=await fetch(C);if(!M||!M.ok)throw new Error("BitfinexProvider: REST response not ok for "+h);let y=await M.json(),O=this.transformRestTicker(y,l,h);return O.connectionState=R.DETACHED,O}catch(M){if(this.logger("BitfinexProvider: REST fetch error",M),this.genericFallback&&typeof this.genericFallback.fetchTicker=="function"){let y=await this.genericFallback.fetchTicker(l);return y&&typeof y=="object"&&!y.connectionState&&(y.connectionState=R.BACKUP),y}throw M}}subscribeStream(l){if(!l)return!1;let h=this.ensureEntryMeta(l);if(h.bitfinexSymbol=this.resolveSymbol(l.params),!h.bitfinexSymbol)return this.logger("BitfinexProvider: cannot subscribe, unresolved symbol",l.params),!1;h.chanId=null;let C=this.webSocketPool.subscribe(h.bitfinexSymbol,{context:l,onData:M=>{let y=this.buildTickerFromArray(M,l);y&&this.subscriptionManager.handleStreamingUpdate(l.key,y)},onSubscribed:()=>{l.streamingActive=!0;let M=C.getMetadata?C.getMetadata():null;M&&M.chanId&&(h.chanId=M.chanId,this.channelIdToSymbol[h.chanId]=h.bitfinexSymbol)},onDisconnected:()=>{l.streamingActive=!1,h.chanId=null},onError:M=>{this.logger("BitfinexProvider: subscription error",M)}});return C?(h.poolSubscription=C,l.streamingActive=!0,!0):(l.streamingActive=!1,!1)}unsubscribeStream(l){if(!l)return!0;let h=this.ensureEntryMeta(l);return h.poolSubscription&&typeof h.poolSubscription.unsubscribe=="function"&&h.poolSubscription.unsubscribe(),h.poolSubscription=null,h.chanId=null,l.streamingActive=!1,!0}resolveSymbol(l){if(!l)return null;let h=(l.symbol||"").toUpperCase();if(!h)return null;if(this.symbolOverrides&&this.symbolOverrides[h])return(this.symbolOverrides[h]||"").toUpperCase();let C=h.replace(/[:/]/g,"");if(!C)return null;let M=C.toUpperCase();return"t"+(M.startsWith("T")?M.substring(1):M)}buildRestUrl(l){return this.restBaseUrl.replace(/\/$/,"")+"/v2/ticker/"+encodeURIComponent(l)}sendBitfinexSubscribe(l,h){if(!l||!h)return;let C={event:"subscribe",channel:"ticker",symbol:h};try{l.send(JSON.stringify(C))}catch(M){this.logger("BitfinexProvider: error sending subscribe",M)}}sendBitfinexUnsubscribe(l,h,C){if(!l)return;let M=C&&C.chanId;if(M)try{l.send(JSON.stringify({event:"unsubscribe",chanId:M}))}catch(y){this.logger("BitfinexProvider: error sending unsubscribe",y)}}handlePoolMessage(l,h){if(!l)return;let C=l.data;if(C){if(typeof C=="string")try{C=JSON.parse(C)}catch(M){this.logger("BitfinexProvider: failed to parse WebSocket message",M);return}if(C){if(Array.isArray(C)){this.handleBitfinexDataArray(C,h);return}C&&typeof C=="object"&&this.handleBitfinexEvent(C,h)}}}handleBitfinexEvent(l,h){if(!l||typeof l!="object")return;let C=l.event;if(C==="subscribed"&&l.channel==="ticker"){let M=typeof l.symbol=="string"?l.symbol:"";if(!M)return;let y=l.chanId;y&&(this.channelIdToSymbol[y]=M),h.markSubscribed(M,{chanId:y||null});return}if(C==="unsubscribed"){let M=l.chanId,y=null;M&&(y=this.channelIdToSymbol[M]||h.findSymbol(function(O){return O&&O.chanId===M}),delete this.channelIdToSymbol[M]),y&&(h.markUnsubscribed(y),h.updateMetadata(y,{chanId:null}));return}C==="error"&&this.logger("BitfinexProvider: subscription error",l)}handleBitfinexDataArray(l,h){if(!Array.isArray(l)||l.length<2)return;let C=l[0],M=l[1];if(M==="hb"||!Array.isArray(M))return;let y=this.channelIdToSymbol[C]||h.findSymbol(function(O){return O&&O.chanId===C});y&&h.dispatch(y,M,l)}buildTickerFromArray(l,h){if(!Array.isArray(l))return null;let C=h?h.params:null,M=C&&C.symbol?C.symbol:this.ensureEntryMeta(h).bitfinexSymbol;return{changeDaily:f(l[4]),changeDailyPercent:f(l[5]),last:f(l[6]),volume:f(l[7]),high:f(l[8]),low:f(l[9]),pair:M,pairDisplay:M}}transformRestTicker(l,h,C){if(!Array.isArray(l))throw new Error("BitfinexProvider: unexpected REST payload for "+C);let M=h&&h.symbol?h.symbol:C;return{changeDaily:f(l[4]),changeDailyPercent:f(l[5]),last:f(l[6]),volume:f(l[7]),high:f(l[8]),low:f(l[9]),pair:M,pairDisplay:M}}ensureEntryMeta(l){return l.meta=l.meta||{},l.meta}async fetchCandles(l){let h=this.resolveSymbol(l);if(!h)throw new Error("BitfinexProvider: unable to resolve symbol for candles");let C=k(l.interval);if(!C)throw new Error("BitfinexProvider: unsupported interval "+l.interval);let M=Math.min(Math.max(parseInt(l.limit,10)||24,1),1e3),O=this.restBaseUrl.replace(/\/$/,"")+"/v2/candles/trade:"+C+":"+encodeURIComponent(h)+"/hist?limit="+M;try{let E=await fetch(O);if(!E||!E.ok)throw new Error("BitfinexProvider: candles response not ok");let B=await E.json();if(!Array.isArray(B))throw new Error("BitfinexProvider: unexpected candles payload");return B.map(function(H){return{ts:Math.floor((H[0]||0)/1e3),open:f(H[1]),close:f(H[2]),high:f(H[3]),low:f(H[4]),volume:f(H[5]),volumeQuote:f(H[5])}})}catch(E){if(this.logger("BitfinexProvider: error fetching candles",E),this.genericFallback&&typeof this.genericFallback.fetchCandles=="function")return this.genericFallback.fetchCandles(l);throw E}}}return{BitfinexProvider:d}})});var Ht=he((wn,tt)=>{"use strict";(function(r,t){let a=typeof globalThis!="undefined"?globalThis:r,u=typeof tt=="object"&&tt.exports?[Ke(),Qe(),Je(),gt()]:[r==null?void 0:r.CryptoTickerProviders,r==null?void 0:r.CryptoTickerProviders,r==null?void 0:r.CryptoTickerProviders,r==null?void 0:r.CryptoTickerProviders],c=t(u[0],u[1],u[2],u[3]);typeof tt=="object"&&tt.exports&&(tt.exports=c),a&&(a.CryptoTickerProviders=a.CryptoTickerProviders||{},a.CryptoTickerProviders.YFinanceProvider=c.YFinanceProvider)})(typeof self!="undefined"?self:wn,function(r,t,a,u){let c=r.ProviderInterface||r,i=t.GenericProvider||t,g=a.TickerSubscriptionManager||a,S=u.buildSubscriptionKey||u;class R extends c{constructor(T){super(T);let p=T||{};this.genericFallback=p.genericFallback instanceof i?p.genericFallback:new i(T);let f={logger:(...k)=>{this.logger(...k)},fetchTicker:k=>this.genericFallback.fetchTicker(k),subscribeStreaming:null,unsubscribeStreaming:null,ensureConnection:null,buildSubscriptionKey:function(k,d,x,l){return S(k,d,x,l)},fallbackPollIntervalMs:p.fallbackPollIntervalMs,staleTickerTimeoutMs:p.staleTickerTimeoutMs};this.subscriptionManager=new g(f)}getId(){return"YFINANCE"}ensureConnection(){}subscribeTicker(T,p){return this.subscriptionManager.subscribe(T,p)}async fetchTicker(T){return this.genericFallback.fetchTicker(T)}async fetchCandles(T){return this.genericFallback&&typeof this.genericFallback.fetchCandles=="function"?this.genericFallback.fetchCandles(T):c.prototype.fetchCandles.call(this,T)}getCachedTicker(T){let p=this.subscriptionManager.getCachedTicker(T);return p||this.genericFallback.getCachedTicker(T)}}return{YFinanceProvider:R}})});var kn=he((Cn,nt)=>{"use strict";(function(r,t){let a=typeof globalThis!="undefined"?globalThis:r,u=typeof nt=="object"&&nt.exports?[Qe(),Wt(),jt(),Ht()]:[r==null?void 0:r.CryptoTickerProviders,r==null?void 0:r.CryptoTickerProviders,r==null?void 0:r.CryptoTickerProviders,r==null?void 0:r.CryptoTickerProviders],c=t(u[0],u[1],u[2],u[3]);typeof nt=="object"&&nt.exports&&(nt.exports=c),a&&(a.CryptoTickerProviders=a.CryptoTickerProviders||{},a.CryptoTickerProviders.ProviderRegistry=c.ProviderRegistry)})(typeof self!="undefined"?self:Cn,function(r,t,a,u){let c=r.GenericProvider||r,i=t.BinanceProvider||t,g=a.BitfinexProvider||a,S=u.YFinanceProvider||u;class R{constructor(T){let p=T||{};this.logger=typeof p.logger=="function"?p.logger:function(){},this.baseUrl=p.baseUrl||"",this.providers={},this.fallbackPollIntervalMs=typeof p.fallbackPollIntervalMs=="number"?p.fallbackPollIntervalMs:void 0,this.staleTickerTimeoutMs=typeof p.staleTickerTimeoutMs=="number"?p.staleTickerTimeoutMs:void 0,this.binanceRestBaseUrl=typeof p.binanceRestBaseUrl=="string"&&p.binanceRestBaseUrl.length>0?p.binanceRestBaseUrl:"https://api.binance.com",this.binanceWsBaseUrl=typeof p.binanceWsBaseUrl=="string"&&p.binanceWsBaseUrl.length>0?p.binanceWsBaseUrl:"wss://stream.binance.com:9443/ws",this.binanceSymbolOverrides=p.binanceSymbolOverrides||{},this.bitfinexRestBaseUrl=typeof p.bitfinexRestBaseUrl=="string"&&p.bitfinexRestBaseUrl.length>0?p.bitfinexRestBaseUrl:"https://api-pub.bitfinex.com",this.bitfinexWsBaseUrl=typeof p.bitfinexWsBaseUrl=="string"&&p.bitfinexWsBaseUrl.length>0?p.bitfinexWsBaseUrl:"wss://api-pub.bitfinex.com/ws/2",this.bitfinexSymbolOverrides=p.bitfinexSymbolOverrides||{};let f={baseUrl:this.baseUrl,logger:this.logger,fallbackPollIntervalMs:this.fallbackPollIntervalMs,staleTickerTimeoutMs:this.staleTickerTimeoutMs};this.genericProvider=p.genericProvider instanceof c?p.genericProvider:new c(f),this.register(this.genericProvider),this.register(new i({baseUrl:this.baseUrl,logger:this.logger,fallbackPollIntervalMs:this.fallbackPollIntervalMs,staleTickerTimeoutMs:this.staleTickerTimeoutMs,genericFallback:this.genericProvider,binanceRestBaseUrl:this.binanceRestBaseUrl,binanceWsBaseUrl:this.binanceWsBaseUrl,binanceSymbolOverrides:this.binanceSymbolOverrides})),this.register(new g({baseUrl:this.baseUrl,logger:this.logger,fallbackPollIntervalMs:this.fallbackPollIntervalMs,staleTickerTimeoutMs:this.staleTickerTimeoutMs,genericFallback:this.genericProvider,bitfinexRestBaseUrl:this.bitfinexRestBaseUrl,bitfinexWsBaseUrl:this.bitfinexWsBaseUrl,bitfinexSymbolOverrides:this.bitfinexSymbolOverrides})),this.register(new S({baseUrl:this.baseUrl,logger:this.logger,fallbackPollIntervalMs:this.fallbackPollIntervalMs,staleTickerTimeoutMs:this.staleTickerTimeoutMs,genericFallback:this.genericProvider}))}register(T){if(!T||typeof T.getId!="function")return;let p=T.getId();p&&(this.providers[p.toUpperCase()]=T)}getProvider(T){let p=(T||"").toUpperCase();return this.providers[p]||this.genericProvider}getGenericProvider(){return this.genericProvider}ensureAllConnections(){let T=Object.keys(this.providers);for(let p=0;p<T.length;p++){let f=this.providers[T[p]];f&&typeof f.ensureConnection=="function"&&f.ensureConnection()}}}return{ProviderRegistry:R}})});var qt=he((Sn,Rt)=>{"use strict";(function(r,t){let a=t();typeof Rt=="object"&&Rt.exports&&(Rt.exports=a),r&&typeof r=="object"&&(r.CryptoTickerFormatters=a)})(typeof self!="undefined"?self:Sn,function(){let r=["auto","full","compact","plain"],t=[{value:1e12,suffix:"T"},{value:1e9,suffix:"B"},{value:1e6,suffix:"M"},{value:1e3,suffix:"K"}];function a(c,i,g,S){let R=S||"auto",T=typeof i=="number"?i:parseInt(String(i!=null?i:""),10);(Number.isNaN(T)||T<0)&&(T=2);let p=c*(typeof g=="number"?g:1),f=Math.abs(p),k=p<0?"-":"";function d(C,M){let y=Math.pow(10,M);return Math.round(C*y)/y}function x(C,M){try{return C.toLocaleString(void 0,M)}catch{return C.toString()}}let l="",h=Math.max(0,T);switch(R){case"full":{let C=d(f,h);l=x(C,{minimumFractionDigits:h,maximumFractionDigits:h,useGrouping:!0});break}case"compact":{let C="",M=f;for(let O of t)if(f>=O.value){C=O.suffix,M=f/O.value;break}let y=d(M,h);l=x(y,{minimumFractionDigits:h,maximumFractionDigits:h,useGrouping:!C})+C;break}case"plain":{let C=d(f,h);l=x(C,{minimumFractionDigits:h,maximumFractionDigits:h,useGrouping:!1});break}case"auto":default:{let C="",M=f;f>1e5&&(C="K",M=f/1e3);let y=d(M,h);l=x(y,{minimumFractionDigits:h,maximumFractionDigits:h,useGrouping:!1})+C;break}}return k+l}function u(c,i,g){return g-i===0?.5:(c-i)/(g-i)}return{getRoundedValue:a,normalizeValue:u}})});var En=he((Mt,Tn)=>{(function(r,t){typeof Mt=="object"&&typeof Tn!="undefined"?t(Mt):typeof define=="function"&&define.amd?define(["exports"],t):(r=r||self,t(r.exprEval={}))})(Mt,function(r){"use strict";var t="INUMBER",a="IOP1",u="IOP2",c="IOP3",i="IVAR",g="IVARNAME",S="IFUNCALL",R="IFUNDEF",v="IEXPR",T="IEXPREVAL",p="IMEMBER",f="IENDSTATEMENT",k="IARRAY";function d(n,s){this.type=n,this.value=s!=null?s:0}d.prototype.toString=function(){switch(this.type){case t:case a:case u:case c:case i:case g:case f:return this.value;case S:return"CALL "+this.value;case R:return"DEF "+this.value;case k:return"ARRAY "+this.value;case p:return"."+this.value;default:return"Invalid Instruction"}};function x(n){return new d(a,n)}function l(n){return new d(u,n)}function h(n){return new d(c,n)}function C(n,s,m,P,F){for(var W=[],_=[],K,te,ue,le,ge=0;ge<n.length;ge++){var V=n[ge],de=V.type;if(de===t||de===g)Array.isArray(V.value)?W.push.apply(W,C(V.value.map(function(mt){return new d(t,mt)}).concat(new d(k,V.value.length)),s,m,P,F)):W.push(V);else if(de===i&&F.hasOwnProperty(V.value))V=new d(t,F[V.value]),W.push(V);else if(de===u&&W.length>1)te=W.pop(),K=W.pop(),le=m[V.value],V=new d(t,le(K.value,te.value)),W.push(V);else if(de===c&&W.length>2)ue=W.pop(),te=W.pop(),K=W.pop(),V.value==="?"?W.push(K.value?te.value:ue.value):(le=P[V.value],V=new d(t,le(K.value,te.value,ue.value)),W.push(V));else if(de===a&&W.length>0)K=W.pop(),le=s[V.value],V=new d(t,le(K.value)),W.push(V);else if(de===v){for(;W.length>0;)_.push(W.shift());_.push(new d(v,C(V.value,s,m,P,F)))}else if(de===p&&W.length>0)K=W.pop(),W.push(new d(t,K.value[V.value]));else{for(;W.length>0;)_.push(W.shift());_.push(V)}}for(;W.length>0;)_.push(W.shift());return _}function M(n,s,m){for(var P=[],F=0;F<n.length;F++){var W=n[F],_=W.type;if(_===i&&W.value===s)for(var K=0;K<m.tokens.length;K++){var te=m.tokens[K],ue;te.type===a?ue=x(te.value):te.type===u?ue=l(te.value):te.type===c?ue=h(te.value):ue=new d(te.type,te.value),P.push(ue)}else _===v?P.push(new d(v,M(W.value,s,m))):P.push(W)}return P}function y(n,s,m){var P=[],F,W,_,K,te,ue;if(E(n))return B(n,m);for(var le=n.length,ge=0;ge<le;ge++){var V=n[ge],de=V.type;if(de===t||de===g)P.push(V.value);else if(de===u)W=P.pop(),F=P.pop(),V.value==="and"?P.push(F?!!y(W,s,m):!1):V.value==="or"?P.push(F?!0:!!y(W,s,m)):V.value==="="?(K=s.binaryOps[V.value],P.push(K(F,y(W,s,m),m))):(K=s.binaryOps[V.value],P.push(K(B(F,m),B(W,m))));else if(de===c)_=P.pop(),W=P.pop(),F=P.pop(),V.value==="?"?P.push(y(F?W:_,s,m)):(K=s.ternaryOps[V.value],P.push(K(B(F,m),B(W,m),B(_,m))));else if(de===i)if(V.value in s.functions)P.push(s.functions[V.value]);else if(V.value in s.unaryOps&&s.parser.isOperatorEnabled(V.value))P.push(s.unaryOps[V.value]);else{var mt=m[V.value];if(mt!==void 0)P.push(mt);else throw new Error("undefined variable: "+V.value)}else if(de===a)F=P.pop(),K=s.unaryOps[V.value],P.push(K(B(F,m)));else if(de===S){for(ue=V.value,te=[];ue-- >0;)te.unshift(B(P.pop(),m));if(K=P.pop(),K.apply&&K.call)P.push(K.apply(void 0,te));else throw new Error(K+" is not a function")}else if(de===R)P.push(function(){for(var cr=P.pop(),Lt=[],lr=V.value;lr-- >0;)Lt.unshift(P.pop());var nn=P.pop(),_t=function(){for(var rn=Object.assign({},m),vt=0,ur=Lt.length;vt<ur;vt++)rn[Lt[vt]]=arguments[vt];return y(cr,s,rn)};return Object.defineProperty(_t,"name",{value:nn,writable:!1}),m[nn]=_t,_t}());else if(de===v)P.push(O(V,s));else if(de===T)P.push(V);else if(de===p)F=P.pop(),P.push(F[V.value]);else if(de===f)P.pop();else if(de===k){for(ue=V.value,te=[];ue-- >0;)te.unshift(P.pop());P.push(te)}else throw new Error("invalid Expression")}if(P.length>1)throw new Error("invalid Expression (parity)");return P[0]===0?0:B(P[0],m)}function O(n,s,m){return E(n)?n:{type:T,value:function(P){return y(n.value,s,P)}}}function E(n){return n&&n.type===T}function B(n,s){return E(n)?n.value(s):n}function H(n,s){for(var m=[],P,F,W,_,K,te,ue=0;ue<n.length;ue++){var le=n[ue],ge=le.type;if(ge===t)typeof le.value=="number"&&le.value<0?m.push("("+le.value+")"):Array.isArray(le.value)?m.push("["+le.value.map(N).join(", ")+"]"):m.push(N(le.value));else if(ge===u)F=m.pop(),P=m.pop(),_=le.value,s?_==="^"?m.push("Math.pow("+P+", "+F+")"):_==="and"?m.push("(!!"+P+" && !!"+F+")"):_==="or"?m.push("(!!"+P+" || !!"+F+")"):_==="||"?m.push("(function(a,b){ return Array.isArray(a) && Array.isArray(b) ? a.concat(b) : String(a) + String(b); }(("+P+"),("+F+")))"):_==="=="?m.push("("+P+" === "+F+")"):_==="!="?m.push("("+P+" !== "+F+")"):_==="["?m.push(P+"[("+F+") | 0]"):m.push("("+P+" "+_+" "+F+")"):_==="["?m.push(P+"["+F+"]"):m.push("("+P+" "+_+" "+F+")");else if(ge===c)if(W=m.pop(),F=m.pop(),P=m.pop(),_=le.value,_==="?")m.push("("+P+" ? "+F+" : "+W+")");else throw new Error("invalid Expression");else if(ge===i||ge===g)m.push(le.value);else if(ge===a)P=m.pop(),_=le.value,_==="-"||_==="+"?m.push("("+_+P+")"):s?_==="not"?m.push("(!"+P+")"):_==="!"?m.push("fac("+P+")"):m.push(_+"("+P+")"):_==="!"?m.push("("+P+"!)"):m.push("("+_+" "+P+")");else if(ge===S){for(te=le.value,K=[];te-- >0;)K.unshift(m.pop());_=m.pop(),m.push(_+"("+K.join(", ")+")")}else if(ge===R){for(F=m.pop(),te=le.value,K=[];te-- >0;)K.unshift(m.pop());P=m.pop(),s?m.push("("+P+" = function("+K.join(", ")+") { return "+F+" })"):m.push("("+P+"("+K.join(", ")+") = "+F+")")}else if(ge===p)P=m.pop(),m.push(P+"."+le.value);else if(ge===k){for(te=le.value,K=[];te-- >0;)K.unshift(m.pop());m.push("["+K.join(", ")+"]")}else if(ge===v)m.push("("+H(le.value,s)+")");else if(ge!==f)throw new Error("invalid Expression")}return m.length>1&&(s?m=[m.join(",")]:m=[m.join(";")]),String(m[0])}function N(n){return typeof n=="string"?JSON.stringify(n).replace(/\u2028/g,"\\u2028").replace(/\u2029/g,"\\u2029"):n}function Y(n,s){for(var m=0;m<n.length;m++)if(n[m]===s)return!0;return!1}function re(n,s,m){m=m||{};for(var P=!!m.withMembers,F=null,W=0;W<n.length;W++){var _=n[W];_.type===i||_.type===g?!P&&!Y(s,_.value)?s.push(_.value):(F!==null&&(Y(s,F)||s.push(F)),F=_.value):_.type===p&&P&&F!==null?F+="."+_.value:_.type===v?re(_.value,s,m):F!==null&&(Y(s,F)||s.push(F),F=null)}F!==null&&!Y(s,F)&&s.push(F)}function J(n,s){this.tokens=n,this.parser=s,this.unaryOps=s.unaryOps,this.binaryOps=s.binaryOps,this.ternaryOps=s.ternaryOps,this.functions=s.functions}J.prototype.simplify=function(n){return n=n||{},new J(C(this.tokens,this.unaryOps,this.binaryOps,this.ternaryOps,n),this.parser)},J.prototype.substitute=function(n,s){return s instanceof J||(s=this.parser.parse(String(s))),new J(M(this.tokens,n,s),this.parser)},J.prototype.evaluate=function(n){return n=n||{},y(this.tokens,this,n)},J.prototype.toString=function(){return H(this.tokens,!1)},J.prototype.symbols=function(n){n=n||{};var s=[];return re(this.tokens,s,n),s},J.prototype.variables=function(n){n=n||{};var s=[];re(this.tokens,s,n);var m=this.functions;return s.filter(function(P){return!(P in m)})},J.prototype.toJSFunction=function(n,s){var m=this,P=new Function(n,"with(this.functions) with (this.ternaryOps) with (this.binaryOps) with (this.unaryOps) { return "+H(this.simplify(s).tokens,!0)+"; }");return function(){return P.apply(m,arguments)}};var ie="TEOF",j="TOP",z="TNUMBER",fe="TSTRING",U="TPAREN",q="TBRACKET",ve="TCOMMA",Ce="TNAME",ye="TSEMICOLON";function pe(n,s,m){this.type=n,this.value=s,this.index=m}pe.prototype.toString=function(){return this.type+": "+this.value};function Z(n,s){this.pos=0,this.current=null,this.unaryOps=n.unaryOps,this.binaryOps=n.binaryOps,this.ternaryOps=n.ternaryOps,this.consts=n.consts,this.expression=s,this.savedPosition=0,this.savedCurrent=null,this.options=n.options,this.parser=n}Z.prototype.newToken=function(n,s,m){return new pe(n,s,m!=null?m:this.pos)},Z.prototype.save=function(){this.savedPosition=this.pos,this.savedCurrent=this.current},Z.prototype.restore=function(){this.pos=this.savedPosition,this.current=this.savedCurrent},Z.prototype.next=function(){if(this.pos>=this.expression.length)return this.newToken(ie,"EOF");if(this.isWhitespace()||this.isComment())return this.next();if(this.isRadixInteger()||this.isNumber()||this.isOperator()||this.isString()||this.isParen()||this.isBracket()||this.isComma()||this.isSemicolon()||this.isNamedOp()||this.isConst()||this.isName())return this.current;this.parseError('Unknown character "'+this.expression.charAt(this.pos)+'"')},Z.prototype.isString=function(){var n=!1,s=this.pos,m=this.expression.charAt(s);if(m==="'"||m==='"')for(var P=this.expression.indexOf(m,s+1);P>=0&&this.pos<this.expression.length;){if(this.pos=P+1,this.expression.charAt(P-1)!=="\\"){var F=this.expression.substring(s+1,P);this.current=this.newToken(fe,this.unescape(F),s),n=!0;break}P=this.expression.indexOf(m,P+1)}return n},Z.prototype.isParen=function(){var n=this.expression.charAt(this.pos);return n==="("||n===")"?(this.current=this.newToken(U,n),this.pos++,!0):!1},Z.prototype.isBracket=function(){var n=this.expression.charAt(this.pos);return(n==="["||n==="]")&&this.isOperatorEnabled("[")?(this.current=this.newToken(q,n),this.pos++,!0):!1},Z.prototype.isComma=function(){var n=this.expression.charAt(this.pos);return n===","?(this.current=this.newToken(ve,","),this.pos++,!0):!1},Z.prototype.isSemicolon=function(){var n=this.expression.charAt(this.pos);return n===";"?(this.current=this.newToken(ye,";"),this.pos++,!0):!1},Z.prototype.isConst=function(){for(var n=this.pos,s=n;s<this.expression.length;s++){var m=this.expression.charAt(s);if(m.toUpperCase()===m.toLowerCase()&&(s===this.pos||m!=="_"&&m!=="."&&(m<"0"||m>"9")))break}if(s>n){var P=this.expression.substring(n,s);if(P in this.consts)return this.current=this.newToken(z,this.consts[P]),this.pos+=P.length,!0}return!1},Z.prototype.isNamedOp=function(){for(var n=this.pos,s=n;s<this.expression.length;s++){var m=this.expression.charAt(s);if(m.toUpperCase()===m.toLowerCase()&&(s===this.pos||m!=="_"&&(m<"0"||m>"9")))break}if(s>n){var P=this.expression.substring(n,s);if(this.isOperatorEnabled(P)&&(P in this.binaryOps||P in this.unaryOps||P in this.ternaryOps))return this.current=this.newToken(j,P),this.pos+=P.length,!0}return!1},Z.prototype.isName=function(){for(var n=this.pos,s=n,m=!1;s<this.expression.length;s++){var P=this.expression.charAt(s);if(P.toUpperCase()===P.toLowerCase()){if(s===this.pos&&(P==="$"||P==="_")){P==="_"&&(m=!0);continue}else if(s===this.pos||!m||P!=="_"&&(P<"0"||P>"9"))break}else m=!0}if(m){var F=this.expression.substring(n,s);return this.current=this.newToken(Ce,F),this.pos+=F.length,!0}return!1},Z.prototype.isWhitespace=function(){for(var n=!1,s=this.expression.charAt(this.pos);(s===" "||s==="	"||s===`
`||s==="\r")&&(n=!0,this.pos++,!(this.pos>=this.expression.length));)s=this.expression.charAt(this.pos);return n};var Te=/^[0-9a-f]{4}$/i;Z.prototype.unescape=function(n){var s=n.indexOf("\\");if(s<0)return n;for(var m=n.substring(0,s);s>=0;){var P=n.charAt(++s);switch(P){case"'":m+="'";break;case'"':m+='"';break;case"\\":m+="\\";break;case"/":m+="/";break;case"b":m+="\b";break;case"f":m+="\f";break;case"n":m+=`
`;break;case"r":m+="\r";break;case"t":m+="	";break;case"u":var F=n.substring(s+1,s+5);Te.test(F)||this.parseError("Illegal escape sequence: \\u"+F),m+=String.fromCharCode(parseInt(F,16)),s+=4;break;default:throw this.parseError('Illegal escape sequence: "\\'+P+'"')}++s;var W=n.indexOf("\\",s);m+=n.substring(s,W<0?n.length:W),s=W}return m},Z.prototype.isComment=function(){var n=this.expression.charAt(this.pos);return n==="/"&&this.expression.charAt(this.pos+1)==="*"?(this.pos=this.expression.indexOf("*/",this.pos)+2,this.pos===1&&(this.pos=this.expression.length),!0):!1},Z.prototype.isRadixInteger=function(){var n=this.pos;if(n>=this.expression.length-2||this.expression.charAt(n)!=="0")return!1;++n;var s,m;if(this.expression.charAt(n)==="x")s=16,m=/^[0-9a-f]$/i,++n;else if(this.expression.charAt(n)==="b")s=2,m=/^[01]$/i,++n;else return!1;for(var P=!1,F=n;n<this.expression.length;){var W=this.expression.charAt(n);if(m.test(W))n++,P=!0;else break}return P&&(this.current=this.newToken(z,parseInt(this.expression.substring(F,n),s)),this.pos=n),P},Z.prototype.isNumber=function(){for(var n=!1,s=this.pos,m=s,P=s,F=!1,W=!1,_;s<this.expression.length&&(_=this.expression.charAt(s),_>="0"&&_<="9"||!F&&_===".");)_==="."?F=!0:W=!0,s++,n=W;if(n&&(P=s),_==="e"||_==="E"){s++;for(var K=!0,te=!1;s<this.expression.length;){if(_=this.expression.charAt(s),K&&(_==="+"||_==="-"))K=!1;else if(_>="0"&&_<="9")te=!0,K=!1;else break;s++}te||(s=P)}return n?(this.current=this.newToken(z,parseFloat(this.expression.substring(m,s))),this.pos=s):this.pos=P,n},Z.prototype.isOperator=function(){var n=this.pos,s=this.expression.charAt(this.pos);if(s==="+"||s==="-"||s==="*"||s==="/"||s==="%"||s==="^"||s==="?"||s===":"||s===".")this.current=this.newToken(j,s);else if(s==="\u2219"||s==="\u2022")this.current=this.newToken(j,"*");else if(s===">")this.expression.charAt(this.pos+1)==="="?(this.current=this.newToken(j,">="),this.pos++):this.current=this.newToken(j,">");else if(s==="<")this.expression.charAt(this.pos+1)==="="?(this.current=this.newToken(j,"<="),this.pos++):this.current=this.newToken(j,"<");else if(s==="|")if(this.expression.charAt(this.pos+1)==="|")this.current=this.newToken(j,"||"),this.pos++;else return!1;else if(s==="=")this.expression.charAt(this.pos+1)==="="?(this.current=this.newToken(j,"=="),this.pos++):this.current=this.newToken(j,s);else if(s==="!")this.expression.charAt(this.pos+1)==="="?(this.current=this.newToken(j,"!="),this.pos++):this.current=this.newToken(j,s);else return!1;return this.pos++,this.isOperatorEnabled(this.current.value)?!0:(this.pos=n,!1)},Z.prototype.isOperatorEnabled=function(n){return this.parser.isOperatorEnabled(n)},Z.prototype.getCoordinates=function(){var n=0,s,m=-1;do n++,s=this.pos-m,m=this.expression.indexOf(`
`,m+1);while(m>=0&&m<this.pos);return{line:n,column:s}},Z.prototype.parseError=function(n){var s=this.getCoordinates();throw new Error("parse error ["+s.line+":"+s.column+"]: "+n)};function X(n,s,m){this.parser=n,this.tokens=s,this.current=null,this.nextToken=null,this.next(),this.savedCurrent=null,this.savedNextToken=null,this.allowMemberAccess=m.allowMemberAccess!==!1}X.prototype.next=function(){return this.current=this.nextToken,this.nextToken=this.tokens.next()},X.prototype.tokenMatches=function(n,s){return typeof s=="undefined"?!0:Array.isArray(s)?Y(s,n.value):typeof s=="function"?s(n):n.value===s},X.prototype.save=function(){this.savedCurrent=this.current,this.savedNextToken=this.nextToken,this.tokens.save()},X.prototype.restore=function(){this.tokens.restore(),this.current=this.savedCurrent,this.nextToken=this.savedNextToken},X.prototype.accept=function(n,s){return this.nextToken.type===n&&this.tokenMatches(this.nextToken,s)?(this.next(),!0):!1},X.prototype.expect=function(n,s){if(!this.accept(n,s)){var m=this.tokens.getCoordinates();throw new Error("parse error ["+m.line+":"+m.column+"]: Expected "+(s||n))}},X.prototype.parseAtom=function(n){var s=this.tokens.unaryOps;function m(F){return F.value in s}if(this.accept(Ce)||this.accept(j,m))n.push(new d(i,this.current.value));else if(this.accept(z))n.push(new d(t,this.current.value));else if(this.accept(fe))n.push(new d(t,this.current.value));else if(this.accept(U,"("))this.parseExpression(n),this.expect(U,")");else if(this.accept(q,"["))if(this.accept(q,"]"))n.push(new d(k,0));else{var P=this.parseArrayList(n);n.push(new d(k,P))}else throw new Error("unexpected "+this.nextToken)},X.prototype.parseExpression=function(n){var s=[];this.parseUntilEndStatement(n,s)||(this.parseVariableAssignmentExpression(s),!this.parseUntilEndStatement(n,s)&&this.pushExpression(n,s))},X.prototype.pushExpression=function(n,s){for(var m=0,P=s.length;m<P;m++)n.push(s[m])},X.prototype.parseUntilEndStatement=function(n,s){return this.accept(ye)?(this.nextToken&&this.nextToken.type!==ie&&!(this.nextToken.type===U&&this.nextToken.value===")")&&s.push(new d(f)),this.nextToken.type!==ie&&this.parseExpression(s),n.push(new d(v,s)),!0):!1},X.prototype.parseArrayList=function(n){for(var s=0;!this.accept(q,"]");)for(this.parseExpression(n),++s;this.accept(ve);)this.parseExpression(n),++s;return s},X.prototype.parseVariableAssignmentExpression=function(n){for(this.parseConditionalExpression(n);this.accept(j,"=");){var s=n.pop(),m=[],P=n.length-1;if(s.type===S){if(!this.tokens.isOperatorEnabled("()="))throw new Error("function definition is not permitted");for(var F=0,W=s.value+1;F<W;F++){var _=P-F;n[_].type===i&&(n[_]=new d(g,n[_].value))}this.parseVariableAssignmentExpression(m),n.push(new d(v,m)),n.push(new d(R,s.value));continue}if(s.type!==i&&s.type!==p)throw new Error("expected variable for assignment");this.parseVariableAssignmentExpression(m),n.push(new d(g,s.value)),n.push(new d(v,m)),n.push(l("="))}},X.prototype.parseConditionalExpression=function(n){for(this.parseOrExpression(n);this.accept(j,"?");){var s=[],m=[];this.parseConditionalExpression(s),this.expect(j,":"),this.parseConditionalExpression(m),n.push(new d(v,s)),n.push(new d(v,m)),n.push(h("?"))}},X.prototype.parseOrExpression=function(n){for(this.parseAndExpression(n);this.accept(j,"or");){var s=[];this.parseAndExpression(s),n.push(new d(v,s)),n.push(l("or"))}},X.prototype.parseAndExpression=function(n){for(this.parseComparison(n);this.accept(j,"and");){var s=[];this.parseComparison(s),n.push(new d(v,s)),n.push(l("and"))}};var Ee=["==","!=","<","<=",">=",">","in"];X.prototype.parseComparison=function(n){for(this.parseAddSub(n);this.accept(j,Ee);){var s=this.current;this.parseAddSub(n),n.push(l(s.value))}};var Q=["+","-","||"];X.prototype.parseAddSub=function(n){for(this.parseTerm(n);this.accept(j,Q);){var s=this.current;this.parseTerm(n),n.push(l(s.value))}};var ee=["*","/","%"];X.prototype.parseTerm=function(n){for(this.parseFactor(n);this.accept(j,ee);){var s=this.current;this.parseFactor(n),n.push(l(s.value))}},X.prototype.parseFactor=function(n){var s=this.tokens.unaryOps;function m(F){return F.value in s}if(this.save(),this.accept(j,m)){if(this.current.value!=="-"&&this.current.value!=="+"){if(this.nextToken.type===U&&this.nextToken.value==="("){this.restore(),this.parseExponential(n);return}else if(this.nextToken.type===ye||this.nextToken.type===ve||this.nextToken.type===ie||this.nextToken.type===U&&this.nextToken.value===")"){this.restore(),this.parseAtom(n);return}}var P=this.current;this.parseFactor(n),n.push(x(P.value))}else this.parseExponential(n)},X.prototype.parseExponential=function(n){for(this.parsePostfixExpression(n);this.accept(j,"^");)this.parseFactor(n),n.push(l("^"))},X.prototype.parsePostfixExpression=function(n){for(this.parseFunctionCall(n);this.accept(j,"!");)n.push(x("!"))},X.prototype.parseFunctionCall=function(n){var s=this.tokens.unaryOps;function m(W){return W.value in s}if(this.accept(j,m)){var P=this.current;this.parseAtom(n),n.push(x(P.value))}else for(this.parseMemberExpression(n);this.accept(U,"(");)if(this.accept(U,")"))n.push(new d(S,0));else{var F=this.parseArgumentList(n);n.push(new d(S,F))}},X.prototype.parseArgumentList=function(n){for(var s=0;!this.accept(U,")");)for(this.parseExpression(n),++s;this.accept(ve);)this.parseExpression(n),++s;return s},X.prototype.parseMemberExpression=function(n){for(this.parseAtom(n);this.accept(j,".")||this.accept(q,"[");){var s=this.current;if(s.value==="."){if(!this.allowMemberAccess)throw new Error('unexpected ".", member access is not permitted');this.expect(Ce),n.push(new d(p,this.current.value))}else if(s.value==="["){if(!this.tokens.isOperatorEnabled("["))throw new Error('unexpected "[]", arrays are disabled');this.parseExpression(n),this.expect(q,"]"),n.push(l("["))}else throw new Error("unexpected symbol: "+s.value)}};function Oe(n,s){return Number(n)+Number(s)}function Le(n,s){return n-s}function _e(n,s){return n*s}function Ne(n,s){return n/s}function Se(n,s){return n%s}function ce(n,s){return Array.isArray(n)&&Array.isArray(s)?n.concat(s):""+n+s}function Ie(n,s){return n===s}function Fe(n,s){return n!==s}function $e(n,s){return n>s}function Ue(n,s){return n<s}function D(n,s){return n>=s}function e(n,s){return n<=s}function o(n,s){return!!(n&&s)}function b(n,s){return!!(n||s)}function w(n,s){return Y(s,n)}function I(n){return(Math.exp(n)-Math.exp(-n))/2}function A(n){return(Math.exp(n)+Math.exp(-n))/2}function L(n){return n===1/0?1:n===-1/0?-1:(Math.exp(n)-Math.exp(-n))/(Math.exp(n)+Math.exp(-n))}function $(n){return n===-1/0?n:Math.log(n+Math.sqrt(n*n+1))}function G(n){return Math.log(n+Math.sqrt(n*n-1))}function ne(n){return Math.log((1+n)/(1-n))/2}function De(n){return Math.log(n)*Math.LOG10E}function qe(n){return-n}function oe(n){return!n}function se(n){return n<0?Math.ceil(n):Math.floor(n)}function ae(n){return Math.random()*(n||1)}function ke(n){return xe(n+1)}function Ve(n){return isFinite(n)&&n===Math.round(n)}var ft=4.7421875,Be=[.9999999999999971,57.15623566586292,-59.59796035547549,14.136097974741746,-.4919138160976202,3399464998481189e-20,4652362892704858e-20,-9837447530487956e-20,.0001580887032249125,-.00021026444172410488,.00021743961811521265,-.0001643181065367639,8441822398385275e-20,-26190838401581408e-21,36899182659531625e-22];function xe(n){var s,m;if(Ve(n)){if(n<=0)return isFinite(n)?1/0:NaN;if(n>171)return 1/0;for(var P=n-2,F=n-1;P>1;)F*=P,P--;return F===0&&(F=1),F}if(n<.5)return Math.PI/(Math.sin(Math.PI*n)*xe(1-n));if(n>=171.35)return 1/0;if(n>85){var W=n*n,_=W*n,K=_*n,te=K*n;return Math.sqrt(2*Math.PI/n)*Math.pow(n/Math.E,n)*(1+1/(12*n)+1/(288*W)-139/(51840*_)-571/(2488320*K)+163879/(209018880*te)+5246819/(75246796800*te*n))}--n,m=Be[0];for(var ue=1;ue<Be.length;++ue)m+=Be[ue]/(n+ue);return s=n+ft+.5,Math.sqrt(2*Math.PI)*Math.pow(s,n+.5)*Math.exp(-s)*m}function pt(n){return Array.isArray(n)?n.length:String(n).length}function yt(){for(var n=0,s=0,m=0;m<arguments.length;m++){var P=Math.abs(arguments[m]),F;s<P?(F=s/P,n=n*F*F+1,s=P):P>0?(F=P/s,n+=F*F):n+=P}return s===1/0?1/0:s*Math.sqrt(n)}function ze(n,s,m){return n?s:m}function zn(n,s){return typeof s=="undefined"||+s==0?Math.round(n):(n=+n,s=-+s,isNaN(n)||!(typeof s=="number"&&s%1===0)?NaN:(n=n.toString().split("e"),n=Math.round(+(n[0]+"e"+(n[1]?+n[1]-s:-s))),n=n.toString().split("e"),+(n[0]+"e"+(n[1]?+n[1]+s:s))))}function Vn(n,s,m){return m&&(m[n]=s),s}function Gn(n,s){return n[s|0]}function Kn(n){return arguments.length===1&&Array.isArray(n)?Math.max.apply(Math,n):Math.max.apply(Math,arguments)}function Yn(n){return arguments.length===1&&Array.isArray(n)?Math.min.apply(Math,n):Math.min.apply(Math,arguments)}function Jn(n,s){if(typeof n!="function")throw new Error("First argument to map is not a function");if(!Array.isArray(s))throw new Error("Second argument to map is not an array");return s.map(function(m,P){return n(m,P)})}function Xn(n,s,m){if(typeof n!="function")throw new Error("First argument to fold is not a function");if(!Array.isArray(m))throw new Error("Second argument to fold is not an array");return m.reduce(function(P,F,W){return n(P,F,W)},s)}function Qn(n,s){if(typeof n!="function")throw new Error("First argument to filter is not a function");if(!Array.isArray(s))throw new Error("Second argument to filter is not an array");return s.filter(function(m,P){return n(m,P)})}function Zn(n,s){if(!(Array.isArray(s)||typeof s=="string"))throw new Error("Second argument to indexOf is not a string or array");return s.indexOf(n)}function er(n,s){if(!Array.isArray(s))throw new Error("Second argument to join is not an array");return s.join(n)}function tr(n){return(n>0)-(n<0)||+n}var Zt=1/3;function nr(n){return n<0?-Math.pow(-n,Zt):Math.pow(n,Zt)}function rr(n){return Math.exp(n)-1}function ir(n){return Math.log(1+n)}function sr(n){return Math.log(n)/Math.LN2}function We(n){this.options=n||{},this.unaryOps={sin:Math.sin,cos:Math.cos,tan:Math.tan,asin:Math.asin,acos:Math.acos,atan:Math.atan,sinh:Math.sinh||I,cosh:Math.cosh||A,tanh:Math.tanh||L,asinh:Math.asinh||$,acosh:Math.acosh||G,atanh:Math.atanh||ne,sqrt:Math.sqrt,cbrt:Math.cbrt||nr,log:Math.log,log2:Math.log2||sr,ln:Math.log,lg:Math.log10||De,log10:Math.log10||De,expm1:Math.expm1||rr,log1p:Math.log1p||ir,abs:Math.abs,ceil:Math.ceil,floor:Math.floor,round:Math.round,trunc:Math.trunc||se,"-":qe,"+":Number,exp:Math.exp,not:oe,length:pt,"!":ke,sign:Math.sign||tr},this.binaryOps={"+":Oe,"-":Le,"*":_e,"/":Ne,"%":Se,"^":Math.pow,"||":ce,"==":Ie,"!=":Fe,">":$e,"<":Ue,">=":D,"<=":e,and:o,or:b,in:w,"=":Vn,"[":Gn},this.ternaryOps={"?":ze},this.functions={random:ae,fac:ke,min:Yn,max:Kn,hypot:Math.hypot||yt,pyt:Math.hypot||yt,pow:Math.pow,atan2:Math.atan2,if:ze,gamma:xe,roundTo:zn,map:Jn,fold:Xn,filter:Qn,indexOf:Zn,join:er},this.consts={E:Math.E,PI:Math.PI,true:!0,false:!1}}We.prototype.parse=function(n){var s=[],m=new X(this,new Z(this,n),{allowMemberAccess:this.options.allowMemberAccess});return m.parseExpression(s),m.expect(ie,"EOF"),new J(s,this)},We.prototype.evaluate=function(n,s){return this.parse(n).evaluate(s)};var en=new We;We.parse=function(n){return en.parse(n)},We.evaluate=function(n,s){return en.parse(n).evaluate(s)};var tn={"+":"add","-":"subtract","*":"multiply","/":"divide","%":"remainder","^":"power","!":"factorial","<":"comparison",">":"comparison","<=":"comparison",">=":"comparison","==":"comparison","!=":"comparison","||":"concatenate",and:"logical",or:"logical",not:"logical","?":"conditional",":":"conditional","=":"assignment","[":"array","()=":"fndef"};function or(n){return tn.hasOwnProperty(n)?tn[n]:n}We.prototype.isOperatorEnabled=function(n){var s=or(n),m=this.options.operators||{};return!(s in m)||!!m[s]};var ar={Parser:We,Expression:J};r.Expression=J,r.Parser=We,r.default=ar,Object.defineProperty(r,"__esModule",{value:!0})})});var At=he((Rn,It)=>{"use strict";var Dt=class{constructor(t,a){let u=t||{},c=Array.isArray(u.allowedVariables)&&u.allowedVariables.length>0?u.allowedVariables.slice():zt.slice();this.allowedVariables=c;let i=a||Pn();this.parser=new i({operators:{add:!0,subtract:!0,multiply:!0,divide:!0,remainder:!0,power:!1,factorial:!1,comparison:!0,logical:!0,conditional:!0,concatenate:!1,assignment:!1,array:!1,fndef:!1},allowMemberAccess:!1}),this.cache={}}validate(t){let a;try{a=this.getCacheEntry(t)}catch(u){return{ok:!1,error:u instanceof Error?u.message:"Invalid expression"}}return a?a.disallowedVariables.length>0?{ok:!1,error:"Unknown variables: "+a.disallowedVariables.join(", ")+". Allowed variables: "+this.allowedVariables.join(", ")}:{ok:!0,variables:a.variables.slice()}:{ok:!1,error:"Expression cannot be empty"}}evaluate(t,a){let u=this.getCacheEntry(t);if(!u)throw new Error("Expression cannot be empty");if(u.disallowedVariables.length>0)throw new Error("Unknown variables: "+u.disallowedVariables.join(", ")+". Allowed variables: "+this.allowedVariables.join(", "));let c={},i=a||{};for(let g of this.allowedVariables){let S=Object.prototype.hasOwnProperty.call(i,g)?i[g]:void 0;if(zt.indexOf(g)!==-1){c[g]=He(S);continue}typeof S=="number"?c[g]=Number.isFinite(S)?S:0:typeof S=="boolean"||typeof S=="string"?c[g]=S:S==null?c[g]=0:c[g]=S}return u.compiled.evaluate(c)}clearCache(){this.cache={}}getCacheEntry(t){let a=this.normalizeExpression(t);if(!a)return null;if(this.cache[a])return this.cache[a];let u;try{u=this.parser.parse(a)}catch(S){throw this.wrapParseError(S)}let c=u.variables({withMembers:!1})||[],i=c.filter(S=>this.allowedVariables.indexOf(S)===-1),g={expression:a,compiled:u,variables:c.slice(),disallowedVariables:i.slice()};return this.cache[a]=g,g}normalizeExpression(t){return typeof t!="string"?"":t.trim()}wrapParseError(t){let a=t&&typeof t=="object"&&t instanceof Error&&t.message?wr(t.message):"Invalid expression",u=new Error(a);return t&&typeof t=="object"&&(u.originalError=t),u}},zt=["value","high","low","changeDaily","changeDailyPercent","volume"];function mr(r){return r?r.slice():[]}function He(r){if(r==null)return 0;if(typeof r=="number")return Number.isFinite(r)?r:0;if(typeof r=="string"&&r.trim()!==""){let t=Number(r);if(!Number.isNaN(t)&&Number.isFinite(t))return t}return 0}function xn(r){let t=r||{};return{value:He(t.last),high:He(t.high),low:He(t.low),changeDaily:He(t.changeDaily),changeDailyPercent:He(t.changeDailyPercent),volume:He(t.volume)}}function vr(r,t){let a=xn(r);if(t&&typeof t=="object")for(let u in t)Object.prototype.hasOwnProperty.call(t,u)&&(a[u]=t[u]);return a}function wr(r){return r?r.indexOf("member access is not permitted")>=0?r+'. Remove object-style prefixes (for example use "value" instead of "values.last").':r:"Invalid expression"}function Pn(){if(typeof je=="function")try{let a=En();if(a&&a.Parser)return a.Parser}catch{}let r=typeof globalThis!="undefined"?globalThis:{},t=r.exprEval&&r.exprEval.Parser;if(t)return t;throw new Error("expr-eval dependency is missing")}(function(t,a){let u=Pn(),c=a(u);typeof It=="object"&&It.exports&&(It.exports=c),t&&typeof t=="object"&&(t.CryptoTickerExpressionEvaluator=c)})(typeof self!="undefined"?self:Rn,function(t){return{createEvaluator:a=>new Dt(a,t),ExpressionEvaluator:Dt,normalizeNumericValue:He,buildBaseContext:xn,buildContext:vr,allowedVariables:mr(zt)}})});var Vt=he((Mn,rt)=>{"use strict";(function(r,t){let a=typeof rt=="object"&&rt.exports?At():r==null?void 0:r.CryptoTickerExpressionEvaluator,u=t(a);typeof rt=="object"&&rt.exports&&(rt.exports=u),r&&typeof r=="object"&&(r.CryptoTickerAlertManager=u)})(typeof self!="undefined"?self:Mn,function(r){if(!r)throw new Error("Expression evaluator dependency is missing");let t=r,a=t.createEvaluator(),u={},c={};function i(f){return u[f]||"off"}function g(f){return c[f]!=="off"}function S(f){c[f]="off"}function R(f){c[f]="on"}function v(f){return g(f)&&i(f)==="on"}function T(f){delete u[f],delete c[f]}function p(f){let k=f.context,d=f.settings||{},x=f.values||{},l=f.backgroundColor,h=f.textColor,C=!1,M=d.alertRule;if(!M)return u[k]="off",{alertMode:C,backgroundColor:l,textColor:h};try{let y=t.buildBaseContext(x);if(a.evaluate(M,y)){if(u[k]="on",g(k)){C=!0;let E=l;l=h,h=E}}else u[k]="off",R(k)}catch(y){u[k]="error",console.error("Error evaluating alertRule",{context:k,settings:d,values:x,error:y instanceof Error?y.message:y})}return{alertMode:C,backgroundColor:l,textColor:h}}return{evaluateAlert:p,shouldDisarmOnKeyPress:v,disarmAlert:S,armAlert:R,clearContext:T,getAlertStatus:i,isAlertArmed:g}})});var Gt=he((In,Ot)=>{"use strict";(function(t,a){let u=a();typeof Ot=="object"&&Ot.exports&&(Ot.exports=u),t&&typeof t=="object"&&(t.CryptoTickerState=u)})(typeof self!="undefined"?self:In,function(){let t={},a={},u={},c={},i={},g={};function S(N,Y){t[N]={context:N,settings:Y}}function R(N){return t[N]||null}function v(N){Object.keys(t).forEach(Y=>{N(t[Y],Y)})}function T(N){delete t[N],delete g[N]}function p(N,Y){N&&(a[N]=Y||null)}function f(N){return N&&a[N]||null}function k(N){N&&delete a[N]}function d(N,Y){N&&Y&&(u[N]=Y)}function x(N){return N&&u[N]||null}function l(N){N&&(delete u[N],delete g[N])}function h(N){return c[N]||(c[N]={}),c[N]}function C(N,Y){c[N]=Y}function M(N){return i[N]}function y(N,Y){i[N]=Y}function O(){Object.keys(t).forEach(N=>{delete t[N]}),Object.keys(a).forEach(N=>{let Y=a[N];if(Y&&typeof Y.unsubscribe=="function")try{Y.unsubscribe()}catch{}delete a[N]}),Object.keys(u).forEach(N=>{delete u[N]}),Object.keys(c).forEach(N=>{delete c[N]}),Object.keys(i).forEach(N=>{delete i[N]}),Object.keys(g).forEach(N=>{delete g[N]})}function E(N,Y,re){if(!N||!Y)return;let J=typeof re=="number"?re:Date.now();g[N]={values:Object.assign({},Y),timestamp:J}}function B(N){return N&&g[N]||null}function H(N){N&&delete g[N]}return{setContextDetails:S,getContextDetails:R,forEachContext:v,clearContextDetails:T,setSubscription:p,getSubscription:f,clearSubscription:k,setConnectionState:d,getConnectionState:x,clearConnectionState:l,getOrCreateConversionRateEntry:h,setConversionRateEntry:C,getCandlesCacheEntry:M,setCandlesCacheEntry:y,resetAllState:O,setLastGoodTicker:E,getLastGoodTicker:B,clearLastGoodTicker:H}})});var An=he((Dn,it)=>{"use strict";(function(r,t){let a=typeof globalThis!="undefined"?globalThis:r,u=typeof it=="object"&&it.exports?Gt():r==null?void 0:r.CryptoTickerState,c=t(u,a);typeof it=="object"&&it.exports&&(it.exports=c),r&&typeof r=="object"&&(r.CryptoTickerSettingsManager=c)})(typeof self!="undefined"?self:Dn,function(t,a){function u(f){if(typeof je=="function")try{return je(f)}catch{return null}return null}function c(){return a&&typeof a.CryptoTickerDefaults!="undefined"?a.CryptoTickerDefaults:u("./default-settings")}let i=c();function g(){if(!i)throw new Error("Default settings module is not available");return i}function S(f){let k=g();return typeof k.applyDefaults=="function"?k.applyDefaults(f):k.defaultSettings?Object.assign({},k.defaultSettings,f||{}):Object.assign({},f||{})}function R(){let f=g();return typeof f.getDefaultSettings=="function"?f.getDefaultSettings():f.defaultSettings?JSON.parse(JSON.stringify(f.defaultSettings)):{}}let v=R();function T(f){let k=f.context,d=f.settings,x=f.updateSubscription,l=S(d);return t.setContextDetails(k,l),typeof x=="function"&&x(l),l}let p=i&&i.settingsSchema?i.settingsSchema:null;return{applyDefaultSettings:S,getDefaultSettingsSnapshot:R,defaultSettings:v,settingsSchema:p,refreshSettings:T}})});var On=he((zr,Nt)=>{"use strict";var Cr={TIMESTAMP_SECONDS_THRESHOLD:9999999999,DEFAULT_PRICE_BAR_POSITION:.5};(function(t,a){let u=a();if(typeof Nt=="object"&&Nt.exports)Nt.exports=u;else{let c=t.CryptoTickerConstants||{};t.CryptoTickerConstants=Object.assign({},c,u)}})(typeof globalThis!="undefined"?globalThis:self,function(){return Cr})});var Fn=he((Nn,Ft)=>{"use strict";(function(r,t){let a=t();typeof Ft=="object"&&Ft.exports&&(Ft.exports=a),r&&typeof r=="object"&&(r.CryptoTickerConnectionStatusIcons=a)})(typeof self!="undefined"?self:Nn,function(){function t(){return{LIVE:"live",DETACHED:"detached",BACKUP:"backup",BROKEN:"broken"}}function a(c){if(!c||typeof c!="object")return t();let i=t(),g={};for(let S in i){if(!Object.prototype.hasOwnProperty.call(i,S))continue;let R=i[S],v=c[S];g[S]=typeof v=="string"&&v?v:R}return g}function u(c){let i=c.canvasContext,g=c.canvas,S=c.state,R=c.color,v=c.sizeMultiplier,T=c.position,p=c.connectionStates;if(!g||!i||!S)return;let f=a(p),k=(T||"OFF").toUpperCase();if(k==="OFF")return;let d=String(S).toLowerCase(),x=typeof v=="number"&&Number.isFinite(v)&&v>0?v:1,l=20*x,h=4*x,C=g.width-l-h,M=h;k==="BOTTOM_LEFT"&&(C=h,M=g.height-l-h),i.save(),i.translate(C,M),i.lineWidth=Math.max(1.5*x,1),i.strokeStyle=R,i.fillStyle=R;function y(O){if(!(!Array.isArray(O)||O.length===0)){i.beginPath();for(let E=0;E<O.length;E++){let B=O[E],H=B[0]*l,N=B[1]*l;E===0?i.moveTo(H,N):i.lineTo(H,N)}i.closePath(),i.fill()}}d===f.LIVE?y([[.7545784909869392,0],[.18263591551829597,.5685964091677761],[.3947756629367107,.5685964091677761],[.23171302126434715,1],[.8173281041988991,.43136761054941897],[.6051523764976793,.43136761054941897]]):d===f.DETACHED?(y([[0,.45],[.4,.45],[.4,.6],[0,.6]]),y([[.6,.45],[1,.45],[1,.6],[.6,.6]])):d===f.BACKUP?(y([[0,.3],[.4,.3],[.4,.38],[0,.38]]),y([[.6,.3],[1,.3],[1,.38],[.6,.38]]),y([[0,.62],[.4,.62],[.4,.7],[0,.7]]),y([[.6,.62],[1,.62],[1,.7],[.6,.7]])):d===f.BROKEN&&(i.save(),i.fillStyle="#ff0000",i.beginPath(),i.moveTo(l*.46,l*.32),i.lineTo(l*.42,l*.38),i.lineTo(l*.46,l*.44),i.lineTo(l*.41,l*.5),i.lineTo(l*.43,l*.88),i.lineTo(l*.3,l*.73),i.lineTo(l*.18,l*.62),i.bezierCurveTo(l*.08,l*.52,l*.08,l*.38,l*.15,l*.28),i.bezierCurveTo(l*.25,l*.16,l*.4,l*.2,l*.46,l*.32),i.closePath(),i.fill(),i.beginPath(),i.moveTo(l*.54,l*.28),i.lineTo(l*.58,l*.34),i.lineTo(l*.54,l*.4),i.lineTo(l*.59,l*.46),i.lineTo(l*.57,l*.84),i.lineTo(l*.7,l*.69),i.lineTo(l*.82,l*.58),i.bezierCurveTo(l*.92,l*.48,l*.92,l*.34,l*.85,l*.24),i.bezierCurveTo(l*.75,l*.12,l*.6,l*.16,l*.54,l*.28),i.closePath(),i.fill(),i.restore()),i.restore()}return{renderConnectionStatusIcon:u}})});var Bn=he((Un,st)=>{"use strict";(function(r,t){let a=typeof st=="object"&&st.exports?[Vt(),qt(),At(),On(),Fn()]:[r==null?void 0:r.CryptoTickerAlertManager,r==null?void 0:r.CryptoTickerFormatters,r==null?void 0:r.CryptoTickerExpressionEvaluator,r==null?void 0:r.CryptoTickerConstants,r==null?void 0:r.CryptoTickerConnectionStatusIcons],u=t(a[0],a[1],a[2],a[3],a[4]);typeof st=="object"&&st.exports&&(st.exports=u),r&&typeof r=="object"&&(r.CryptoTickerCanvasRenderer=u)})(typeof self!="undefined"?self:Un,function(r,t,a,u,c){if(!r)throw new Error("Alert manager dependency is missing");if(!t)throw new Error("Formatters dependency is missing");if(!a)throw new Error("Expression evaluator dependency is missing");let i=u||{},g=typeof i.TIMESTAMP_SECONDS_THRESHOLD=="number"?i.TIMESTAMP_SECONDS_THRESHOLD:9999999999,S=typeof i.DEFAULT_PRICE_BAR_POSITION=="number"?i.DEFAULT_PRICE_BAR_POSITION:.5;function R(){let y=a.allowedVariables.slice(0),O=["alert","backgroundColor","textColor","defaultBackgroundColor","defaultTextColor"];for(let E=0;E<O.length;E++)y.indexOf(O[E])===-1&&y.push(O[E]);return a.createEvaluator({allowedVariables:y})}let v=R(),T=c&&typeof c=="object"?c:null,p=T&&typeof T.renderConnectionStatusIcon=="function"?T.renderConnectionStatusIcon:function(){};function f(y,O){return Math.max(y/144,O/144)}function k(y){let O=parseInt(y.candlesDisplayed);return isNaN(O)?20:Math.min(60,Math.max(5,O))}function d(y,O,E,B,H){let N=Math.sqrt(.75*Math.pow(B,2));y.beginPath(),y.moveTo(O-B/2,E-N/3),y.lineTo(O+B/2,E-N/3),y.lineTo(O,E+N*2/3),y.fillStyle=H,y.fill()}function x(y,O,E,B){if(!O&&O!==0)return[""];let H=String(O).split(/\r?\n/),N=[];function Y(re){let J=re.split(""),ie=[],j="";for(let z=0;z<J.length;z++){let fe=j+J[z];y.measureText(fe).width>E&&j?(ie.push(j),j=J[z]):j=fe}return j&&ie.push(j),ie}y.font=B;for(let re=0;re<H.length;re++){let J=H[re];if(!J||J.trim()===""){N.push("");continue}let ie=J.trim().split(/\s+/),j=ie.shift()||"";for(;ie.length>0;){let z=ie.shift(),fe=j?j+" "+z:z;if(y.measureText(fe).width<=E){j=fe;continue}if(j&&N.push(j),y.measureText(z).width<=E)j=z;else{let U=Y(z);for(let q=0;q<U.length-1;q++)N.push(U[q]);j=U.length>0?U[U.length-1]:""}}j&&N.push(j)}return N.length===0&&N.push(""),N}function l(y){if(y==null)return null;let O=typeof y=="number"?y:parseFloat(y);if(!Number.isFinite(O))return null;let E=O>g?O:O*1e3,B=new Date(E);if(isNaN(B.getTime()))return null;try{return B.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}catch{return B.toISOString()}}function h(y){let O=y.canvas,E=y.canvasContext,B=y.message,H=y.backgroundColor||"#000000",N=y.textColor||"#ffffff",Y=y.font||"Lato",re=y.fontSize,J=y.connectionStates,ie=y.connectionState,j=(y.displayConnectionStatusIcon||"OFF").toUpperCase(),z=O.width,fe=O.height,U=f(z,fe),q=12*U,ve=re?re*U:Math.max(22*U,14),Ce="bold "+ve+"px "+Y,ye=ve*1.25;E.clearRect(0,0,z,fe),E.fillStyle=H,E.fillRect(0,0,z,fe);let pe=z-q*2,Z=x(E,B,pe,Ce),Te=fe-q*2;j!=="OFF"&&J&&(Te-=28*U);let X=ye*Z.length,Ee=q+(Te-X)/2+ye/2;Ee<q+ye/2&&(Ee=q+ye/2),E.fillStyle=N,E.textAlign="center",E.textBaseline="middle",E.font=Ce;for(let Q=0;Q<Z.length;Q++){let ee=Z[Q];ee&&E.fillText(ee,z/2,Ee+Q*ye)}j!=="OFF"&&J&&p({canvas:O,canvasContext:E,state:ie,color:N,sizeMultiplier:U,position:j,connectionStates:J})}function C(y){let O=y.canvas,E=y.canvasContext,B=y.settings||{},H=y.values||{},N=y.context,Y=y.connectionStates,re=y.connectionState,J=y.dataState||"live",ie=y.infoMessage||"",j=y.lastValidTimestamp||H.lastUpdated||null,z=O.width,fe=O.height,U=f(z,fe),q=10*U,ve=B.pair,Ce=B.title||H.pairDisplay||H.pair||ve||"",ye=B.multiplier||1,pe=B.priceFormat||"compact";function Z(oe,se){let ae=parseFloat(oe);return isNaN(ae)||ae<=0?se:ae}function Te(oe,se){let ae=parseInt(oe,10);return isNaN(ae)||ae<0?se:ae}let X=Te(B.digits,2),Ee=Te(B.highLowDigits,X),Q=Z(B.fontSizeBase,25),ee=Z(B.fontSizePrice,Q*35/25),Oe=Z(B.fontSizeHighLow,Q),Le=Z(B.fontSizeChange,Q*19/25),_e=B.backgroundColor||"#000000",Ne=B.textColor||"#ffffff",Se=_e,ce=Ne,Ie=re||H.connectionState||null,Fe=typeof H.last=="number"&&Number.isFinite(H.last)?H.last:null,$e=typeof H.high=="number"&&Number.isFinite(H.high)?H.high:null,Ue=typeof H.low=="number"&&Number.isFinite(H.low)?H.low:null,D=typeof H.changeDailyPercent=="number"&&Number.isFinite(H.changeDailyPercent)?H.changeDailyPercent:null,e=D!==null?D*100:null,o=typeof J=="string"?J.toLowerCase():"live",b=o==="stale"?"#f6a623":o==="missing"?"#d9534f":null,w=r.evaluateAlert({context:N,settings:B,values:H,backgroundColor:Se,textColor:ce}),I=w.alertMode;Se=w.backgroundColor,ce=w.textColor;let A=a.buildContext(H,{alert:I,backgroundColor:Se,textColor:ce,defaultBackgroundColor:_e,defaultTextColor:Ne});if(B.backgroundColorRule)try{let oe=v.evaluate(B.backgroundColorRule,A),se=String(oe||"").trim();se&&(Se=se,A.backgroundColor=Se)}catch(oe){console.error("Error evaluating backgroundColorRule",{context:N,expression:B.backgroundColorRule,values:H,error:oe instanceof Error?oe.message:oe})}if(B.textColorRule)try{A.textColor=ce;let oe=v.evaluate(B.textColorRule,A),se=String(oe||"").trim();se&&(ce=se,A.textColor=ce)}catch(oe){console.error("Error evaluating textColorRule",{context:N,expression:B.textColorRule,values:H,error:oe instanceof Error?oe.message:oe})}E.clearRect(0,0,z,fe),E.fillStyle=Se,E.fillRect(0,0,z,fe);let L=B.font||"Lato",$=Q*U+"px "+L;E.font=$,E.fillStyle=ce,E.textAlign="left",E.textBaseline="alphabetic";let G=25*U,ne=q;if(b){let oe=5*U,se=q+oe,ae=G-Q*U*.4;E.beginPath(),E.fillStyle=b,E.arc(se,ae,oe,0,Math.PI*2),E.fill(),E.fillStyle=ce,ne+=oe*2+6*U}if(Ce&&E.fillText(Ce,ne,G),o==="stale"){let oe=ie?ie.toUpperCase():"STALE",se=l(j),ae=se?oe+" \u2022 "+se:oe,ke=Math.max(14,Q*.6)*U;E.font=ke+"px "+L,E.fillStyle=b||ce,E.fillText(ae,ne,G+ke+4*U),E.font=$,E.fillStyle=ce}if(o!=="missing"){let oe=Fe!==null?t.getRoundedValue(Fe,X,ye,pe):"--";if(E.font="bold "+ee*U+"px "+L,E.fillStyle=ce,E.textAlign="left",E.fillText(oe,q,60*U),B.displayHighLow!=="off"){E.font=Oe*U+"px "+L,E.fillStyle=ce,E.textAlign="left";let se=Ue!==null?t.getRoundedValue(Ue,Ee,ye,pe):"--";E.fillText(se,q,90*U),E.textAlign="right";let ae=$e!==null?t.getRoundedValue($e,Ee,ye,pe):"--";E.fillText(ae,z-q,135*U)}if(B.displayDailyChange!=="off"&&e!==null){let se=E.fillStyle,ae=2;Math.abs(e)>=100?ae=0:Math.abs(e)>=10&&(ae=1);let ke=t.getRoundedValue(e,ae,1,"plain");e>0?(ke="+"+ke,E.fillStyle="green"):e<0?E.fillStyle="red":E.fillStyle=se,E.font=Le*U+"px "+L,E.textAlign="right",E.fillText(ke,z-q,90*U),E.fillStyle=se}if(B.displayHighLowBar!=="off"&&$e!==null&&Ue!==null&&Fe!==null){let se=104*U,ae=5*U,ke=6*U,Ve=$e-Ue,ft=Ve>0?Math.min(Math.max((Fe-Ue)/Ve,0),1):S,Be=z-ae*2,xe=ae+Math.round(Be*ft),pt=12*U;E.beginPath(),E.moveTo(ae,se),E.lineTo(xe,se),E.lineWidth=ke,E.strokeStyle="green",E.stroke(),E.beginPath(),E.moveTo(xe,se),E.lineTo(z-ae,se),E.lineWidth=ke,E.strokeStyle="red",E.stroke(),d(E,xe,se,pt,ce)}}else{let oe=ie?ie.toUpperCase():"NO DATA",se=Math.max(26,Q)*U,ae="bold "+se+"px "+L;E.font=ae,E.fillStyle=b||ce;let ke=E.textAlign,Ve=E.textBaseline;E.textAlign="center",E.textBaseline="middle";let ft=z-q*2,Be=x(E,oe,ft,ae),xe=se*1.1,pt=xe*Be.length,yt=(fe-pt)/2+xe/2;for(let ze=0;ze<Be.length;ze++)E.fillText(Be[ze],z/2,yt+ze*xe);E.textAlign=ke,E.textBaseline=Ve,E.font=$,E.fillStyle=ce}let qe=(B.displayConnectionStatusIcon||"OFF").toUpperCase();qe!=="OFF"&&p({canvas:O,canvasContext:E,state:Ie,color:ce,sizeMultiplier:U,position:qe,connectionStates:Y})}function M(y){let O=y.canvas,E=y.canvasContext,B=y.settings||{},H=y.candlesNormalized||[],N=y.connectionStates,Y=y.connectionState,re=O.width,J=O.height,ie=f(re,J),j=10*ie,z=(B.displayConnectionStatusIcon||"OFF").toUpperCase(),fe=Y||null,U=B.backgroundColor||"#000000",q=B.textColor||"#ffffff",ve=H.slice(-k(B)),Ce=ve.length,ye=re-2*j,pe=J-2*j,Z=Ce>0?ye/Ce:ye,Te=Math.max(2*ie,Z*.15),X=Math.max(4*ie,Z*.6);E.clearRect(0,0,re,J),E.fillStyle=U,E.fillRect(0,0,re,J);let Ee=B.font||"Lato";E.font=15*ie+"px "+Ee,E.fillStyle=q;let Q=B.candlesInterval||"1h";E.textAlign="right",E.fillText(Q,re-10*ie,J-5*ie),ve.forEach(function(ee){let Oe=Math.round(j+Math.round(ee.timePercent*ye)),Le=Math.round(j+pe-ee.highPercent*pe),_e=Math.round(j+pe-ee.lowPercent*pe);E.beginPath(),E.moveTo(Oe,Le),E.lineTo(Oe,_e),E.lineWidth=Te,E.strokeStyle=ee.closePercent>ee.openPercent?"#1c9900":"#a10",E.stroke();let Ne=Math.round(j+pe-ee.openPercent*pe),Se=Math.round(j+pe-ee.closePercent*pe),ce=Math.min(Ne,Se),Ie=Math.max(Ne,Se);E.beginPath(),E.rect(Math.round(Oe-X/2),ce,Math.round(X),Math.max(1,Ie-ce)),E.fillStyle=ee.closePercent>ee.openPercent?"#1c9900":"#a10",E.fill()}),z!=="OFF"&&p({canvas:O,canvasContext:E,state:fe,color:q,sizeMultiplier:ie,position:z,connectionStates:N})}return{getCanvasSizeMultiplier:f,getCandlesDisplayCount:k,renderConnectionStatusIcon:p,renderTickerCanvas:C,renderCandlesCanvas:M,renderMessageCanvas:h}})});var qn=he((Vr,Qt)=>{"use strict";var jn={tProxyBase:"https://tproxyv8.opendle.com",fallbackPollIntervalMs:6e4,staleTickerTimeoutMs:36e4,messages:{loading:"LOADING...",stale:"STALE",noData:"NO DATA",misconfigured:"INVALID PAIR",conversionError:"CONVERSION ERROR"}};function Ae(r){if(typeof je=="function")try{return je(r)}catch{return null}return null}function kr(){return typeof CryptoTickerConfig!="undefined"?CryptoTickerConfig:null}function ot(r){if(typeof r=="string"){let t=r.trim();return t.length===0?null:t.toUpperCase()}return r==null?null:String(r).trim().toUpperCase()||null}var Sr=Ae("./config"),Tr=Ae("./constants"),Er=kr(),Me=Object.assign({},jn,Sr||{},Er||{}),Ln=Tr||(typeof CryptoTickerConstants!="undefined"?CryptoTickerConstants:null)||{},xr=typeof Ln.TIMESTAMP_SECONDS_THRESHOLD=="number"?Ln.TIMESTAMP_SECONDS_THRESHOLD:9999999999,bt=Me.tProxyBase,_n=typeof bt=="string"?bt.replace(/\/$/,""):"",$n="_ctBust",Pr=jn.messages,Pe=Object.assign({},Pr,Me&&Me.messages||{});function Rr(r){if(!r||typeof r!="string")return r;try{let t=new URL(r);return t.searchParams.set($n,Date.now().toString()),t.toString()}catch{let a=r.indexOf("?")===-1?"?":"&";return r+a+$n+"="+Date.now()}}function Wn(r,t){if(!r||typeof r!="string")return{url:r,options:t};let a=r.replace(/\/$/,"");if(!_n||a.indexOf(_n)!==0)return{url:r,options:t};let u=Object.assign({},t||{});u.cache="no-store";let c=Object.assign({},u.headers||{});return c["cache-control"]="no-cache",c.pragma="no-cache",u.headers=c,{url:Rr(r),options:u}}var Kt=Ae("./providers/subscription-key"),ut=typeof CryptoTickerProviders!="undefined"?CryptoTickerProviders:null,Mr=Kt&&Kt.buildSubscriptionKey?Kt.buildSubscriptionKey:ut&&typeof ut.buildSubscriptionKey=="function"?ut.buildSubscriptionKey:function(r,t,a,u){let c=r||"",i=t||"",g=a||null,S=u||null,R="";return g!==null&&S!==null&&g!==S&&(R="__"+g+"_"+S),c+"__"+i+R},Ir=Ae("./providers/connection-states"),Re=Ir||(typeof CryptoTickerConnectionStates!="undefined"?CryptoTickerConnectionStates:{LIVE:"live",DETACHED:"detached",BACKUP:"backup",BROKEN:"broken"}),Dr=Ae("./canvas-renderer"),Ar=Ae("./alert-manager"),Or=Ae("./formatters"),Nr=Ae("./ticker-state"),Fr=Ae("./settings-manager"),ct=Dr||(typeof CryptoTickerCanvasRenderer!="undefined"?CryptoTickerCanvasRenderer:null),Jt=Ar||(typeof CryptoTickerAlertManager!="undefined"?CryptoTickerAlertManager:null),Xt=Or||(typeof CryptoTickerFormatters!="undefined"?CryptoTickerFormatters:null),we=Nr||(typeof CryptoTickerState!="undefined"?CryptoTickerState:null),ht=Fr||(typeof CryptoTickerSettingsManager!="undefined"?CryptoTickerSettingsManager:null);if(!ct||!Jt||!Xt||!we||!ht)throw new Error("CryptoTicker dependencies are not available");var Hn=!1,lt=null,at,Ut,Ur=!1,Br=60*60*1e3,Yt=null,Bt=ht.applyDefaultSettings,Lr=ht.defaultSettings,_r=ht.getDefaultSettingsSnapshot,$r=ht.settingsSchema,me={type:"com.courcelle.cryptoticker.ticker",log:function(...r){Hn&&console.log(...r)},setContextConnectionState:function(r,t){we.setConnectionState(r,t)},getContextConnectionState:function(r){return we.getConnectionState(r)},clearContextConnectionState:function(r){we.clearConnectionState(r)},getProviderRegistry:function(){if(!Yt){let r=Ae("./providers/provider-registry"),t=r&&r.ProviderRegistry?r.ProviderRegistry:ut&&ut.ProviderRegistry?ut.ProviderRegistry:null;if(!t)throw new Error("ProviderRegistry is not available");Yt=new t({baseUrl:bt,logger:(...a)=>{this.log(...a)},fallbackPollIntervalMs:Me.fallbackPollIntervalMs,staleTickerTimeoutMs:Me.staleTickerTimeoutMs,binanceRestBaseUrl:Me.binanceRestBaseUrl,binanceWsBaseUrl:Me.binanceWsBaseUrl,binanceSymbolOverrides:Me.binanceSymbolOverrides,bitfinexRestBaseUrl:Me.bitfinexRestBaseUrl,bitfinexWsBaseUrl:Me.bitfinexWsBaseUrl,bitfinexSymbolOverrides:Me.bitfinexSymbolOverrides})}return Yt},websocketSend:function(r){lt&&lt.send(r)},onKeyDown:async function(r,t,a,u){switch(t.mode){case"candles":t.mode="ticker";break;case"ticker":default:Jt.shouldDisarmOnKeyPress(r)?Jt.disarmAlert(r):t.mode="candles";break}this.websocketSend(JSON.stringify({event:"setSettings",context:r,payload:t})),this.refreshTimer(r,t)},onKeyUp:function(r,t,a,u){},onWillAppear:async function(r,t,a){this.initCanvas(),this.refreshTimer(r,t)},refreshTimers:async function(){we.forEachContext(r=>{this.refreshTimer(r.context,r.settings)})},refreshTimer:async function(r,t){let a=this.refreshSettings(r,t);this.updateTicker(r,a)},connect:function(){let r=this.getProviderRegistry();r&&typeof r.ensureAllConnections=="function"&&r.ensureAllConnections()},updateSubscription:function(r,t){let a=t.exchange,u=t.pair,c=this.resolveConversionCurrencies(t.fromCurrency,t.currency),i=this.getSubscriptionContextKey(a,u,c.from,null),g=we.getSubscription(r);if(g&&g.key===i)return g;if(g&&typeof g.unsubscribe=="function"){try{g.unsubscribe()}catch(p){this.log("Error unsubscribing from provider",p)}we.clearSubscription(r),this.clearContextConnectionState(r)}let R=this.getProviderRegistry().getProvider(a),v={exchange:a,symbol:u,fromCurrency:c.from,toCurrency:null},T=this;try{let p=R.subscribeTicker(v,{onData:async function(f){let k=we.getContextDetails(r);if(k){T.setContextConnectionState(k.context,f&&f.connectionState);try{let d=await T.convertTickerValues(f,k.settings&&k.settings.fromCurrency,k.settings&&k.settings.currency);await T.updateCanvas(k.context,k.settings,d)}catch(d){T.log("Error updating canvas from subscription",d)}}},onError:function(f){T.log("Provider subscription error",f),T.setContextConnectionState(r,Re.BROKEN)}});return we.setSubscription(r,{key:i,unsubscribe:p&&typeof p.unsubscribe=="function"?p.unsubscribe:function(){},providerId:R.getId?R.getId():null}),we.getSubscription(r)}catch(p){this.log("Error subscribing to provider",p)}return null},refreshSettings:function(r,t){return ht.refreshSettings({context:r,settings:t,updateSubscription:a=>{this.updateSubscription(r,a)}})},getSubscriptionContextKey:function(r,t,a,u){return Mr(r,t,a,u)},resolveConversionCurrencies:function(r,t){let a=ot(r)||"USD",u=ot(t);return!u||u===a?{from:a,to:null}:{from:a,to:u}},getConversionRate:async function(r,t){let a=ot(r),u=ot(t);if(!a||!u||a===u)return 1;let c=a+"_"+u,i=Date.now(),g=we.getOrCreateConversionRateEntry(c);if(typeof g.rate=="number"&&g.rate>0&&g.fetchedAt&&i-g.fetchedAt<Br)return g.rate;if(g.promise)try{return await g.promise}catch(p){this.log("Conversion rate promise failed",p)}let S=typeof fetch=="function"?fetch:null;if(!S)return typeof g.rate=="number"&&g.rate>0?g.rate:1;let R=(bt||"").replace(/\/$/,"");if(!R)return typeof g.rate=="number"&&g.rate>0?g.rate:1;let v=R+"/api/ticker/json/currency/"+encodeURIComponent(a)+"/"+encodeURIComponent(u),T=this;g.promise=async function(){try{let p=Wn(v),f=await S(p.url,p.options);if(!f||!f.ok)throw new Error("Conversion rate response not ok");let k=await f.json(),d=k&&k.rate!==void 0?parseFloat(k.rate):NaN;if(!d||!isFinite(d)||d<=0)throw new Error("Invalid conversion rate");return g.rate=d,g.fetchedAt=Date.now(),d}catch(p){throw T.log("Error fetching conversion rate",p),p}finally{delete g.promise}}();try{return await g.promise}catch{return typeof g.rate=="number"&&g.rate>0?g.rate:1}},convertTickerValues:async function(r,t,a){if(!r)return r;let u=this.resolveConversionCurrencies(t,a);if(!u.to)return r;let c=ot(r.conversionToCurrency),i=ot(r.conversionFromCurrency);if(c===u.to&&i===u.from)return r;let g=null;try{g=await this.getConversionRate(u.from,u.to)}catch(S){return this.log("Conversion rate error",S),this.createConversionErrorValues(r)}return!g||!isFinite(g)||g<=0?this.createConversionErrorValues(r):this.applyTickerConversion(r,g,u.from,u.to)},createConversionErrorValues:function(r){let t=Object.assign({},r),a=["last","high","low","open","close","changeDaily","changeDailyPercent","volume"];for(let u=0;u<a.length;u++){let c=a[u];Object.prototype.hasOwnProperty.call(t,c)&&delete t[c]}return t.conversionRate=null,t.conversionError=!0,t},applyTickerConversion:function(r,t,a,u){if(!r||typeof r!="object")return r;let c=Object.assign({},r),i=["last","high","low","open","close","changeDaily"];for(let g=0;g<i.length;g++){let S=i[g];if(!Object.prototype.hasOwnProperty.call(r,S))continue;let R=r[S],v=typeof R=="number"?R:parseFloat(R);isNaN(v)||(c[S]=v*t)}return c.conversionRate=t,c.conversionFromCurrency=a,c.conversionToCurrency=u,c},applyCandlesConversion:function(r,t){return!Array.isArray(r)||!t||!isFinite(t)||t<=0?r:r.map(function(a){if(!a||typeof a!="object")return a;let u=Object.assign({},a),c=["open","close","high","low"];for(let i=0;i<c.length;i++){let g=c[i];if(!Object.prototype.hasOwnProperty.call(a,g))continue;let S=a[g],R=typeof S=="number"?S:parseFloat(S);isNaN(R)||(u[g]=R*t)}if(Object.prototype.hasOwnProperty.call(a,"volumeQuote")){let i=a.volumeQuote,g=typeof i=="number"?i:parseFloat(i);isNaN(g)||(u.volumeQuote=g*t)}return u})},updateTicker:async function(r,t){let a=t.pair,u=await this.getTickerValue(a,t.currency,t.exchange,t.fromCurrency);this.setContextConnectionState(r,u&&u.connectionState),this.updateCanvas(r,t,u)},initCanvas:function(){at=document.getElementById("ticker"),Ut=at.getContext("2d")},updateCanvas:async function(r,t,a){this.log("updateCanvas",r,t,a);let u=a&&a.connectionState||this.getContextConnectionState(r);switch(t.mode){case"candles":{let c=await this.getCandles(t);this.updateCanvasCandles(r,t,c,u);break}case"ticker":default:this.updateCanvasTicker(r,t,a,u);break}},sanitizeTickerValues:function(r){if(!r||typeof r!="object")return{values:{},hasAny:!1,hasCritical:!1,timestamp:null};let t=Object.assign({},r);function a(S,R,v){if(typeof S=="number"&&Number.isFinite(S))return v?Math.round(S):S;if(typeof S=="string"){let T=S.trim();if(T){let p=v?parseInt(T,10):parseFloat(T);if(!isNaN(p)&&Number.isFinite(p))return v?Math.round(p):p}}return R}let u=a(r.last,null,!1);u===null?delete t.last:t.last=u;let c={high:null,low:null,volume:0,changeDaily:0,changeDailyPercent:0};Object.keys(c).forEach(S=>{let R=c[S],v=a(r[S],R,!1);v==null||!Number.isFinite(v)?delete t[S]:v===R&&r[S]===void 0?R===null?delete t[S]:t[S]=R:t[S]=v});let i=["lastUpdated","timestamp","time","updatedAt"],g=null;for(let S=0;S<i.length;S++){let R=i[S];if(!Object.prototype.hasOwnProperty.call(r,R))continue;let T=a(r[R],null,!0);if(T!=null){let p=T>xr?T:T*1e3;g=p,t.lastUpdated=p;break}}return typeof t.pairDisplay!="string"&&delete t.pairDisplay,{values:t,hasAny:Object.keys(r).length>0,hasCritical:u!==null,timestamp:g}},buildTickerRenderContext:function(r,t,a,u){let c=this.sanitizeTickerValues(a),i=c.values,g=Date.now(),S="missing",R=null,v=null,T=i,p=null,f=u||i.connectionState||null,k=we.getLastGoodTicker(r),d=f===Re.BROKEN,l=[Re.LIVE,Re.BACKUP,Re.DETACHED].indexOf(f)!==-1,h=c.hasCritical&&Number.isFinite(i.last)&&i.last===0&&(!Number.isFinite(i.high)||i.high===0)&&(!Number.isFinite(i.low)||i.low===0)&&(!Number.isFinite(i.volume)||i.volume===0)&&c.timestamp===null,C=c.hasCritical&&(!l||d)&&h;if(!!i.conversionError){S="missing",T=Object.assign({},i);let y=t.title||i.pairDisplay||i.pair||t.pair||"";return!T.pairDisplay&&y&&(T.pairDisplay=y),R=Pe.conversionError||"CONVERSION ERROR",p="conversion_error",{values:T,dataState:S,infoMessage:R,lastValidTimestamp:v,degradedReason:p}}if(c.hasCritical&&!d&&!C){let y=c.timestamp||g;i.lastUpdated=y,we.setLastGoodTicker(r,i,y),v=y,S="live",T=Object.assign({},i)}else if(k&&k.values&&typeof k.values=="object"&&Number.isFinite(k.values.last))S="stale",T=Object.assign({},k.values),v=k.timestamp,T.lastUpdated||(T.lastUpdated=k.timestamp),R=Pe.stale,p=c.hasAny?"partial":"missing";else{S="missing",T=Object.assign({},i);let y=t.title||i.pairDisplay||i.pair||t.pair||"";!T.pairDisplay&&y&&(T.pairDisplay=y),C||d?(R=Pe.misconfigured||Pe.noData,p="misconfigured"):(R=Pe.loading,p=c.hasAny?"partial":"none")}return!R&&S==="missing"&&(R=d?Pe.misconfigured||Pe.noData:Pe.loading),!R&&S==="live"&&d&&(R=Pe.misconfigured||Pe.noData),!R&&S==="stale"&&!Pe.stale&&(R="STALE"),{values:T,dataState:S,infoMessage:R,lastValidTimestamp:v,degradedReason:p}},displayMessage:function(r,t,a){this.initCanvas();let u=a||{},c=Bt(u.settings||{}),i=u.backgroundColor||c.backgroundColor||"#000000",g=u.textColor||c.textColor||"#ffffff",S=u.font||c.font||"Lato",R=u.fontSize||null,v=u.connectionState||null,T=u.displayConnectionStatusIcon||c.displayConnectionStatusIcon||"OFF";v&&this.setContextConnectionState(r,v),ct.renderMessageCanvas({canvas:at,canvasContext:Ut,message:t,backgroundColor:i,textColor:g,font:S,fontSize:R,connectionStates:Re,connectionState:v||this.getContextConnectionState(r),displayConnectionStatusIcon:T}),this.sendCanvas(r)},getCanvasSizeMultiplier:function(r,t){return ct.getCanvasSizeMultiplier(r,t)},getCandlesDisplayCount:function(r){return ct.getCandlesDisplayCount(r)},updateCanvasTicker:function(r,t,a,u){this.log("updateCanvasTicker",r,t,a);let c=this.buildTickerRenderContext(r,t,a,u);ct.renderTickerCanvas({canvas:at,canvasContext:Ut,settings:t,values:c.values,context:r,connectionStates:Re,connectionState:u||a&&a.connectionState||null,dataState:c.dataState,infoMessage:c.infoMessage,lastValidTimestamp:c.lastValidTimestamp,degradedReason:c.degradedReason}),this.sendCanvas(r)},updateCanvasCandles:function(r,t,a,u){this.log("updateCanvasCandles",r,t,a),ct.renderCandlesCanvas({canvas:at,canvasContext:Ut,settings:t,candlesNormalized:a,connectionStates:Re,connectionState:u||this.getContextConnectionState(r)}),this.sendCanvas(r)},sendCanvas:function(r){var t={event:"setImage",context:r,payload:{image:at.toDataURL(),target:DestinationEnum.HARDWARE_AND_SOFTWARE}};this.websocketSend(JSON.stringify(t))},getRoundedValue:function(r,t,a,u){return Xt.getRoundedValue(r,t,a,u)},getTickerValue:async function(r,t,a,u){let i=this.getProviderRegistry().getProvider(a),g=this.resolveConversionCurrencies(u,t),S={exchange:a,symbol:r,fromCurrency:g.from,toCurrency:null};try{let R=await i.fetchTicker(S),T=await this.convertTickerValues(R,g.from,g.to)||R;return T&&typeof T=="object"&&!T.connectionState&&(T.connectionState=Re.DETACHED),T}catch(R){this.log("Error fetching ticker",R);let v=this.getSubscriptionContextKey(a,r,g.from,null);if(i&&typeof i.getCachedTicker=="function"){let T=i.getCachedTicker(v);if(T){let f=await this.convertTickerValues(T,g.from,g.to)||T;return f&&!f.connectionState&&(f.connectionState=Re.BACKUP),f}}return{changeDaily:0,changeDailyPercent:0,last:0,volume:0,high:0,low:0,pair:r,pairDisplay:r,connectionState:Re.BROKEN}}},getCandles:async function(r){this.log("getCandles");let t=r.exchange,a=r.pair,u=this.convertCandlesInterval(r.candlesInterval||"1h"),c=this.getCandlesDisplayCount(r),i=this.resolveConversionCurrencies(r.fromCurrency,r.currency),g=i.to||i.from||"",S=t+"_"+a+"_"+u+"_"+c+"_"+g,R=we.getCandlesCacheEntry(S);R||(R={},we.setCandlesCacheEntry(S,R));let v=new Date().getTime(),T="time",p="candles";if(R[T]&&R[T]>v-60*1e3)return R[p];let f={exchange:t,symbol:a,interval:u,limit:24},k=null;try{let h=this.getProviderRegistry(),C=h.getProvider(t);if(C&&typeof C.fetchCandles=="function"&&(k=await C.fetchCandles(f)),Array.isArray(k)||(k=null),k===null){let M=h.getGenericProvider();M&&typeof M.fetchCandles=="function"&&(k=await M.fetchCandles(f),Array.isArray(k)||(k=null))}}catch(h){this.log("Error fetching provider candles",h),k=null}if(k===null)try{let h=bt+"/api/Candles/json/"+t+"/"+a+"/"+u+"?limit=24",C=Wn(h),y=await(await fetch(C.url,C.options)).json();y&&Array.isArray(y.candles)&&(k=y.candles)}catch(h){this.log("Error fetching candles from proxy",h)}if(!Array.isArray(k))return R[p]||[];let d=this.prepareCandlesForDisplay(k,c),x=d;if(i.to)try{let h=await this.getConversionRate(i.from,i.to);h&&isFinite(h)&&h>0&&(x=this.applyCandlesConversion(d,h))}catch(h){this.log("Conversion rate error for candles",h)}let l=this.getCandlesNormalized(x);return R[T]=v,R[p]=l,R[p]},convertCandlesInterval:function(r){switch(r){case"1m":return"MINUTES_1";case"5m":return"MINUTES_5";case"15m":return"MINUTES_15";case"1h":return"HOURS_1";case"6h":return"HOURS_6";case"12h":return"HOURS_12";case"1D":return"DAYS_1";case"7D":return"DAYS_7";case"1M":return"MONTHS_1"}return r},prepareCandlesForDisplay:function(r,t){if(!Array.isArray(r)||r.length===0)return[];let a=r.map(function(u){if(!u)return null;let c=u.ts;if(typeof c!="number"){let i=u.openTime;if(i){let g=Date.parse(i);isNaN(g)||(c=Math.floor(g/1e3))}}return typeof c!="number"||isNaN(c)?null:{candle:u,ts:c}}).filter(function(u){return u!==null}).sort(function(u,c){return u.ts-c.ts}).map(function(u){return u.candle.ts===u.ts?u.candle:Object.assign({},u.candle,{ts:u.ts})});return typeof t=="number"&&t>0&&a.length>t?a.slice(-t):a},getCandlesNormalized:function(r){let t=Number.POSITIVE_INFINITY,a=0,u=Number.POSITIVE_INFINITY,c=0,i=Number.POSITIVE_INFINITY,g=0;(r||[]).forEach(function(v){i=Math.min(i,v.ts),g=Math.max(g,v.ts),t=Math.min(t,v.open),t=Math.min(t,v.close),t=Math.min(t,v.high),t=Math.min(t,v.low),a=Math.max(a,v.open),a=Math.max(a,v.close),a=Math.max(a,v.high),a=Math.max(a,v.low),u=Math.min(u,v.volumeQuote),c=Math.max(c,v.volumeQuote)});let S=this,R=[];return(r||[]).forEach(function(v){R.push({timePercent:S.normalizeValue(v.ts,i,g),openPercent:S.normalizeValue(v.open,t,a),closePercent:S.normalizeValue(v.close,t,a),highPercent:S.normalizeValue(v.high,t,a),lowPercent:S.normalizeValue(v.low,t,a),volumePercent:S.normalizeValue(v.volumeQuote,u,c)})}),this.log("getCandlesNormalized",R),R},normalizeValue:function(r,t,a){return Xt.normalizeValue(r,t,a)}};me.defaultSettings=Lr;me.applyDefaultSettings=Bt;me.getDefaultSettings=function(){return _r()};me.settingsSchema=$r;function Wr(r,t,a,u,c){lt=new WebSocket("ws://127.0.0.1:"+r);function i(g){var S={event:a,uuid:g};me.websocketSend(JSON.stringify(S))}lt.onopen=function(){i(t)},lt.onmessage=async function(g){var S=JSON.parse(g.data);let R=S.event,v=S.context,T=S.payload||{},p=T.settings;!p&&R==="sendToPlugin"&&(p=T);let f=p,k=T.coordinates,d=T.userDesiredState;["deviceDidConnect","titleParametersDidChange"].indexOf(R)>=0||(f!=null&&(f=Bt(f)),R=="keyDown"?await me.onKeyDown(v,f,k,d):R=="keyUp"?await me.onKeyUp(v,f,k,d):R=="willAppear"?await me.onWillAppear(v,f,k):f!=null&&(me.refreshSettings(v,f),me.refreshTimer(v,f)))},lt.onclose=function(){},setInterval(async function(){await me.refreshTimers()},3e5)}if(Ur){Hn=!0,me.connect();let r=Bt({digits:0,pair:"LTCUSD",mode:"ticker"}),t="test",a={column:1,row:1},u=null;setTimeout(function(){me.onWillAppear(t,r,a),setInterval(async function(){await me.onKeyDown(t,r,a,u),await me.onKeyUp(t,r,a,u)},5e3)},1e3)}typeof Qt!="undefined"&&(Qt.exports=me);typeof window!="undefined"&&(window.connectElgatoStreamDeckSocket=Wr)});var Kr=be(an()),Yr=be(ln()),Jr=be(Ge()),Xr=be(gt()),Qr=be(Ke()),Zr=be(Je()),ei=be(Qe()),ti=be(bn()),ni=be(Pt()),ri=be(Wt()),ii=be(jt()),si=be(Ht()),oi=be(kn()),ai=be(qt()),ci=be(At()),li=be(Vt()),ui=be(Gt()),hi=be(An()),fi=be(Bn()),pi=be(qn());})();
