"use strict";(()=>{var cr=Object.create;var sn=Object.defineProperty;var lr=Object.getOwnPropertyDescriptor;var ur=Object.getOwnPropertyNames;var hr=Object.getPrototypeOf,fr=Object.prototype.hasOwnProperty;var je=(r=>typeof require!="undefined"?require:typeof Proxy!="undefined"?new Proxy(r,{get:(t,c)=>(typeof require!="undefined"?require:t)[c]}):r)(function(r){if(typeof require!="undefined")return require.apply(this,arguments);throw Error('Dynamic require of "'+r+'" is not supported')});var he=(r,t)=>()=>(t||r((t={exports:{}}).exports,t),t.exports);var pr=(r,t,c,u)=>{if(t&&typeof t=="object"||typeof t=="function")for(let l of ur(t))!fr.call(r,l)&&l!==c&&sn(r,l,{get:()=>t[l],enumerable:!(u=lr(t,l))||u.enumerable});return r};var be=(r,t,c)=>(c=r!=null?cr(hr(r)):{},pr(t||!r||!r.__esModule?sn(c,"default",{value:r,enumerable:!0}):c,r));var an=he((mt,_t)=>{"use strict";var on,pt;on=self,pt=()=>(()=>{var r={d:(I,e)=>{for(var a in e)r.o(e,a)&&!r.o(I,a)&&Object.defineProperty(I,a,{enumerable:!0,get:e[a]})}};r.g=function(){if(typeof globalThis=="object")return globalThis;try{return this||new Function("return this")()}catch{if(typeof window=="object")return window}}(),r.o=(I,e)=>Object.prototype.hasOwnProperty.call(I,e),r.r=I=>{typeof Symbol!="undefined"&&Symbol.toStringTag&&Object.defineProperty(I,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(I,"t",{value:!0})};var t,c={};r.r(c),r.d(c,{AbortError:()=>o,DefaultHttpClient:()=>j,HttpClient:()=>i,HttpError:()=>u,HttpResponse:()=>d,HttpTransportType:()=>Q,HubConnection:()=>pe,HubConnectionBuilder:()=>Ue,HubConnectionState:()=>H,JsonHubProtocol:()=>Fe,LogLevel:()=>t,MessageType:()=>U,NullLogger:()=>g,Subject:()=>ve,TimeoutError:()=>l,TransferFormat:()=>ee,VERSION:()=>M});class u extends Error{constructor(e,a){let b=new.target.prototype;super(`${e}: Status code '${a}'`),this.statusCode=a,this.__proto__=b}}class l extends Error{constructor(e="A timeout occurred."){let a=new.target.prototype;super(e),this.__proto__=a}}class o extends Error{constructor(e="An abort occurred."){let a=new.target.prototype;super(e),this.__proto__=a}}class p extends Error{constructor(e,a){let b=new.target.prototype;super(e),this.transport=a,this.errorType="UnsupportedTransportError",this.__proto__=b}}class k extends Error{constructor(e,a){let b=new.target.prototype;super(e),this.transport=a,this.errorType="DisabledTransportError",this.__proto__=b}}class P extends Error{constructor(e,a){let b=new.target.prototype;super(e),this.transport=a,this.errorType="FailedToStartTransportError",this.__proto__=b}}class v extends Error{constructor(e){let a=new.target.prototype;super(e),this.errorType="FailedToNegotiateWithServerError",this.__proto__=a}}class T extends Error{constructor(e,a){let b=new.target.prototype;super(e),this.innerErrors=a,this.__proto__=b}}class d{constructor(e,a,b){this.statusCode=e,this.statusText=a,this.content=b}}class i{get(e,a){return this.send({...a,method:"GET",url:e})}post(e,a){return this.send({...a,method:"POST",url:e})}delete(e,a){return this.send({...a,method:"DELETE",url:e})}getCookieString(e){return""}}(function(I){I[I.Trace=0]="Trace",I[I.Debug=1]="Debug",I[I.Information=2]="Information",I[I.Warning=3]="Warning",I[I.Error=4]="Error",I[I.Critical=5]="Critical",I[I.None=6]="None"})(t||(t={}));class g{constructor(){}log(e,a){}}g.instance=new g;let M="8.0.0";class A{static isRequired(e,a){if(e==null)throw new Error(`The '${a}' argument is required.`)}static isNotEmpty(e,a){if(!e||e.match(/^\s*$/))throw new Error(`The '${a}' argument should not be empty.`)}static isIn(e,a,b){if(!(e in a))throw new Error(`Unknown ${b} value: ${e}.`)}}class h{static get isBrowser(){return!h.isNode&&typeof window=="object"&&typeof window.document=="object"}static get isWebWorker(){return!h.isNode&&typeof self=="object"&&"importScripts"in self}static get isReactNative(){return!h.isNode&&typeof window=="object"&&window.document===void 0}static get isNode(){return typeof process!="undefined"&&process.release&&process.release.name==="node"}}function f(I,e){let a="";return C(I)?(a=`Binary data of length ${I.byteLength}`,e&&(a+=`. Content: '${function(b){let w=new Uint8Array(b),R="";return w.forEach(D=>{R+=`0x${D<16?"0":""}${D.toString(16)} `}),R.substr(0,R.length-1)}(I)}'`)):typeof I=="string"&&(a=`String data of length ${I.length}`,e&&(a+=`. Content: '${I}'`)),a}function C(I){return I&&typeof ArrayBuffer!="undefined"&&(I instanceof ArrayBuffer||I.constructor&&I.constructor.name==="ArrayBuffer")}async function E(I,e,a,b,w,R){let D={},[B,W]=S();D[B]=W,I.log(t.Trace,`(${e} transport) sending data. ${f(w,R.logMessageContent)}.`);let G=C(w)?"arraybuffer":"text",ne=await a.post(b,{content:w,headers:{...D,...R.headers},responseType:G,timeout:R.timeout,withCredentials:R.withCredentials});I.log(t.Trace,`(${e} transport) request complete. Response status: ${ne.statusCode}.`)}class y{constructor(e,a){this.i=e,this.h=a}dispose(){let e=this.i.observers.indexOf(this.h);e>-1&&this.i.observers.splice(e,1),this.i.observers.length===0&&this.i.cancelCallback&&this.i.cancelCallback().catch(a=>{})}}class O{constructor(e){this.l=e,this.out=console}log(e,a){if(e>=this.l){let b=`[${new Date().toISOString()}] ${t[e]}: ${a}`;switch(e){case t.Critical:case t.Error:this.out.error(b);break;case t.Warning:this.out.warn(b);break;case t.Information:this.out.info(b);break;default:this.out.log(b)}}}}function S(){let I="X-SignalR-User-Agent";return h.isNode&&(I="User-Agent"),[I,L(M,V(),h.isNode?"NodeJS":"Browser",N())]}function L(I,e,a,b){let w="Microsoft SignalR/",R=I.split(".");return w+=`${R[0]}.${R[1]}`,w+=` (${I}; `,w+=e&&e!==""?`${e}; `:"Unknown OS; ",w+=`${a}`,w+=b?`; ${b}`:"; Unknown Runtime Version",w+=")",w}function V(){if(!h.isNode)return"";switch(process.platform){case"win32":return"Windows NT";case"darwin":return"macOS";case"linux":return"Linux";default:return process.platform}}function N(){if(h.isNode)return process.versions.node}function X(I){return I.stack?I.stack:I.message?I.message:`${I}`}class ae extends i{constructor(e){super(),this.u=e,this.p=fetch.bind(function(){if(typeof globalThis!="undefined")return globalThis;if(typeof self!="undefined")return self;if(typeof window!="undefined")return window;if(r.g!==void 0)return r.g;throw new Error("could not find global")}()),this.m=AbortController,this.m}async send(e){if(e.abortSignal&&e.abortSignal.aborted)throw new o;if(!e.method)throw new Error("No method defined.");if(!e.url)throw new Error("No url defined.");let a=new this.m,b;e.abortSignal&&(e.abortSignal.onabort=()=>{a.abort(),b=new o});let w,R=null;if(e.timeout){let W=e.timeout;R=setTimeout(()=>{a.abort(),this.u.log(t.Warning,"Timeout from HTTP request."),b=new l},W)}e.content===""&&(e.content=void 0),e.content&&(e.headers=e.headers||{},C(e.content)?e.headers["Content-Type"]="application/octet-stream":e.headers["Content-Type"]="text/plain;charset=UTF-8");try{w=await this.p(e.url,{body:e.content,cache:"no-cache",credentials:e.withCredentials===!0?"include":"same-origin",headers:{"X-Requested-With":"XMLHttpRequest",...e.headers},method:e.method,mode:"cors",redirect:"follow",signal:a.signal})}catch(W){throw b||(this.u.log(t.Warning,`Error from HTTP request. ${W}.`),W)}finally{R&&clearTimeout(R),e.abortSignal&&(e.abortSignal.onabort=null)}if(!w.ok){let W=await J(w,"text");throw new u(W||w.statusText,w.status)}let D=J(w,e.responseType),B=await D;return new d(w.status,w.statusText,B)}getCookieString(e){let a="";return h.isNode&&this.v&&this.v.getCookies(e,(b,w)=>a=w.join("; ")),a}}function J(I,e){let a;switch(e){case"arraybuffer":a=I.arrayBuffer();break;case"text":default:a=I.text();break;case"blob":case"document":case"json":throw new Error(`${e} is not supported.`)}return a}class re extends i{constructor(e){super(),this.u=e}send(e){return e.abortSignal&&e.abortSignal.aborted?Promise.reject(new o):e.method?e.url?new Promise((a,b)=>{let w=new XMLHttpRequest;w.open(e.method,e.url,!0),w.withCredentials=e.withCredentials===void 0||e.withCredentials,w.setRequestHeader("X-Requested-With","XMLHttpRequest"),e.content===""&&(e.content=void 0),e.content&&(C(e.content)?w.setRequestHeader("Content-Type","application/octet-stream"):w.setRequestHeader("Content-Type","text/plain;charset=UTF-8"));let R=e.headers;R&&Object.keys(R).forEach(D=>{w.setRequestHeader(D,R[D])}),e.responseType&&(w.responseType=e.responseType),e.abortSignal&&(e.abortSignal.onabort=()=>{w.abort(),b(new o)}),e.timeout&&(w.timeout=e.timeout),w.onload=()=>{e.abortSignal&&(e.abortSignal.onabort=null),w.status>=200&&w.status<300?a(new d(w.status,w.statusText,w.response||w.responseText)):b(new u(w.response||w.responseText||w.statusText,w.status))},w.onerror=()=>{this.u.log(t.Warning,`Error from HTTP request. ${w.status}: ${w.statusText}.`),b(new u(w.statusText,w.status))},w.ontimeout=()=>{this.u.log(t.Warning,"Timeout from HTTP request."),b(new l)},w.send(e.content)}):Promise.reject(new Error("No url defined.")):Promise.reject(new Error("No method defined."))}}class j extends i{constructor(e){if(super(),typeof fetch!="undefined"||h.isNode)this.$=new ae(e);else{if(typeof XMLHttpRequest=="undefined")throw new Error("No usable HttpClient found.");this.$=new re(e)}}send(e){return e.abortSignal&&e.abortSignal.aborted?Promise.reject(new o):e.method?e.url?this.$.send(e):Promise.reject(new Error("No url defined.")):Promise.reject(new Error("No method defined."))}getCookieString(e){return this.$.getCookieString(e)}}class q{static write(e){return`${e}${q.RecordSeparator}`}static parse(e){if(e[e.length-1]!==q.RecordSeparator)throw new Error("Message is incomplete.");let a=e.split(q.RecordSeparator);return a.pop(),a}}q.RecordSeparatorCode=30,q.RecordSeparator=String.fromCharCode(q.RecordSeparatorCode);class fe{writeHandshakeRequest(e){return q.write(JSON.stringify(e))}parseHandshakeResponse(e){let a,b;if(C(e)){let D=new Uint8Array(e),B=D.indexOf(q.RecordSeparatorCode);if(B===-1)throw new Error("Message is incomplete.");let W=B+1;a=String.fromCharCode.apply(null,Array.prototype.slice.call(D.slice(0,W))),b=D.byteLength>W?D.slice(W).buffer:null}else{let D=e,B=D.indexOf(q.RecordSeparator);if(B===-1)throw new Error("Message is incomplete.");let W=B+1;a=D.substring(0,W),b=D.length>W?D.substring(W):null}let w=q.parse(a),R=JSON.parse(w[0]);if(R.type)throw new Error("Expected a handshake response from the server.");return[b,R]}}var U,H;(function(I){I[I.Invocation=1]="Invocation",I[I.StreamItem=2]="StreamItem",I[I.Completion=3]="Completion",I[I.StreamInvocation=4]="StreamInvocation",I[I.CancelInvocation=5]="CancelInvocation",I[I.Ping=6]="Ping",I[I.Close=7]="Close",I[I.Ack=8]="Ack",I[I.Sequence=9]="Sequence"})(U||(U={}));class ve{constructor(){this.observers=[]}next(e){for(let a of this.observers)a.next(e)}error(e){for(let a of this.observers)a.error&&a.error(e)}complete(){for(let e of this.observers)e.complete&&e.complete()}subscribe(e){return this.observers.push(e),new y(this,e)}}class Ce{constructor(e,a,b){this.C=1e5,this.S=[],this.k=0,this.P=!1,this.T=1,this.I=0,this._=0,this.H=!1,this.D=e,this.R=a,this.C=b}async A(e){let a=this.D.writeMessage(e),b=Promise.resolve();if(this.U(e)){this.k++;let w=()=>{},R=()=>{};C(a)?this._+=a.byteLength:this._+=a.length,this._>=this.C&&(b=new Promise((D,B)=>{w=D,R=B})),this.S.push(new ye(a,this.k,w,R))}try{this.H||await this.R.send(a)}catch{this.L()}await b}N(e){let a=-1;for(let b=0;b<this.S.length;b++){let w=this.S[b];if(w.q<=e.sequenceId)a=b,C(w.M)?this._-=w.M.byteLength:this._-=w.M.length,w.j();else{if(!(this._<this.C))break;w.j()}}a!==-1&&(this.S=this.S.slice(a+1))}W(e){if(this.P)return e.type===U.Sequence&&(this.P=!1,!0);if(!this.U(e))return!0;let a=this.T;return this.T++,a<=this.I?(a===this.I&&this.O(),!1):(this.I=a,this.O(),!0)}F(e){e.sequenceId>this.T?this.R.stop(new Error("Sequence ID greater than amount of messages we've received.")):this.T=e.sequenceId}L(){this.H=!0,this.P=!0}async B(){let e=this.S.length!==0?this.S[0].q:this.k+1;await this.R.send(this.D.writeMessage({type:U.Sequence,sequenceId:e}));let a=this.S;for(let b of a)await this.R.send(b.M);this.H=!1}X(e){e!=null||(e=new Error("Unable to reconnect to server."));for(let a of this.S)a.J(e)}U(e){switch(e.type){case U.Invocation:case U.StreamItem:case U.Completion:case U.StreamInvocation:case U.CancelInvocation:return!0;case U.Close:case U.Sequence:case U.Ping:case U.Ack:return!1}}O(){this.V===void 0&&(this.V=setTimeout(async()=>{try{this.H||await this.R.send(this.D.writeMessage({type:U.Ack,sequenceId:this.I}))}catch{}clearTimeout(this.V),this.V=void 0},1e3))}}class ye{constructor(e,a,b,w){this.M=e,this.q=a,this.j=b,this.J=w}}(function(I){I.Disconnected="Disconnected",I.Connecting="Connecting",I.Connected="Connected",I.Disconnecting="Disconnecting",I.Reconnecting="Reconnecting"})(H||(H={}));class pe{static create(e,a,b,w,R,D,B){return new pe(e,a,b,w,R,D,B)}constructor(e,a,b,w,R,D,B){this.K=0,this.G=()=>{this.u.log(t.Warning,"The page is being frozen, this will likely lead to the connection being closed and messages being lost. For more information see the docs at https://learn.microsoft.com/aspnet/core/signalr/javascript-client#bsleep")},A.isRequired(e,"connection"),A.isRequired(a,"logger"),A.isRequired(b,"protocol"),this.serverTimeoutInMilliseconds=R!=null?R:3e4,this.keepAliveIntervalInMilliseconds=D!=null?D:15e3,this.Y=B!=null?B:1e5,this.u=a,this.D=b,this.connection=e,this.Z=w,this.tt=new fe,this.connection.onreceive=W=>this.et(W),this.connection.onclose=W=>this.st(W),this.it={},this.nt={},this.rt=[],this.ot=[],this.ht=[],this.ct=0,this.lt=!1,this.ut=H.Disconnected,this.dt=!1,this.ft=this.D.writeMessage({type:U.Ping})}get state(){return this.ut}get connectionId(){return this.connection&&this.connection.connectionId||null}get baseUrl(){return this.connection.baseUrl||""}set baseUrl(e){if(this.ut!==H.Disconnected&&this.ut!==H.Reconnecting)throw new Error("The HubConnection must be in the Disconnected or Reconnecting state to change the url.");if(!e)throw new Error("The HubConnection url must be a valid url.");this.connection.baseUrl=e}start(){return this.wt=this.gt(),this.wt}async gt(){if(this.ut!==H.Disconnected)return Promise.reject(new Error("Cannot start a HubConnection that is not in the 'Disconnected' state."));this.ut=H.Connecting,this.u.log(t.Debug,"Starting HubConnection.");try{await this.yt(),h.isBrowser&&window.document.addEventListener("freeze",this.G),this.ut=H.Connected,this.dt=!0,this.u.log(t.Debug,"HubConnection connected successfully.")}catch(e){return this.ut=H.Disconnected,this.u.log(t.Debug,`HubConnection failed to start successfully because of error '${e}'.`),Promise.reject(e)}}async yt(){this.bt=void 0,this.lt=!1;let e=new Promise((a,b)=>{this.vt=a,this.Et=b});await this.connection.start(this.D.transferFormat);try{let a=this.D.version;this.connection.features.reconnect||(a=1);let b={protocol:this.D.name,version:a};if(this.u.log(t.Debug,"Sending handshake request."),await this.$t(this.tt.writeHandshakeRequest(b)),this.u.log(t.Information,`Using HubProtocol '${this.D.name}'.`),this.Ct(),this.St(),this.kt(),await e,this.bt)throw this.bt;this.connection.features.reconnect&&(this.Pt=new Ce(this.D,this.connection,this.Y),this.connection.features.disconnected=this.Pt.L.bind(this.Pt),this.connection.features.resend=()=>{if(this.Pt)return this.Pt.B()}),this.connection.features.inherentKeepAlive||await this.$t(this.ft)}catch(a){throw this.u.log(t.Debug,`Hub handshake failed with error '${a}' during start(). Stopping HubConnection.`),this.Ct(),this.Tt(),await this.connection.stop(a),a}}async stop(){let e=this.wt;this.connection.features.reconnect=!1,this.It=this._t(),await this.It;try{await e}catch{}}_t(e){if(this.ut===H.Disconnected)return this.u.log(t.Debug,`Call to HubConnection.stop(${e}) ignored because it is already in the disconnected state.`),Promise.resolve();if(this.ut===H.Disconnecting)return this.u.log(t.Debug,`Call to HttpConnection.stop(${e}) ignored because the connection is already in the disconnecting state.`),this.It;let a=this.ut;return this.ut=H.Disconnecting,this.u.log(t.Debug,"Stopping HubConnection."),this.Ht?(this.u.log(t.Debug,"Connection stopped during reconnect delay. Done reconnecting."),clearTimeout(this.Ht),this.Ht=void 0,this.Dt(),Promise.resolve()):(a===H.Connected&&this.Rt(),this.Ct(),this.Tt(),this.bt=e||new o("The connection was stopped before the hub handshake could complete."),this.connection.stop(e))}async Rt(){try{await this.xt(this.At())}catch{}}stream(e,...a){let[b,w]=this.Ut(a),R=this.Lt(e,a,w),D,B=new ve;return B.cancelCallback=()=>{let W=this.Nt(R.invocationId);return delete this.it[R.invocationId],D.then(()=>this.xt(W))},this.it[R.invocationId]=(W,G)=>{G?B.error(G):W&&(W.type===U.Completion?W.error?B.error(new Error(W.error)):B.complete():B.next(W.item))},D=this.xt(R).catch(W=>{B.error(W),delete this.it[R.invocationId]}),this.qt(b,D),B}$t(e){return this.kt(),this.connection.send(e)}xt(e){return this.Pt?this.Pt.A(e):this.$t(this.D.writeMessage(e))}send(e,...a){let[b,w]=this.Ut(a),R=this.xt(this.Mt(e,a,!0,w));return this.qt(b,R),R}invoke(e,...a){let[b,w]=this.Ut(a),R=this.Mt(e,a,!1,w);return new Promise((D,B)=>{this.it[R.invocationId]=(G,ne)=>{ne?B(ne):G&&(G.type===U.Completion?G.error?B(new Error(G.error)):D(G.result):B(new Error(`Unexpected message type: ${G.type}`)))};let W=this.xt(R).catch(G=>{B(G),delete this.it[R.invocationId]});this.qt(b,W)})}on(e,a){e&&a&&(e=e.toLowerCase(),this.nt[e]||(this.nt[e]=[]),this.nt[e].indexOf(a)===-1&&this.nt[e].push(a))}off(e,a){if(!e)return;e=e.toLowerCase();let b=this.nt[e];if(b)if(a){let w=b.indexOf(a);w!==-1&&(b.splice(w,1),b.length===0&&delete this.nt[e])}else delete this.nt[e]}onclose(e){e&&this.rt.push(e)}onreconnecting(e){e&&this.ot.push(e)}onreconnected(e){e&&this.ht.push(e)}et(e){if(this.Ct(),this.lt||(e=this.jt(e),this.lt=!0),e){let a=this.D.parseMessages(e,this.u);for(let b of a)if(!this.Pt||this.Pt.W(b))switch(b.type){case U.Invocation:this.Wt(b);break;case U.StreamItem:case U.Completion:{let w=this.it[b.invocationId];if(w){b.type===U.Completion&&delete this.it[b.invocationId];try{w(b)}catch(R){this.u.log(t.Error,`Stream callback threw error: ${X(R)}`)}}break}case U.Ping:break;case U.Close:{this.u.log(t.Information,"Close message received from server.");let w=b.error?new Error("Server returned an error on close: "+b.error):void 0;b.allowReconnect===!0?this.connection.stop(w):this.It=this._t(w);break}case U.Ack:this.Pt&&this.Pt.N(b);break;case U.Sequence:this.Pt&&this.Pt.F(b);break;default:this.u.log(t.Warning,`Invalid message type: ${b.type}.`)}}this.St()}jt(e){let a,b;try{[b,a]=this.tt.parseHandshakeResponse(e)}catch(w){let R="Error parsing handshake response: "+w;this.u.log(t.Error,R);let D=new Error(R);throw this.Et(D),D}if(a.error){let w="Server returned handshake error: "+a.error;this.u.log(t.Error,w);let R=new Error(w);throw this.Et(R),R}return this.u.log(t.Debug,"Server handshake complete."),this.vt(),b}kt(){this.connection.features.inherentKeepAlive||(this.K=new Date().getTime()+this.keepAliveIntervalInMilliseconds,this.Tt())}St(){if(!(this.connection.features&&this.connection.features.inherentKeepAlive||(this.Ot=setTimeout(()=>this.serverTimeout(),this.serverTimeoutInMilliseconds),this.Ft!==void 0))){let e=this.K-new Date().getTime();e<0&&(e=0),this.Ft=setTimeout(async()=>{if(this.ut===H.Connected)try{await this.$t(this.ft)}catch{this.Tt()}},e)}}serverTimeout(){this.connection.stop(new Error("Server timeout elapsed without receiving a message from the server."))}async Wt(e){let a=e.target.toLowerCase(),b=this.nt[a];if(!b)return this.u.log(t.Warning,`No client method with the name '${a}' found.`),void(e.invocationId&&(this.u.log(t.Warning,`No result given for '${a}' method and invocation ID '${e.invocationId}'.`),await this.xt(this.Bt(e.invocationId,"Client didn't provide a result.",null))));let w=b.slice(),R=!!e.invocationId,D,B,W;for(let G of w)try{let ne=D;D=await G.apply(this,e.arguments),R&&D&&ne&&(this.u.log(t.Error,`Multiple results provided for '${a}'. Sending error to server.`),W=this.Bt(e.invocationId,"Client provided multiple results.",null)),B=void 0}catch(ne){B=ne,this.u.log(t.Error,`A callback for the method '${a}' threw error '${ne}'.`)}W?await this.xt(W):R?(B?W=this.Bt(e.invocationId,`${B}`,null):D!==void 0?W=this.Bt(e.invocationId,null,D):(this.u.log(t.Warning,`No result given for '${a}' method and invocation ID '${e.invocationId}'.`),W=this.Bt(e.invocationId,"Client didn't provide a result.",null)),await this.xt(W)):D&&this.u.log(t.Error,`Result given for '${a}' method but server is not expecting a result.`)}st(e){this.u.log(t.Debug,`HubConnection.connectionClosed(${e}) called while in state ${this.ut}.`),this.bt=this.bt||e||new o("The underlying connection was closed before the hub handshake could complete."),this.vt&&this.vt(),this.Xt(e||new Error("Invocation canceled due to the underlying connection being closed.")),this.Ct(),this.Tt(),this.ut===H.Disconnecting?this.Dt(e):this.ut===H.Connected&&this.Z?this.Jt(e):this.ut===H.Connected&&this.Dt(e)}Dt(e){if(this.dt){this.ut=H.Disconnected,this.dt=!1,this.Pt&&(this.Pt.X(e!=null?e:new Error("Connection closed.")),this.Pt=void 0),h.isBrowser&&window.document.removeEventListener("freeze",this.G);try{this.rt.forEach(a=>a.apply(this,[e]))}catch(a){this.u.log(t.Error,`An onclose callback called with error '${e}' threw error '${a}'.`)}}}async Jt(e){let a=Date.now(),b=0,w=e!==void 0?e:new Error("Attempting to reconnect due to a unknown error."),R=this.zt(b++,0,w);if(R===null)return this.u.log(t.Debug,"Connection not reconnecting because the IRetryPolicy returned null on the first reconnect attempt."),void this.Dt(e);if(this.ut=H.Reconnecting,e?this.u.log(t.Information,`Connection reconnecting because of error '${e}'.`):this.u.log(t.Information,"Connection reconnecting."),this.ot.length!==0){try{this.ot.forEach(D=>D.apply(this,[e]))}catch(D){this.u.log(t.Error,`An onreconnecting callback called with error '${e}' threw error '${D}'.`)}if(this.ut!==H.Reconnecting)return void this.u.log(t.Debug,"Connection left the reconnecting state in onreconnecting callback. Done reconnecting.")}for(;R!==null;){if(this.u.log(t.Information,`Reconnect attempt number ${b} will start in ${R} ms.`),await new Promise(D=>{this.Ht=setTimeout(D,R)}),this.Ht=void 0,this.ut!==H.Reconnecting)return void this.u.log(t.Debug,"Connection left the reconnecting state during reconnect delay. Done reconnecting.");try{if(await this.yt(),this.ut=H.Connected,this.u.log(t.Information,"HubConnection reconnected successfully."),this.ht.length!==0)try{this.ht.forEach(D=>D.apply(this,[this.connection.connectionId]))}catch(D){this.u.log(t.Error,`An onreconnected callback called with connectionId '${this.connection.connectionId}; threw error '${D}'.`)}return}catch(D){if(this.u.log(t.Information,`Reconnect attempt failed because of error '${D}'.`),this.ut!==H.Reconnecting)return this.u.log(t.Debug,`Connection moved to the '${this.ut}' from the reconnecting state during reconnect attempt. Done reconnecting.`),void(this.ut===H.Disconnecting&&this.Dt());w=D instanceof Error?D:new Error(D.toString()),R=this.zt(b++,Date.now()-a,w)}}this.u.log(t.Information,`Reconnect retries have been exhausted after ${Date.now()-a} ms and ${b} failed attempts. Connection disconnecting.`),this.Dt()}zt(e,a,b){try{return this.Z.nextRetryDelayInMilliseconds({elapsedMilliseconds:a,previousRetryCount:e,retryReason:b})}catch(w){return this.u.log(t.Error,`IRetryPolicy.nextRetryDelayInMilliseconds(${e}, ${a}) threw error '${w}'.`),null}}Xt(e){let a=this.it;this.it={},Object.keys(a).forEach(b=>{let w=a[b];try{w(null,e)}catch(R){this.u.log(t.Error,`Stream 'error' callback called with '${e}' threw error: ${X(R)}`)}})}Tt(){this.Ft&&(clearTimeout(this.Ft),this.Ft=void 0)}Ct(){this.Ot&&clearTimeout(this.Ot)}Mt(e,a,b,w){if(b)return w.length!==0?{arguments:a,streamIds:w,target:e,type:U.Invocation}:{arguments:a,target:e,type:U.Invocation};{let R=this.ct;return this.ct++,w.length!==0?{arguments:a,invocationId:R.toString(),streamIds:w,target:e,type:U.Invocation}:{arguments:a,invocationId:R.toString(),target:e,type:U.Invocation}}}qt(e,a){if(e.length!==0){a||(a=Promise.resolve());for(let b in e)e[b].subscribe({complete:()=>{a=a.then(()=>this.xt(this.Bt(b)))},error:w=>{let R;R=w instanceof Error?w.message:w&&w.toString?w.toString():"Unknown error",a=a.then(()=>this.xt(this.Bt(b,R)))},next:w=>{a=a.then(()=>this.xt(this.Vt(b,w)))}})}}Ut(e){let a=[],b=[];for(let w=0;w<e.length;w++){let R=e[w];if(this.Kt(R)){let D=this.ct;this.ct++,a[D]=R,b.push(D.toString()),e.splice(w,1)}}return[a,b]}Kt(e){return e&&e.subscribe&&typeof e.subscribe=="function"}Lt(e,a,b){let w=this.ct;return this.ct++,b.length!==0?{arguments:a,invocationId:w.toString(),streamIds:b,target:e,type:U.StreamInvocation}:{arguments:a,invocationId:w.toString(),target:e,type:U.StreamInvocation}}Nt(e){return{invocationId:e,type:U.CancelInvocation}}Vt(e,a){return{invocationId:e,item:a,type:U.StreamItem}}Bt(e,a,b){return a?{error:a,invocationId:e,type:U.Completion}:{invocationId:e,result:b,type:U.Completion}}At(){return{type:U.Close}}}let Z=[0,2e3,1e4,3e4,null];class Te{constructor(e){this.Gt=e!==void 0?[...e,null]:Z}nextRetryDelayInMilliseconds(e){return this.Gt[e.previousRetryCount]}}class Y{}Y.Authorization="Authorization",Y.Cookie="Cookie";class Ee extends i{constructor(e,a){super(),this.Qt=e,this.Yt=a}async send(e){let a=!0;this.Yt&&(!this.Zt||e.url&&e.url.indexOf("/negotiate?")>0)&&(a=!1,this.Zt=await this.Yt()),this.te(e);let b=await this.Qt.send(e);return a&&b.statusCode===401&&this.Yt?(this.Zt=await this.Yt(),this.te(e),await this.Qt.send(e)):b}te(e){e.headers||(e.headers={}),this.Zt?e.headers[Y.Authorization]=`Bearer ${this.Zt}`:this.Yt&&e.headers[Y.Authorization]&&delete e.headers[Y.Authorization]}getCookieString(e){return this.Qt.getCookieString(e)}}var Q,ee;(function(I){I[I.None=0]="None",I[I.WebSockets=1]="WebSockets",I[I.ServerSentEvents=2]="ServerSentEvents",I[I.LongPolling=4]="LongPolling"})(Q||(Q={})),function(I){I[I.Text=1]="Text",I[I.Binary=2]="Binary"}(ee||(ee={}));class Oe{constructor(){this.ee=!1,this.onabort=null}abort(){this.ee||(this.ee=!0,this.onabort&&this.onabort())}get signal(){return this}get aborted(){return this.ee}}class Le{get pollAborted(){return this.se.aborted}constructor(e,a,b){this.$=e,this.u=a,this.se=new Oe,this.ie=b,this.ne=!1,this.onreceive=null,this.onclose=null}async connect(e,a){if(A.isRequired(e,"url"),A.isRequired(a,"transferFormat"),A.isIn(a,ee,"transferFormat"),this.re=e,this.u.log(t.Trace,"(LongPolling transport) Connecting."),a===ee.Binary&&typeof XMLHttpRequest!="undefined"&&typeof new XMLHttpRequest().responseType!="string")throw new Error("Binary protocols over XmlHttpRequest not implementing advanced features are not supported.");let[b,w]=S(),R={[b]:w,...this.ie.headers},D={abortSignal:this.se.signal,headers:R,timeout:1e5,withCredentials:this.ie.withCredentials};a===ee.Binary&&(D.responseType="arraybuffer");let B=`${e}&_=${Date.now()}`;this.u.log(t.Trace,`(LongPolling transport) polling: ${B}.`);let W=await this.$.get(B,D);W.statusCode!==200?(this.u.log(t.Error,`(LongPolling transport) Unexpected response code: ${W.statusCode}.`),this.oe=new u(W.statusText||"",W.statusCode),this.ne=!1):this.ne=!0,this.he=this.ce(this.re,D)}async ce(e,a){try{for(;this.ne;)try{let b=`${e}&_=${Date.now()}`;this.u.log(t.Trace,`(LongPolling transport) polling: ${b}.`);let w=await this.$.get(b,a);w.statusCode===204?(this.u.log(t.Information,"(LongPolling transport) Poll terminated by server."),this.ne=!1):w.statusCode!==200?(this.u.log(t.Error,`(LongPolling transport) Unexpected response code: ${w.statusCode}.`),this.oe=new u(w.statusText||"",w.statusCode),this.ne=!1):w.content?(this.u.log(t.Trace,`(LongPolling transport) data received. ${f(w.content,this.ie.logMessageContent)}.`),this.onreceive&&this.onreceive(w.content)):this.u.log(t.Trace,"(LongPolling transport) Poll timed out, reissuing.")}catch(b){this.ne?b instanceof l?this.u.log(t.Trace,"(LongPolling transport) Poll timed out, reissuing."):(this.oe=b,this.ne=!1):this.u.log(t.Trace,`(LongPolling transport) Poll errored after shutdown: ${b.message}`)}}finally{this.u.log(t.Trace,"(LongPolling transport) Polling complete."),this.pollAborted||this.ae()}}async send(e){return this.ne?E(this.u,"LongPolling",this.$,this.re,e,this.ie):Promise.reject(new Error("Cannot send until the transport is connected"))}async stop(){this.u.log(t.Trace,"(LongPolling transport) Stopping polling."),this.ne=!1,this.se.abort();try{await this.he,this.u.log(t.Trace,`(LongPolling transport) sending DELETE request to ${this.re}.`);let e={},[a,b]=S();e[a]=b;let w={headers:{...e,...this.ie.headers},timeout:this.ie.timeout,withCredentials:this.ie.withCredentials},R;try{await this.$.delete(this.re,w)}catch(D){R=D}R?R instanceof u&&(R.statusCode===404?this.u.log(t.Trace,"(LongPolling transport) A 404 response was returned from sending a DELETE request."):this.u.log(t.Trace,`(LongPolling transport) Error sending a DELETE request: ${R}`)):this.u.log(t.Trace,"(LongPolling transport) DELETE request accepted.")}finally{this.u.log(t.Trace,"(LongPolling transport) Stop finished."),this.ae()}}ae(){if(this.onclose){let e="(LongPolling transport) Firing onclose event.";this.oe&&(e+=" Error: "+this.oe),this.u.log(t.Trace,e),this.onclose(this.oe)}}}class _e{constructor(e,a,b,w){this.$=e,this.Zt=a,this.u=b,this.ie=w,this.onreceive=null,this.onclose=null}async connect(e,a){return A.isRequired(e,"url"),A.isRequired(a,"transferFormat"),A.isIn(a,ee,"transferFormat"),this.u.log(t.Trace,"(SSE transport) Connecting."),this.re=e,this.Zt&&(e+=(e.indexOf("?")<0?"?":"&")+`access_token=${encodeURIComponent(this.Zt)}`),new Promise((b,w)=>{let R,D=!1;if(a===ee.Text){if(h.isBrowser||h.isWebWorker)R=new this.ie.EventSource(e,{withCredentials:this.ie.withCredentials});else{let B=this.$.getCookieString(e),W={};W.Cookie=B;let[G,ne]=S();W[G]=ne,R=new this.ie.EventSource(e,{withCredentials:this.ie.withCredentials,headers:{...W,...this.ie.headers}})}try{R.onmessage=B=>{if(this.onreceive)try{this.u.log(t.Trace,`(SSE transport) data received. ${f(B.data,this.ie.logMessageContent)}.`),this.onreceive(B.data)}catch(W){return void this.le(W)}},R.onerror=B=>{D?this.le():w(new Error("EventSource failed to connect. The connection could not be found on the server, either the connection ID is not present on the server, or a proxy is refusing/buffering the connection. If you have multiple servers check that sticky sessions are enabled."))},R.onopen=()=>{this.u.log(t.Information,`SSE connected to ${this.re}`),this.ue=R,D=!0,b()}}catch(B){return void w(B)}}else w(new Error("The Server-Sent Events transport only supports the 'Text' transfer format"))})}async send(e){return this.ue?E(this.u,"SSE",this.$,this.re,e,this.ie):Promise.reject(new Error("Cannot send until the transport is connected"))}stop(){return this.le(),Promise.resolve()}le(e){this.ue&&(this.ue.close(),this.ue=void 0,this.onclose&&this.onclose(e))}}class Ne{constructor(e,a,b,w,R,D){this.u=b,this.Yt=a,this.de=w,this.fe=R,this.$=e,this.onreceive=null,this.onclose=null,this.pe=D}async connect(e,a){let b;return A.isRequired(e,"url"),A.isRequired(a,"transferFormat"),A.isIn(a,ee,"transferFormat"),this.u.log(t.Trace,"(WebSockets transport) Connecting."),this.Yt&&(b=await this.Yt()),new Promise((w,R)=>{let D;e=e.replace(/^http/,"ws");let B=this.$.getCookieString(e),W=!1;if(h.isNode||h.isReactNative){let G={},[ne,De]=S();G[ne]=De,b&&(G[Y.Authorization]=`Bearer ${b}`),B&&(G[Y.Cookie]=B),D=new this.fe(e,void 0,{headers:{...G,...this.pe}})}else b&&(e+=(e.indexOf("?")<0?"?":"&")+`access_token=${encodeURIComponent(b)}`);D||(D=new this.fe(e)),a===ee.Binary&&(D.binaryType="arraybuffer"),D.onopen=G=>{this.u.log(t.Information,`WebSocket connected to ${e}.`),this.we=D,W=!0,w()},D.onerror=G=>{let ne=null;ne=typeof ErrorEvent!="undefined"&&G instanceof ErrorEvent?G.error:"There was an error with the transport",this.u.log(t.Information,`(WebSockets transport) ${ne}.`)},D.onmessage=G=>{if(this.u.log(t.Trace,`(WebSockets transport) data received. ${f(G.data,this.de)}.`),this.onreceive)try{this.onreceive(G.data)}catch(ne){return void this.le(ne)}},D.onclose=G=>{if(W)this.le(G);else{let ne=null;ne=typeof ErrorEvent!="undefined"&&G instanceof ErrorEvent?G.error:"WebSocket failed to connect. The connection could not be found on the server, either the endpoint may not be a SignalR endpoint, the connection ID is not present on the server, or there is a proxy blocking WebSockets. If you have multiple servers check that sticky sessions are enabled.",R(new Error(ne))}}})}send(e){return this.we&&this.we.readyState===this.fe.OPEN?(this.u.log(t.Trace,`(WebSockets transport) sending data. ${f(e,this.de)}.`),this.we.send(e),Promise.resolve()):Promise.reject("WebSocket is not in the OPEN state")}stop(){return this.we&&this.le(void 0),Promise.resolve()}le(e){this.we&&(this.we.onclose=()=>{},this.we.onmessage=()=>{},this.we.onerror=()=>{},this.we.close(),this.we=void 0),this.u.log(t.Trace,"(WebSockets transport) socket closed."),this.onclose&&(!this.ge(e)||e.wasClean!==!1&&e.code===1e3?e instanceof Error?this.onclose(e):this.onclose():this.onclose(new Error(`WebSocket closed with status code: ${e.code} (${e.reason||"no reason given"}).`)))}ge(e){return e&&typeof e.wasClean=="boolean"&&typeof e.code=="number"}}class Se{constructor(e,a={}){var b;if(this.me=()=>{},this.features={},this.ye=1,A.isRequired(e,"url"),this.u=(b=a.logger)===void 0?new O(t.Information):b===null?g.instance:b.log!==void 0?b:new O(b),this.baseUrl=this.be(e),(a=a||{}).logMessageContent=a.logMessageContent!==void 0&&a.logMessageContent,typeof a.withCredentials!="boolean"&&a.withCredentials!==void 0)throw new Error("withCredentials option was not a 'boolean' or 'undefined' value");a.withCredentials=a.withCredentials===void 0||a.withCredentials,a.timeout=a.timeout===void 0?1e5:a.timeout;let w=null,R=null;h.isNode&&(w=function(){throw new Error("Trying to import 'ws' in the browser.")}(),R=function(){throw new Error("Trying to import 'eventsource' in the browser.")}()),h.isNode||typeof WebSocket=="undefined"||a.WebSocket?h.isNode&&!a.WebSocket&&w&&(a.WebSocket=w):a.WebSocket=WebSocket,h.isNode||typeof EventSource=="undefined"||a.EventSource?h.isNode&&!a.EventSource&&R!==void 0&&(a.EventSource=R):a.EventSource=EventSource,this.$=new Ee(a.httpClient||new j(this.u),a.accessTokenFactory),this.ut="Disconnected",this.dt=!1,this.ie=a,this.onreceive=null,this.onclose=null}async start(e){if(e=e||ee.Binary,A.isIn(e,ee,"transferFormat"),this.u.log(t.Debug,`Starting connection with transfer format '${ee[e]}'.`),this.ut!=="Disconnected")return Promise.reject(new Error("Cannot start an HttpConnection that is not in the 'Disconnected' state."));if(this.ut="Connecting",this.ve=this.yt(e),await this.ve,this.ut==="Disconnecting"){let a="Failed to start the HttpConnection before stop() was called.";return this.u.log(t.Error,a),await this.It,Promise.reject(new o(a))}if(this.ut!=="Connected"){let a="HttpConnection.startInternal completed gracefully but didn't enter the connection into the connected state!";return this.u.log(t.Error,a),Promise.reject(new o(a))}this.dt=!0}send(e){return this.ut!=="Connected"?Promise.reject(new Error("Cannot send data if the connection is not in the 'Connected' State.")):(this.Ee||(this.Ee=new ce(this.transport)),this.Ee.send(e))}async stop(e){return this.ut==="Disconnected"?(this.u.log(t.Debug,`Call to HttpConnection.stop(${e}) ignored because the connection is already in the disconnected state.`),Promise.resolve()):this.ut==="Disconnecting"?(this.u.log(t.Debug,`Call to HttpConnection.stop(${e}) ignored because the connection is already in the disconnecting state.`),this.It):(this.ut="Disconnecting",this.It=new Promise(a=>{this.me=a}),await this._t(e),void await this.It)}async _t(e){this.$e=e;try{await this.ve}catch{}if(this.transport){try{await this.transport.stop()}catch(a){this.u.log(t.Error,`HttpConnection.transport.stop() threw error '${a}'.`),this.Ce()}this.transport=void 0}else this.u.log(t.Debug,"HttpConnection.transport is undefined in HttpConnection.stop() because start() failed.")}async yt(e){let a=this.baseUrl;this.Yt=this.ie.accessTokenFactory,this.$.Yt=this.Yt;try{if(this.ie.skipNegotiation){if(this.ie.transport!==Q.WebSockets)throw new Error("Negotiation can only be skipped when using the WebSocket transport directly.");this.transport=this.Se(Q.WebSockets),await this.ke(a,e)}else{let b=null,w=0;do{if(b=await this.Pe(a),this.ut==="Disconnecting"||this.ut==="Disconnected")throw new o("The connection was stopped during negotiation.");if(b.error)throw new Error(b.error);if(b.ProtocolVersion)throw new Error("Detected a connection attempt to an ASP.NET SignalR Server. This client only supports connecting to an ASP.NET Core SignalR Server. See https://aka.ms/signalr-core-differences for details.");if(b.url&&(a=b.url),b.accessToken){let R=b.accessToken;this.Yt=()=>R,this.$.Zt=R,this.$.Yt=void 0}w++}while(b.url&&w<100);if(w===100&&b.url)throw new Error("Negotiate redirection limit exceeded.");await this.Te(a,this.ie.transport,b,e)}this.transport instanceof Le&&(this.features.inherentKeepAlive=!0),this.ut==="Connecting"&&(this.u.log(t.Debug,"The HttpConnection connected successfully."),this.ut="Connected")}catch(b){return this.u.log(t.Error,"Failed to start the connection: "+b),this.ut="Disconnected",this.transport=void 0,this.me(),Promise.reject(b)}}async Pe(e){let a={},[b,w]=S();a[b]=w;let R=this.Ie(e);this.u.log(t.Debug,`Sending negotiation request: ${R}.`);try{let D=await this.$.post(R,{content:"",headers:{...a,...this.ie.headers},timeout:this.ie.timeout,withCredentials:this.ie.withCredentials});if(D.statusCode!==200)return Promise.reject(new Error(`Unexpected status code returned from negotiate '${D.statusCode}'`));let B=JSON.parse(D.content);return(!B.negotiateVersion||B.negotiateVersion<1)&&(B.connectionToken=B.connectionId),B.useStatefulReconnect&&this.ie._e!==!0?Promise.reject(new v("Client didn't negotiate Stateful Reconnect but the server did.")):B}catch(D){let B="Failed to complete negotiation with the server: "+D;return D instanceof u&&D.statusCode===404&&(B+=" Either this is not a SignalR endpoint or there is a proxy blocking the connection."),this.u.log(t.Error,B),Promise.reject(new v(B))}}He(e,a){return a?e+(e.indexOf("?")===-1?"?":"&")+`id=${a}`:e}async Te(e,a,b,w){let R=this.He(e,b.connectionToken);if(this.De(a))return this.u.log(t.Debug,"Connection was provided an instance of ITransport, using that directly."),this.transport=a,await this.ke(R,w),void(this.connectionId=b.connectionId);let D=[],B=b.availableTransports||[],W=b;for(let G of B){let ne=this.Re(G,a,w,(W==null?void 0:W.useStatefulReconnect)===!0);if(ne instanceof Error)D.push(`${G.transport} failed:`),D.push(ne);else if(this.De(ne)){if(this.transport=ne,!W){try{W=await this.Pe(e)}catch(De){return Promise.reject(De)}R=this.He(e,W.connectionToken)}try{return await this.ke(R,w),void(this.connectionId=W.connectionId)}catch(De){if(this.u.log(t.Error,`Failed to start the transport '${G.transport}': ${De}`),W=void 0,D.push(new P(`${G.transport} failed: ${De}`,Q[G.transport])),this.ut!=="Connecting"){let Ve="Failed to select transport before stop() was called.";return this.u.log(t.Debug,Ve),Promise.reject(new o(Ve))}}}}return D.length>0?Promise.reject(new T(`Unable to connect to the server with any of the available transports. ${D.join(" ")}`,D)):Promise.reject(new Error("None of the transports supported by the client are supported by the server."))}Se(e){switch(e){case Q.WebSockets:if(!this.ie.WebSocket)throw new Error("'WebSocket' is not supported in your environment.");return new Ne(this.$,this.Yt,this.u,this.ie.logMessageContent,this.ie.WebSocket,this.ie.headers||{});case Q.ServerSentEvents:if(!this.ie.EventSource)throw new Error("'EventSource' is not supported in your environment.");return new _e(this.$,this.$.Zt,this.u,this.ie);case Q.LongPolling:return new Le(this.$,this.u,this.ie);default:throw new Error(`Unknown transport: ${e}.`)}}ke(e,a){return this.transport.onreceive=this.onreceive,this.features.reconnect?this.transport.onclose=async b=>{let w=!1;if(this.features.reconnect){try{this.features.disconnected(),await this.transport.connect(e,a),await this.features.resend()}catch{w=!0}w&&this.Ce(b)}else this.Ce(b)}:this.transport.onclose=b=>this.Ce(b),this.transport.connect(e,a)}Re(e,a,b,w){let R=Q[e.transport];if(R==null)return this.u.log(t.Debug,`Skipping transport '${e.transport}' because it is not supported by this client.`),new Error(`Skipping transport '${e.transport}' because it is not supported by this client.`);if(!function(D,B){return!D||(B&D)!=0}(a,R))return this.u.log(t.Debug,`Skipping transport '${Q[R]}' because it was disabled by the client.`),new k(`'${Q[R]}' is disabled by the client.`,R);if(!(e.transferFormats.map(D=>ee[D]).indexOf(b)>=0))return this.u.log(t.Debug,`Skipping transport '${Q[R]}' because it does not support the requested transfer format '${ee[b]}'.`),new Error(`'${Q[R]}' does not support ${ee[b]}.`);if(R===Q.WebSockets&&!this.ie.WebSocket||R===Q.ServerSentEvents&&!this.ie.EventSource)return this.u.log(t.Debug,`Skipping transport '${Q[R]}' because it is not supported in your environment.'`),new p(`'${Q[R]}' is not supported in your environment.`,R);this.u.log(t.Debug,`Selecting transport '${Q[R]}'.`);try{return this.features.reconnect=R===Q.WebSockets?w:void 0,this.Se(R)}catch(D){return D}}De(e){return e&&typeof e=="object"&&"connect"in e}Ce(e){if(this.u.log(t.Debug,`HttpConnection.stopConnection(${e}) called while in state ${this.ut}.`),this.transport=void 0,e=this.$e||e,this.$e=void 0,this.ut!=="Disconnected"){if(this.ut==="Connecting")throw this.u.log(t.Warning,`Call to HttpConnection.stopConnection(${e}) was ignored because the connection is still in the connecting state.`),new Error(`HttpConnection.stopConnection(${e}) was called while the connection is still in the connecting state.`);if(this.ut==="Disconnecting"&&this.me(),e?this.u.log(t.Error,`Connection disconnected with error '${e}'.`):this.u.log(t.Information,"Connection disconnected."),this.Ee&&(this.Ee.stop().catch(a=>{this.u.log(t.Error,`TransportSendQueue.stop() threw error '${a}'.`)}),this.Ee=void 0),this.connectionId=void 0,this.ut="Disconnected",this.dt){this.dt=!1;try{this.onclose&&this.onclose(e)}catch(a){this.u.log(t.Error,`HttpConnection.onclose(${e}) threw error '${a}'.`)}}}else this.u.log(t.Debug,`Call to HttpConnection.stopConnection(${e}) was ignored because the connection is already in the disconnected state.`)}be(e){if(e.lastIndexOf("https://",0)===0||e.lastIndexOf("http://",0)===0)return e;if(!h.isBrowser)throw new Error(`Cannot resolve '${e}'.`);let a=window.document.createElement("a");return a.href=e,this.u.log(t.Information,`Normalizing '${e}' to '${a.href}'.`),a.href}Ie(e){let a=new URL(e);a.pathname.endsWith("/")?a.pathname+="negotiate":a.pathname+="/negotiate";let b=new URLSearchParams(a.searchParams);return b.has("negotiateVersion")||b.append("negotiateVersion",this.ye.toString()),b.has("useStatefulReconnect")?b.get("useStatefulReconnect")==="true"&&(this.ie._e=!0):this.ie._e===!0&&b.append("useStatefulReconnect","true"),a.search=b.toString(),a.toString()}}class ce{constructor(e){this.xe=e,this.Ae=[],this.Ue=!0,this.Le=new Ie,this.Ne=new Ie,this.qe=this.Me()}send(e){return this.je(e),this.Ne||(this.Ne=new Ie),this.Ne.promise}stop(){return this.Ue=!1,this.Le.resolve(),this.qe}je(e){if(this.Ae.length&&typeof this.Ae[0]!=typeof e)throw new Error(`Expected data to be of type ${typeof this.Ae} but was of type ${typeof e}`);this.Ae.push(e),this.Le.resolve()}async Me(){for(;;){if(await this.Le.promise,!this.Ue){this.Ne&&this.Ne.reject("Connection stopped.");break}this.Le=new Ie;let e=this.Ne;this.Ne=void 0;let a=typeof this.Ae[0]=="string"?this.Ae.join(""):ce.We(this.Ae);this.Ae.length=0;try{await this.xe.send(a),e.resolve()}catch(b){e.reject(b)}}}static We(e){let a=e.map(R=>R.byteLength).reduce((R,D)=>R+D),b=new Uint8Array(a),w=0;for(let R of e)b.set(new Uint8Array(R),w),w+=R.byteLength;return b.buffer}}class Ie{constructor(){this.promise=new Promise((e,a)=>[this.j,this.Oe]=[e,a])}resolve(){this.j()}reject(e){this.Oe(e)}}class Fe{constructor(){this.name="json",this.version=2,this.transferFormat=ee.Text}parseMessages(e,a){if(typeof e!="string")throw new Error("Invalid input for JSON hub protocol. Expected a string.");if(!e)return[];a===null&&(a=g.instance);let b=q.parse(e),w=[];for(let R of b){let D=JSON.parse(R);if(typeof D.type!="number")throw new Error("Invalid payload.");switch(D.type){case U.Invocation:this.U(D);break;case U.StreamItem:this.Fe(D);break;case U.Completion:this.Be(D);break;case U.Ping:case U.Close:break;case U.Ack:this.Xe(D);break;case U.Sequence:this.Je(D);break;default:a.log(t.Information,"Unknown message type '"+D.type+"' ignored.");continue}w.push(D)}return w}writeMessage(e){return q.write(JSON.stringify(e))}U(e){this.ze(e.target,"Invalid payload for Invocation message."),e.invocationId!==void 0&&this.ze(e.invocationId,"Invalid payload for Invocation message.")}Fe(e){if(this.ze(e.invocationId,"Invalid payload for StreamItem message."),e.item===void 0)throw new Error("Invalid payload for StreamItem message.")}Be(e){if(e.result&&e.error)throw new Error("Invalid payload for Completion message.");!e.result&&e.error&&this.ze(e.error,"Invalid payload for Completion message."),this.ze(e.invocationId,"Invalid payload for Completion message.")}Xe(e){if(typeof e.sequenceId!="number")throw new Error("Invalid SequenceId for Ack message.")}Je(e){if(typeof e.sequenceId!="number")throw new Error("Invalid SequenceId for Sequence message.")}ze(e,a){if(typeof e!="string"||e==="")throw new Error(a)}}let We={trace:t.Trace,debug:t.Debug,info:t.Information,information:t.Information,warn:t.Warning,warning:t.Warning,error:t.Error,critical:t.Critical,none:t.None};class Ue{configureLogging(e){if(A.isRequired(e,"logging"),e.log!==void 0)this.logger=e;else if(typeof e=="string"){let a=function(b){let w=We[b.toLowerCase()];if(w!==void 0)return w;throw new Error(`Unknown log level: ${b}`)}(e);this.logger=new O(a)}else this.logger=new O(e);return this}withUrl(e,a){return A.isRequired(e,"url"),A.isNotEmpty(e,"url"),this.url=e,this.httpConnectionOptions=typeof a=="object"?{...this.httpConnectionOptions,...a}:{...this.httpConnectionOptions,transport:a},this}withHubProtocol(e){return A.isRequired(e,"protocol"),this.protocol=e,this}withAutomaticReconnect(e){if(this.reconnectPolicy)throw new Error("A reconnectPolicy has already been set.");return e?Array.isArray(e)?this.reconnectPolicy=new Te(e):this.reconnectPolicy=e:this.reconnectPolicy=new Te,this}withServerTimeout(e){return A.isRequired(e,"milliseconds"),this.Ve=e,this}withKeepAliveInterval(e){return A.isRequired(e,"milliseconds"),this.Ke=e,this}withStatefulReconnect(e){return this.httpConnectionOptions===void 0&&(this.httpConnectionOptions={}),this.httpConnectionOptions._e=!0,this.Y=e==null?void 0:e.bufferSize,this}build(){let e=this.httpConnectionOptions||{};if(e.logger===void 0&&(e.logger=this.logger),!this.url)throw new Error("The 'HubConnectionBuilder.withUrl' method must be called before building the connection.");let a=new Se(this.url,e);return pe.create(a,this.logger||g.instance,this.protocol||new Fe,this.reconnectPolicy,this.Ve,this.Ke,this.Y)}}return Uint8Array.prototype.indexOf||Object.defineProperty(Uint8Array.prototype,"indexOf",{value:Array.prototype.indexOf,writable:!0}),Uint8Array.prototype.slice||Object.defineProperty(Uint8Array.prototype,"slice",{value:function(I,e){return new Uint8Array(Array.prototype.slice.call(this,I,e))},writable:!0}),Uint8Array.prototype.forEach||Object.defineProperty(Uint8Array.prototype,"forEach",{value:Array.prototype.forEach,writable:!0}),c})(),typeof mt=="object"&&typeof _t=="object"?_t.exports=pt():typeof define=="function"&&define.amd?define([],pt):typeof mt=="object"?mt.signalR=pt():on.signalR=pt()});var ln=he((cn,vt)=>{"use strict";(function(r,t){if(typeof vt=="object"&&vt.exports)vt.exports=t();else{let c=t();r.CryptoTickerConfig=Object.assign({},r.CryptoTickerConfig||{},c)}})(typeof self!="undefined"?self:cn,function(){return{tProxyBase:"https://tproxyv8.opendle.com",fallbackPollIntervalMs:6e4,staleTickerTimeoutMs:5*60*1e3,binanceRestBaseUrl:"https://api.binance.com",binanceWsBaseUrl:"wss://stream.binance.com:9443/ws",binanceSymbolOverrides:{},bitfinexRestBaseUrl:"https://api-pub.bitfinex.com",bitfinexWsBaseUrl:"wss://api-pub.bitfinex.com/ws/2",bitfinexSymbolOverrides:{},messages:{loading:"LOADING...",stale:"STALE",noData:"NO DATA",misconfigured:"INVALID PAIR",conversionError:"CONVERT ERROR"}}})});var Ge=he((un,wt)=>{"use strict";var dr={LIVE:"live",DETACHED:"detached",BACKUP:"backup",BROKEN:"broken"};(function(r,t){let c=typeof globalThis!="undefined"?globalThis:r,u=t();typeof wt=="object"&&wt.exports&&(wt.exports=u),c&&(c.CryptoTickerConnectionStates=u)})(typeof self!="undefined"?self:un,function(){return dr})});var kt=he((hn,Ct)=>{"use strict";(function(r,t){let c=typeof globalThis!="undefined"?globalThis:r,u=t();typeof Ct=="object"&&Ct.exports&&(Ct.exports=u),c&&(c.CryptoTickerProviders=c.CryptoTickerProviders||{},c.CryptoTickerProviders.buildSubscriptionKey=u.buildSubscriptionKey)})(typeof self!="undefined"?self:hn,function(){function t(c,u,l,o){let p=c||"",k=u||"",P=l||null,v=o||null,T="";return P!==null&&v!==null&&P!==v&&(T="__"+P+"_"+v),p+"__"+k+T}return{buildSubscriptionKey:t}})});var Ke=he((fn,St)=>{"use strict";(function(r,t){let c=typeof globalThis!="undefined"?globalThis:r,u=t();typeof St=="object"&&St.exports&&(St.exports=u),c&&(c.CryptoTickerProviders=c.CryptoTickerProviders||{},c.CryptoTickerProviders.ProviderInterface=u.ProviderInterface)})(typeof self!="undefined"?self:fn,function(){function t(){}class c{constructor(l){let o=l||{};this.baseUrl=typeof o.baseUrl=="string"?o.baseUrl:"",this.logger=typeof o.logger=="function"?o.logger:t}getId(){throw new Error("Provider must implement getId()")}subscribeTicker(l,o){throw new Error("Provider must implement subscribeTicker()")}async fetchTicker(l){throw new Error("Provider must implement fetchTicker()")}getCachedTicker(l){return null}async fetchCandles(l){throw new Error("Provider must implement fetchCandles()")}ensureConnection(){}async fetchConversionRate(l,o){return 1}}return{ProviderInterface:c}})});var dt=he((pn,Ye)=>{"use strict";(function(r,t){let c=typeof globalThis!="undefined"?globalThis:r,u=typeof Ye=="object"&&Ye.exports?[kt(),Ge()]:[r==null?void 0:r.CryptoTickerProviders,r==null?void 0:r.CryptoTickerConnectionStates],l=t(u[0],u[1]);typeof Ye=="object"&&Ye.exports&&(Ye.exports=l),c&&(c.CryptoTickerProviders=c.CryptoTickerProviders||{},c.CryptoTickerProviders.TickerSubscriptionManager=l.TickerSubscriptionManager)})(typeof self!="undefined"?self:pn,function(r,t){let c=r.buildSubscriptionKey||r,u=t||{LIVE:"live",DETACHED:"detached",BACKUP:"backup",BROKEN:"broken"},l=6e4,o=5*60*1e3;function p(){}function k(T){let d=T||{};return{onData:typeof d.onData=="function"?d.onData:null,onError:typeof d.onError=="function"?d.onError:null}}function P(T){let d=T||{},i=d.fromCurrency||null,g=d.toCurrency||null;return{exchange:d.exchange,symbol:d.symbol,fromCurrency:i,toCurrency:g}}class v{constructor(d){let i=d||{};this.logger=typeof i.logger=="function"?i.logger:p,this.fetchTickerFn=typeof i.fetchTicker=="function"?i.fetchTicker:null,this.subscribeStreamingFn=typeof i.subscribeStreaming=="function"?i.subscribeStreaming:null,this.unsubscribeStreamingFn=typeof i.unsubscribeStreaming=="function"?i.unsubscribeStreaming:null,this.ensureConnectionFn=typeof i.ensureConnection=="function"?i.ensureConnection:null,this.subscriptionKeyBuilder=typeof i.buildSubscriptionKey=="function"?i.buildSubscriptionKey:c,this.fallbackPollIntervalMs=typeof i.fallbackPollIntervalMs=="number"?i.fallbackPollIntervalMs:l,this.staleTickerTimeoutMs=typeof i.staleTickerTimeoutMs=="number"?i.staleTickerTimeoutMs:o,this.connectionStates=u,this.entries={},this.cache={}}subscribe(d,i){let g=k(i),M=this.getOrCreateEntry(d);if(M.subscribers.push(g),this.ensureConnectionFn)try{this.ensureConnectionFn()}catch(h){this.logger("TickerSubscriptionManager: ensureConnection error",h)}this.ensureStreaming(M),this.startFallbackPolling(M);let A=this;return this.fetchTickerFn&&this.fetchTickerFn(M.params).then(function(h){A.applyTickerStateFromFetch(M,h),A.cache[M.key]=h,A.notifySubscribers(M,h)}).catch(function(h){if(A.logger("TickerSubscriptionManager: fetchTicker error",h),g.onError)try{g.onError(h)}catch(f){A.logger("TickerSubscriptionManager: onError handler threw",f)}}),{key:M.key,unsubscribe:()=>{this.unsubscribe(M.key,g)}}}unsubscribe(d,i){let g=this.entries[d];if(!g)return;let M=g.subscribers.indexOf(i);M>=0&&g.subscribers.splice(M,1),g.subscribers.length===0&&(this.stopFallbackPolling(g),this.stopStreaming(g),delete this.entries[d])}getCachedTicker(d){return this.cache[d]||null}handleStreamingUpdate(d,i){let g=this.entries[d];g&&(g.lastStreamUpdate=Date.now(),this.setEntryConnectionState(g,this.connectionStates.LIVE,i),this.cache[d]=i,this.notifySubscribers(g,i))}getEntry(d){return this.entries[d]||null}handleStreamingUpdateFromParts(d,i,g,M,A){let h=this.buildKey(d,i,g,M);this.handleStreamingUpdate(h,A)}buildKey(d,i,g,M){return this.subscriptionKeyBuilder(d,i,g,M)}buildKeyFromParams(d){let i=d||{};return this.buildKey(i.exchange,i.symbol,i.fromCurrency,i.toCurrency)}forEachEntry(d){if(typeof d!="function")return;let i=Object.keys(this.entries);for(let g=0;g<i.length;g++){let M=i[g];d(this.entries[M])}}ensureStreaming(d){if(!d||d.streamingActive||!this.subscribeStreamingFn){d&&!d.streamingActive&&(d.streamingActive=!!this.subscribeStreamingFn);return}try{let i=this.subscribeStreamingFn(d);i&&typeof i.then=="function"?i.then(()=>{d.streamingActive=!0}).catch(g=>{d.streamingActive=!1,this.logger("TickerSubscriptionManager: subscribeStreaming promise rejected",g)}):i===!1?d.streamingActive=!1:d.streamingActive=!0}catch(i){d.streamingActive=!1,this.logger("TickerSubscriptionManager: subscribeStreaming error",i)}}stopStreaming(d){if(!(!d||!this.unsubscribeStreamingFn||!d.streamingActive))try{let i=this.unsubscribeStreamingFn(d);i&&typeof i.then=="function"?i.then(()=>{d.streamingActive=!1}).catch(g=>{this.logger("TickerSubscriptionManager: unsubscribeStreaming promise rejected",g)}):d.streamingActive=!1}catch(i){d.streamingActive=!1,this.logger("TickerSubscriptionManager: unsubscribeStreaming error",i)}}notifySubscribers(d,i){if(!d)return;let g=d.subscribers;for(let M=0;M<g.length;M++){let A=g[M];if(A&&A.onData)try{A.onData(i)}catch(h){this.logger("TickerSubscriptionManager: onData handler threw",h)}}}startFallbackPolling(d){if(!d||d.fallbackTimerId||!this.fetchTickerFn)return;let i=this;d.fallbackTimerId=setInterval(function(){i.pollEntryIfNeeded(d)},this.fallbackPollIntervalMs)}stopFallbackPolling(d){!d||!d.fallbackTimerId||(clearInterval(d.fallbackTimerId),d.fallbackTimerId=null)}pollEntryIfNeeded(d){if(!d||!this.fetchTickerFn||!this.shouldPollEntry(d))return;let i=this;this.fetchTickerFn(d.params).then(function(g){i.applyTickerStateFromFetch(d,g),i.cache[d.key]=g,i.notifySubscribers(d,g)}).catch(function(g){i.logger("TickerSubscriptionManager: fallback fetch error",g),i.handleFetchError(d)})}shouldPollEntry(d){if(!d)return!1;if(!d.streamingActive)return!0;let i=d.lastStreamUpdate||0;return i?Date.now()-i>this.staleTickerTimeoutMs:!0}getOrCreateEntry(d){let i=this.buildKeyFromParams(d),g=this.entries[i];return g||(g={key:i,params:P(d),subscribers:[],streamingActive:!1,lastStreamUpdate:0,fallbackTimerId:null,meta:{},connectionState:null},this.entries[i]=g),g}setEntryConnectionState(d,i,g){d&&(d.connectionState=i,g&&typeof g=="object"&&(g.connectionState=i))}applyTickerStateFromFetch(d,i){if(!d||!i)return;let g=i.connectionState||(d.streamingActive?this.connectionStates.LIVE:this.connectionStates.DETACHED);this.setEntryConnectionState(d,g,i)}handleFetchError(d){if(!d)return;this.setEntryConnectionState(d,this.connectionStates.BROKEN);let i=d.key,g=this.cache[i];if(g){g.connectionState=this.connectionStates.BROKEN,this.notifySubscribers(d,g);return}let M={changeDaily:0,changeDailyPercent:0,last:0,volume:0,high:0,low:0,pair:d.params.symbol,pairDisplay:d.params.symbol,connectionState:this.connectionStates.BROKEN};this.cache[i]=M,this.notifySubscribers(d,M)}}return{TickerSubscriptionManager:v}})});var Xe=he((dn,Je)=>{"use strict";(function(r,t){let c=typeof globalThis!="undefined"?globalThis:r,u=typeof Je=="object"&&Je.exports?[Ke(),kt(),dt(),Ge()]:[r==null?void 0:r.CryptoTickerProviders,r==null?void 0:r.CryptoTickerProviders,r==null?void 0:r.CryptoTickerProviders,r==null?void 0:r.CryptoTickerConnectionStates],l=t(u[0],u[1],u[2],u[3]);typeof Je=="object"&&Je.exports&&(Je.exports=l),c&&(c.CryptoTickerProviders=c.CryptoTickerProviders||{},c.CryptoTickerProviders.GenericProvider=l.GenericProvider)})(typeof self!="undefined"?self:dn,function(r,t,c,u){let l=r.ProviderInterface||r,o=t.buildSubscriptionKey||t,p=c.TickerSubscriptionManager||c,k=u||{LIVE:"live",DETACHED:"detached",BACKUP:"backup",BROKEN:"broken"},P="Connected",v=5e3;class T extends l{constructor(i){super(i);let g=i||{};this.retryDelayMs=typeof g.retryDelayMs=="number"?g.retryDelayMs:v,this.connection=null,this.shouldReconnect=!0,this.connectionState="Disconnected",this.startingConnection=!1;let M={logger:(...A)=>{this.logger(...A)},fetchTicker:this.rawFetchTicker.bind(this),subscribeStreaming:this.subscribeEntry.bind(this),unsubscribeStreaming:this.unsubscribeEntry.bind(this),ensureConnection:this.ensureConnection.bind(this),buildSubscriptionKey:function(A,h,f,C){return o(A,h,f,C)},fallbackPollIntervalMs:g.fallbackPollIntervalMs,staleTickerTimeoutMs:g.staleTickerTimeoutMs};this.subscriptionManager=new p(M)}getId(){return"GENERIC"}subscribeTicker(i,g){return this.subscriptionManager.subscribe(i,g)}getCachedTicker(i){return this.subscriptionManager.getCachedTicker(i)}ensureConnection(){if(!(this.connection&&(this.connectionState===P||this.startingConnection))){if(typeof signalR=="undefined"||!signalR.HubConnectionBuilder){this.logger("GenericProvider: SignalR not available, skipping WebSocket connection.");return}if(!this.connection){this.connection=new signalR.HubConnectionBuilder().withUrl(this.baseUrl+"/tickerhub").withAutomaticReconnect().configureLogging(signalR.LogLevel.Warning).build();let i=this;this.connection.on("ticker",function(g){i.handleTickerMessage(g)}),this.connection.onreconnected(function(){i.logger("GenericProvider: connection re-established, resubscribing."),i.onConnectionEstablished()}),this.connection.onclose(function(){i.connectionState="Disconnected",i.shouldReconnect&&setTimeout(function(){i.startConnection()},i.retryDelayMs)})}this.startConnection()}}startConnection(){if(!this.connection||this.startingConnection||this.connectionState===P)return;let i=this;this.startingConnection=!0,this.connection.start().then(function(){i.connectionState=P,i.startingConnection=!1,i.onConnectionEstablished()}).catch(function(g){i.connectionState="Disconnected",i.startingConnection=!1,i.logger("GenericProvider: error starting connection",g),setTimeout(function(){i.startConnection()},i.retryDelayMs)})}isConnected(){return this.connection&&this.connectionState===P}onConnectionEstablished(){let i=this;this.subscriptionManager.forEachEntry(function(g){g&&(g.streamingActive=!1,g.meta&&(g.meta.isSubscribed=!1,g.meta.pending=!0),i.subscriptionManager.ensureStreaming(g))})}subscribeEntry(i){if(!i)return!1;if(i.meta=i.meta||{},!this.connection)return this.ensureConnection(),i.meta.pending=!0,i.streamingActive=!1,!1;if(!this.isConnected())return this.startConnection(),i.meta.pending=!0,i.streamingActive=!1,!1;if(i.meta.isSubscribed)return i.meta.pending=!1,!0;i.meta.pending=!0;let g=i.params,M=this;return this.connection.invoke("Subscribe",g.exchange,g.symbol,g.fromCurrency,g.toCurrency).then(function(){return i.meta.isSubscribed=!0,i.meta.pending=!1,i.streamingActive=!0,!0}).catch(function(A){return i.meta.isSubscribed=!1,i.meta.pending=!1,i.streamingActive=!1,M.logger("GenericProvider: error invoking Subscribe",A),!1})}unsubscribeEntry(i){if(!i)return!0;if(i.meta=i.meta||{},!this.connection||!i.meta.isSubscribed)return i.meta.isSubscribed=!1,i.streamingActive=!1,!0;let g=i.params,M=this;return this.connection.invoke("Unsubscribe",g.exchange,g.symbol,g.fromCurrency,g.toCurrency).then(function(){return i.meta.isSubscribed=!1,i.streamingActive=!1,!0}).catch(function(A){return i.meta.isSubscribed=!1,i.streamingActive=!1,M.logger("GenericProvider: error invoking Unsubscribe",A),!1})}fetchTicker(i){return this.rawFetchTicker(i)}rawFetchTicker(i){let g=i.exchange,M=i.symbol,A=i.fromCurrency||"USD",h=i.toCurrency||null,f=this.baseUrl+"/api/Ticker/json/"+g+"/"+M+"?fromCurrency="+encodeURIComponent(A);h!==null&&(f+="&toCurrency="+encodeURIComponent(h));let C=this;return fetch(f).then(function(E){return E.json()}).then(function(E){let y=C.transformTickerResponse(E);return y.connectionState=k.BACKUP,y}).catch(function(E){C.logger("GenericProvider: error fetching ticker",E);let y=C.subscriptionManager.buildKey(g,M,A,h),O=C.subscriptionManager.getCachedTicker(y);if(O)return O.connectionState=O.connectionState||k.BACKUP,O;let S=C.buildEmptyTicker(M);return S.connectionState=k.BROKEN,S})}handleTickerMessage(i){if(!i)return;let g=i.provider||i.provider,M=i.symbol||i.symbol,A=i.conversionFromCurrency||i.conversionFromCurrency||null,h=i.conversionToCurrency||i.conversionToCurrency||null,f=this.subscriptionManager.buildKey(g,M,A,h),C=this.transformTickerResponse(i),E=this.subscriptionManager.getEntry(f);E&&E.meta&&(E.meta.isSubscribed=!0,E.meta.pending=!1,E.streamingActive=!0),this.subscriptionManager.handleStreamingUpdate(f,C)}async fetchCandles(i){let g=i.exchange,M=i.symbol,A=i.interval,h=typeof i.limit=="number"&&i.limit>0?i.limit:24,C=this.baseUrl.replace(/\/$/,"")+"/api/Candles/json/"+encodeURIComponent(g)+"/"+encodeURIComponent(M)+"/"+A+"?limit="+h;try{let E=await fetch(C);if(!E||!E.ok)throw new Error("GenericProvider: candles response not ok");let y=await E.json();return Array.isArray(y.candles)?y.candles:[]}catch(E){throw this.logger("GenericProvider: error fetching candles",E),E}}transformTickerResponse(i){let g=i||{};return{changeDaily:g.dailyChange||0,changeDailyPercent:g.dailyChangeRelative||0,last:g.last||0,volume:g.volume||0,high:g.high24h||0,low:g.low24h||0,pair:g.symbol||g.pair||"",pairDisplay:g.symbolDisplay||g.symbol||g.pair||""}}buildEmptyTicker(i){let g=i||"";return{changeDaily:0,changeDailyPercent:0,last:0,volume:0,high:0,low:0,pair:g,pairDisplay:g,connectionState:k.BROKEN}}}return{GenericProvider:T}})});var bn=he((gn,Tt)=>{"use strict";(function(t,c){let u=c();typeof Tt=="object"&&Tt.exports&&(Tt.exports=u),t&&typeof t=="object"&&(t.CryptoTickerDefaults=u)})(typeof self!="undefined"?self:gn,function(){function t(v){if(v===null||typeof v!="object")return v;if(Array.isArray(v))return v.map(d=>t(d));let T={};for(let d in v)Object.prototype.hasOwnProperty.call(v,d)&&(T[d]=t(v[d]));return T}function c(v){let T=v==null?void 0:v.case,d=(v==null?void 0:v.allowEmptyString)===!0,i=(v==null?void 0:v.allowNull)===!0,g=Object.prototype.hasOwnProperty.call(v||{},"trim")?!!(v!=null&&v.trim):!0,M=Array.isArray(v==null?void 0:v.allowedValues)?v==null?void 0:v.allowedValues:null;return function(h){if(h===void 0)return null;if(h===null)return i?null:"";let f=String(h);if(g&&(f=f.trim()),!f&&!d)return null;if(T==="upper"?f=f.toUpperCase():T==="lower"&&(f=f.toLowerCase()),M&&M.length>0){let C=T==="lower"?f.toLowerCase():T==="upper"?f.toUpperCase():f;return M.some(y=>T==="lower"?y.toLowerCase()===C:T==="upper"?y.toUpperCase()===C:y===C)?T==="lower"||T==="upper"?C:f:null}return f}}function u(v){let T=typeof(v==null?void 0:v.min)=="number"?v.min:null,d=typeof(v==null?void 0:v.max)=="number"?v.max:null,i=(v==null?void 0:v.integer)===!0;return function(M){if(M==null||M==="")return null;let A=typeof M=="number"?M:parseFloat(String(M));return Number.isNaN(A)?null:(i&&(A=Math.round(A)),T!==null&&A<T&&(A=T),d!==null&&A>d&&(A=d),A)}}let l={title:{type:"string",default:"",normalize:c({allowEmptyString:!0,allowNull:!0,trim:!0})},exchange:{type:"string",default:"BINANCE",normalize:c({trim:!0,allowEmptyString:!1,case:"upper"})},pair:{type:"string",default:"BTCUSD",normalize:c({trim:!0,allowEmptyString:!1,case:"upper"})},fromCurrency:{type:"string",default:"USD",normalize:c({trim:!0,allowEmptyString:!1,case:"upper"})},currency:{type:"string",default:"",normalize:c({trim:!0,allowEmptyString:!0,case:"upper",allowNull:!0})},candlesInterval:{type:"string",default:"1h",normalize:c({trim:!0,allowEmptyString:!1})},candlesDisplayed:{type:"number",default:20,normalize:u({min:5,max:60,integer:!0})},multiplier:{type:"number",default:1,normalize:u({min:0})},digits:{type:"number",default:2,normalize:u({min:0,max:10,integer:!0})},highLowDigits:{type:"string",default:"",normalize:c({trim:!0,allowEmptyString:!0})},font:{type:"string",default:"Lato,'Roboto Condensed',Helvetica,Calibri,sans-serif",normalize:c({trim:!0,allowEmptyString:!1})},fontSizeBase:{type:"number",default:25,normalize:u({min:1,max:200,integer:!0})},fontSizePrice:{type:"number",default:35,normalize:u({min:1,max:200,integer:!0})},fontSizeHighLow:{type:"string",default:"",normalize:c({trim:!0,allowEmptyString:!0})},fontSizeChange:{type:"number",default:19,normalize:u({min:1,max:200,integer:!0})},priceFormat:{type:"string",default:"compact",normalize:c({trim:!0,allowEmptyString:!1,case:"lower"})},backgroundColor:{type:"string",default:"#000000",normalize:c({trim:!0,allowEmptyString:!1})},textColor:{type:"string",default:"#ffffff",normalize:c({trim:!0,allowEmptyString:!1})},displayHighLow:{type:"string",default:"on",normalize:c({trim:!0,allowEmptyString:!1,case:"lower",allowedValues:["on","off"]})},displayHighLowBar:{type:"string",default:"on",normalize:c({trim:!0,allowEmptyString:!1,case:"lower",allowedValues:["on","off"]})},displayDailyChange:{type:"string",default:"on",normalize:c({trim:!0,allowEmptyString:!1,case:"lower",allowedValues:["on","off"]})},displayConnectionStatusIcon:{type:"string",default:"OFF",normalize:c({trim:!0,allowEmptyString:!1,case:"upper",allowedValues:["OFF","TOP_RIGHT","BOTTOM_LEFT"]})},alertRule:{type:"string",default:"",normalize:c({trim:!0,allowEmptyString:!0})},backgroundColorRule:{type:"string",default:"",normalize:c({trim:!0,allowEmptyString:!0})},textColorRule:{type:"string",default:"",normalize:c({trim:!0,allowEmptyString:!0})},mode:{type:"string",default:"ticker",normalize:c({trim:!0,allowEmptyString:!1,case:"lower",allowedValues:["ticker","candles"]})}};function o(v,T,d){if(!v||typeof v!="object")return{value:T,error:null};let i=v.normalize,g=v.default;if(typeof i!="function")return{value:T===void 0?t(g):T,error:null};let M=i(T);if(M==null){let A=i(g);return{value:A==null?t(g):A,error:d?"Invalid "+v.type:null}}return{value:M,error:null}}function p(v){let T=v&&typeof v=="object"?v:{},d={},i=[];for(let g in l){if(!Object.prototype.hasOwnProperty.call(l,g))continue;let M=l[g],A=Object.prototype.hasOwnProperty.call(T,g),h=A?T[g]:void 0,f=o(M,h,A);d[g]=f.value,f.error&&i.push({key:g,message:f.error})}for(let g in T)!Object.prototype.hasOwnProperty.call(l,g)&&Object.prototype.hasOwnProperty.call(T,g)&&(d[g]=T[g]);return{settings:d,errors:i}}function k(v){return p(v).settings}let P=k(null);return{settingsSchema:l,defaultSettings:P,getDefaultSettings:function(){return t(P)},validateSettings:function(v){let T=p(v);return{settings:T.settings,errors:T.errors.slice(0)}},applyDefaults:k}})});var xt=he((yn,Et)=>{"use strict";(function(r,t){let c=typeof globalThis!="undefined"?globalThis:r,u=t();typeof Et=="object"&&Et.exports&&(Et.exports=u),c&&(c.CryptoTickerProviders=c.CryptoTickerProviders||{},c.CryptoTickerProviders.WebSocketConnectionPool=u.WebSocketConnectionPool)})(typeof self!="undefined"?self:yn,function(){function r(){}function t(u,l){if(!l||typeof l!="object")return u;let o=Object.keys(l);for(let p=0;p<o.length;p++){let k=o[p];u[k]=l[k]}return u}class c{constructor(l){let o=l||{};this.logger=typeof o.logger=="function"?o.logger:r,this.createWebSocket=typeof o.createWebSocket=="function"?o.createWebSocket:null,this.subscribeHandler=typeof o.subscribe=="function"?o.subscribe:null,this.unsubscribeHandler=typeof o.unsubscribe=="function"?o.unsubscribe:null,this.handleMessageFn=typeof o.handleMessage=="function"?o.handleMessage:null,this.onOpen=typeof o.onOpen=="function"?o.onOpen:null,this.onError=typeof o.onError=="function"?o.onError:null,this.onClose=typeof o.onClose=="function"?o.onClose:null,this.reconnectDelayMs=typeof o.reconnectDelayMs=="number"?o.reconnectDelayMs:5e3,this.autoCloseDelayMs=typeof o.autoCloseDelayMs=="number"?o.autoCloseDelayMs:0,this.shouldResubscribeOnReconnect=o.shouldResubscribeOnReconnect!==!1,this.symbolEntries={},this.ws=null,this.wsClosedByUser=!1,this.reconnectTimer=null,this.closeTimer=null,this.isConnecting=!1}subscribe(l,o){let p=typeof l=="string"?l:"";if(!p)return this.logger("WebSocketConnectionPool: subscribe called without symbol"),null;if(!this.createWebSocket)return this.logger("WebSocketConnectionPool: createWebSocket not configured"),null;let k=this.buildSubscriber(o);if(!k.onData)return this.logger("WebSocketConnectionPool: subscriber missing onData handler for",p),null;let P=this.symbolEntries[p];P||(P={symbol:p,subscribers:[],subscribed:!1,subscriptionRequested:!1,meta:{}},this.symbolEntries[p]=P),P.subscribers.push(k),this.clearCloseTimer(),this.ensureConnection(),this.isSocketOpen()&&!P.subscribed&&!P.subscriptionRequested&&this.requestSubscribe(P);let v=this;return{symbol:p,unsubscribe:function(){v.removeSubscriber(p,k)},updateMetadata:function(T){v.updateSymbolMetadata(p,T)},getMetadata:function(){let T=v.symbolEntries[p];return T?T.meta:null}}}removeSubscriber(l,o){let p=this.symbolEntries[l];if(!p)return;let k=p.subscribers.indexOf(o);if(k>=0&&p.subscribers.splice(k,1),!(p.subscribers.length>0)){if(this.isSocketOpen()&&this.unsubscribeHandler&&(p.subscribed||p.subscriptionRequested))try{this.unsubscribeHandler(this.ws,l,p.meta)}catch(P){this.logger("WebSocketConnectionPool: unsubscribe handler error",P)}delete this.symbolEntries[l],this.maybeCloseConnection()}}ensureConnection(){if(this.ws||this.isConnecting)return;let l=null;try{l=this.createWebSocket()}catch(o){this.logger("WebSocketConnectionPool: failed to create WebSocket",o);return}if(!l){this.logger("WebSocketConnectionPool: createWebSocket returned falsy value"),this.scheduleReconnect();return}this.ws=l,this.wsClosedByUser=!1,this.isConnecting=!0,this.attachSocketHandlers(l)}attachSocketHandlers(l){let o=this;l.onopen=function(){if(o.isConnecting=!1,o.onOpen)try{o.onOpen(o.ws)}catch(p){o.logger("WebSocketConnectionPool: onOpen handler error",p)}o.flushPendingSubscriptions()},l.onmessage=function(p){if(o.handleMessageFn)try{o.handleMessageFn(p,o.buildMessageHelpers())}catch(k){o.logger("WebSocketConnectionPool: handleMessage error",k)}},l.onerror=function(p){if(o.onError)try{o.onError(p)}catch(k){o.logger("WebSocketConnectionPool: onError handler error",k)}},l.onclose=function(p){o.handleSocketClose(p)}}handleSocketClose(l){if(this.onClose)try{this.onClose(l)}catch(p){this.logger("WebSocketConnectionPool: onClose handler error",p)}let o=this.hasSubscribers();if(this.isConnecting=!1,this.ws=null,!this.wsClosedByUser&&o){this.resetSubscriptionState(),this.notifyAllDisconnected(),this.scheduleReconnect();return}this.wsClosedByUser=!1,this.resetSubscriptionState()}resetSubscriptionState(){let l=Object.keys(this.symbolEntries);for(let o=0;o<l.length;o++){let p=this.symbolEntries[l[o]];p.subscribed=!1,p.subscriptionRequested=!1}}scheduleReconnect(){if(this.reconnectTimer||!this.hasSubscribers())return;let l=this;this.reconnectTimer=setTimeout(function(){l.reconnectTimer=null,l.hasSubscribers()&&l.ensureConnection()},this.reconnectDelayMs)}clearReconnectTimer(){this.reconnectTimer&&(clearTimeout(this.reconnectTimer),this.reconnectTimer=null)}flushPendingSubscriptions(){let l=Object.keys(this.symbolEntries);for(let o=0;o<l.length;o++){let p=this.symbolEntries[l[o]];!p.subscribed&&!p.subscriptionRequested&&this.requestSubscribe(p)}}requestSubscribe(l){if(!(!l||!this.isSocketOpen())){if(!this.subscribeHandler){l.subscribed=!0,this.notifySubscribed(l.symbol,null);return}try{l.subscriptionRequested=!0,this.subscribeHandler(this.ws,l.symbol,l.meta)}catch(o){l.subscriptionRequested=!1,this.logger("WebSocketConnectionPool: subscribe handler error",o),this.notifySubscribeError(l.symbol,o)}}}notifySubscribed(l,o){let p=this.symbolEntries[l];if(!p)return;if(p.subscribed){o&&t(p.meta,o);return}p.subscribed=!0,p.subscriptionRequested=!1,o&&t(p.meta,o);let k=p.subscribers;for(let P=0;P<k.length;P++){let v=k[P];if(v.onSubscribed)try{v.onSubscribed(v.context)}catch(T){this.logger("WebSocketConnectionPool: onSubscribed handler error",T)}}}notifySubscribeError(l,o){let p=this.symbolEntries[l];if(!p)return;let k=p.subscribers;for(let P=0;P<k.length;P++){let v=k[P];if(v.onError)try{v.onError(o,v.context)}catch(T){this.logger("WebSocketConnectionPool: onError handler error",T)}}}notifyAllDisconnected(){let l=Object.keys(this.symbolEntries);for(let o=0;o<l.length;o++)this.notifyDisconnected(l[o])}notifyDisconnected(l){let o=this.symbolEntries[l];if(!o)return;let p=o.subscribers;for(let k=0;k<p.length;k++){let P=p[k];if(P.onDisconnected)try{P.onDisconnected(P.context)}catch(v){this.logger("WebSocketConnectionPool: onDisconnected handler error",v)}}}dispatch(l,o,p){let k=this.symbolEntries[l];if(!k)return;let P=k.subscribers;for(let v=0;v<P.length;v++){let T=P[v];if(T.onData)try{T.onData(o,p,T.context)}catch(d){this.logger("WebSocketConnectionPool: subscriber onData error",d)}}}dispatchToAll(l,o){let p=Object.keys(this.symbolEntries);for(let k=0;k<p.length;k++)this.dispatch(p[k],l,o)}markSymbolSubscribed(l,o){this.notifySubscribed(l,o)}markSymbolUnsubscribed(l){let o=this.symbolEntries[l];o&&(o.subscribed=!1,o.subscriptionRequested=!1)}updateSymbolMetadata(l,o){let p=this.symbolEntries[l];p&&t(p.meta,o)}getSymbolMetadata(l){let o=this.symbolEntries[l];return o?o.meta:null}findSymbolByMeta(l){if(typeof l!="function")return null;let o=Object.keys(this.symbolEntries);for(let p=0;p<o.length;p++){let k=this.symbolEntries[o[p]];if(l(k.meta,k.symbol))return k.symbol}return null}hasSubscribers(){let l=Object.keys(this.symbolEntries);for(let o=0;o<l.length;o++)if(this.symbolEntries[l[o]].subscribers.length>0)return!0;return!1}maybeCloseConnection(){this.hasSubscribers()||(this.autoCloseDelayMs>0?this.scheduleCloseTimer():this.closeConnection())}scheduleCloseTimer(){if(this.closeTimer)return;let l=this;this.closeTimer=setTimeout(function(){l.closeTimer=null,l.hasSubscribers()||l.closeConnection()},this.autoCloseDelayMs)}clearCloseTimer(){this.closeTimer&&(clearTimeout(this.closeTimer),this.closeTimer=null)}closeConnection(){if(this.clearReconnectTimer(),!!this.ws){this.wsClosedByUser=!0;try{this.ws.close()}catch(l){this.logger("WebSocketConnectionPool: error closing WebSocket",l)}this.ws=null}}buildSubscriber(l){let o=l||{};return{context:o.context||null,onData:typeof o.onData=="function"?o.onData:null,onError:typeof o.onError=="function"?o.onError:null,onSubscribed:typeof o.onSubscribed=="function"?o.onSubscribed:null,onDisconnected:typeof o.onDisconnected=="function"?o.onDisconnected:null}}buildMessageHelpers(){let l=this;return{dispatch:function(o,p,k){l.dispatch(o,p,k)},dispatchToAll:function(o,p){l.dispatchToAll(o,p)},markSubscribed:function(o,p){l.markSymbolSubscribed(o,p)},markUnsubscribed:function(o){l.markSymbolUnsubscribed(o)},updateMetadata:function(o,p){l.updateSymbolMetadata(o,p)},getMetadata:function(o){return l.getSymbolMetadata(o)},findSymbol:function(o){return l.findSymbolByMeta(o)},getActiveSymbols:function(){return Object.keys(l.symbolEntries)}}}isSocketOpen(){return this.ws&&this.ws.readyState===1}}return{WebSocketConnectionPool:c}})});var Wt=he((mn,Qe)=>{"use strict";(function(r,t){let c=typeof globalThis!="undefined"?globalThis:r,u=typeof Qe=="object"&&Qe.exports?[Ke(),Xe(),dt(),Ge(),xt()]:[r==null?void 0:r.CryptoTickerProviders,r==null?void 0:r.CryptoTickerProviders,r==null?void 0:r.CryptoTickerProviders,r==null?void 0:r.CryptoTickerConnectionStates,r==null?void 0:r.CryptoTickerProviders],l=t(u[0],u[1],u[2],u[3],u[4]);typeof Qe=="object"&&Qe.exports&&(Qe.exports=l),c&&(c.CryptoTickerProviders=c.CryptoTickerProviders||{},c.CryptoTickerProviders.BinanceProvider=l.BinanceProvider)})(typeof self!="undefined"?self:mn,function(r,t,c,u,l){let o=r.ProviderInterface||r,p=t.GenericProvider||t,k=c.TickerSubscriptionManager||c,P=u||{LIVE:"live",DETACHED:"detached",BACKUP:"backup",BROKEN:"broken"},v=l.WebSocketConnectionPool||l,T=5e3;function d(){return typeof WebSocket!="undefined"?WebSocket:typeof window!="undefined"&&window.WebSocket?window.WebSocket:typeof global!="undefined"&&global.WebSocket?global.WebSocket:null}function i(h){let f=parseFloat(h);return isNaN(f)?0:f}function g(h){return i(h)/100}function M(h){switch(h){case"MINUTES_1":return"1m";case"MINUTES_5":return"5m";case"MINUTES_15":return"15m";case"HOURS_1":return"1h";case"HOURS_6":return"6h";case"HOURS_12":return"12h";case"DAYS_1":return"1d";case"DAYS_7":return"1w";case"MONTHS_1":return"1M"}return null}class A extends o{constructor(f){super(f);let C=f||{};this.genericFallback=C.genericFallback instanceof p?C.genericFallback:new p(f),this.restBaseUrl=typeof C.binanceRestBaseUrl=="string"&&C.binanceRestBaseUrl.length>0?C.binanceRestBaseUrl:"https://api.binance.com",this.wsBaseUrl=typeof C.binanceWsBaseUrl=="string"&&C.binanceWsBaseUrl.length>0?C.binanceWsBaseUrl:"wss://stream.binance.com:9443/ws",this.symbolOverrides=C.binanceSymbolOverrides||{},this.wsReconnectDelayMs=typeof C.retryDelayMs=="number"?C.retryDelayMs:T;let E={logger:(...y)=>{this.logger(...y)},fetchTicker:this.fetchTickerDirect.bind(this),subscribeStreaming:this.subscribeStream.bind(this),unsubscribeStreaming:this.unsubscribeStream.bind(this),fallbackPollIntervalMs:C.fallbackPollIntervalMs,staleTickerTimeoutMs:C.staleTickerTimeoutMs};this.subscriptionManager=new k(E),this.wsRequestId=0,this.webSocketPool=new v({logger:(...y)=>{this.logger(...y)},reconnectDelayMs:this.wsReconnectDelayMs,createWebSocket:()=>{let y=d();if(!y)return this.logger("BinanceProvider: WebSocket not available in this environment"),null;let O=this.wsBaseUrl.replace(/\/$/,"");try{return new y(O)}catch(S){return this.logger("BinanceProvider: error creating pooled WebSocket",S),null}},subscribe:(y,O)=>{this.sendBinanceSubscription(y,O,!0)},unsubscribe:(y,O)=>{this.sendBinanceSubscription(y,O,!1)},handleMessage:(y,O)=>{this.handlePoolMessage(y,O)},onError:y=>{this.logger("BinanceProvider: pooled WebSocket error",y)},onClose:()=>{this.wsRequestId=0}})}getId(){return"BINANCE"}subscribeTicker(f,C){return this.subscriptionManager.subscribe(f,C)}getCachedTicker(f){let C=this.subscriptionManager.getCachedTicker(f);return C||(this.genericFallback&&typeof this.genericFallback.getCachedTicker=="function"?this.genericFallback.getCachedTicker(f):null)}ensureConnection(){let f=this;this.subscriptionManager.forEachEntry(function(C){f.subscriptionManager.ensureStreaming(C)})}async fetchTicker(f){try{return await this.fetchTickerDirect(f)}catch(C){if(this.logger("BinanceProvider: direct fetch failed, using fallback",C),this.genericFallback&&typeof this.genericFallback.fetchTicker=="function")return this.genericFallback.fetchTicker(f);throw C}}async fetchTickerDirect(f){let C=this.resolveSymbol(f);if(!C)throw new Error("BinanceProvider: unable to resolve symbol for "+(f.symbol||""));let E=this.buildRestUrl(C);try{let y=await fetch(E);if(!y||!y.ok)throw new Error("BinanceProvider: REST response not ok for "+C);let O=await y.json(),S=this.transformRestTicker(O,f,C);return S.connectionState=P.DETACHED,S}catch(y){if(this.logger("BinanceProvider: REST fetch error",y),this.genericFallback&&typeof this.genericFallback.fetchTicker=="function"){let O=await this.genericFallback.fetchTicker(f);return O&&typeof O=="object"&&!O.connectionState&&(O.connectionState=P.BACKUP),O}throw y}}subscribeStream(f){if(!f)return!1;let C=this.ensureEntryMeta(f);if(C.binanceSymbol=this.resolveSymbol(f.params),!C.binanceSymbol)return this.logger("BinanceProvider: cannot subscribe, unresolved symbol",f.params),!1;let E=this.webSocketPool.subscribe(C.binanceSymbol,{context:f,onData:y=>{let O=this.transformStreamTicker(y,f,C.binanceSymbol);this.subscriptionManager.handleStreamingUpdate(f.key,O)},onSubscribed:()=>{f.streamingActive=!0},onDisconnected:()=>{f.streamingActive=!1},onError:y=>{this.logger("BinanceProvider: subscription error",y)}});return E?(C.poolSubscription=E,f.streamingActive=!0,!0):(f.streamingActive=!1,!1)}unsubscribeStream(f){if(!f)return!0;let C=this.ensureEntryMeta(f);return C.poolSubscription&&typeof C.poolSubscription.unsubscribe=="function"&&C.poolSubscription.unsubscribe(),C.poolSubscription=null,f.streamingActive=!1,!0}resolveSymbol(f){if(!f)return null;let C=(f.symbol||"").toUpperCase();return C?this.symbolOverrides&&this.symbolOverrides[C]?(this.symbolOverrides[C]||"").toUpperCase():C.endsWith("USD")?C.slice(0,-3)+"USDT":C:null}buildRestUrl(f){return this.restBaseUrl.replace(/\/$/,"")+"/api/v3/ticker/24hr?symbol="+encodeURIComponent(f)}sendBinanceSubscription(f,C,E){if(!f||!C)return;let y=C.toLowerCase()+"@ticker",O={method:E?"SUBSCRIBE":"UNSUBSCRIBE",params:[y],id:this.nextWsRequestId()};try{f.send(JSON.stringify(O))}catch(S){this.logger("BinanceProvider: error sending subscription message",S)}}nextWsRequestId(){return this.wsRequestId+=1,this.wsRequestId>1e6&&(this.wsRequestId=1),this.wsRequestId}handlePoolMessage(f,C){if(!f)return;let E=f.data;if(!E)return;if(typeof E=="string")try{E=JSON.parse(E)}catch(S){this.logger("BinanceProvider: failed to parse WebSocket message",S);return}if(!E||Array.isArray(E))return;if(E.error){this.logger("BinanceProvider: WebSocket error message",E.error);return}if(typeof E.result!="undefined")return;let y=E;if(E.data&&typeof E.data=="object"&&(y=E.data),!y||typeof y!="object")return;let O=(y.s||y.symbol||"").toUpperCase();O&&(C.markSubscribed(O),C.dispatch(O,y,E))}transformRestTicker(f,C,E){let y=C&&C.symbol?C.symbol:E;return{changeDaily:i(f.priceChange),changeDailyPercent:g(f.priceChangePercent),last:i(f.lastPrice),volume:i(f.volume),high:i(f.highPrice),low:i(f.lowPrice),pair:y,pairDisplay:y}}transformStreamTicker(f,C,E){let y=C?C.params:null,O=y&&y.symbol?y.symbol:E;return{changeDaily:i(f.p||f.priceChange),changeDailyPercent:g(f.P||f.priceChangePercent),last:i(f.c||f.lastPrice),volume:i(f.v||f.volume),high:i(f.h||f.highPrice),low:i(f.l||f.lowPrice),pair:O,pairDisplay:O}}ensureEntryMeta(f){return f.meta=f.meta||{},f.meta}async fetchCandles(f){let C=this.resolveSymbol(f);if(!C)throw new Error("BinanceProvider: unable to resolve symbol for candles");let E=M(f.interval);if(!E)throw new Error("BinanceProvider: unsupported interval "+f.interval);let y=Math.min(Math.max(parseInt(f.limit,10)||24,1),1e3),S=this.restBaseUrl.replace(/\/$/,"")+"/api/v3/klines?symbol="+encodeURIComponent(C)+"&interval="+encodeURIComponent(E)+"&limit="+y;try{let L=await fetch(S);if(!L||!L.ok)throw new Error("BinanceProvider: candles response not ok");let V=await L.json();if(!Array.isArray(V))throw new Error("BinanceProvider: unexpected candles payload");return V.map(function(N){return{ts:Math.floor((N[0]||0)/1e3),open:i(N[1]),high:i(N[2]),low:i(N[3]),close:i(N[4]),volume:i(N[5]),volumeQuote:i(N[7])}})}catch(L){if(this.logger("BinanceProvider: error fetching candles",L),this.genericFallback&&typeof this.genericFallback.fetchCandles=="function")return this.genericFallback.fetchCandles(f);throw L}}}return{BinanceProvider:A}})});var $t=he((vn,Ze)=>{"use strict";(function(r,t){let c=typeof globalThis!="undefined"?globalThis:r,u=typeof Ze=="object"&&Ze.exports?[Ke(),Xe(),dt(),Ge(),xt()]:[r==null?void 0:r.CryptoTickerProviders,r==null?void 0:r.CryptoTickerProviders,r==null?void 0:r.CryptoTickerProviders,r==null?void 0:r.CryptoTickerConnectionStates,r==null?void 0:r.CryptoTickerProviders],l=t(u[0],u[1],u[2],u[3],u[4]);typeof Ze=="object"&&Ze.exports&&(Ze.exports=l),c&&(c.CryptoTickerProviders=c.CryptoTickerProviders||{},c.CryptoTickerProviders.BitfinexProvider=l.BitfinexProvider)})(typeof self!="undefined"?self:vn,function(r,t,c,u,l){let o=r.ProviderInterface||r,p=t.GenericProvider||t,k=c.TickerSubscriptionManager||c,P=u||{LIVE:"live",DETACHED:"detached",BACKUP:"backup",BROKEN:"broken"},v=l.WebSocketConnectionPool||l,T=5e3;function d(){return typeof WebSocket!="undefined"?WebSocket:typeof window!="undefined"&&window.WebSocket?window.WebSocket:typeof global!="undefined"&&global.WebSocket?global.WebSocket:null}function i(A){let h=parseFloat(A);return isNaN(h)?0:h}function g(A){switch(A){case"MINUTES_1":return"1m";case"MINUTES_5":return"5m";case"MINUTES_15":return"15m";case"HOURS_1":return"1h";case"HOURS_6":return"6h";case"HOURS_12":return"12h";case"DAYS_1":return"1D";case"DAYS_7":return"1W";case"MONTHS_1":return"1M"}return null}class M extends o{constructor(h){super(h);let f=h||{};this.genericFallback=f.genericFallback instanceof p?f.genericFallback:new p(h),this.restBaseUrl=typeof f.bitfinexRestBaseUrl=="string"&&f.bitfinexRestBaseUrl.length>0?f.bitfinexRestBaseUrl:"https://api-pub.bitfinex.com",this.wsBaseUrl=typeof f.bitfinexWsBaseUrl=="string"&&f.bitfinexWsBaseUrl.length>0?f.bitfinexWsBaseUrl:"wss://api-pub.bitfinex.com/ws/2",this.symbolOverrides=f.bitfinexSymbolOverrides||{},this.wsReconnectDelayMs=typeof f.retryDelayMs=="number"?f.retryDelayMs:T;let C={logger:(...E)=>{this.logger(...E)},fetchTicker:this.fetchTickerDirect.bind(this),subscribeStreaming:this.subscribeStream.bind(this),unsubscribeStreaming:this.unsubscribeStream.bind(this),fallbackPollIntervalMs:f.fallbackPollIntervalMs,staleTickerTimeoutMs:f.staleTickerTimeoutMs};this.subscriptionManager=new k(C),this.channelIdToSymbol={},this.webSocketPool=new v({logger:(...E)=>{this.logger(...E)},reconnectDelayMs:this.wsReconnectDelayMs,createWebSocket:()=>{let E=d();if(!E)return this.logger("BitfinexProvider: WebSocket not available in this environment"),null;let y=this.wsBaseUrl.replace(/\/$/,"");try{return new E(y)}catch(O){return this.logger("BitfinexProvider: error creating pooled WebSocket",O),null}},subscribe:(E,y)=>{this.sendBitfinexSubscribe(E,y)},unsubscribe:(E,y,O)=>{this.sendBitfinexUnsubscribe(E,y,O)},handleMessage:(E,y)=>{this.handlePoolMessage(E,y)},onError:E=>{this.logger("BitfinexProvider: pooled WebSocket error",E)},onClose:()=>{this.channelIdToSymbol={}}})}getId(){return"BITFINEX"}subscribeTicker(h,f){return this.subscriptionManager.subscribe(h,f)}getCachedTicker(h){let f=this.subscriptionManager.getCachedTicker(h);return f||(this.genericFallback&&typeof this.genericFallback.getCachedTicker=="function"?this.genericFallback.getCachedTicker(h):null)}ensureConnection(){let h=this;this.subscriptionManager.forEachEntry(function(f){h.subscriptionManager.ensureStreaming(f)})}async fetchTicker(h){try{return await this.fetchTickerDirect(h)}catch(f){if(this.logger("BitfinexProvider: direct fetch failed, using fallback",f),this.genericFallback&&typeof this.genericFallback.fetchTicker=="function")return this.genericFallback.fetchTicker(h);throw f}}async fetchTickerDirect(h){let f=this.resolveSymbol(h);if(!f)throw new Error("BitfinexProvider: unable to resolve symbol for "+(h.symbol||""));let C=this.buildRestUrl(f);try{let E=await fetch(C);if(!E||!E.ok)throw new Error("BitfinexProvider: REST response not ok for "+f);let y=await E.json(),O=this.transformRestTicker(y,h,f);return O.connectionState=P.DETACHED,O}catch(E){if(this.logger("BitfinexProvider: REST fetch error",E),this.genericFallback&&typeof this.genericFallback.fetchTicker=="function"){let y=await this.genericFallback.fetchTicker(h);return y&&typeof y=="object"&&!y.connectionState&&(y.connectionState=P.BACKUP),y}throw E}}subscribeStream(h){if(!h)return!1;let f=this.ensureEntryMeta(h);if(f.bitfinexSymbol=this.resolveSymbol(h.params),!f.bitfinexSymbol)return this.logger("BitfinexProvider: cannot subscribe, unresolved symbol",h.params),!1;f.chanId=null;let C=this.webSocketPool.subscribe(f.bitfinexSymbol,{context:h,onData:E=>{let y=this.buildTickerFromArray(E,h);y&&this.subscriptionManager.handleStreamingUpdate(h.key,y)},onSubscribed:()=>{h.streamingActive=!0;let E=C.getMetadata?C.getMetadata():null;E&&E.chanId&&(f.chanId=E.chanId,this.channelIdToSymbol[f.chanId]=f.bitfinexSymbol)},onDisconnected:()=>{h.streamingActive=!1,f.chanId=null},onError:E=>{this.logger("BitfinexProvider: subscription error",E)}});return C?(f.poolSubscription=C,h.streamingActive=!0,!0):(h.streamingActive=!1,!1)}unsubscribeStream(h){if(!h)return!0;let f=this.ensureEntryMeta(h);return f.poolSubscription&&typeof f.poolSubscription.unsubscribe=="function"&&f.poolSubscription.unsubscribe(),f.poolSubscription=null,f.chanId=null,h.streamingActive=!1,!0}resolveSymbol(h){if(!h)return null;let f=(h.symbol||"").toUpperCase();if(!f)return null;if(this.symbolOverrides&&this.symbolOverrides[f])return(this.symbolOverrides[f]||"").toUpperCase();let C=f.replace(/[:/]/g,"");if(!C)return null;let E=C.toUpperCase();return"t"+(E.startsWith("T")?E.substring(1):E)}buildRestUrl(h){return this.restBaseUrl.replace(/\/$/,"")+"/v2/ticker/"+encodeURIComponent(h)}sendBitfinexSubscribe(h,f){if(!h||!f)return;let C={event:"subscribe",channel:"ticker",symbol:f};try{h.send(JSON.stringify(C))}catch(E){this.logger("BitfinexProvider: error sending subscribe",E)}}sendBitfinexUnsubscribe(h,f,C){if(!h)return;let E=C&&C.chanId;if(E)try{h.send(JSON.stringify({event:"unsubscribe",chanId:E}))}catch(y){this.logger("BitfinexProvider: error sending unsubscribe",y)}}handlePoolMessage(h,f){if(!h)return;let C=h.data;if(C){if(typeof C=="string")try{C=JSON.parse(C)}catch(E){this.logger("BitfinexProvider: failed to parse WebSocket message",E);return}if(C){if(Array.isArray(C)){this.handleBitfinexDataArray(C,f);return}C&&typeof C=="object"&&this.handleBitfinexEvent(C,f)}}}handleBitfinexEvent(h,f){if(!h||typeof h!="object")return;let C=h.event;if(C==="subscribed"&&h.channel==="ticker"){let E=typeof h.symbol=="string"?h.symbol:"";if(!E)return;let y=h.chanId;y&&(this.channelIdToSymbol[y]=E),f.markSubscribed(E,{chanId:y||null});return}if(C==="unsubscribed"){let E=h.chanId,y=null;E&&(y=this.channelIdToSymbol[E]||f.findSymbol(function(O){return O&&O.chanId===E}),delete this.channelIdToSymbol[E]),y&&(f.markUnsubscribed(y),f.updateMetadata(y,{chanId:null}));return}C==="error"&&this.logger("BitfinexProvider: subscription error",h)}handleBitfinexDataArray(h,f){if(!Array.isArray(h)||h.length<2)return;let C=h[0],E=h[1];if(E==="hb"||!Array.isArray(E))return;let y=this.channelIdToSymbol[C]||f.findSymbol(function(O){return O&&O.chanId===C});y&&f.dispatch(y,E,h)}buildTickerFromArray(h,f){if(!Array.isArray(h))return null;let C=f?f.params:null,E=C&&C.symbol?C.symbol:this.ensureEntryMeta(f).bitfinexSymbol;return{changeDaily:i(h[4]),changeDailyPercent:i(h[5]),last:i(h[6]),volume:i(h[7]),high:i(h[8]),low:i(h[9]),pair:E,pairDisplay:E}}transformRestTicker(h,f,C){if(!Array.isArray(h))throw new Error("BitfinexProvider: unexpected REST payload for "+C);let E=f&&f.symbol?f.symbol:C;return{changeDaily:i(h[4]),changeDailyPercent:i(h[5]),last:i(h[6]),volume:i(h[7]),high:i(h[8]),low:i(h[9]),pair:E,pairDisplay:E}}ensureEntryMeta(h){return h.meta=h.meta||{},h.meta}async fetchCandles(h){let f=this.resolveSymbol(h);if(!f)throw new Error("BitfinexProvider: unable to resolve symbol for candles");let C=g(h.interval);if(!C)throw new Error("BitfinexProvider: unsupported interval "+h.interval);let E=Math.min(Math.max(parseInt(h.limit,10)||24,1),1e3),O=this.restBaseUrl.replace(/\/$/,"")+"/v2/candles/trade:"+C+":"+encodeURIComponent(f)+"/hist?limit="+E;try{let S=await fetch(O);if(!S||!S.ok)throw new Error("BitfinexProvider: candles response not ok");let L=await S.json();if(!Array.isArray(L))throw new Error("BitfinexProvider: unexpected candles payload");return L.map(function(V){return{ts:Math.floor((V[0]||0)/1e3),open:i(V[1]),close:i(V[2]),high:i(V[3]),low:i(V[4]),volume:i(V[5]),volumeQuote:i(V[5])}})}catch(S){if(this.logger("BitfinexProvider: error fetching candles",S),this.genericFallback&&typeof this.genericFallback.fetchCandles=="function")return this.genericFallback.fetchCandles(h);throw S}}}return{BitfinexProvider:M}})});var jt=he((wn,et)=>{"use strict";(function(r,t){let c=typeof globalThis!="undefined"?globalThis:r,u=typeof et=="object"&&et.exports?[Ke(),Xe()]:[r==null?void 0:r.CryptoTickerProviders,r==null?void 0:r.CryptoTickerProviders],l=t(u[0],u[1]);typeof et=="object"&&et.exports&&(et.exports=l),c&&(c.CryptoTickerProviders=c.CryptoTickerProviders||{},c.CryptoTickerProviders.YFinanceProvider=l.YFinanceProvider)})(typeof self!="undefined"?self:wn,function(r,t){let c=r.ProviderInterface||r,u=t.GenericProvider||t;class l extends c{constructor(p){super(p);let k=p||{};this.genericFallback=k.genericFallback instanceof u?k.genericFallback:new u(p)}getId(){return"YFINANCE"}ensureConnection(){this.genericFallback.ensureConnection()}subscribeTicker(p,k){return this.genericFallback.subscribeTicker(p,k)}async fetchTicker(p){return this.genericFallback.fetchTicker(p)}getCachedTicker(p){return this.genericFallback.getCachedTicker(p)}}return{YFinanceProvider:l}})});var kn=he((Cn,tt)=>{"use strict";(function(r,t){let c=typeof globalThis!="undefined"?globalThis:r,u=typeof tt=="object"&&tt.exports?[Xe(),Wt(),$t(),jt()]:[r==null?void 0:r.CryptoTickerProviders,r==null?void 0:r.CryptoTickerProviders,r==null?void 0:r.CryptoTickerProviders,r==null?void 0:r.CryptoTickerProviders],l=t(u[0],u[1],u[2],u[3]);typeof tt=="object"&&tt.exports&&(tt.exports=l),c&&(c.CryptoTickerProviders=c.CryptoTickerProviders||{},c.CryptoTickerProviders.ProviderRegistry=l.ProviderRegistry)})(typeof self!="undefined"?self:Cn,function(r,t,c,u){let l=r.GenericProvider||r,o=t.BinanceProvider||t,p=c.BitfinexProvider||c,k=u.YFinanceProvider||u;class P{constructor(T){let d=T||{};this.logger=typeof d.logger=="function"?d.logger:function(){},this.baseUrl=d.baseUrl||"",this.providers={},this.fallbackPollIntervalMs=typeof d.fallbackPollIntervalMs=="number"?d.fallbackPollIntervalMs:void 0,this.staleTickerTimeoutMs=typeof d.staleTickerTimeoutMs=="number"?d.staleTickerTimeoutMs:void 0,this.binanceRestBaseUrl=typeof d.binanceRestBaseUrl=="string"&&d.binanceRestBaseUrl.length>0?d.binanceRestBaseUrl:"https://api.binance.com",this.binanceWsBaseUrl=typeof d.binanceWsBaseUrl=="string"&&d.binanceWsBaseUrl.length>0?d.binanceWsBaseUrl:"wss://stream.binance.com:9443/ws",this.binanceSymbolOverrides=d.binanceSymbolOverrides||{},this.bitfinexRestBaseUrl=typeof d.bitfinexRestBaseUrl=="string"&&d.bitfinexRestBaseUrl.length>0?d.bitfinexRestBaseUrl:"https://api-pub.bitfinex.com",this.bitfinexWsBaseUrl=typeof d.bitfinexWsBaseUrl=="string"&&d.bitfinexWsBaseUrl.length>0?d.bitfinexWsBaseUrl:"wss://api-pub.bitfinex.com/ws/2",this.bitfinexSymbolOverrides=d.bitfinexSymbolOverrides||{};let i={baseUrl:this.baseUrl,logger:this.logger,fallbackPollIntervalMs:this.fallbackPollIntervalMs,staleTickerTimeoutMs:this.staleTickerTimeoutMs};this.genericProvider=d.genericProvider instanceof l?d.genericProvider:new l(i),this.register(this.genericProvider),this.register(new o({baseUrl:this.baseUrl,logger:this.logger,fallbackPollIntervalMs:this.fallbackPollIntervalMs,staleTickerTimeoutMs:this.staleTickerTimeoutMs,genericFallback:this.genericProvider,binanceRestBaseUrl:this.binanceRestBaseUrl,binanceWsBaseUrl:this.binanceWsBaseUrl,binanceSymbolOverrides:this.binanceSymbolOverrides})),this.register(new p({baseUrl:this.baseUrl,logger:this.logger,fallbackPollIntervalMs:this.fallbackPollIntervalMs,staleTickerTimeoutMs:this.staleTickerTimeoutMs,genericFallback:this.genericProvider,bitfinexRestBaseUrl:this.bitfinexRestBaseUrl,bitfinexWsBaseUrl:this.bitfinexWsBaseUrl,bitfinexSymbolOverrides:this.bitfinexSymbolOverrides})),this.register(new k({baseUrl:this.baseUrl,logger:this.logger,fallbackPollIntervalMs:this.fallbackPollIntervalMs,staleTickerTimeoutMs:this.staleTickerTimeoutMs,genericFallback:this.genericProvider}))}register(T){if(!T||typeof T.getId!="function")return;let d=T.getId();d&&(this.providers[d.toUpperCase()]=T)}getProvider(T){let d=(T||"").toUpperCase();return this.providers[d]||this.genericProvider}getGenericProvider(){return this.genericProvider}ensureAllConnections(){let T=Object.keys(this.providers);for(let d=0;d<T.length;d++){let i=this.providers[T[d]];i&&typeof i.ensureConnection=="function"&&i.ensureConnection()}}}return{ProviderRegistry:P}})});var Ht=he((Sn,Pt)=>{"use strict";(function(r,t){let c=t();typeof Pt=="object"&&Pt.exports&&(Pt.exports=c),r&&typeof r=="object"&&(r.CryptoTickerFormatters=c)})(typeof self!="undefined"?self:Sn,function(){let r=["auto","full","compact","plain"],t=[{value:1e12,suffix:"T"},{value:1e9,suffix:"B"},{value:1e6,suffix:"M"},{value:1e3,suffix:"K"}];function c(l,o,p,k){let P=k||"auto",T=typeof o=="number"?o:parseInt(String(o!=null?o:""),10);(Number.isNaN(T)||T<0)&&(T=2);let d=l*(typeof p=="number"?p:1),i=Math.abs(d),g=d<0?"-":"";function M(C,E){let y=Math.pow(10,E);return Math.round(C*y)/y}function A(C,E){try{return C.toLocaleString(void 0,E)}catch{return C.toString()}}let h="",f=Math.max(0,T);switch(P){case"full":{let C=M(i,f);h=A(C,{minimumFractionDigits:f,maximumFractionDigits:f,useGrouping:!0});break}case"compact":{let C="",E=i;for(let O of t)if(i>=O.value){C=O.suffix,E=i/O.value;break}let y=M(E,f);h=A(y,{minimumFractionDigits:f,maximumFractionDigits:f,useGrouping:!C})+C;break}case"plain":{let C=M(i,f);h=A(C,{minimumFractionDigits:f,maximumFractionDigits:f,useGrouping:!1});break}case"auto":default:{let C="",E=i;i>1e5&&(C="K",E=i/1e3);let y=M(E,f);h=A(y,{minimumFractionDigits:f,maximumFractionDigits:f,useGrouping:!1})+C;break}}return g+h}function u(l,o,p){return p-o===0?.5:(l-o)/(p-o)}return{getRoundedValue:c,normalizeValue:u}})});var En=he((Rt,Tn)=>{(function(r,t){typeof Rt=="object"&&typeof Tn!="undefined"?t(Rt):typeof define=="function"&&define.amd?define(["exports"],t):(r=r||self,t(r.exprEval={}))})(Rt,function(r){"use strict";var t="INUMBER",c="IOP1",u="IOP2",l="IOP3",o="IVAR",p="IVARNAME",k="IFUNCALL",P="IFUNDEF",v="IEXPR",T="IEXPREVAL",d="IMEMBER",i="IENDSTATEMENT",g="IARRAY";function M(n,s){this.type=n,this.value=s!=null?s:0}M.prototype.toString=function(){switch(this.type){case t:case c:case u:case l:case o:case p:case i:return this.value;case k:return"CALL "+this.value;case P:return"DEF "+this.value;case g:return"ARRAY "+this.value;case d:return"."+this.value;default:return"Invalid Instruction"}};function A(n){return new M(c,n)}function h(n){return new M(u,n)}function f(n){return new M(l,n)}function C(n,s,m,x,F){for(var $=[],_=[],K,te,ue,le,ge=0;ge<n.length;ge++){var z=n[ge],de=z.type;if(de===t||de===p)Array.isArray(z.value)?$.push.apply($,C(z.value.map(function(bt){return new M(t,bt)}).concat(new M(g,z.value.length)),s,m,x,F)):$.push(z);else if(de===o&&F.hasOwnProperty(z.value))z=new M(t,F[z.value]),$.push(z);else if(de===u&&$.length>1)te=$.pop(),K=$.pop(),le=m[z.value],z=new M(t,le(K.value,te.value)),$.push(z);else if(de===l&&$.length>2)ue=$.pop(),te=$.pop(),K=$.pop(),z.value==="?"?$.push(K.value?te.value:ue.value):(le=x[z.value],z=new M(t,le(K.value,te.value,ue.value)),$.push(z));else if(de===c&&$.length>0)K=$.pop(),le=s[z.value],z=new M(t,le(K.value)),$.push(z);else if(de===v){for(;$.length>0;)_.push($.shift());_.push(new M(v,C(z.value,s,m,x,F)))}else if(de===d&&$.length>0)K=$.pop(),$.push(new M(t,K.value[z.value]));else{for(;$.length>0;)_.push($.shift());_.push(z)}}for(;$.length>0;)_.push($.shift());return _}function E(n,s,m){for(var x=[],F=0;F<n.length;F++){var $=n[F],_=$.type;if(_===o&&$.value===s)for(var K=0;K<m.tokens.length;K++){var te=m.tokens[K],ue;te.type===c?ue=A(te.value):te.type===u?ue=h(te.value):te.type===l?ue=f(te.value):ue=new M(te.type,te.value),x.push(ue)}else _===v?x.push(new M(v,E($.value,s,m))):x.push($)}return x}function y(n,s,m){var x=[],F,$,_,K,te,ue;if(S(n))return L(n,m);for(var le=n.length,ge=0;ge<le;ge++){var z=n[ge],de=z.type;if(de===t||de===p)x.push(z.value);else if(de===u)$=x.pop(),F=x.pop(),z.value==="and"?x.push(F?!!y($,s,m):!1):z.value==="or"?x.push(F?!0:!!y($,s,m)):z.value==="="?(K=s.binaryOps[z.value],x.push(K(F,y($,s,m),m))):(K=s.binaryOps[z.value],x.push(K(L(F,m),L($,m))));else if(de===l)_=x.pop(),$=x.pop(),F=x.pop(),z.value==="?"?x.push(y(F?$:_,s,m)):(K=s.ternaryOps[z.value],x.push(K(L(F,m),L($,m),L(_,m))));else if(de===o)if(z.value in s.functions)x.push(s.functions[z.value]);else if(z.value in s.unaryOps&&s.parser.isOperatorEnabled(z.value))x.push(s.unaryOps[z.value]);else{var bt=m[z.value];if(bt!==void 0)x.push(bt);else throw new Error("undefined variable: "+z.value)}else if(de===c)F=x.pop(),K=s.unaryOps[z.value],x.push(K(L(F,m)));else if(de===k){for(ue=z.value,te=[];ue-- >0;)te.unshift(L(x.pop(),m));if(K=x.pop(),K.apply&&K.call)x.push(K.apply(void 0,te));else throw new Error(K+" is not a function")}else if(de===P)x.push(function(){for(var sr=x.pop(),Bt=[],or=z.value;or-- >0;)Bt.unshift(x.pop());var nn=x.pop(),Lt=function(){for(var rn=Object.assign({},m),yt=0,ar=Bt.length;yt<ar;yt++)rn[Bt[yt]]=arguments[yt];return y(sr,s,rn)};return Object.defineProperty(Lt,"name",{value:nn,writable:!1}),m[nn]=Lt,Lt}());else if(de===v)x.push(O(z,s));else if(de===T)x.push(z);else if(de===d)F=x.pop(),x.push(F[z.value]);else if(de===i)x.pop();else if(de===g){for(ue=z.value,te=[];ue-- >0;)te.unshift(x.pop());x.push(te)}else throw new Error("invalid Expression")}if(x.length>1)throw new Error("invalid Expression (parity)");return x[0]===0?0:L(x[0],m)}function O(n,s,m){return S(n)?n:{type:T,value:function(x){return y(n.value,s,x)}}}function S(n){return n&&n.type===T}function L(n,s){return S(n)?n.value(s):n}function V(n,s){for(var m=[],x,F,$,_,K,te,ue=0;ue<n.length;ue++){var le=n[ue],ge=le.type;if(ge===t)typeof le.value=="number"&&le.value<0?m.push("("+le.value+")"):Array.isArray(le.value)?m.push("["+le.value.map(N).join(", ")+"]"):m.push(N(le.value));else if(ge===u)F=m.pop(),x=m.pop(),_=le.value,s?_==="^"?m.push("Math.pow("+x+", "+F+")"):_==="and"?m.push("(!!"+x+" && !!"+F+")"):_==="or"?m.push("(!!"+x+" || !!"+F+")"):_==="||"?m.push("(function(a,b){ return Array.isArray(a) && Array.isArray(b) ? a.concat(b) : String(a) + String(b); }(("+x+"),("+F+")))"):_==="=="?m.push("("+x+" === "+F+")"):_==="!="?m.push("("+x+" !== "+F+")"):_==="["?m.push(x+"[("+F+") | 0]"):m.push("("+x+" "+_+" "+F+")"):_==="["?m.push(x+"["+F+"]"):m.push("("+x+" "+_+" "+F+")");else if(ge===l)if($=m.pop(),F=m.pop(),x=m.pop(),_=le.value,_==="?")m.push("("+x+" ? "+F+" : "+$+")");else throw new Error("invalid Expression");else if(ge===o||ge===p)m.push(le.value);else if(ge===c)x=m.pop(),_=le.value,_==="-"||_==="+"?m.push("("+_+x+")"):s?_==="not"?m.push("(!"+x+")"):_==="!"?m.push("fac("+x+")"):m.push(_+"("+x+")"):_==="!"?m.push("("+x+"!)"):m.push("("+_+" "+x+")");else if(ge===k){for(te=le.value,K=[];te-- >0;)K.unshift(m.pop());_=m.pop(),m.push(_+"("+K.join(", ")+")")}else if(ge===P){for(F=m.pop(),te=le.value,K=[];te-- >0;)K.unshift(m.pop());x=m.pop(),s?m.push("("+x+" = function("+K.join(", ")+") { return "+F+" })"):m.push("("+x+"("+K.join(", ")+") = "+F+")")}else if(ge===d)x=m.pop(),m.push(x+"."+le.value);else if(ge===g){for(te=le.value,K=[];te-- >0;)K.unshift(m.pop());m.push("["+K.join(", ")+"]")}else if(ge===v)m.push("("+V(le.value,s)+")");else if(ge!==i)throw new Error("invalid Expression")}return m.length>1&&(s?m=[m.join(",")]:m=[m.join(";")]),String(m[0])}function N(n){return typeof n=="string"?JSON.stringify(n).replace(/\u2028/g,"\\u2028").replace(/\u2029/g,"\\u2029"):n}function X(n,s){for(var m=0;m<n.length;m++)if(n[m]===s)return!0;return!1}function ae(n,s,m){m=m||{};for(var x=!!m.withMembers,F=null,$=0;$<n.length;$++){var _=n[$];_.type===o||_.type===p?!x&&!X(s,_.value)?s.push(_.value):(F!==null&&(X(s,F)||s.push(F)),F=_.value):_.type===d&&x&&F!==null?F+="."+_.value:_.type===v?ae(_.value,s,m):F!==null&&(X(s,F)||s.push(F),F=null)}F!==null&&!X(s,F)&&s.push(F)}function J(n,s){this.tokens=n,this.parser=s,this.unaryOps=s.unaryOps,this.binaryOps=s.binaryOps,this.ternaryOps=s.ternaryOps,this.functions=s.functions}J.prototype.simplify=function(n){return n=n||{},new J(C(this.tokens,this.unaryOps,this.binaryOps,this.ternaryOps,n),this.parser)},J.prototype.substitute=function(n,s){return s instanceof J||(s=this.parser.parse(String(s))),new J(E(this.tokens,n,s),this.parser)},J.prototype.evaluate=function(n){return n=n||{},y(this.tokens,this,n)},J.prototype.toString=function(){return V(this.tokens,!1)},J.prototype.symbols=function(n){n=n||{};var s=[];return ae(this.tokens,s,n),s},J.prototype.variables=function(n){n=n||{};var s=[];ae(this.tokens,s,n);var m=this.functions;return s.filter(function(x){return!(x in m)})},J.prototype.toJSFunction=function(n,s){var m=this,x=new Function(n,"with(this.functions) with (this.ternaryOps) with (this.binaryOps) with (this.unaryOps) { return "+V(this.simplify(s).tokens,!0)+"; }");return function(){return x.apply(m,arguments)}};var re="TEOF",j="TOP",q="TNUMBER",fe="TSTRING",U="TPAREN",H="TBRACKET",ve="TCOMMA",Ce="TNAME",ye="TSEMICOLON";function pe(n,s,m){this.type=n,this.value=s,this.index=m}pe.prototype.toString=function(){return this.type+": "+this.value};function Z(n,s){this.pos=0,this.current=null,this.unaryOps=n.unaryOps,this.binaryOps=n.binaryOps,this.ternaryOps=n.ternaryOps,this.consts=n.consts,this.expression=s,this.savedPosition=0,this.savedCurrent=null,this.options=n.options,this.parser=n}Z.prototype.newToken=function(n,s,m){return new pe(n,s,m!=null?m:this.pos)},Z.prototype.save=function(){this.savedPosition=this.pos,this.savedCurrent=this.current},Z.prototype.restore=function(){this.pos=this.savedPosition,this.current=this.savedCurrent},Z.prototype.next=function(){if(this.pos>=this.expression.length)return this.newToken(re,"EOF");if(this.isWhitespace()||this.isComment())return this.next();if(this.isRadixInteger()||this.isNumber()||this.isOperator()||this.isString()||this.isParen()||this.isBracket()||this.isComma()||this.isSemicolon()||this.isNamedOp()||this.isConst()||this.isName())return this.current;this.parseError('Unknown character "'+this.expression.charAt(this.pos)+'"')},Z.prototype.isString=function(){var n=!1,s=this.pos,m=this.expression.charAt(s);if(m==="'"||m==='"')for(var x=this.expression.indexOf(m,s+1);x>=0&&this.pos<this.expression.length;){if(this.pos=x+1,this.expression.charAt(x-1)!=="\\"){var F=this.expression.substring(s+1,x);this.current=this.newToken(fe,this.unescape(F),s),n=!0;break}x=this.expression.indexOf(m,x+1)}return n},Z.prototype.isParen=function(){var n=this.expression.charAt(this.pos);return n==="("||n===")"?(this.current=this.newToken(U,n),this.pos++,!0):!1},Z.prototype.isBracket=function(){var n=this.expression.charAt(this.pos);return(n==="["||n==="]")&&this.isOperatorEnabled("[")?(this.current=this.newToken(H,n),this.pos++,!0):!1},Z.prototype.isComma=function(){var n=this.expression.charAt(this.pos);return n===","?(this.current=this.newToken(ve,","),this.pos++,!0):!1},Z.prototype.isSemicolon=function(){var n=this.expression.charAt(this.pos);return n===";"?(this.current=this.newToken(ye,";"),this.pos++,!0):!1},Z.prototype.isConst=function(){for(var n=this.pos,s=n;s<this.expression.length;s++){var m=this.expression.charAt(s);if(m.toUpperCase()===m.toLowerCase()&&(s===this.pos||m!=="_"&&m!=="."&&(m<"0"||m>"9")))break}if(s>n){var x=this.expression.substring(n,s);if(x in this.consts)return this.current=this.newToken(q,this.consts[x]),this.pos+=x.length,!0}return!1},Z.prototype.isNamedOp=function(){for(var n=this.pos,s=n;s<this.expression.length;s++){var m=this.expression.charAt(s);if(m.toUpperCase()===m.toLowerCase()&&(s===this.pos||m!=="_"&&(m<"0"||m>"9")))break}if(s>n){var x=this.expression.substring(n,s);if(this.isOperatorEnabled(x)&&(x in this.binaryOps||x in this.unaryOps||x in this.ternaryOps))return this.current=this.newToken(j,x),this.pos+=x.length,!0}return!1},Z.prototype.isName=function(){for(var n=this.pos,s=n,m=!1;s<this.expression.length;s++){var x=this.expression.charAt(s);if(x.toUpperCase()===x.toLowerCase()){if(s===this.pos&&(x==="$"||x==="_")){x==="_"&&(m=!0);continue}else if(s===this.pos||!m||x!=="_"&&(x<"0"||x>"9"))break}else m=!0}if(m){var F=this.expression.substring(n,s);return this.current=this.newToken(Ce,F),this.pos+=F.length,!0}return!1},Z.prototype.isWhitespace=function(){for(var n=!1,s=this.expression.charAt(this.pos);(s===" "||s==="	"||s===`
`||s==="\r")&&(n=!0,this.pos++,!(this.pos>=this.expression.length));)s=this.expression.charAt(this.pos);return n};var Te=/^[0-9a-f]{4}$/i;Z.prototype.unescape=function(n){var s=n.indexOf("\\");if(s<0)return n;for(var m=n.substring(0,s);s>=0;){var x=n.charAt(++s);switch(x){case"'":m+="'";break;case'"':m+='"';break;case"\\":m+="\\";break;case"/":m+="/";break;case"b":m+="\b";break;case"f":m+="\f";break;case"n":m+=`
`;break;case"r":m+="\r";break;case"t":m+="	";break;case"u":var F=n.substring(s+1,s+5);Te.test(F)||this.parseError("Illegal escape sequence: \\u"+F),m+=String.fromCharCode(parseInt(F,16)),s+=4;break;default:throw this.parseError('Illegal escape sequence: "\\'+x+'"')}++s;var $=n.indexOf("\\",s);m+=n.substring(s,$<0?n.length:$),s=$}return m},Z.prototype.isComment=function(){var n=this.expression.charAt(this.pos);return n==="/"&&this.expression.charAt(this.pos+1)==="*"?(this.pos=this.expression.indexOf("*/",this.pos)+2,this.pos===1&&(this.pos=this.expression.length),!0):!1},Z.prototype.isRadixInteger=function(){var n=this.pos;if(n>=this.expression.length-2||this.expression.charAt(n)!=="0")return!1;++n;var s,m;if(this.expression.charAt(n)==="x")s=16,m=/^[0-9a-f]$/i,++n;else if(this.expression.charAt(n)==="b")s=2,m=/^[01]$/i,++n;else return!1;for(var x=!1,F=n;n<this.expression.length;){var $=this.expression.charAt(n);if(m.test($))n++,x=!0;else break}return x&&(this.current=this.newToken(q,parseInt(this.expression.substring(F,n),s)),this.pos=n),x},Z.prototype.isNumber=function(){for(var n=!1,s=this.pos,m=s,x=s,F=!1,$=!1,_;s<this.expression.length&&(_=this.expression.charAt(s),_>="0"&&_<="9"||!F&&_===".");)_==="."?F=!0:$=!0,s++,n=$;if(n&&(x=s),_==="e"||_==="E"){s++;for(var K=!0,te=!1;s<this.expression.length;){if(_=this.expression.charAt(s),K&&(_==="+"||_==="-"))K=!1;else if(_>="0"&&_<="9")te=!0,K=!1;else break;s++}te||(s=x)}return n?(this.current=this.newToken(q,parseFloat(this.expression.substring(m,s))),this.pos=s):this.pos=x,n},Z.prototype.isOperator=function(){var n=this.pos,s=this.expression.charAt(this.pos);if(s==="+"||s==="-"||s==="*"||s==="/"||s==="%"||s==="^"||s==="?"||s===":"||s===".")this.current=this.newToken(j,s);else if(s==="\u2219"||s==="\u2022")this.current=this.newToken(j,"*");else if(s===">")this.expression.charAt(this.pos+1)==="="?(this.current=this.newToken(j,">="),this.pos++):this.current=this.newToken(j,">");else if(s==="<")this.expression.charAt(this.pos+1)==="="?(this.current=this.newToken(j,"<="),this.pos++):this.current=this.newToken(j,"<");else if(s==="|")if(this.expression.charAt(this.pos+1)==="|")this.current=this.newToken(j,"||"),this.pos++;else return!1;else if(s==="=")this.expression.charAt(this.pos+1)==="="?(this.current=this.newToken(j,"=="),this.pos++):this.current=this.newToken(j,s);else if(s==="!")this.expression.charAt(this.pos+1)==="="?(this.current=this.newToken(j,"!="),this.pos++):this.current=this.newToken(j,s);else return!1;return this.pos++,this.isOperatorEnabled(this.current.value)?!0:(this.pos=n,!1)},Z.prototype.isOperatorEnabled=function(n){return this.parser.isOperatorEnabled(n)},Z.prototype.getCoordinates=function(){var n=0,s,m=-1;do n++,s=this.pos-m,m=this.expression.indexOf(`
`,m+1);while(m>=0&&m<this.pos);return{line:n,column:s}},Z.prototype.parseError=function(n){var s=this.getCoordinates();throw new Error("parse error ["+s.line+":"+s.column+"]: "+n)};function Y(n,s,m){this.parser=n,this.tokens=s,this.current=null,this.nextToken=null,this.next(),this.savedCurrent=null,this.savedNextToken=null,this.allowMemberAccess=m.allowMemberAccess!==!1}Y.prototype.next=function(){return this.current=this.nextToken,this.nextToken=this.tokens.next()},Y.prototype.tokenMatches=function(n,s){return typeof s=="undefined"?!0:Array.isArray(s)?X(s,n.value):typeof s=="function"?s(n):n.value===s},Y.prototype.save=function(){this.savedCurrent=this.current,this.savedNextToken=this.nextToken,this.tokens.save()},Y.prototype.restore=function(){this.tokens.restore(),this.current=this.savedCurrent,this.nextToken=this.savedNextToken},Y.prototype.accept=function(n,s){return this.nextToken.type===n&&this.tokenMatches(this.nextToken,s)?(this.next(),!0):!1},Y.prototype.expect=function(n,s){if(!this.accept(n,s)){var m=this.tokens.getCoordinates();throw new Error("parse error ["+m.line+":"+m.column+"]: Expected "+(s||n))}},Y.prototype.parseAtom=function(n){var s=this.tokens.unaryOps;function m(F){return F.value in s}if(this.accept(Ce)||this.accept(j,m))n.push(new M(o,this.current.value));else if(this.accept(q))n.push(new M(t,this.current.value));else if(this.accept(fe))n.push(new M(t,this.current.value));else if(this.accept(U,"("))this.parseExpression(n),this.expect(U,")");else if(this.accept(H,"["))if(this.accept(H,"]"))n.push(new M(g,0));else{var x=this.parseArrayList(n);n.push(new M(g,x))}else throw new Error("unexpected "+this.nextToken)},Y.prototype.parseExpression=function(n){var s=[];this.parseUntilEndStatement(n,s)||(this.parseVariableAssignmentExpression(s),!this.parseUntilEndStatement(n,s)&&this.pushExpression(n,s))},Y.prototype.pushExpression=function(n,s){for(var m=0,x=s.length;m<x;m++)n.push(s[m])},Y.prototype.parseUntilEndStatement=function(n,s){return this.accept(ye)?(this.nextToken&&this.nextToken.type!==re&&!(this.nextToken.type===U&&this.nextToken.value===")")&&s.push(new M(i)),this.nextToken.type!==re&&this.parseExpression(s),n.push(new M(v,s)),!0):!1},Y.prototype.parseArrayList=function(n){for(var s=0;!this.accept(H,"]");)for(this.parseExpression(n),++s;this.accept(ve);)this.parseExpression(n),++s;return s},Y.prototype.parseVariableAssignmentExpression=function(n){for(this.parseConditionalExpression(n);this.accept(j,"=");){var s=n.pop(),m=[],x=n.length-1;if(s.type===k){if(!this.tokens.isOperatorEnabled("()="))throw new Error("function definition is not permitted");for(var F=0,$=s.value+1;F<$;F++){var _=x-F;n[_].type===o&&(n[_]=new M(p,n[_].value))}this.parseVariableAssignmentExpression(m),n.push(new M(v,m)),n.push(new M(P,s.value));continue}if(s.type!==o&&s.type!==d)throw new Error("expected variable for assignment");this.parseVariableAssignmentExpression(m),n.push(new M(p,s.value)),n.push(new M(v,m)),n.push(h("="))}},Y.prototype.parseConditionalExpression=function(n){for(this.parseOrExpression(n);this.accept(j,"?");){var s=[],m=[];this.parseConditionalExpression(s),this.expect(j,":"),this.parseConditionalExpression(m),n.push(new M(v,s)),n.push(new M(v,m)),n.push(f("?"))}},Y.prototype.parseOrExpression=function(n){for(this.parseAndExpression(n);this.accept(j,"or");){var s=[];this.parseAndExpression(s),n.push(new M(v,s)),n.push(h("or"))}},Y.prototype.parseAndExpression=function(n){for(this.parseComparison(n);this.accept(j,"and");){var s=[];this.parseComparison(s),n.push(new M(v,s)),n.push(h("and"))}};var Ee=["==","!=","<","<=",">=",">","in"];Y.prototype.parseComparison=function(n){for(this.parseAddSub(n);this.accept(j,Ee);){var s=this.current;this.parseAddSub(n),n.push(h(s.value))}};var Q=["+","-","||"];Y.prototype.parseAddSub=function(n){for(this.parseTerm(n);this.accept(j,Q);){var s=this.current;this.parseTerm(n),n.push(h(s.value))}};var ee=["*","/","%"];Y.prototype.parseTerm=function(n){for(this.parseFactor(n);this.accept(j,ee);){var s=this.current;this.parseFactor(n),n.push(h(s.value))}},Y.prototype.parseFactor=function(n){var s=this.tokens.unaryOps;function m(F){return F.value in s}if(this.save(),this.accept(j,m)){if(this.current.value!=="-"&&this.current.value!=="+"){if(this.nextToken.type===U&&this.nextToken.value==="("){this.restore(),this.parseExponential(n);return}else if(this.nextToken.type===ye||this.nextToken.type===ve||this.nextToken.type===re||this.nextToken.type===U&&this.nextToken.value===")"){this.restore(),this.parseAtom(n);return}}var x=this.current;this.parseFactor(n),n.push(A(x.value))}else this.parseExponential(n)},Y.prototype.parseExponential=function(n){for(this.parsePostfixExpression(n);this.accept(j,"^");)this.parseFactor(n),n.push(h("^"))},Y.prototype.parsePostfixExpression=function(n){for(this.parseFunctionCall(n);this.accept(j,"!");)n.push(A("!"))},Y.prototype.parseFunctionCall=function(n){var s=this.tokens.unaryOps;function m($){return $.value in s}if(this.accept(j,m)){var x=this.current;this.parseAtom(n),n.push(A(x.value))}else for(this.parseMemberExpression(n);this.accept(U,"(");)if(this.accept(U,")"))n.push(new M(k,0));else{var F=this.parseArgumentList(n);n.push(new M(k,F))}},Y.prototype.parseArgumentList=function(n){for(var s=0;!this.accept(U,")");)for(this.parseExpression(n),++s;this.accept(ve);)this.parseExpression(n),++s;return s},Y.prototype.parseMemberExpression=function(n){for(this.parseAtom(n);this.accept(j,".")||this.accept(H,"[");){var s=this.current;if(s.value==="."){if(!this.allowMemberAccess)throw new Error('unexpected ".", member access is not permitted');this.expect(Ce),n.push(new M(d,this.current.value))}else if(s.value==="["){if(!this.tokens.isOperatorEnabled("["))throw new Error('unexpected "[]", arrays are disabled');this.parseExpression(n),this.expect(H,"]"),n.push(h("["))}else throw new Error("unexpected symbol: "+s.value)}};function Oe(n,s){return Number(n)+Number(s)}function Le(n,s){return n-s}function _e(n,s){return n*s}function Ne(n,s){return n/s}function Se(n,s){return n%s}function ce(n,s){return Array.isArray(n)&&Array.isArray(s)?n.concat(s):""+n+s}function Ie(n,s){return n===s}function Fe(n,s){return n!==s}function We(n,s){return n>s}function Ue(n,s){return n<s}function I(n,s){return n>=s}function e(n,s){return n<=s}function a(n,s){return!!(n&&s)}function b(n,s){return!!(n||s)}function w(n,s){return X(s,n)}function R(n){return(Math.exp(n)-Math.exp(-n))/2}function D(n){return(Math.exp(n)+Math.exp(-n))/2}function B(n){return n===1/0?1:n===-1/0?-1:(Math.exp(n)-Math.exp(-n))/(Math.exp(n)+Math.exp(-n))}function W(n){return n===-1/0?n:Math.log(n+Math.sqrt(n*n+1))}function G(n){return Math.log(n+Math.sqrt(n*n-1))}function ne(n){return Math.log((1+n)/(1-n))/2}function De(n){return Math.log(n)*Math.LOG10E}function Ve(n){return-n}function se(n){return!n}function ie(n){return n<0?Math.ceil(n):Math.floor(n)}function oe(n){return Math.random()*(n||1)}function ke(n){return xe(n+1)}function ze(n){return isFinite(n)&&n===Math.round(n)}var ht=4.7421875,Be=[.9999999999999971,57.15623566586292,-59.59796035547549,14.136097974741746,-.4919138160976202,3399464998481189e-20,4652362892704858e-20,-9837447530487956e-20,.0001580887032249125,-.00021026444172410488,.00021743961811521265,-.0001643181065367639,8441822398385275e-20,-26190838401581408e-21,36899182659531625e-22];function xe(n){var s,m;if(ze(n)){if(n<=0)return isFinite(n)?1/0:NaN;if(n>171)return 1/0;for(var x=n-2,F=n-1;x>1;)F*=x,x--;return F===0&&(F=1),F}if(n<.5)return Math.PI/(Math.sin(Math.PI*n)*xe(1-n));if(n>=171.35)return 1/0;if(n>85){var $=n*n,_=$*n,K=_*n,te=K*n;return Math.sqrt(2*Math.PI/n)*Math.pow(n/Math.E,n)*(1+1/(12*n)+1/(288*$)-139/(51840*_)-571/(2488320*K)+163879/(209018880*te)+5246819/(75246796800*te*n))}--n,m=Be[0];for(var ue=1;ue<Be.length;++ue)m+=Be[ue]/(n+ue);return s=n+ht+.5,Math.sqrt(2*Math.PI)*Math.pow(s,n+.5)*Math.exp(-s)*m}function ft(n){return Array.isArray(n)?n.length:String(n).length}function gt(){for(var n=0,s=0,m=0;m<arguments.length;m++){var x=Math.abs(arguments[m]),F;s<x?(F=s/x,n=n*F*F+1,s=x):x>0?(F=x/s,n+=F*F):n+=x}return s===1/0?1/0:s*Math.sqrt(n)}function qe(n,s,m){return n?s:m}function jn(n,s){return typeof s=="undefined"||+s==0?Math.round(n):(n=+n,s=-+s,isNaN(n)||!(typeof s=="number"&&s%1===0)?NaN:(n=n.toString().split("e"),n=Math.round(+(n[0]+"e"+(n[1]?+n[1]-s:-s))),n=n.toString().split("e"),+(n[0]+"e"+(n[1]?+n[1]+s:s))))}function Hn(n,s,m){return m&&(m[n]=s),s}function Vn(n,s){return n[s|0]}function qn(n){return arguments.length===1&&Array.isArray(n)?Math.max.apply(Math,n):Math.max.apply(Math,arguments)}function zn(n){return arguments.length===1&&Array.isArray(n)?Math.min.apply(Math,n):Math.min.apply(Math,arguments)}function Gn(n,s){if(typeof n!="function")throw new Error("First argument to map is not a function");if(!Array.isArray(s))throw new Error("Second argument to map is not an array");return s.map(function(m,x){return n(m,x)})}function Kn(n,s,m){if(typeof n!="function")throw new Error("First argument to fold is not a function");if(!Array.isArray(m))throw new Error("Second argument to fold is not an array");return m.reduce(function(x,F,$){return n(x,F,$)},s)}function Yn(n,s){if(typeof n!="function")throw new Error("First argument to filter is not a function");if(!Array.isArray(s))throw new Error("Second argument to filter is not an array");return s.filter(function(m,x){return n(m,x)})}function Jn(n,s){if(!(Array.isArray(s)||typeof s=="string"))throw new Error("Second argument to indexOf is not a string or array");return s.indexOf(n)}function Xn(n,s){if(!Array.isArray(s))throw new Error("Second argument to join is not an array");return s.join(n)}function Qn(n){return(n>0)-(n<0)||+n}var Zt=1/3;function Zn(n){return n<0?-Math.pow(-n,Zt):Math.pow(n,Zt)}function er(n){return Math.exp(n)-1}function tr(n){return Math.log(1+n)}function nr(n){return Math.log(n)/Math.LN2}function $e(n){this.options=n||{},this.unaryOps={sin:Math.sin,cos:Math.cos,tan:Math.tan,asin:Math.asin,acos:Math.acos,atan:Math.atan,sinh:Math.sinh||R,cosh:Math.cosh||D,tanh:Math.tanh||B,asinh:Math.asinh||W,acosh:Math.acosh||G,atanh:Math.atanh||ne,sqrt:Math.sqrt,cbrt:Math.cbrt||Zn,log:Math.log,log2:Math.log2||nr,ln:Math.log,lg:Math.log10||De,log10:Math.log10||De,expm1:Math.expm1||er,log1p:Math.log1p||tr,abs:Math.abs,ceil:Math.ceil,floor:Math.floor,round:Math.round,trunc:Math.trunc||ie,"-":Ve,"+":Number,exp:Math.exp,not:se,length:ft,"!":ke,sign:Math.sign||Qn},this.binaryOps={"+":Oe,"-":Le,"*":_e,"/":Ne,"%":Se,"^":Math.pow,"||":ce,"==":Ie,"!=":Fe,">":We,"<":Ue,">=":I,"<=":e,and:a,or:b,in:w,"=":Hn,"[":Vn},this.ternaryOps={"?":qe},this.functions={random:oe,fac:ke,min:zn,max:qn,hypot:Math.hypot||gt,pyt:Math.hypot||gt,pow:Math.pow,atan2:Math.atan2,if:qe,gamma:xe,roundTo:jn,map:Gn,fold:Kn,filter:Yn,indexOf:Jn,join:Xn},this.consts={E:Math.E,PI:Math.PI,true:!0,false:!1}}$e.prototype.parse=function(n){var s=[],m=new Y(this,new Z(this,n),{allowMemberAccess:this.options.allowMemberAccess});return m.parseExpression(s),m.expect(re,"EOF"),new J(s,this)},$e.prototype.evaluate=function(n,s){return this.parse(n).evaluate(s)};var en=new $e;$e.parse=function(n){return en.parse(n)},$e.evaluate=function(n,s){return en.parse(n).evaluate(s)};var tn={"+":"add","-":"subtract","*":"multiply","/":"divide","%":"remainder","^":"power","!":"factorial","<":"comparison",">":"comparison","<=":"comparison",">=":"comparison","==":"comparison","!=":"comparison","||":"concatenate",and:"logical",or:"logical",not:"logical","?":"conditional",":":"conditional","=":"assignment","[":"array","()=":"fndef"};function rr(n){return tn.hasOwnProperty(n)?tn[n]:n}$e.prototype.isOperatorEnabled=function(n){var s=rr(n),m=this.options.operators||{};return!(s in m)||!!m[s]};var ir={Parser:$e,Expression:J};r.Expression=J,r.Parser=$e,r.default=ir,Object.defineProperty(r,"__esModule",{value:!0})})});var Dt=he((Rn,Mt)=>{"use strict";var It=class{constructor(t,c){let u=t||{},l=Array.isArray(u.allowedVariables)&&u.allowedVariables.length>0?u.allowedVariables.slice():Vt.slice();this.allowedVariables=l;let o=c||Pn();this.parser=new o({operators:{add:!0,subtract:!0,multiply:!0,divide:!0,remainder:!0,power:!1,factorial:!1,comparison:!0,logical:!0,conditional:!0,concatenate:!1,assignment:!1,array:!1,fndef:!1},allowMemberAccess:!1}),this.cache={}}validate(t){let c;try{c=this.getCacheEntry(t)}catch(u){return{ok:!1,error:u instanceof Error?u.message:"Invalid expression"}}return c?c.disallowedVariables.length>0?{ok:!1,error:"Unknown variables: "+c.disallowedVariables.join(", ")+". Allowed variables: "+this.allowedVariables.join(", ")}:{ok:!0,variables:c.variables.slice()}:{ok:!1,error:"Expression cannot be empty"}}evaluate(t,c){let u=this.getCacheEntry(t);if(!u)throw new Error("Expression cannot be empty");if(u.disallowedVariables.length>0)throw new Error("Unknown variables: "+u.disallowedVariables.join(", ")+". Allowed variables: "+this.allowedVariables.join(", "));let l={},o=c||{};for(let p of this.allowedVariables){let k=Object.prototype.hasOwnProperty.call(o,p)?o[p]:void 0;if(Vt.indexOf(p)!==-1){l[p]=He(k);continue}typeof k=="number"?l[p]=Number.isFinite(k)?k:0:typeof k=="boolean"||typeof k=="string"?l[p]=k:k==null?l[p]=0:l[p]=k}return u.compiled.evaluate(l)}clearCache(){this.cache={}}getCacheEntry(t){let c=this.normalizeExpression(t);if(!c)return null;if(this.cache[c])return this.cache[c];let u;try{u=this.parser.parse(c)}catch(k){throw this.wrapParseError(k)}let l=u.variables({withMembers:!1})||[],o=l.filter(k=>this.allowedVariables.indexOf(k)===-1),p={expression:c,compiled:u,variables:l.slice(),disallowedVariables:o.slice()};return this.cache[c]=p,p}normalizeExpression(t){return typeof t!="string"?"":t.trim()}wrapParseError(t){let c=t&&typeof t=="object"&&t instanceof Error&&t.message?yr(t.message):"Invalid expression",u=new Error(c);return t&&typeof t=="object"&&(u.originalError=t),u}},Vt=["value","high","low","changeDaily","changeDailyPercent","volume"];function gr(r){return r?r.slice():[]}function He(r){if(r==null)return 0;if(typeof r=="number")return Number.isFinite(r)?r:0;if(typeof r=="string"&&r.trim()!==""){let t=Number(r);if(!Number.isNaN(t)&&Number.isFinite(t))return t}return 0}function xn(r){let t=r||{};return{value:He(t.last),high:He(t.high),low:He(t.low),changeDaily:He(t.changeDaily),changeDailyPercent:He(t.changeDailyPercent),volume:He(t.volume)}}function br(r,t){let c=xn(r);if(t&&typeof t=="object")for(let u in t)Object.prototype.hasOwnProperty.call(t,u)&&(c[u]=t[u]);return c}function yr(r){return r?r.indexOf("member access is not permitted")>=0?r+'. Remove object-style prefixes (for example use "value" instead of "values.last").':r:"Invalid expression"}function Pn(){if(typeof je=="function")try{let c=En();if(c&&c.Parser)return c.Parser}catch{}let r=typeof globalThis!="undefined"?globalThis:{},t=r.exprEval&&r.exprEval.Parser;if(t)return t;throw new Error("expr-eval dependency is missing")}(function(t,c){let u=Pn(),l=c(u);typeof Mt=="object"&&Mt.exports&&(Mt.exports=l),t&&typeof t=="object"&&(t.CryptoTickerExpressionEvaluator=l)})(typeof self!="undefined"?self:Rn,function(t){return{createEvaluator:c=>new It(c,t),ExpressionEvaluator:It,normalizeNumericValue:He,buildBaseContext:xn,buildContext:br,allowedVariables:gr(Vt)}})});var qt=he((Mn,nt)=>{"use strict";(function(r,t){let c=typeof nt=="object"&&nt.exports?Dt():r==null?void 0:r.CryptoTickerExpressionEvaluator,u=t(c);typeof nt=="object"&&nt.exports&&(nt.exports=u),r&&typeof r=="object"&&(r.CryptoTickerAlertManager=u)})(typeof self!="undefined"?self:Mn,function(r){if(!r)throw new Error("Expression evaluator dependency is missing");let t=r,c=t.createEvaluator(),u={},l={};function o(i){return u[i]||"off"}function p(i){return l[i]!=="off"}function k(i){l[i]="off"}function P(i){l[i]="on"}function v(i){return p(i)&&o(i)==="on"}function T(i){delete u[i],delete l[i]}function d(i){let g=i.context,M=i.settings||{},A=i.values||{},h=i.backgroundColor,f=i.textColor,C=!1,E=M.alertRule;if(!E)return u[g]="off",{alertMode:C,backgroundColor:h,textColor:f};try{let y=t.buildBaseContext(A);if(c.evaluate(E,y)){if(u[g]="on",p(g)){C=!0;let S=h;h=f,f=S}}else u[g]="off",P(g)}catch(y){u[g]="error",console.error("Error evaluating alertRule",{context:g,settings:M,values:A,error:y instanceof Error?y.message:y})}return{alertMode:C,backgroundColor:h,textColor:f}}return{evaluateAlert:d,shouldDisarmOnKeyPress:v,disarmAlert:k,armAlert:P,clearContext:T,getAlertStatus:o,isAlertArmed:p}})});var zt=he((In,At)=>{"use strict";(function(t,c){let u=c();typeof At=="object"&&At.exports&&(At.exports=u),t&&typeof t=="object"&&(t.CryptoTickerState=u)})(typeof self!="undefined"?self:In,function(){let t={},c={},u={},l={},o={},p={};function k(N,X){t[N]={context:N,settings:X}}function P(N){return t[N]||null}function v(N){Object.keys(t).forEach(X=>{N(t[X],X)})}function T(N){delete t[N],delete p[N]}function d(N,X){N&&(c[N]=X||null)}function i(N){return N&&c[N]||null}function g(N){N&&delete c[N]}function M(N,X){N&&X&&(u[N]=X)}function A(N){return N&&u[N]||null}function h(N){N&&(delete u[N],delete p[N])}function f(N){return l[N]||(l[N]={}),l[N]}function C(N,X){l[N]=X}function E(N){return o[N]}function y(N,X){o[N]=X}function O(){Object.keys(t).forEach(N=>{delete t[N]}),Object.keys(c).forEach(N=>{let X=c[N];if(X&&typeof X.unsubscribe=="function")try{X.unsubscribe()}catch{}delete c[N]}),Object.keys(u).forEach(N=>{delete u[N]}),Object.keys(l).forEach(N=>{delete l[N]}),Object.keys(o).forEach(N=>{delete o[N]}),Object.keys(p).forEach(N=>{delete p[N]})}function S(N,X,ae){if(!N||!X)return;let J=typeof ae=="number"?ae:Date.now();p[N]={values:Object.assign({},X),timestamp:J}}function L(N){return N&&p[N]||null}function V(N){N&&delete p[N]}return{setContextDetails:k,getContextDetails:P,forEachContext:v,clearContextDetails:T,setSubscription:d,getSubscription:i,clearSubscription:g,setConnectionState:M,getConnectionState:A,clearConnectionState:h,getOrCreateConversionRateEntry:f,setConversionRateEntry:C,getCandlesCacheEntry:E,setCandlesCacheEntry:y,resetAllState:O,setLastGoodTicker:S,getLastGoodTicker:L,clearLastGoodTicker:V}})});var An=he((Dn,rt)=>{"use strict";(function(r,t){let c=typeof globalThis!="undefined"?globalThis:r,u=typeof rt=="object"&&rt.exports?zt():r==null?void 0:r.CryptoTickerState,l=t(u,c);typeof rt=="object"&&rt.exports&&(rt.exports=l),r&&typeof r=="object"&&(r.CryptoTickerSettingsManager=l)})(typeof self!="undefined"?self:Dn,function(t,c){function u(i){if(typeof je=="function")try{return je(i)}catch{return null}return null}function l(){return c&&typeof c.CryptoTickerDefaults!="undefined"?c.CryptoTickerDefaults:u("./default-settings")}let o=l();function p(){if(!o)throw new Error("Default settings module is not available");return o}function k(i){let g=p();return typeof g.applyDefaults=="function"?g.applyDefaults(i):g.defaultSettings?Object.assign({},g.defaultSettings,i||{}):Object.assign({},i||{})}function P(){let i=p();return typeof i.getDefaultSettings=="function"?i.getDefaultSettings():i.defaultSettings?JSON.parse(JSON.stringify(i.defaultSettings)):{}}let v=P();function T(i){let g=i.context,M=i.settings,A=i.updateSubscription,h=k(M);return t.setContextDetails(g,h),typeof A=="function"&&A(h),h}let d=o&&o.settingsSchema?o.settingsSchema:null;return{applyDefaultSettings:k,getDefaultSettingsSnapshot:P,defaultSettings:v,settingsSchema:d,refreshSettings:T}})});var On=he(($r,Ot)=>{"use strict";var mr={TIMESTAMP_SECONDS_THRESHOLD:9999999999,DEFAULT_PRICE_BAR_POSITION:.5};(function(t,c){let u=c();if(typeof Ot=="object"&&Ot.exports)Ot.exports=u;else{let l=t.CryptoTickerConstants||{};t.CryptoTickerConstants=Object.assign({},l,u)}})(typeof globalThis!="undefined"?globalThis:self,function(){return mr})});var Fn=he((Nn,Nt)=>{"use strict";(function(r,t){let c=t();typeof Nt=="object"&&Nt.exports&&(Nt.exports=c),r&&typeof r=="object"&&(r.CryptoTickerConnectionStatusIcons=c)})(typeof self!="undefined"?self:Nn,function(){function t(){return{LIVE:"live",DETACHED:"detached",BACKUP:"backup",BROKEN:"broken"}}function c(l){if(!l||typeof l!="object")return t();let o=t(),p={};for(let k in o){if(!Object.prototype.hasOwnProperty.call(o,k))continue;let P=o[k],v=l[k];p[k]=typeof v=="string"&&v?v:P}return p}function u(l){let o=l.canvasContext,p=l.canvas,k=l.state,P=l.color,v=l.sizeMultiplier,T=l.position,d=l.connectionStates;if(!p||!o||!k)return;let i=c(d),g=(T||"OFF").toUpperCase();if(g==="OFF")return;let M=String(k).toLowerCase(),A=typeof v=="number"&&Number.isFinite(v)&&v>0?v:1,h=20*A,f=4*A,C=p.width-h-f,E=f;g==="BOTTOM_LEFT"&&(C=f,E=p.height-h-f),o.save(),o.translate(C,E),o.lineWidth=Math.max(1.5*A,1),o.strokeStyle=P,o.fillStyle=P;function y(O){if(!(!Array.isArray(O)||O.length===0)){o.beginPath();for(let S=0;S<O.length;S++){let L=O[S],V=L[0]*h,N=L[1]*h;S===0?o.moveTo(V,N):o.lineTo(V,N)}o.closePath(),o.fill()}}M===i.LIVE?y([[.7545784909869392,0],[.18263591551829597,.5685964091677761],[.3947756629367107,.5685964091677761],[.23171302126434715,1],[.8173281041988991,.43136761054941897],[.6051523764976793,.43136761054941897]]):M===i.DETACHED?(y([[0,.45],[.4,.45],[.4,.6],[0,.6]]),y([[.6,.45],[1,.45],[1,.6],[.6,.6]])):M===i.BACKUP?(y([[0,.3],[.4,.3],[.4,.38],[0,.38]]),y([[.6,.3],[1,.3],[1,.38],[.6,.38]]),y([[0,.62],[.4,.62],[.4,.7],[0,.7]]),y([[.6,.62],[1,.62],[1,.7],[.6,.7]])):M===i.BROKEN&&(o.save(),o.fillStyle="#ff0000",o.beginPath(),o.moveTo(h*.46,h*.32),o.lineTo(h*.42,h*.38),o.lineTo(h*.46,h*.44),o.lineTo(h*.41,h*.5),o.lineTo(h*.43,h*.88),o.lineTo(h*.3,h*.73),o.lineTo(h*.18,h*.62),o.bezierCurveTo(h*.08,h*.52,h*.08,h*.38,h*.15,h*.28),o.bezierCurveTo(h*.25,h*.16,h*.4,h*.2,h*.46,h*.32),o.closePath(),o.fill(),o.beginPath(),o.moveTo(h*.54,h*.28),o.lineTo(h*.58,h*.34),o.lineTo(h*.54,h*.4),o.lineTo(h*.59,h*.46),o.lineTo(h*.57,h*.84),o.lineTo(h*.7,h*.69),o.lineTo(h*.82,h*.58),o.bezierCurveTo(h*.92,h*.48,h*.92,h*.34,h*.85,h*.24),o.bezierCurveTo(h*.75,h*.12,h*.6,h*.16,h*.54,h*.28),o.closePath(),o.fill(),o.restore()),o.restore()}return{renderConnectionStatusIcon:u}})});var Bn=he((Un,it)=>{"use strict";(function(r,t){let c=typeof it=="object"&&it.exports?[qt(),Ht(),Dt(),On(),Fn()]:[r==null?void 0:r.CryptoTickerAlertManager,r==null?void 0:r.CryptoTickerFormatters,r==null?void 0:r.CryptoTickerExpressionEvaluator,r==null?void 0:r.CryptoTickerConstants,r==null?void 0:r.CryptoTickerConnectionStatusIcons],u=t(c[0],c[1],c[2],c[3],c[4]);typeof it=="object"&&it.exports&&(it.exports=u),r&&typeof r=="object"&&(r.CryptoTickerCanvasRenderer=u)})(typeof self!="undefined"?self:Un,function(r,t,c,u,l){if(!r)throw new Error("Alert manager dependency is missing");if(!t)throw new Error("Formatters dependency is missing");if(!c)throw new Error("Expression evaluator dependency is missing");let o=u||{},p=typeof o.TIMESTAMP_SECONDS_THRESHOLD=="number"?o.TIMESTAMP_SECONDS_THRESHOLD:9999999999,k=typeof o.DEFAULT_PRICE_BAR_POSITION=="number"?o.DEFAULT_PRICE_BAR_POSITION:.5;function P(){let y=c.allowedVariables.slice(0),O=["alert","backgroundColor","textColor","defaultBackgroundColor","defaultTextColor"];for(let S=0;S<O.length;S++)y.indexOf(O[S])===-1&&y.push(O[S]);return c.createEvaluator({allowedVariables:y})}let v=P(),T=l&&typeof l=="object"?l:null,d=T&&typeof T.renderConnectionStatusIcon=="function"?T.renderConnectionStatusIcon:function(){};function i(y,O){return Math.max(y/144,O/144)}function g(y){let O=parseInt(y.candlesDisplayed);return isNaN(O)?20:Math.min(60,Math.max(5,O))}function M(y,O,S,L,V){let N=Math.sqrt(.75*Math.pow(L,2));y.beginPath(),y.moveTo(O-L/2,S-N/3),y.lineTo(O+L/2,S-N/3),y.lineTo(O,S+N*2/3),y.fillStyle=V,y.fill()}function A(y,O,S,L){if(!O&&O!==0)return[""];let V=String(O).split(/\r?\n/),N=[];function X(ae){let J=ae.split(""),re=[],j="";for(let q=0;q<J.length;q++){let fe=j+J[q];y.measureText(fe).width>S&&j?(re.push(j),j=J[q]):j=fe}return j&&re.push(j),re}y.font=L;for(let ae=0;ae<V.length;ae++){let J=V[ae];if(!J||J.trim()===""){N.push("");continue}let re=J.trim().split(/\s+/),j=re.shift()||"";for(;re.length>0;){let q=re.shift(),fe=j?j+" "+q:q;if(y.measureText(fe).width<=S){j=fe;continue}if(j&&N.push(j),y.measureText(q).width<=S)j=q;else{let U=X(q);for(let H=0;H<U.length-1;H++)N.push(U[H]);j=U.length>0?U[U.length-1]:""}}j&&N.push(j)}return N.length===0&&N.push(""),N}function h(y){if(y==null)return null;let O=typeof y=="number"?y:parseFloat(y);if(!Number.isFinite(O))return null;let S=O>p?O:O*1e3,L=new Date(S);if(isNaN(L.getTime()))return null;try{return L.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}catch{return L.toISOString()}}function f(y){let O=y.canvas,S=y.canvasContext,L=y.message,V=y.backgroundColor||"#000000",N=y.textColor||"#ffffff",X=y.font||"Lato",ae=y.fontSize,J=y.connectionStates,re=y.connectionState,j=(y.displayConnectionStatusIcon||"OFF").toUpperCase(),q=O.width,fe=O.height,U=i(q,fe),H=12*U,ve=ae?ae*U:Math.max(22*U,14),Ce="bold "+ve+"px "+X,ye=ve*1.25;S.clearRect(0,0,q,fe),S.fillStyle=V,S.fillRect(0,0,q,fe);let pe=q-H*2,Z=A(S,L,pe,Ce),Te=fe-H*2;j!=="OFF"&&J&&(Te-=28*U);let Y=ye*Z.length,Ee=H+(Te-Y)/2+ye/2;Ee<H+ye/2&&(Ee=H+ye/2),S.fillStyle=N,S.textAlign="center",S.textBaseline="middle",S.font=Ce;for(let Q=0;Q<Z.length;Q++){let ee=Z[Q];ee&&S.fillText(ee,q/2,Ee+Q*ye)}j!=="OFF"&&J&&d({canvas:O,canvasContext:S,state:re,color:N,sizeMultiplier:U,position:j,connectionStates:J})}function C(y){let O=y.canvas,S=y.canvasContext,L=y.settings||{},V=y.values||{},N=y.context,X=y.connectionStates,ae=y.connectionState,J=y.dataState||"live",re=y.infoMessage||"",j=y.lastValidTimestamp||V.lastUpdated||null,q=O.width,fe=O.height,U=i(q,fe),H=10*U,ve=L.pair,Ce=L.title||V.pairDisplay||V.pair||ve||"",ye=L.multiplier||1,pe=L.priceFormat||"compact";function Z(se,ie){let oe=parseFloat(se);return isNaN(oe)||oe<=0?ie:oe}function Te(se,ie){let oe=parseInt(se,10);return isNaN(oe)||oe<0?ie:oe}let Y=Te(L.digits,2),Ee=Te(L.highLowDigits,Y),Q=Z(L.fontSizeBase,25),ee=Z(L.fontSizePrice,Q*35/25),Oe=Z(L.fontSizeHighLow,Q),Le=Z(L.fontSizeChange,Q*19/25),_e=L.backgroundColor||"#000000",Ne=L.textColor||"#ffffff",Se=_e,ce=Ne,Ie=ae||V.connectionState||null,Fe=typeof V.last=="number"&&Number.isFinite(V.last)?V.last:null,We=typeof V.high=="number"&&Number.isFinite(V.high)?V.high:null,Ue=typeof V.low=="number"&&Number.isFinite(V.low)?V.low:null,I=typeof V.changeDailyPercent=="number"&&Number.isFinite(V.changeDailyPercent)?V.changeDailyPercent:null,e=I!==null?I*100:null,a=typeof J=="string"?J.toLowerCase():"live",b=a==="stale"?"#f6a623":a==="missing"?"#d9534f":null,w=r.evaluateAlert({context:N,settings:L,values:V,backgroundColor:Se,textColor:ce}),R=w.alertMode;Se=w.backgroundColor,ce=w.textColor;let D=c.buildContext(V,{alert:R,backgroundColor:Se,textColor:ce,defaultBackgroundColor:_e,defaultTextColor:Ne});if(L.backgroundColorRule)try{let se=v.evaluate(L.backgroundColorRule,D),ie=String(se||"").trim();ie&&(Se=ie,D.backgroundColor=Se)}catch(se){console.error("Error evaluating backgroundColorRule",{context:N,expression:L.backgroundColorRule,values:V,error:se instanceof Error?se.message:se})}if(L.textColorRule)try{D.textColor=ce;let se=v.evaluate(L.textColorRule,D),ie=String(se||"").trim();ie&&(ce=ie,D.textColor=ce)}catch(se){console.error("Error evaluating textColorRule",{context:N,expression:L.textColorRule,values:V,error:se instanceof Error?se.message:se})}S.clearRect(0,0,q,fe),S.fillStyle=Se,S.fillRect(0,0,q,fe);let B=L.font||"Lato",W=Q*U+"px "+B;S.font=W,S.fillStyle=ce,S.textAlign="left",S.textBaseline="alphabetic";let G=25*U,ne=H;if(b){let se=5*U,ie=H+se,oe=G-Q*U*.4;S.beginPath(),S.fillStyle=b,S.arc(ie,oe,se,0,Math.PI*2),S.fill(),S.fillStyle=ce,ne+=se*2+6*U}if(Ce&&S.fillText(Ce,ne,G),a==="stale"){let se=re?re.toUpperCase():"STALE",ie=h(j),oe=ie?se+" \u2022 "+ie:se,ke=Math.max(14,Q*.6)*U;S.font=ke+"px "+B,S.fillStyle=b||ce,S.fillText(oe,ne,G+ke+4*U),S.font=W,S.fillStyle=ce}if(a!=="missing"){let se=Fe!==null?t.getRoundedValue(Fe,Y,ye,pe):"--";if(S.font="bold "+ee*U+"px "+B,S.fillStyle=ce,S.textAlign="left",S.fillText(se,H,60*U),L.displayHighLow!=="off"){S.font=Oe*U+"px "+B,S.fillStyle=ce,S.textAlign="left";let ie=Ue!==null?t.getRoundedValue(Ue,Ee,ye,pe):"--";S.fillText(ie,H,90*U),S.textAlign="right";let oe=We!==null?t.getRoundedValue(We,Ee,ye,pe):"--";S.fillText(oe,q-H,135*U)}if(L.displayDailyChange!=="off"&&e!==null){let ie=S.fillStyle,oe=2;Math.abs(e)>=100?oe=0:Math.abs(e)>=10&&(oe=1);let ke=t.getRoundedValue(e,oe,1,"plain");e>0?(ke="+"+ke,S.fillStyle="green"):e<0?S.fillStyle="red":S.fillStyle=ie,S.font=Le*U+"px "+B,S.textAlign="right",S.fillText(ke,q-H,90*U),S.fillStyle=ie}if(L.displayHighLowBar!=="off"&&We!==null&&Ue!==null&&Fe!==null){let ie=104*U,oe=5*U,ke=6*U,ze=We-Ue,ht=ze>0?Math.min(Math.max((Fe-Ue)/ze,0),1):k,Be=q-oe*2,xe=oe+Math.round(Be*ht),ft=12*U;S.beginPath(),S.moveTo(oe,ie),S.lineTo(xe,ie),S.lineWidth=ke,S.strokeStyle="green",S.stroke(),S.beginPath(),S.moveTo(xe,ie),S.lineTo(q-oe,ie),S.lineWidth=ke,S.strokeStyle="red",S.stroke(),M(S,xe,ie,ft,ce)}}else{let se=re?re.toUpperCase():"NO DATA",ie=Math.max(26,Q)*U,oe="bold "+ie+"px "+B;S.font=oe,S.fillStyle=b||ce;let ke=S.textAlign,ze=S.textBaseline;S.textAlign="center",S.textBaseline="middle";let ht=q-H*2,Be=A(S,se,ht,oe),xe=ie*1.1,ft=xe*Be.length,gt=(fe-ft)/2+xe/2;for(let qe=0;qe<Be.length;qe++)S.fillText(Be[qe],q/2,gt+qe*xe);S.textAlign=ke,S.textBaseline=ze,S.font=W,S.fillStyle=ce}let Ve=(L.displayConnectionStatusIcon||"OFF").toUpperCase();Ve!=="OFF"&&d({canvas:O,canvasContext:S,state:Ie,color:ce,sizeMultiplier:U,position:Ve,connectionStates:X})}function E(y){let O=y.canvas,S=y.canvasContext,L=y.settings||{},V=y.candlesNormalized||[],N=y.connectionStates,X=y.connectionState,ae=O.width,J=O.height,re=i(ae,J),j=10*re,q=(L.displayConnectionStatusIcon||"OFF").toUpperCase(),fe=X||null,U=L.backgroundColor||"#000000",H=L.textColor||"#ffffff",ve=V.slice(-g(L)),Ce=ve.length,ye=ae-2*j,pe=J-2*j,Z=Ce>0?ye/Ce:ye,Te=Math.max(2*re,Z*.15),Y=Math.max(4*re,Z*.6);S.clearRect(0,0,ae,J),S.fillStyle=U,S.fillRect(0,0,ae,J);let Ee=L.font||"Lato";S.font=15*re+"px "+Ee,S.fillStyle=H;let Q=L.candlesInterval||"1h";S.textAlign="right",S.fillText(Q,ae-10*re,J-5*re),ve.forEach(function(ee){let Oe=Math.round(j+Math.round(ee.timePercent*ye)),Le=Math.round(j+pe-ee.highPercent*pe),_e=Math.round(j+pe-ee.lowPercent*pe);S.beginPath(),S.moveTo(Oe,Le),S.lineTo(Oe,_e),S.lineWidth=Te,S.strokeStyle=ee.closePercent>ee.openPercent?"#1c9900":"#a10",S.stroke();let Ne=Math.round(j+pe-ee.openPercent*pe),Se=Math.round(j+pe-ee.closePercent*pe),ce=Math.min(Ne,Se),Ie=Math.max(Ne,Se);S.beginPath(),S.rect(Math.round(Oe-Y/2),ce,Math.round(Y),Math.max(1,Ie-ce)),S.fillStyle=ee.closePercent>ee.openPercent?"#1c9900":"#a10",S.fill()}),q!=="OFF"&&d({canvas:O,canvasContext:S,state:fe,color:H,sizeMultiplier:re,position:q,connectionStates:N})}return{getCanvasSizeMultiplier:i,getCandlesDisplayCount:g,renderConnectionStatusIcon:d,renderTickerCanvas:C,renderCandlesCanvas:E,renderMessageCanvas:f}})});var $n=he((jr,Qt)=>{"use strict";var _n={tProxyBase:"https://tproxyv8.opendle.com",fallbackPollIntervalMs:6e4,staleTickerTimeoutMs:36e4,messages:{loading:"LOADING...",stale:"STALE",noData:"NO DATA",misconfigured:"INVALID PAIR",conversionError:"CONVERSION ERROR"}};function Ae(r){if(typeof je=="function")try{return je(r)}catch{return null}return null}function vr(){return typeof CryptoTickerConfig!="undefined"?CryptoTickerConfig:null}function st(r){if(typeof r=="string"){let t=r.trim();return t.length===0?null:t.toUpperCase()}return r==null?null:String(r).trim().toUpperCase()||null}var wr=Ae("./config"),Cr=Ae("./constants"),kr=vr(),Me=Object.assign({},_n,wr||{},kr||{}),Ln=Cr||(typeof CryptoTickerConstants!="undefined"?CryptoTickerConstants:null)||{},Sr=typeof Ln.TIMESTAMP_SECONDS_THRESHOLD=="number"?Ln.TIMESTAMP_SECONDS_THRESHOLD:9999999999,Gt=Me.tProxyBase,Tr=_n.messages,Pe=Object.assign({},Tr,Me&&Me.messages||{}),Kt=Ae("./providers/subscription-key"),lt=typeof CryptoTickerProviders!="undefined"?CryptoTickerProviders:null,Er=Kt&&Kt.buildSubscriptionKey?Kt.buildSubscriptionKey:lt&&typeof lt.buildSubscriptionKey=="function"?lt.buildSubscriptionKey:function(r,t,c,u){let l=r||"",o=t||"",p=c||null,k=u||null,P="";return p!==null&&k!==null&&p!==k&&(P="__"+p+"_"+k),l+"__"+o+P},xr=Ae("./providers/connection-states"),Re=xr||(typeof CryptoTickerConnectionStates!="undefined"?CryptoTickerConnectionStates:{LIVE:"live",DETACHED:"detached",BACKUP:"backup",BROKEN:"broken"}),Pr=Ae("./canvas-renderer"),Rr=Ae("./alert-manager"),Mr=Ae("./formatters"),Ir=Ae("./ticker-state"),Dr=Ae("./settings-manager"),at=Pr||(typeof CryptoTickerCanvasRenderer!="undefined"?CryptoTickerCanvasRenderer:null),Jt=Rr||(typeof CryptoTickerAlertManager!="undefined"?CryptoTickerAlertManager:null),Xt=Mr||(typeof CryptoTickerFormatters!="undefined"?CryptoTickerFormatters:null),we=Ir||(typeof CryptoTickerState!="undefined"?CryptoTickerState:null),ut=Dr||(typeof CryptoTickerSettingsManager!="undefined"?CryptoTickerSettingsManager:null);if(!at||!Jt||!Xt||!we||!ut)throw new Error("CryptoTicker dependencies are not available");var Wn=!1,ct=null,ot,Ft,Ar=!1,Or=60*60*1e3,Yt=null,Ut=ut.applyDefaultSettings,Nr=ut.defaultSettings,Fr=ut.getDefaultSettingsSnapshot,Ur=ut.settingsSchema,me={type:"com.courcelle.cryptoticker.ticker",log:function(...r){Wn&&console.log(...r)},setContextConnectionState:function(r,t){we.setConnectionState(r,t)},getContextConnectionState:function(r){return we.getConnectionState(r)},clearContextConnectionState:function(r){we.clearConnectionState(r)},getProviderRegistry:function(){if(!Yt){let r=Ae("./providers/provider-registry"),t=r&&r.ProviderRegistry?r.ProviderRegistry:lt&&lt.ProviderRegistry?lt.ProviderRegistry:null;if(!t)throw new Error("ProviderRegistry is not available");Yt=new t({baseUrl:Gt,logger:(...c)=>{this.log(...c)},fallbackPollIntervalMs:Me.fallbackPollIntervalMs,staleTickerTimeoutMs:Me.staleTickerTimeoutMs,binanceRestBaseUrl:Me.binanceRestBaseUrl,binanceWsBaseUrl:Me.binanceWsBaseUrl,binanceSymbolOverrides:Me.binanceSymbolOverrides,bitfinexRestBaseUrl:Me.bitfinexRestBaseUrl,bitfinexWsBaseUrl:Me.bitfinexWsBaseUrl,bitfinexSymbolOverrides:Me.bitfinexSymbolOverrides})}return Yt},websocketSend:function(r){ct&&ct.send(r)},onKeyDown:async function(r,t,c,u){switch(t.mode){case"candles":t.mode="ticker";break;case"ticker":default:Jt.shouldDisarmOnKeyPress(r)?Jt.disarmAlert(r):t.mode="candles";break}this.websocketSend(JSON.stringify({event:"setSettings",context:r,payload:t})),this.refreshTimer(r,t)},onKeyUp:function(r,t,c,u){},onWillAppear:async function(r,t,c){this.initCanvas(),this.refreshTimer(r,t)},refreshTimers:async function(){we.forEachContext(r=>{this.refreshTimer(r.context,r.settings)})},refreshTimer:async function(r,t){let c=this.refreshSettings(r,t);this.updateTicker(r,c)},connect:function(){let r=this.getProviderRegistry();r&&typeof r.ensureAllConnections=="function"&&r.ensureAllConnections()},updateSubscription:function(r,t){let c=t.exchange,u=t.pair,l=this.resolveConversionCurrencies(t.fromCurrency,t.currency),o=this.getSubscriptionContextKey(c,u,l.from,null),p=we.getSubscription(r);if(p&&p.key===o)return p;if(p&&typeof p.unsubscribe=="function"){try{p.unsubscribe()}catch(d){this.log("Error unsubscribing from provider",d)}we.clearSubscription(r),this.clearContextConnectionState(r)}let P=this.getProviderRegistry().getProvider(c),v={exchange:c,symbol:u,fromCurrency:l.from,toCurrency:null},T=this;try{let d=P.subscribeTicker(v,{onData:async function(i){let g=we.getContextDetails(r);if(g){T.setContextConnectionState(g.context,i&&i.connectionState);try{let M=await T.convertTickerValues(i,g.settings&&g.settings.fromCurrency,g.settings&&g.settings.currency);await T.updateCanvas(g.context,g.settings,M)}catch(M){T.log("Error updating canvas from subscription",M)}}},onError:function(i){T.log("Provider subscription error",i),T.setContextConnectionState(r,Re.BROKEN)}});return we.setSubscription(r,{key:o,unsubscribe:d&&typeof d.unsubscribe=="function"?d.unsubscribe:function(){},providerId:P.getId?P.getId():null}),we.getSubscription(r)}catch(d){this.log("Error subscribing to provider",d)}return null},refreshSettings:function(r,t){return ut.refreshSettings({context:r,settings:t,updateSubscription:c=>{this.updateSubscription(r,c)}})},getSubscriptionContextKey:function(r,t,c,u){return Er(r,t,c,u)},resolveConversionCurrencies:function(r,t){let c=st(r)||"USD",u=st(t);return!u||u===c?{from:c,to:null}:{from:c,to:u}},getConversionRate:async function(r,t){let c=st(r),u=st(t);if(!c||!u||c===u)return 1;let l=c+"_"+u,o=Date.now(),p=we.getOrCreateConversionRateEntry(l);if(typeof p.rate=="number"&&p.rate>0&&p.fetchedAt&&o-p.fetchedAt<Or)return p.rate;if(p.promise)try{return await p.promise}catch(d){this.log("Conversion rate promise failed",d)}let k=typeof fetch=="function"?fetch:null;if(!k)return typeof p.rate=="number"&&p.rate>0?p.rate:1;let P=(Gt||"").replace(/\/$/,"");if(!P)return typeof p.rate=="number"&&p.rate>0?p.rate:1;let v=P+"/api/ticker/json/currency/"+encodeURIComponent(c)+"/"+encodeURIComponent(u),T=this;p.promise=async function(){try{let d=await k(v);if(!d||!d.ok)throw new Error("Conversion rate response not ok");let i=await d.json(),g=i&&i.rate!==void 0?parseFloat(i.rate):NaN;if(!g||!isFinite(g)||g<=0)throw new Error("Invalid conversion rate");return p.rate=g,p.fetchedAt=Date.now(),g}catch(d){throw T.log("Error fetching conversion rate",d),d}finally{delete p.promise}}();try{return await p.promise}catch{return typeof p.rate=="number"&&p.rate>0?p.rate:1}},convertTickerValues:async function(r,t,c){if(!r)return r;let u=this.resolveConversionCurrencies(t,c);if(!u.to)return r;let l=st(r.conversionToCurrency),o=st(r.conversionFromCurrency);if(l===u.to&&o===u.from)return r;let p=null;try{p=await this.getConversionRate(u.from,u.to)}catch(k){return this.log("Conversion rate error",k),this.createConversionErrorValues(r)}return!p||!isFinite(p)||p<=0?this.createConversionErrorValues(r):this.applyTickerConversion(r,p,u.from,u.to)},createConversionErrorValues:function(r){let t=Object.assign({},r),c=["last","high","low","open","close","changeDaily","changeDailyPercent","volume"];for(let u=0;u<c.length;u++){let l=c[u];Object.prototype.hasOwnProperty.call(t,l)&&delete t[l]}return t.conversionRate=null,t.conversionError=!0,t},applyTickerConversion:function(r,t,c,u){if(!r||typeof r!="object")return r;let l=Object.assign({},r),o=["last","high","low","open","close","changeDaily"];for(let p=0;p<o.length;p++){let k=o[p];if(!Object.prototype.hasOwnProperty.call(r,k))continue;let P=r[k],v=typeof P=="number"?P:parseFloat(P);isNaN(v)||(l[k]=v*t)}return l.conversionRate=t,l.conversionFromCurrency=c,l.conversionToCurrency=u,l},applyCandlesConversion:function(r,t){return!Array.isArray(r)||!t||!isFinite(t)||t<=0?r:r.map(function(c){if(!c||typeof c!="object")return c;let u=Object.assign({},c),l=["open","close","high","low"];for(let o=0;o<l.length;o++){let p=l[o];if(!Object.prototype.hasOwnProperty.call(c,p))continue;let k=c[p],P=typeof k=="number"?k:parseFloat(k);isNaN(P)||(u[p]=P*t)}if(Object.prototype.hasOwnProperty.call(c,"volumeQuote")){let o=c.volumeQuote,p=typeof o=="number"?o:parseFloat(o);isNaN(p)||(u.volumeQuote=p*t)}return u})},updateTicker:async function(r,t){let c=t.pair,u=await this.getTickerValue(c,t.currency,t.exchange,t.fromCurrency);this.setContextConnectionState(r,u&&u.connectionState),this.updateCanvas(r,t,u)},initCanvas:function(){ot=document.getElementById("ticker"),Ft=ot.getContext("2d")},updateCanvas:async function(r,t,c){this.log("updateCanvas",r,t,c);let u=c&&c.connectionState||this.getContextConnectionState(r);switch(t.mode){case"candles":{let l=await this.getCandles(t);this.updateCanvasCandles(r,t,l,u);break}case"ticker":default:this.updateCanvasTicker(r,t,c,u);break}},sanitizeTickerValues:function(r){if(!r||typeof r!="object")return{values:{},hasAny:!1,hasCritical:!1,timestamp:null};let t=Object.assign({},r);function c(k,P,v){if(typeof k=="number"&&Number.isFinite(k))return v?Math.round(k):k;if(typeof k=="string"){let T=k.trim();if(T){let d=v?parseInt(T,10):parseFloat(T);if(!isNaN(d)&&Number.isFinite(d))return v?Math.round(d):d}}return P}let u=c(r.last,null,!1);u===null?delete t.last:t.last=u;let l={high:null,low:null,volume:0,changeDaily:0,changeDailyPercent:0};Object.keys(l).forEach(k=>{let P=l[k],v=c(r[k],P,!1);v==null||!Number.isFinite(v)?delete t[k]:v===P&&r[k]===void 0?P===null?delete t[k]:t[k]=P:t[k]=v});let o=["lastUpdated","timestamp","time","updatedAt"],p=null;for(let k=0;k<o.length;k++){let P=o[k];if(!Object.prototype.hasOwnProperty.call(r,P))continue;let T=c(r[P],null,!0);if(T!=null){let d=T>Sr?T:T*1e3;p=d,t.lastUpdated=d;break}}return typeof t.pairDisplay!="string"&&delete t.pairDisplay,{values:t,hasAny:Object.keys(r).length>0,hasCritical:u!==null,timestamp:p}},buildTickerRenderContext:function(r,t,c,u){let l=this.sanitizeTickerValues(c),o=l.values,p=Date.now(),k="missing",P=null,v=null,T=o,d=null,i=u||o.connectionState||null,g=we.getLastGoodTicker(r),M=i===Re.BROKEN,h=[Re.LIVE,Re.BACKUP,Re.DETACHED].indexOf(i)!==-1,f=l.hasCritical&&Number.isFinite(o.last)&&o.last===0&&(!Number.isFinite(o.high)||o.high===0)&&(!Number.isFinite(o.low)||o.low===0)&&(!Number.isFinite(o.volume)||o.volume===0)&&l.timestamp===null,C=l.hasCritical&&(!h||M)&&f;if(!!o.conversionError){k="missing",T=Object.assign({},o);let y=t.title||o.pairDisplay||o.pair||t.pair||"";return!T.pairDisplay&&y&&(T.pairDisplay=y),P=Pe.conversionError||"CONVERSION ERROR",d="conversion_error",{values:T,dataState:k,infoMessage:P,lastValidTimestamp:v,degradedReason:d}}if(l.hasCritical&&!M&&!C){let y=l.timestamp||p;o.lastUpdated=y,we.setLastGoodTicker(r,o,y),v=y,k="live",T=Object.assign({},o)}else if(g&&g.values&&typeof g.values=="object"&&Number.isFinite(g.values.last))k="stale",T=Object.assign({},g.values),v=g.timestamp,T.lastUpdated||(T.lastUpdated=g.timestamp),P=Pe.stale,d=l.hasAny?"partial":"missing";else{k="missing",T=Object.assign({},o);let y=t.title||o.pairDisplay||o.pair||t.pair||"";!T.pairDisplay&&y&&(T.pairDisplay=y),C||M?(P=Pe.misconfigured||Pe.noData,d="misconfigured"):(P=Pe.loading,d=l.hasAny?"partial":"none")}return!P&&k==="missing"&&(P=M?Pe.misconfigured||Pe.noData:Pe.loading),!P&&k==="live"&&M&&(P=Pe.misconfigured||Pe.noData),!P&&k==="stale"&&!Pe.stale&&(P="STALE"),{values:T,dataState:k,infoMessage:P,lastValidTimestamp:v,degradedReason:d}},displayMessage:function(r,t,c){this.initCanvas();let u=c||{},l=Ut(u.settings||{}),o=u.backgroundColor||l.backgroundColor||"#000000",p=u.textColor||l.textColor||"#ffffff",k=u.font||l.font||"Lato",P=u.fontSize||null,v=u.connectionState||null,T=u.displayConnectionStatusIcon||l.displayConnectionStatusIcon||"OFF";v&&this.setContextConnectionState(r,v),at.renderMessageCanvas({canvas:ot,canvasContext:Ft,message:t,backgroundColor:o,textColor:p,font:k,fontSize:P,connectionStates:Re,connectionState:v||this.getContextConnectionState(r),displayConnectionStatusIcon:T}),this.sendCanvas(r)},getCanvasSizeMultiplier:function(r,t){return at.getCanvasSizeMultiplier(r,t)},getCandlesDisplayCount:function(r){return at.getCandlesDisplayCount(r)},updateCanvasTicker:function(r,t,c,u){this.log("updateCanvasTicker",r,t,c);let l=this.buildTickerRenderContext(r,t,c,u);at.renderTickerCanvas({canvas:ot,canvasContext:Ft,settings:t,values:l.values,context:r,connectionStates:Re,connectionState:u||c&&c.connectionState||null,dataState:l.dataState,infoMessage:l.infoMessage,lastValidTimestamp:l.lastValidTimestamp,degradedReason:l.degradedReason}),this.sendCanvas(r)},updateCanvasCandles:function(r,t,c,u){this.log("updateCanvasCandles",r,t,c),at.renderCandlesCanvas({canvas:ot,canvasContext:Ft,settings:t,candlesNormalized:c,connectionStates:Re,connectionState:u||this.getContextConnectionState(r)}),this.sendCanvas(r)},sendCanvas:function(r){var t={event:"setImage",context:r,payload:{image:ot.toDataURL(),target:DestinationEnum.HARDWARE_AND_SOFTWARE}};this.websocketSend(JSON.stringify(t))},getRoundedValue:function(r,t,c,u){return Xt.getRoundedValue(r,t,c,u)},getTickerValue:async function(r,t,c,u){let o=this.getProviderRegistry().getProvider(c),p=this.resolveConversionCurrencies(u,t),k={exchange:c,symbol:r,fromCurrency:p.from,toCurrency:null};try{let P=await o.fetchTicker(k),T=await this.convertTickerValues(P,p.from,p.to)||P;return T&&typeof T=="object"&&!T.connectionState&&(T.connectionState=Re.DETACHED),T}catch(P){this.log("Error fetching ticker",P);let v=this.getSubscriptionContextKey(c,r,p.from,null);if(o&&typeof o.getCachedTicker=="function"){let T=o.getCachedTicker(v);if(T){let i=await this.convertTickerValues(T,p.from,p.to)||T;return i&&!i.connectionState&&(i.connectionState=Re.BACKUP),i}}return{changeDaily:0,changeDailyPercent:0,last:0,volume:0,high:0,low:0,pair:r,pairDisplay:r,connectionState:Re.BROKEN}}},getCandles:async function(r){this.log("getCandles");let t=r.exchange,c=r.pair,u=this.convertCandlesInterval(r.candlesInterval||"1h"),l=this.getCandlesDisplayCount(r),o=this.resolveConversionCurrencies(r.fromCurrency,r.currency),p=o.to||o.from||"",k=t+"_"+c+"_"+u+"_"+l+"_"+p,P=we.getCandlesCacheEntry(k);P||(P={},we.setCandlesCacheEntry(k,P));let v=new Date().getTime(),T="time",d="candles";if(P[T]&&P[T]>v-60*1e3)return P[d];let i={exchange:t,symbol:c,interval:u,limit:24},g=null;try{let f=this.getProviderRegistry(),C=f.getProvider(t);if(C&&typeof C.fetchCandles=="function"&&(g=await C.fetchCandles(i)),Array.isArray(g)||(g=null),g===null){let E=f.getGenericProvider();E&&typeof E.fetchCandles=="function"&&(g=await E.fetchCandles(i),Array.isArray(g)||(g=null))}}catch(f){this.log("Error fetching provider candles",f),g=null}if(g===null)try{let C=await(await fetch(Gt+"/api/Candles/json/"+t+"/"+c+"/"+u+"?limit=24")).json();C&&Array.isArray(C.candles)&&(g=C.candles)}catch(f){this.log("Error fetching candles from proxy",f)}if(!Array.isArray(g))return P[d]||[];let M=this.prepareCandlesForDisplay(g,l),A=M;if(o.to)try{let f=await this.getConversionRate(o.from,o.to);f&&isFinite(f)&&f>0&&(A=this.applyCandlesConversion(M,f))}catch(f){this.log("Conversion rate error for candles",f)}let h=this.getCandlesNormalized(A);return P[T]=v,P[d]=h,P[d]},convertCandlesInterval:function(r){switch(r){case"1m":return"MINUTES_1";case"5m":return"MINUTES_5";case"15m":return"MINUTES_15";case"1h":return"HOURS_1";case"6h":return"HOURS_6";case"12h":return"HOURS_12";case"1D":return"DAYS_1";case"7D":return"DAYS_7";case"1M":return"MONTHS_1"}return r},prepareCandlesForDisplay:function(r,t){if(!Array.isArray(r)||r.length===0)return[];let c=r.map(function(u){if(!u)return null;let l=u.ts;if(typeof l!="number"){let o=u.openTime;if(o){let p=Date.parse(o);isNaN(p)||(l=Math.floor(p/1e3))}}return typeof l!="number"||isNaN(l)?null:{candle:u,ts:l}}).filter(function(u){return u!==null}).sort(function(u,l){return u.ts-l.ts}).map(function(u){return u.candle.ts===u.ts?u.candle:Object.assign({},u.candle,{ts:u.ts})});return typeof t=="number"&&t>0&&c.length>t?c.slice(-t):c},getCandlesNormalized:function(r){let t=Number.POSITIVE_INFINITY,c=0,u=Number.POSITIVE_INFINITY,l=0,o=Number.POSITIVE_INFINITY,p=0;(r||[]).forEach(function(v){o=Math.min(o,v.ts),p=Math.max(p,v.ts),t=Math.min(t,v.open),t=Math.min(t,v.close),t=Math.min(t,v.high),t=Math.min(t,v.low),c=Math.max(c,v.open),c=Math.max(c,v.close),c=Math.max(c,v.high),c=Math.max(c,v.low),u=Math.min(u,v.volumeQuote),l=Math.max(l,v.volumeQuote)});let k=this,P=[];return(r||[]).forEach(function(v){P.push({timePercent:k.normalizeValue(v.ts,o,p),openPercent:k.normalizeValue(v.open,t,c),closePercent:k.normalizeValue(v.close,t,c),highPercent:k.normalizeValue(v.high,t,c),lowPercent:k.normalizeValue(v.low,t,c),volumePercent:k.normalizeValue(v.volumeQuote,u,l)})}),this.log("getCandlesNormalized",P),P},normalizeValue:function(r,t,c){return Xt.normalizeValue(r,t,c)}};me.defaultSettings=Nr;me.applyDefaultSettings=Ut;me.getDefaultSettings=function(){return Fr()};me.settingsSchema=Ur;function Br(r,t,c,u,l){ct=new WebSocket("ws://127.0.0.1:"+r);function o(p){var k={event:c,uuid:p};me.websocketSend(JSON.stringify(k))}ct.onopen=function(){o(t)},ct.onmessage=async function(p){var k=JSON.parse(p.data);let P=k.event,v=k.context,T=k.payload||{},d=T.settings;!d&&P==="sendToPlugin"&&(d=T);let i=d,g=T.coordinates,M=T.userDesiredState;["deviceDidConnect","titleParametersDidChange"].indexOf(P)>=0||(i!=null&&(i=Ut(i)),P=="keyDown"?await me.onKeyDown(v,i,g,M):P=="keyUp"?await me.onKeyUp(v,i,g,M):P=="willAppear"?await me.onWillAppear(v,i,g):i!=null&&(me.refreshSettings(v,i),me.refreshTimer(v,i)))},ct.onclose=function(){},setInterval(async function(){await me.refreshTimers()},3e5)}if(Ar){Wn=!0,me.connect();let r=Ut({digits:0,pair:"LTCUSD",mode:"ticker"}),t="test",c={column:1,row:1},u=null;setTimeout(function(){me.onWillAppear(t,r,c),setInterval(async function(){await me.onKeyDown(t,r,c,u),await me.onKeyUp(t,r,c,u)},5e3)},1e3)}typeof Qt!="undefined"&&(Qt.exports=me);typeof window!="undefined"&&(window.connectElgatoStreamDeckSocket=Br)});var Vr=be(an()),qr=be(ln()),zr=be(Ge()),Gr=be(kt()),Kr=be(Ke()),Yr=be(dt()),Jr=be(Xe()),Xr=be(bn()),Qr=be(xt()),Zr=be(Wt()),ei=be($t()),ti=be(jt()),ni=be(kn()),ri=be(Ht()),ii=be(Dt()),si=be(qt()),oi=be(zt()),ai=be(An()),ci=be(Bn()),li=be($n());})();
