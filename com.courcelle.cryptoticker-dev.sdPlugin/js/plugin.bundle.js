"use strict";(()=>{var hr=Object.create;var an=Object.defineProperty;var fr=Object.getOwnPropertyDescriptor;var pr=Object.getOwnPropertyNames;var dr=Object.getPrototypeOf,gr=Object.prototype.hasOwnProperty;var je=(r=>typeof require!="undefined"?require:typeof Proxy!="undefined"?new Proxy(r,{get:(t,a)=>(typeof require!="undefined"?require:t)[a]}):r)(function(r){if(typeof require!="undefined")return require.apply(this,arguments);throw Error('Dynamic require of "'+r+'" is not supported')});var ue=(r,t)=>()=>(t||r((t={exports:{}}).exports,t),t.exports);var br=(r,t,a,u)=>{if(t&&typeof t=="object"||typeof t=="function")for(let c of pr(t))!gr.call(r,c)&&c!==a&&an(r,c,{get:()=>t[c],enumerable:!(u=fr(t,c))||u.enumerable});return r};var be=(r,t,a)=>(a=r!=null?hr(dr(r)):{},br(t||!r||!r.__esModule?an(a,"default",{value:r,enumerable:!0}):a,r));var ln=ue((wt,Wt)=>{"use strict";var cn,dt;cn=self,dt=()=>(()=>{var r={d:(A,e)=>{for(var o in e)r.o(e,o)&&!r.o(A,o)&&Object.defineProperty(A,o,{enumerable:!0,get:e[o]})}};r.g=function(){if(typeof globalThis=="object")return globalThis;try{return this||new Function("return this")()}catch{if(typeof window=="object")return window}}(),r.o=(A,e)=>Object.prototype.hasOwnProperty.call(A,e),r.r=A=>{typeof Symbol!="undefined"&&Symbol.toStringTag&&Object.defineProperty(A,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(A,"t",{value:!0})};var t,a={};r.r(a),r.d(a,{AbortError:()=>s,DefaultHttpClient:()=>W,HttpClient:()=>f,HttpError:()=>u,HttpResponse:()=>h,HttpTransportType:()=>Z,HubConnection:()=>fe,HubConnectionBuilder:()=>Le,HubConnectionState:()=>q,JsonHubProtocol:()=>de,LogLevel:()=>t,MessageType:()=>F,NullLogger:()=>k,Subject:()=>ve,TimeoutError:()=>c,TransferFormat:()=>ne,VERSION:()=>p});class u extends Error{constructor(e,o){let b=new.target.prototype;super(`${e}: Status code '${o}'`),this.statusCode=o,this.__proto__=b}}class c extends Error{constructor(e="A timeout occurred."){let o=new.target.prototype;super(e),this.__proto__=o}}class s extends Error{constructor(e="An abort occurred."){let o=new.target.prototype;super(e),this.__proto__=o}}class g extends Error{constructor(e,o){let b=new.target.prototype;super(e),this.transport=o,this.errorType="UnsupportedTransportError",this.__proto__=b}}class S extends Error{constructor(e,o){let b=new.target.prototype;super(e),this.transport=o,this.errorType="DisabledTransportError",this.__proto__=b}}class E extends Error{constructor(e,o){let b=new.target.prototype;super(e),this.transport=o,this.errorType="FailedToStartTransportError",this.__proto__=b}}class R extends Error{constructor(e){let o=new.target.prototype;super(e),this.errorType="FailedToNegotiateWithServerError",this.__proto__=o}}class y extends Error{constructor(e,o){let b=new.target.prototype;super(e),this.innerErrors=o,this.__proto__=b}}class h{constructor(e,o,b){this.statusCode=e,this.statusText=o,this.content=b}}class f{get(e,o){return this.send({...o,method:"GET",url:e})}post(e,o){return this.send({...o,method:"POST",url:e})}delete(e,o){return this.send({...o,method:"DELETE",url:e})}getCookieString(e){return""}}(function(A){A[A.Trace=0]="Trace",A[A.Debug=1]="Debug",A[A.Information=2]="Information",A[A.Warning=3]="Warning",A[A.Error=4]="Error",A[A.Critical=5]="Critical",A[A.None=6]="None"})(t||(t={}));class k{constructor(){}log(e,o){}}k.instance=new k;let p="8.0.0";class x{static isRequired(e,o){if(e==null)throw new Error(`The '${o}' argument is required.`)}static isNotEmpty(e,o){if(!e||e.match(/^\s*$/))throw new Error(`The '${o}' argument should not be empty.`)}static isIn(e,o,b){if(!(e in o))throw new Error(`Unknown ${b} value: ${e}.`)}}class l{static get isBrowser(){return!l.isNode&&typeof window=="object"&&typeof window.document=="object"}static get isWebWorker(){return!l.isNode&&typeof self=="object"&&"importScripts"in self}static get isReactNative(){return!l.isNode&&typeof window=="object"&&window.document===void 0}static get isNode(){return typeof process!="undefined"&&process.release&&process.release.name==="node"}}function d(A,e){let o="";return C(A)?(o=`Binary data of length ${A.byteLength}`,e&&(o+=`. Content: '${function(b){let w=new Uint8Array(b),M="";return w.forEach(D=>{M+=`0x${D<16?"0":""}${D.toString(16)} `}),M.substr(0,M.length-1)}(A)}'`)):typeof A=="string"&&(o=`String data of length ${A.length}`,e&&(o+=`. Content: '${A}'`)),o}function C(A){return A&&typeof ArrayBuffer!="undefined"&&(A instanceof ArrayBuffer||A.constructor&&A.constructor.name==="ArrayBuffer")}async function I(A,e,o,b,w,M){let D={},[$,L]=T();D[$]=L,A.log(t.Trace,`(${e} transport) sending data. ${d(w,M.logMessageContent)}.`);let K=C(w)?"arraybuffer":"text",se=await o.post(b,{content:w,headers:{...D,...M.headers},responseType:K,timeout:M.timeout,withCredentials:M.withCredentials});A.log(t.Trace,`(${e} transport) request complete. Response status: ${se.statusCode}.`)}class v{constructor(e,o){this.i=e,this.h=o}dispose(){let e=this.i.observers.indexOf(this.h);e>-1&&this.i.observers.splice(e,1),this.i.observers.length===0&&this.i.cancelCallback&&this.i.cancelCallback().catch(o=>{})}}class N{constructor(e){this.l=e,this.out=console}log(e,o){if(e>=this.l){let b=`[${new Date().toISOString()}] ${t[e]}: ${o}`;switch(e){case t.Critical:case t.Error:this.out.error(b);break;case t.Warning:this.out.warn(b);break;case t.Information:this.out.info(b);break;default:this.out.log(b)}}}}function T(){let A="X-SignalR-User-Agent";return l.isNode&&(A="User-Agent"),[A,B(p,z(),l.isNode?"NodeJS":"Browser",O())]}function B(A,e,o,b){let w="Microsoft SignalR/",M=A.split(".");return w+=`${M[0]}.${M[1]}`,w+=` (${A}; `,w+=e&&e!==""?`${e}; `:"Unknown OS; ",w+=`${o}`,w+=b?`; ${b}`:"; Unknown Runtime Version",w+=")",w}function z(){if(!l.isNode)return"";switch(process.platform){case"win32":return"Windows NT";case"darwin":return"macOS";case"linux":return"Linux";default:return process.platform}}function O(){if(l.isNode)return process.versions.node}function G(A){return A.stack?A.stack:A.message?A.message:`${A}`}class X extends f{constructor(e){super(),this.u=e,this.p=fetch.bind(function(){if(typeof globalThis!="undefined")return globalThis;if(typeof self!="undefined")return self;if(typeof window!="undefined")return window;if(r.g!==void 0)return r.g;throw new Error("could not find global")}()),this.m=AbortController,this.m}async send(e){if(e.abortSignal&&e.abortSignal.aborted)throw new s;if(!e.method)throw new Error("No method defined.");if(!e.url)throw new Error("No url defined.");let o=new this.m,b;e.abortSignal&&(e.abortSignal.onabort=()=>{o.abort(),b=new s});let w,M=null;if(e.timeout){let L=e.timeout;M=setTimeout(()=>{o.abort(),this.u.log(t.Warning,"Timeout from HTTP request."),b=new c},L)}e.content===""&&(e.content=void 0),e.content&&(e.headers=e.headers||{},C(e.content)?e.headers["Content-Type"]="application/octet-stream":e.headers["Content-Type"]="text/plain;charset=UTF-8");try{w=await this.p(e.url,{body:e.content,cache:"no-cache",credentials:e.withCredentials===!0?"include":"same-origin",headers:{"X-Requested-With":"XMLHttpRequest",...e.headers},method:e.method,mode:"cors",redirect:"follow",signal:o.signal})}catch(L){throw b||(this.u.log(t.Warning,`Error from HTTP request. ${L}.`),L)}finally{M&&clearTimeout(M),e.abortSignal&&(e.abortSignal.onabort=null)}if(!w.ok){let L=await V(w,"text");throw new u(L||w.statusText,w.status)}let D=V(w,e.responseType),$=await D;return new h(w.status,w.statusText,$)}getCookieString(e){let o="";return l.isNode&&this.v&&this.v.getCookies(e,(b,w)=>o=w.join("; ")),o}}function V(A,e){let o;switch(e){case"arraybuffer":o=A.arrayBuffer();break;case"text":default:o=A.text();break;case"blob":case"document":case"json":throw new Error(`${e} is not supported.`)}return o}class ee extends f{constructor(e){super(),this.u=e}send(e){return e.abortSignal&&e.abortSignal.aborted?Promise.reject(new s):e.method?e.url?new Promise((o,b)=>{let w=new XMLHttpRequest;w.open(e.method,e.url,!0),w.withCredentials=e.withCredentials===void 0||e.withCredentials,w.setRequestHeader("X-Requested-With","XMLHttpRequest"),e.content===""&&(e.content=void 0),e.content&&(C(e.content)?w.setRequestHeader("Content-Type","application/octet-stream"):w.setRequestHeader("Content-Type","text/plain;charset=UTF-8"));let M=e.headers;M&&Object.keys(M).forEach(D=>{w.setRequestHeader(D,M[D])}),e.responseType&&(w.responseType=e.responseType),e.abortSignal&&(e.abortSignal.onabort=()=>{w.abort(),b(new s)}),e.timeout&&(w.timeout=e.timeout),w.onload=()=>{e.abortSignal&&(e.abortSignal.onabort=null),w.status>=200&&w.status<300?o(new h(w.status,w.statusText,w.response||w.responseText)):b(new u(w.response||w.responseText||w.statusText,w.status))},w.onerror=()=>{this.u.log(t.Warning,`Error from HTTP request. ${w.status}: ${w.statusText}.`),b(new u(w.statusText,w.status))},w.ontimeout=()=>{this.u.log(t.Warning,"Timeout from HTTP request."),b(new c)},w.send(e.content)}):Promise.reject(new Error("No url defined.")):Promise.reject(new Error("No method defined."))}}class W extends f{constructor(e){if(super(),typeof fetch!="undefined"||l.isNode)this.$=new X(e);else{if(typeof XMLHttpRequest=="undefined")throw new Error("No usable HttpClient found.");this.$=new ee(e)}}send(e){return e.abortSignal&&e.abortSignal.aborted?Promise.reject(new s):e.method?e.url?this.$.send(e):Promise.reject(new Error("No url defined.")):Promise.reject(new Error("No method defined."))}getCookieString(e){return this.$.getCookieString(e)}}class H{static write(e){return`${e}${H.RecordSeparator}`}static parse(e){if(e[e.length-1]!==H.RecordSeparator)throw new Error("Message is incomplete.");let o=e.split(H.RecordSeparator);return o.pop(),o}}H.RecordSeparatorCode=30,H.RecordSeparator=String.fromCharCode(H.RecordSeparatorCode);class he{writeHandshakeRequest(e){return H.write(JSON.stringify(e))}parseHandshakeResponse(e){let o,b;if(C(e)){let D=new Uint8Array(e),$=D.indexOf(H.RecordSeparatorCode);if($===-1)throw new Error("Message is incomplete.");let L=$+1;o=String.fromCharCode.apply(null,Array.prototype.slice.call(D.slice(0,L))),b=D.byteLength>L?D.slice(L).buffer:null}else{let D=e,$=D.indexOf(H.RecordSeparator);if($===-1)throw new Error("Message is incomplete.");let L=$+1;o=D.substring(0,L),b=D.length>L?D.substring(L):null}let w=H.parse(o),M=JSON.parse(w[0]);if(M.type)throw new Error("Expected a handshake response from the server.");return[b,M]}}var F,q;(function(A){A[A.Invocation=1]="Invocation",A[A.StreamItem=2]="StreamItem",A[A.Completion=3]="Completion",A[A.StreamInvocation=4]="StreamInvocation",A[A.CancelInvocation=5]="CancelInvocation",A[A.Ping=6]="Ping",A[A.Close=7]="Close",A[A.Ack=8]="Ack",A[A.Sequence=9]="Sequence"})(F||(F={}));class ve{constructor(){this.observers=[]}next(e){for(let o of this.observers)o.next(e)}error(e){for(let o of this.observers)o.error&&o.error(e)}complete(){for(let e of this.observers)e.complete&&e.complete()}subscribe(e){return this.observers.push(e),new v(this,e)}}class Se{constructor(e,o,b){this.C=1e5,this.S=[],this.k=0,this.P=!1,this.T=1,this.I=0,this._=0,this.H=!1,this.D=e,this.R=o,this.C=b}async A(e){let o=this.D.writeMessage(e),b=Promise.resolve();if(this.U(e)){this.k++;let w=()=>{},M=()=>{};C(o)?this._+=o.byteLength:this._+=o.length,this._>=this.C&&(b=new Promise((D,$)=>{w=D,M=$})),this.S.push(new ye(o,this.k,w,M))}try{this.H||await this.R.send(o)}catch{this.L()}await b}N(e){let o=-1;for(let b=0;b<this.S.length;b++){let w=this.S[b];if(w.q<=e.sequenceId)o=b,C(w.M)?this._-=w.M.byteLength:this._-=w.M.length,w.j();else{if(!(this._<this.C))break;w.j()}}o!==-1&&(this.S=this.S.slice(o+1))}W(e){if(this.P)return e.type===F.Sequence&&(this.P=!1,!0);if(!this.U(e))return!0;let o=this.T;return this.T++,o<=this.I?(o===this.I&&this.O(),!1):(this.I=o,this.O(),!0)}F(e){e.sequenceId>this.T?this.R.stop(new Error("Sequence ID greater than amount of messages we've received.")):this.T=e.sequenceId}L(){this.H=!0,this.P=!0}async B(){let e=this.S.length!==0?this.S[0].q:this.k+1;await this.R.send(this.D.writeMessage({type:F.Sequence,sequenceId:e}));let o=this.S;for(let b of o)await this.R.send(b.M);this.H=!1}X(e){e!=null||(e=new Error("Unable to reconnect to server."));for(let o of this.S)o.J(e)}U(e){switch(e.type){case F.Invocation:case F.StreamItem:case F.Completion:case F.StreamInvocation:case F.CancelInvocation:return!0;case F.Close:case F.Sequence:case F.Ping:case F.Ack:return!1}}O(){this.V===void 0&&(this.V=setTimeout(async()=>{try{this.H||await this.R.send(this.D.writeMessage({type:F.Ack,sequenceId:this.I}))}catch{}clearTimeout(this.V),this.V=void 0},1e3))}}class ye{constructor(e,o,b,w){this.M=e,this.q=o,this.j=b,this.J=w}}(function(A){A.Disconnected="Disconnected",A.Connecting="Connecting",A.Connected="Connected",A.Disconnecting="Disconnecting",A.Reconnecting="Reconnecting"})(q||(q={}));class fe{static create(e,o,b,w,M,D,$){return new fe(e,o,b,w,M,D,$)}constructor(e,o,b,w,M,D,$){this.K=0,this.G=()=>{this.u.log(t.Warning,"The page is being frozen, this will likely lead to the connection being closed and messages being lost. For more information see the docs at https://learn.microsoft.com/aspnet/core/signalr/javascript-client#bsleep")},x.isRequired(e,"connection"),x.isRequired(o,"logger"),x.isRequired(b,"protocol"),this.serverTimeoutInMilliseconds=M!=null?M:3e4,this.keepAliveIntervalInMilliseconds=D!=null?D:15e3,this.Y=$!=null?$:1e5,this.u=o,this.D=b,this.connection=e,this.Z=w,this.tt=new he,this.connection.onreceive=L=>this.et(L),this.connection.onclose=L=>this.st(L),this.it={},this.nt={},this.rt=[],this.ot=[],this.ht=[],this.ct=0,this.lt=!1,this.ut=q.Disconnected,this.dt=!1,this.ft=this.D.writeMessage({type:F.Ping})}get state(){return this.ut}get connectionId(){return this.connection&&this.connection.connectionId||null}get baseUrl(){return this.connection.baseUrl||""}set baseUrl(e){if(this.ut!==q.Disconnected&&this.ut!==q.Reconnecting)throw new Error("The HubConnection must be in the Disconnected or Reconnecting state to change the url.");if(!e)throw new Error("The HubConnection url must be a valid url.");this.connection.baseUrl=e}start(){return this.wt=this.gt(),this.wt}async gt(){if(this.ut!==q.Disconnected)return Promise.reject(new Error("Cannot start a HubConnection that is not in the 'Disconnected' state."));this.ut=q.Connecting,this.u.log(t.Debug,"Starting HubConnection.");try{await this.yt(),l.isBrowser&&window.document.addEventListener("freeze",this.G),this.ut=q.Connected,this.dt=!0,this.u.log(t.Debug,"HubConnection connected successfully.")}catch(e){return this.ut=q.Disconnected,this.u.log(t.Debug,`HubConnection failed to start successfully because of error '${e}'.`),Promise.reject(e)}}async yt(){this.bt=void 0,this.lt=!1;let e=new Promise((o,b)=>{this.vt=o,this.Et=b});await this.connection.start(this.D.transferFormat);try{let o=this.D.version;this.connection.features.reconnect||(o=1);let b={protocol:this.D.name,version:o};if(this.u.log(t.Debug,"Sending handshake request."),await this.$t(this.tt.writeHandshakeRequest(b)),this.u.log(t.Information,`Using HubProtocol '${this.D.name}'.`),this.Ct(),this.St(),this.kt(),await e,this.bt)throw this.bt;this.connection.features.reconnect&&(this.Pt=new Se(this.D,this.connection,this.Y),this.connection.features.disconnected=this.Pt.L.bind(this.Pt),this.connection.features.resend=()=>{if(this.Pt)return this.Pt.B()}),this.connection.features.inherentKeepAlive||await this.$t(this.ft)}catch(o){throw this.u.log(t.Debug,`Hub handshake failed with error '${o}' during start(). Stopping HubConnection.`),this.Ct(),this.Tt(),await this.connection.stop(o),o}}async stop(){let e=this.wt;this.connection.features.reconnect=!1,this.It=this._t(),await this.It;try{await e}catch{}}_t(e){if(this.ut===q.Disconnected)return this.u.log(t.Debug,`Call to HubConnection.stop(${e}) ignored because it is already in the disconnected state.`),Promise.resolve();if(this.ut===q.Disconnecting)return this.u.log(t.Debug,`Call to HttpConnection.stop(${e}) ignored because the connection is already in the disconnecting state.`),this.It;let o=this.ut;return this.ut=q.Disconnecting,this.u.log(t.Debug,"Stopping HubConnection."),this.Ht?(this.u.log(t.Debug,"Connection stopped during reconnect delay. Done reconnecting."),clearTimeout(this.Ht),this.Ht=void 0,this.Dt(),Promise.resolve()):(o===q.Connected&&this.Rt(),this.Ct(),this.Tt(),this.bt=e||new s("The connection was stopped before the hub handshake could complete."),this.connection.stop(e))}async Rt(){try{await this.xt(this.At())}catch{}}stream(e,...o){let[b,w]=this.Ut(o),M=this.Lt(e,o,w),D,$=new ve;return $.cancelCallback=()=>{let L=this.Nt(M.invocationId);return delete this.it[M.invocationId],D.then(()=>this.xt(L))},this.it[M.invocationId]=(L,K)=>{K?$.error(K):L&&(L.type===F.Completion?L.error?$.error(new Error(L.error)):$.complete():$.next(L.item))},D=this.xt(M).catch(L=>{$.error(L),delete this.it[M.invocationId]}),this.qt(b,D),$}$t(e){return this.kt(),this.connection.send(e)}xt(e){return this.Pt?this.Pt.A(e):this.$t(this.D.writeMessage(e))}send(e,...o){let[b,w]=this.Ut(o),M=this.xt(this.Mt(e,o,!0,w));return this.qt(b,M),M}invoke(e,...o){let[b,w]=this.Ut(o),M=this.Mt(e,o,!1,w);return new Promise((D,$)=>{this.it[M.invocationId]=(K,se)=>{se?$(se):K&&(K.type===F.Completion?K.error?$(new Error(K.error)):D(K.result):$(new Error(`Unexpected message type: ${K.type}`)))};let L=this.xt(M).catch(K=>{$(K),delete this.it[M.invocationId]});this.qt(b,L)})}on(e,o){e&&o&&(e=e.toLowerCase(),this.nt[e]||(this.nt[e]=[]),this.nt[e].indexOf(o)===-1&&this.nt[e].push(o))}off(e,o){if(!e)return;e=e.toLowerCase();let b=this.nt[e];if(b)if(o){let w=b.indexOf(o);w!==-1&&(b.splice(w,1),b.length===0&&delete this.nt[e])}else delete this.nt[e]}onclose(e){e&&this.rt.push(e)}onreconnecting(e){e&&this.ot.push(e)}onreconnected(e){e&&this.ht.push(e)}et(e){if(this.Ct(),this.lt||(e=this.jt(e),this.lt=!0),e){let o=this.D.parseMessages(e,this.u);for(let b of o)if(!this.Pt||this.Pt.W(b))switch(b.type){case F.Invocation:this.Wt(b);break;case F.StreamItem:case F.Completion:{let w=this.it[b.invocationId];if(w){b.type===F.Completion&&delete this.it[b.invocationId];try{w(b)}catch(M){this.u.log(t.Error,`Stream callback threw error: ${G(M)}`)}}break}case F.Ping:break;case F.Close:{this.u.log(t.Information,"Close message received from server.");let w=b.error?new Error("Server returned an error on close: "+b.error):void 0;b.allowReconnect===!0?this.connection.stop(w):this.It=this._t(w);break}case F.Ack:this.Pt&&this.Pt.N(b);break;case F.Sequence:this.Pt&&this.Pt.F(b);break;default:this.u.log(t.Warning,`Invalid message type: ${b.type}.`)}}this.St()}jt(e){let o,b;try{[b,o]=this.tt.parseHandshakeResponse(e)}catch(w){let M="Error parsing handshake response: "+w;this.u.log(t.Error,M);let D=new Error(M);throw this.Et(D),D}if(o.error){let w="Server returned handshake error: "+o.error;this.u.log(t.Error,w);let M=new Error(w);throw this.Et(M),M}return this.u.log(t.Debug,"Server handshake complete."),this.vt(),b}kt(){this.connection.features.inherentKeepAlive||(this.K=new Date().getTime()+this.keepAliveIntervalInMilliseconds,this.Tt())}St(){if(!(this.connection.features&&this.connection.features.inherentKeepAlive||(this.Ot=setTimeout(()=>this.serverTimeout(),this.serverTimeoutInMilliseconds),this.Ft!==void 0))){let e=this.K-new Date().getTime();e<0&&(e=0),this.Ft=setTimeout(async()=>{if(this.ut===q.Connected)try{await this.$t(this.ft)}catch{this.Tt()}},e)}}serverTimeout(){this.connection.stop(new Error("Server timeout elapsed without receiving a message from the server."))}async Wt(e){let o=e.target.toLowerCase(),b=this.nt[o];if(!b)return this.u.log(t.Warning,`No client method with the name '${o}' found.`),void(e.invocationId&&(this.u.log(t.Warning,`No result given for '${o}' method and invocation ID '${e.invocationId}'.`),await this.xt(this.Bt(e.invocationId,"Client didn't provide a result.",null))));let w=b.slice(),M=!!e.invocationId,D,$,L;for(let K of w)try{let se=D;D=await K.apply(this,e.arguments),M&&D&&se&&(this.u.log(t.Error,`Multiple results provided for '${o}'. Sending error to server.`),L=this.Bt(e.invocationId,"Client provided multiple results.",null)),$=void 0}catch(se){$=se,this.u.log(t.Error,`A callback for the method '${o}' threw error '${se}'.`)}L?await this.xt(L):M?($?L=this.Bt(e.invocationId,`${$}`,null):D!==void 0?L=this.Bt(e.invocationId,null,D):(this.u.log(t.Warning,`No result given for '${o}' method and invocation ID '${e.invocationId}'.`),L=this.Bt(e.invocationId,"Client didn't provide a result.",null)),await this.xt(L)):D&&this.u.log(t.Error,`Result given for '${o}' method but server is not expecting a result.`)}st(e){this.u.log(t.Debug,`HubConnection.connectionClosed(${e}) called while in state ${this.ut}.`),this.bt=this.bt||e||new s("The underlying connection was closed before the hub handshake could complete."),this.vt&&this.vt(),this.Xt(e||new Error("Invocation canceled due to the underlying connection being closed.")),this.Ct(),this.Tt(),this.ut===q.Disconnecting?this.Dt(e):this.ut===q.Connected&&this.Z?this.Jt(e):this.ut===q.Connected&&this.Dt(e)}Dt(e){if(this.dt){this.ut=q.Disconnected,this.dt=!1,this.Pt&&(this.Pt.X(e!=null?e:new Error("Connection closed.")),this.Pt=void 0),l.isBrowser&&window.document.removeEventListener("freeze",this.G);try{this.rt.forEach(o=>o.apply(this,[e]))}catch(o){this.u.log(t.Error,`An onclose callback called with error '${e}' threw error '${o}'.`)}}}async Jt(e){let o=Date.now(),b=0,w=e!==void 0?e:new Error("Attempting to reconnect due to a unknown error."),M=this.zt(b++,0,w);if(M===null)return this.u.log(t.Debug,"Connection not reconnecting because the IRetryPolicy returned null on the first reconnect attempt."),void this.Dt(e);if(this.ut=q.Reconnecting,e?this.u.log(t.Information,`Connection reconnecting because of error '${e}'.`):this.u.log(t.Information,"Connection reconnecting."),this.ot.length!==0){try{this.ot.forEach(D=>D.apply(this,[e]))}catch(D){this.u.log(t.Error,`An onreconnecting callback called with error '${e}' threw error '${D}'.`)}if(this.ut!==q.Reconnecting)return void this.u.log(t.Debug,"Connection left the reconnecting state in onreconnecting callback. Done reconnecting.")}for(;M!==null;){if(this.u.log(t.Information,`Reconnect attempt number ${b} will start in ${M} ms.`),await new Promise(D=>{this.Ht=setTimeout(D,M)}),this.Ht=void 0,this.ut!==q.Reconnecting)return void this.u.log(t.Debug,"Connection left the reconnecting state during reconnect delay. Done reconnecting.");try{if(await this.yt(),this.ut=q.Connected,this.u.log(t.Information,"HubConnection reconnected successfully."),this.ht.length!==0)try{this.ht.forEach(D=>D.apply(this,[this.connection.connectionId]))}catch(D){this.u.log(t.Error,`An onreconnected callback called with connectionId '${this.connection.connectionId}; threw error '${D}'.`)}return}catch(D){if(this.u.log(t.Information,`Reconnect attempt failed because of error '${D}'.`),this.ut!==q.Reconnecting)return this.u.log(t.Debug,`Connection moved to the '${this.ut}' from the reconnecting state during reconnect attempt. Done reconnecting.`),void(this.ut===q.Disconnecting&&this.Dt());w=D instanceof Error?D:new Error(D.toString()),M=this.zt(b++,Date.now()-o,w)}}this.u.log(t.Information,`Reconnect retries have been exhausted after ${Date.now()-o} ms and ${b} failed attempts. Connection disconnecting.`),this.Dt()}zt(e,o,b){try{return this.Z.nextRetryDelayInMilliseconds({elapsedMilliseconds:o,previousRetryCount:e,retryReason:b})}catch(w){return this.u.log(t.Error,`IRetryPolicy.nextRetryDelayInMilliseconds(${e}, ${o}) threw error '${w}'.`),null}}Xt(e){let o=this.it;this.it={},Object.keys(o).forEach(b=>{let w=o[b];try{w(null,e)}catch(M){this.u.log(t.Error,`Stream 'error' callback called with '${e}' threw error: ${G(M)}`)}})}Tt(){this.Ft&&(clearTimeout(this.Ft),this.Ft=void 0)}Ct(){this.Ot&&clearTimeout(this.Ot)}Mt(e,o,b,w){if(b)return w.length!==0?{arguments:o,streamIds:w,target:e,type:F.Invocation}:{arguments:o,target:e,type:F.Invocation};{let M=this.ct;return this.ct++,w.length!==0?{arguments:o,invocationId:M.toString(),streamIds:w,target:e,type:F.Invocation}:{arguments:o,invocationId:M.toString(),target:e,type:F.Invocation}}}qt(e,o){if(e.length!==0){o||(o=Promise.resolve());for(let b in e)e[b].subscribe({complete:()=>{o=o.then(()=>this.xt(this.Bt(b)))},error:w=>{let M;M=w instanceof Error?w.message:w&&w.toString?w.toString():"Unknown error",o=o.then(()=>this.xt(this.Bt(b,M)))},next:w=>{o=o.then(()=>this.xt(this.Vt(b,w)))}})}}Ut(e){let o=[],b=[];for(let w=0;w<e.length;w++){let M=e[w];if(this.Kt(M)){let D=this.ct;this.ct++,o[D]=M,b.push(D.toString()),e.splice(w,1)}}return[o,b]}Kt(e){return e&&e.subscribe&&typeof e.subscribe=="function"}Lt(e,o,b){let w=this.ct;return this.ct++,b.length!==0?{arguments:o,invocationId:w.toString(),streamIds:b,target:e,type:F.StreamInvocation}:{arguments:o,invocationId:w.toString(),target:e,type:F.StreamInvocation}}Nt(e){return{invocationId:e,type:F.CancelInvocation}}Vt(e,o){return{invocationId:e,item:o,type:F.StreamItem}}Bt(e,o,b){return o?{error:o,invocationId:e,type:F.Completion}:{invocationId:e,result:b,type:F.Completion}}At(){return{type:F.Close}}}let te=[0,2e3,1e4,3e4,null];class Ee{constructor(e){this.Gt=e!==void 0?[...e,null]:te}nextRetryDelayInMilliseconds(e){return this.Gt[e.previousRetryCount]}}class Q{}Q.Authorization="Authorization",Q.Cookie="Cookie";class xe extends f{constructor(e,o){super(),this.Qt=e,this.Yt=o}async send(e){let o=!0;this.Yt&&(!this.Zt||e.url&&e.url.indexOf("/negotiate?")>0)&&(o=!1,this.Zt=await this.Yt()),this.te(e);let b=await this.Qt.send(e);return o&&b.statusCode===401&&this.Yt?(this.Zt=await this.Yt(),this.te(e),await this.Qt.send(e)):b}te(e){e.headers||(e.headers={}),this.Zt?e.headers[Q.Authorization]=`Bearer ${this.Zt}`:this.Yt&&e.headers[Q.Authorization]&&delete e.headers[Q.Authorization]}getCookieString(e){return this.Qt.getCookieString(e)}}var Z,ne;(function(A){A[A.None=0]="None",A[A.WebSockets=1]="WebSockets",A[A.ServerSentEvents=2]="ServerSentEvents",A[A.LongPolling=4]="LongPolling"})(Z||(Z={})),function(A){A[A.Text=1]="Text",A[A.Binary=2]="Binary"}(ne||(ne={}));class Ne{constructor(){this.ee=!1,this.onabort=null}abort(){this.ee||(this.ee=!0,this.onabort&&this.onabort())}get signal(){return this}get aborted(){return this.ee}}class Fe{get pollAborted(){return this.se.aborted}constructor(e,o,b){this.$=e,this.u=o,this.se=new Ne,this.ie=b,this.ne=!1,this.onreceive=null,this.onclose=null}async connect(e,o){if(x.isRequired(e,"url"),x.isRequired(o,"transferFormat"),x.isIn(o,ne,"transferFormat"),this.re=e,this.u.log(t.Trace,"(LongPolling transport) Connecting."),o===ne.Binary&&typeof XMLHttpRequest!="undefined"&&typeof new XMLHttpRequest().responseType!="string")throw new Error("Binary protocols over XmlHttpRequest not implementing advanced features are not supported.");let[b,w]=T(),M={[b]:w,...this.ie.headers},D={abortSignal:this.se.signal,headers:M,timeout:1e5,withCredentials:this.ie.withCredentials};o===ne.Binary&&(D.responseType="arraybuffer");let $=`${e}&_=${Date.now()}`;this.u.log(t.Trace,`(LongPolling transport) polling: ${$}.`);let L=await this.$.get($,D);L.statusCode!==200?(this.u.log(t.Error,`(LongPolling transport) Unexpected response code: ${L.statusCode}.`),this.oe=new u(L.statusText||"",L.statusCode),this.ne=!1):this.ne=!0,this.he=this.ce(this.re,D)}async ce(e,o){try{for(;this.ne;)try{let b=`${e}&_=${Date.now()}`;this.u.log(t.Trace,`(LongPolling transport) polling: ${b}.`);let w=await this.$.get(b,o);w.statusCode===204?(this.u.log(t.Information,"(LongPolling transport) Poll terminated by server."),this.ne=!1):w.statusCode!==200?(this.u.log(t.Error,`(LongPolling transport) Unexpected response code: ${w.statusCode}.`),this.oe=new u(w.statusText||"",w.statusCode),this.ne=!1):w.content?(this.u.log(t.Trace,`(LongPolling transport) data received. ${d(w.content,this.ie.logMessageContent)}.`),this.onreceive&&this.onreceive(w.content)):this.u.log(t.Trace,"(LongPolling transport) Poll timed out, reissuing.")}catch(b){this.ne?b instanceof c?this.u.log(t.Trace,"(LongPolling transport) Poll timed out, reissuing."):(this.oe=b,this.ne=!1):this.u.log(t.Trace,`(LongPolling transport) Poll errored after shutdown: ${b.message}`)}}finally{this.u.log(t.Trace,"(LongPolling transport) Polling complete."),this.pollAborted||this.ae()}}async send(e){return this.ne?I(this.u,"LongPolling",this.$,this.re,e,this.ie):Promise.reject(new Error("Cannot send until the transport is connected"))}async stop(){this.u.log(t.Trace,"(LongPolling transport) Stopping polling."),this.ne=!1,this.se.abort();try{await this.he,this.u.log(t.Trace,`(LongPolling transport) sending DELETE request to ${this.re}.`);let e={},[o,b]=T();e[o]=b;let w={headers:{...e,...this.ie.headers},timeout:this.ie.timeout,withCredentials:this.ie.withCredentials},M;try{await this.$.delete(this.re,w)}catch(D){M=D}M?M instanceof u&&(M.statusCode===404?this.u.log(t.Trace,"(LongPolling transport) A 404 response was returned from sending a DELETE request."):this.u.log(t.Trace,`(LongPolling transport) Error sending a DELETE request: ${M}`)):this.u.log(t.Trace,"(LongPolling transport) DELETE request accepted.")}finally{this.u.log(t.Trace,"(LongPolling transport) Stop finished."),this.ae()}}ae(){if(this.onclose){let e="(LongPolling transport) Firing onclose event.";this.oe&&(e+=" Error: "+this.oe),this.u.log(t.Trace,e),this.onclose(this.oe)}}}class Be{constructor(e,o,b,w){this.$=e,this.Zt=o,this.u=b,this.ie=w,this.onreceive=null,this.onclose=null}async connect(e,o){return x.isRequired(e,"url"),x.isRequired(o,"transferFormat"),x.isIn(o,ne,"transferFormat"),this.u.log(t.Trace,"(SSE transport) Connecting."),this.re=e,this.Zt&&(e+=(e.indexOf("?")<0?"?":"&")+`access_token=${encodeURIComponent(this.Zt)}`),new Promise((b,w)=>{let M,D=!1;if(o===ne.Text){if(l.isBrowser||l.isWebWorker)M=new this.ie.EventSource(e,{withCredentials:this.ie.withCredentials});else{let $=this.$.getCookieString(e),L={};L.Cookie=$;let[K,se]=T();L[K]=se,M=new this.ie.EventSource(e,{withCredentials:this.ie.withCredentials,headers:{...L,...this.ie.headers}})}try{M.onmessage=$=>{if(this.onreceive)try{this.u.log(t.Trace,`(SSE transport) data received. ${d($.data,this.ie.logMessageContent)}.`),this.onreceive($.data)}catch(L){return void this.le(L)}},M.onerror=$=>{D?this.le():w(new Error("EventSource failed to connect. The connection could not be found on the server, either the connection ID is not present on the server, or a proxy is refusing/buffering the connection. If you have multiple servers check that sticky sessions are enabled."))},M.onopen=()=>{this.u.log(t.Information,`SSE connected to ${this.re}`),this.ue=M,D=!0,b()}}catch($){return void w($)}}else w(new Error("The Server-Sent Events transport only supports the 'Text' transfer format"))})}async send(e){return this.ue?I(this.u,"SSE",this.$,this.re,e,this.ie):Promise.reject(new Error("Cannot send until the transport is connected"))}stop(){return this.le(),Promise.resolve()}le(e){this.ue&&(this.ue.close(),this.ue=void 0,this.onclose&&this.onclose(e))}}class Pe{constructor(e,o,b,w,M,D){this.u=b,this.Yt=o,this.de=w,this.fe=M,this.$=e,this.onreceive=null,this.onclose=null,this.pe=D}async connect(e,o){let b;return x.isRequired(e,"url"),x.isRequired(o,"transferFormat"),x.isIn(o,ne,"transferFormat"),this.u.log(t.Trace,"(WebSockets transport) Connecting."),this.Yt&&(b=await this.Yt()),new Promise((w,M)=>{let D;e=e.replace(/^http/,"ws");let $=this.$.getCookieString(e),L=!1;if(l.isNode||l.isReactNative){let K={},[se,ke]=T();K[se]=ke,b&&(K[Q.Authorization]=`Bearer ${b}`),$&&(K[Q.Cookie]=$),D=new this.fe(e,void 0,{headers:{...K,...this.pe}})}else b&&(e+=(e.indexOf("?")<0?"?":"&")+`access_token=${encodeURIComponent(b)}`);D||(D=new this.fe(e)),o===ne.Binary&&(D.binaryType="arraybuffer"),D.onopen=K=>{this.u.log(t.Information,`WebSocket connected to ${e}.`),this.we=D,L=!0,w()},D.onerror=K=>{let se=null;se=typeof ErrorEvent!="undefined"&&K instanceof ErrorEvent?K.error:"There was an error with the transport",this.u.log(t.Information,`(WebSockets transport) ${se}.`)},D.onmessage=K=>{if(this.u.log(t.Trace,`(WebSockets transport) data received. ${d(K.data,this.de)}.`),this.onreceive)try{this.onreceive(K.data)}catch(se){return void this.le(se)}},D.onclose=K=>{if(L)this.le(K);else{let se=null;se=typeof ErrorEvent!="undefined"&&K instanceof ErrorEvent?K.error:"WebSocket failed to connect. The connection could not be found on the server, either the endpoint may not be a SignalR endpoint, the connection ID is not present on the server, or there is a proxy blocking WebSockets. If you have multiple servers check that sticky sessions are enabled.",M(new Error(se))}}})}send(e){return this.we&&this.we.readyState===this.fe.OPEN?(this.u.log(t.Trace,`(WebSockets transport) sending data. ${d(e,this.de)}.`),this.we.send(e),Promise.resolve()):Promise.reject("WebSocket is not in the OPEN state")}stop(){return this.we&&this.le(void 0),Promise.resolve()}le(e){this.we&&(this.we.onclose=()=>{},this.we.onmessage=()=>{},this.we.onerror=()=>{},this.we.close(),this.we=void 0),this.u.log(t.Trace,"(WebSockets transport) socket closed."),this.onclose&&(!this.ge(e)||e.wasClean!==!1&&e.code===1e3?e instanceof Error?this.onclose(e):this.onclose():this.onclose(new Error(`WebSocket closed with status code: ${e.code} (${e.reason||"no reason given"}).`)))}ge(e){return e&&typeof e.wasClean=="boolean"&&typeof e.code=="number"}}class Ue{constructor(e,o={}){var b;if(this.me=()=>{},this.features={},this.ye=1,x.isRequired(e,"url"),this.u=(b=o.logger)===void 0?new N(t.Information):b===null?k.instance:b.log!==void 0?b:new N(b),this.baseUrl=this.be(e),(o=o||{}).logMessageContent=o.logMessageContent!==void 0&&o.logMessageContent,typeof o.withCredentials!="boolean"&&o.withCredentials!==void 0)throw new Error("withCredentials option was not a 'boolean' or 'undefined' value");o.withCredentials=o.withCredentials===void 0||o.withCredentials,o.timeout=o.timeout===void 0?1e5:o.timeout;let w=null,M=null;l.isNode&&(w=function(){throw new Error("Trying to import 'ws' in the browser.")}(),M=function(){throw new Error("Trying to import 'eventsource' in the browser.")}()),l.isNode||typeof WebSocket=="undefined"||o.WebSocket?l.isNode&&!o.WebSocket&&w&&(o.WebSocket=w):o.WebSocket=WebSocket,l.isNode||typeof EventSource=="undefined"||o.EventSource?l.isNode&&!o.EventSource&&M!==void 0&&(o.EventSource=M):o.EventSource=EventSource,this.$=new xe(o.httpClient||new W(this.u),o.accessTokenFactory),this.ut="Disconnected",this.dt=!1,this.ie=o,this.onreceive=null,this.onclose=null}async start(e){if(e=e||ne.Binary,x.isIn(e,ne,"transferFormat"),this.u.log(t.Debug,`Starting connection with transfer format '${ne[e]}'.`),this.ut!=="Disconnected")return Promise.reject(new Error("Cannot start an HttpConnection that is not in the 'Disconnected' state."));if(this.ut="Connecting",this.ve=this.yt(e),await this.ve,this.ut==="Disconnecting"){let o="Failed to start the HttpConnection before stop() was called.";return this.u.log(t.Error,o),await this.It,Promise.reject(new s(o))}if(this.ut!=="Connected"){let o="HttpConnection.startInternal completed gracefully but didn't enter the connection into the connected state!";return this.u.log(t.Error,o),Promise.reject(new s(o))}this.dt=!0}send(e){return this.ut!=="Connected"?Promise.reject(new Error("Cannot send data if the connection is not in the 'Connected' State.")):(this.Ee||(this.Ee=new Re(this.transport)),this.Ee.send(e))}async stop(e){return this.ut==="Disconnected"?(this.u.log(t.Debug,`Call to HttpConnection.stop(${e}) ignored because the connection is already in the disconnected state.`),Promise.resolve()):this.ut==="Disconnecting"?(this.u.log(t.Debug,`Call to HttpConnection.stop(${e}) ignored because the connection is already in the disconnecting state.`),this.It):(this.ut="Disconnecting",this.It=new Promise(o=>{this.me=o}),await this._t(e),void await this.It)}async _t(e){this.$e=e;try{await this.ve}catch{}if(this.transport){try{await this.transport.stop()}catch(o){this.u.log(t.Error,`HttpConnection.transport.stop() threw error '${o}'.`),this.Ce()}this.transport=void 0}else this.u.log(t.Debug,"HttpConnection.transport is undefined in HttpConnection.stop() because start() failed.")}async yt(e){let o=this.baseUrl;this.Yt=this.ie.accessTokenFactory,this.$.Yt=this.Yt;try{if(this.ie.skipNegotiation){if(this.ie.transport!==Z.WebSockets)throw new Error("Negotiation can only be skipped when using the WebSocket transport directly.");this.transport=this.Se(Z.WebSockets),await this.ke(o,e)}else{let b=null,w=0;do{if(b=await this.Pe(o),this.ut==="Disconnecting"||this.ut==="Disconnected")throw new s("The connection was stopped during negotiation.");if(b.error)throw new Error(b.error);if(b.ProtocolVersion)throw new Error("Detected a connection attempt to an ASP.NET SignalR Server. This client only supports connecting to an ASP.NET Core SignalR Server. See https://aka.ms/signalr-core-differences for details.");if(b.url&&(o=b.url),b.accessToken){let M=b.accessToken;this.Yt=()=>M,this.$.Zt=M,this.$.Yt=void 0}w++}while(b.url&&w<100);if(w===100&&b.url)throw new Error("Negotiate redirection limit exceeded.");await this.Te(o,this.ie.transport,b,e)}this.transport instanceof Fe&&(this.features.inherentKeepAlive=!0),this.ut==="Connecting"&&(this.u.log(t.Debug,"The HttpConnection connected successfully."),this.ut="Connected")}catch(b){return this.u.log(t.Error,"Failed to start the connection: "+b),this.ut="Disconnected",this.transport=void 0,this.me(),Promise.reject(b)}}async Pe(e){let o={},[b,w]=T();o[b]=w;let M=this.Ie(e);this.u.log(t.Debug,`Sending negotiation request: ${M}.`);try{let D=await this.$.post(M,{content:"",headers:{...o,...this.ie.headers},timeout:this.ie.timeout,withCredentials:this.ie.withCredentials});if(D.statusCode!==200)return Promise.reject(new Error(`Unexpected status code returned from negotiate '${D.statusCode}'`));let $=JSON.parse(D.content);return(!$.negotiateVersion||$.negotiateVersion<1)&&($.connectionToken=$.connectionId),$.useStatefulReconnect&&this.ie._e!==!0?Promise.reject(new R("Client didn't negotiate Stateful Reconnect but the server did.")):$}catch(D){let $="Failed to complete negotiation with the server: "+D;return D instanceof u&&D.statusCode===404&&($+=" Either this is not a SignalR endpoint or there is a proxy blocking the connection."),this.u.log(t.Error,$),Promise.reject(new R($))}}He(e,o){return o?e+(e.indexOf("?")===-1?"?":"&")+`id=${o}`:e}async Te(e,o,b,w){let M=this.He(e,b.connectionToken);if(this.De(o))return this.u.log(t.Debug,"Connection was provided an instance of ITransport, using that directly."),this.transport=o,await this.ke(M,w),void(this.connectionId=b.connectionId);let D=[],$=b.availableTransports||[],L=b;for(let K of $){let se=this.Re(K,o,w,(L==null?void 0:L.useStatefulReconnect)===!0);if(se instanceof Error)D.push(`${K.transport} failed:`),D.push(se);else if(this.De(se)){if(this.transport=se,!L){try{L=await this.Pe(e)}catch(ke){return Promise.reject(ke)}M=this.He(e,L.connectionToken)}try{return await this.ke(M,w),void(this.connectionId=L.connectionId)}catch(ke){if(this.u.log(t.Error,`Failed to start the transport '${K.transport}': ${ke}`),L=void 0,D.push(new E(`${K.transport} failed: ${ke}`,Z[K.transport])),this.ut!=="Connecting"){let _e="Failed to select transport before stop() was called.";return this.u.log(t.Debug,_e),Promise.reject(new s(_e))}}}}return D.length>0?Promise.reject(new y(`Unable to connect to the server with any of the available transports. ${D.join(" ")}`,D)):Promise.reject(new Error("None of the transports supported by the client are supported by the server."))}Se(e){switch(e){case Z.WebSockets:if(!this.ie.WebSocket)throw new Error("'WebSocket' is not supported in your environment.");return new Pe(this.$,this.Yt,this.u,this.ie.logMessageContent,this.ie.WebSocket,this.ie.headers||{});case Z.ServerSentEvents:if(!this.ie.EventSource)throw new Error("'EventSource' is not supported in your environment.");return new Be(this.$,this.$.Zt,this.u,this.ie);case Z.LongPolling:return new Fe(this.$,this.u,this.ie);default:throw new Error(`Unknown transport: ${e}.`)}}ke(e,o){return this.transport.onreceive=this.onreceive,this.features.reconnect?this.transport.onclose=async b=>{let w=!1;if(this.features.reconnect){try{this.features.disconnected(),await this.transport.connect(e,o),await this.features.resend()}catch{w=!0}w&&this.Ce(b)}else this.Ce(b)}:this.transport.onclose=b=>this.Ce(b),this.transport.connect(e,o)}Re(e,o,b,w){let M=Z[e.transport];if(M==null)return this.u.log(t.Debug,`Skipping transport '${e.transport}' because it is not supported by this client.`),new Error(`Skipping transport '${e.transport}' because it is not supported by this client.`);if(!function(D,$){return!D||($&D)!=0}(o,M))return this.u.log(t.Debug,`Skipping transport '${Z[M]}' because it was disabled by the client.`),new S(`'${Z[M]}' is disabled by the client.`,M);if(!(e.transferFormats.map(D=>ne[D]).indexOf(b)>=0))return this.u.log(t.Debug,`Skipping transport '${Z[M]}' because it does not support the requested transfer format '${ne[b]}'.`),new Error(`'${Z[M]}' does not support ${ne[b]}.`);if(M===Z.WebSockets&&!this.ie.WebSocket||M===Z.ServerSentEvents&&!this.ie.EventSource)return this.u.log(t.Debug,`Skipping transport '${Z[M]}' because it is not supported in your environment.'`),new g(`'${Z[M]}' is not supported in your environment.`,M);this.u.log(t.Debug,`Selecting transport '${Z[M]}'.`);try{return this.features.reconnect=M===Z.WebSockets?w:void 0,this.Se(M)}catch(D){return D}}De(e){return e&&typeof e=="object"&&"connect"in e}Ce(e){if(this.u.log(t.Debug,`HttpConnection.stopConnection(${e}) called while in state ${this.ut}.`),this.transport=void 0,e=this.$e||e,this.$e=void 0,this.ut!=="Disconnected"){if(this.ut==="Connecting")throw this.u.log(t.Warning,`Call to HttpConnection.stopConnection(${e}) was ignored because the connection is still in the connecting state.`),new Error(`HttpConnection.stopConnection(${e}) was called while the connection is still in the connecting state.`);if(this.ut==="Disconnecting"&&this.me(),e?this.u.log(t.Error,`Connection disconnected with error '${e}'.`):this.u.log(t.Information,"Connection disconnected."),this.Ee&&(this.Ee.stop().catch(o=>{this.u.log(t.Error,`TransportSendQueue.stop() threw error '${o}'.`)}),this.Ee=void 0),this.connectionId=void 0,this.ut="Disconnected",this.dt){this.dt=!1;try{this.onclose&&this.onclose(e)}catch(o){this.u.log(t.Error,`HttpConnection.onclose(${e}) threw error '${o}'.`)}}}else this.u.log(t.Debug,`Call to HttpConnection.stopConnection(${e}) was ignored because the connection is already in the disconnected state.`)}be(e){if(e.lastIndexOf("https://",0)===0||e.lastIndexOf("http://",0)===0)return e;if(!l.isBrowser)throw new Error(`Cannot resolve '${e}'.`);let o=window.document.createElement("a");return o.href=e,this.u.log(t.Information,`Normalizing '${e}' to '${o.href}'.`),o.href}Ie(e){let o=new URL(e);o.pathname.endsWith("/")?o.pathname+="negotiate":o.pathname+="/negotiate";let b=new URLSearchParams(o.searchParams);return b.has("negotiateVersion")||b.append("negotiateVersion",this.ye.toString()),b.has("useStatefulReconnect")?b.get("useStatefulReconnect")==="true"&&(this.ie._e=!0):this.ie._e===!0&&b.append("useStatefulReconnect","true"),o.search=b.toString(),o.toString()}}class Re{constructor(e){this.xe=e,this.Ae=[],this.Ue=!0,this.Le=new we,this.Ne=new we,this.qe=this.Me()}send(e){return this.je(e),this.Ne||(this.Ne=new we),this.Ne.promise}stop(){return this.Ue=!1,this.Le.resolve(),this.qe}je(e){if(this.Ae.length&&typeof this.Ae[0]!=typeof e)throw new Error(`Expected data to be of type ${typeof this.Ae} but was of type ${typeof e}`);this.Ae.push(e),this.Le.resolve()}async Me(){for(;;){if(await this.Le.promise,!this.Ue){this.Ne&&this.Ne.reject("Connection stopped.");break}this.Le=new we;let e=this.Ne;this.Ne=void 0;let o=typeof this.Ae[0]=="string"?this.Ae.join(""):Re.We(this.Ae);this.Ae.length=0;try{await this.xe.send(o),e.resolve()}catch(b){e.reject(b)}}}static We(e){let o=e.map(M=>M.byteLength).reduce((M,D)=>M+D),b=new Uint8Array(o),w=0;for(let M of e)b.set(new Uint8Array(M),w),w+=M.byteLength;return b.buffer}}class we{constructor(){this.promise=new Promise((e,o)=>[this.j,this.Oe]=[e,o])}resolve(){this.j()}reject(e){this.Oe(e)}}class de{constructor(){this.name="json",this.version=2,this.transferFormat=ne.Text}parseMessages(e,o){if(typeof e!="string")throw new Error("Invalid input for JSON hub protocol. Expected a string.");if(!e)return[];o===null&&(o=k.instance);let b=H.parse(e),w=[];for(let M of b){let D=JSON.parse(M);if(typeof D.type!="number")throw new Error("Invalid payload.");switch(D.type){case F.Invocation:this.U(D);break;case F.StreamItem:this.Fe(D);break;case F.Completion:this.Be(D);break;case F.Ping:case F.Close:break;case F.Ack:this.Xe(D);break;case F.Sequence:this.Je(D);break;default:o.log(t.Information,"Unknown message type '"+D.type+"' ignored.");continue}w.push(D)}return w}writeMessage(e){return H.write(JSON.stringify(e))}U(e){this.ze(e.target,"Invalid payload for Invocation message."),e.invocationId!==void 0&&this.ze(e.invocationId,"Invalid payload for Invocation message.")}Fe(e){if(this.ze(e.invocationId,"Invalid payload for StreamItem message."),e.item===void 0)throw new Error("Invalid payload for StreamItem message.")}Be(e){if(e.result&&e.error)throw new Error("Invalid payload for Completion message.");!e.result&&e.error&&this.ze(e.error,"Invalid payload for Completion message."),this.ze(e.invocationId,"Invalid payload for Completion message.")}Xe(e){if(typeof e.sequenceId!="number")throw new Error("Invalid SequenceId for Ack message.")}Je(e){if(typeof e.sequenceId!="number")throw new Error("Invalid SequenceId for Sequence message.")}ze(e,o){if(typeof e!="string"||e==="")throw new Error(o)}}let pt={trace:t.Trace,debug:t.Debug,info:t.Information,information:t.Information,warn:t.Warning,warning:t.Warning,error:t.Error,critical:t.Critical,none:t.None};class Le{configureLogging(e){if(x.isRequired(e,"logging"),e.log!==void 0)this.logger=e;else if(typeof e=="string"){let o=function(b){let w=pt[b.toLowerCase()];if(w!==void 0)return w;throw new Error(`Unknown log level: ${b}`)}(e);this.logger=new N(o)}else this.logger=new N(e);return this}withUrl(e,o){return x.isRequired(e,"url"),x.isNotEmpty(e,"url"),this.url=e,this.httpConnectionOptions=typeof o=="object"?{...this.httpConnectionOptions,...o}:{...this.httpConnectionOptions,transport:o},this}withHubProtocol(e){return x.isRequired(e,"protocol"),this.protocol=e,this}withAutomaticReconnect(e){if(this.reconnectPolicy)throw new Error("A reconnectPolicy has already been set.");return e?Array.isArray(e)?this.reconnectPolicy=new Ee(e):this.reconnectPolicy=e:this.reconnectPolicy=new Ee,this}withServerTimeout(e){return x.isRequired(e,"milliseconds"),this.Ve=e,this}withKeepAliveInterval(e){return x.isRequired(e,"milliseconds"),this.Ke=e,this}withStatefulReconnect(e){return this.httpConnectionOptions===void 0&&(this.httpConnectionOptions={}),this.httpConnectionOptions._e=!0,this.Y=e==null?void 0:e.bufferSize,this}build(){let e=this.httpConnectionOptions||{};if(e.logger===void 0&&(e.logger=this.logger),!this.url)throw new Error("The 'HubConnectionBuilder.withUrl' method must be called before building the connection.");let o=new Ue(this.url,e);return fe.create(o,this.logger||k.instance,this.protocol||new de,this.reconnectPolicy,this.Ve,this.Ke,this.Y)}}return Uint8Array.prototype.indexOf||Object.defineProperty(Uint8Array.prototype,"indexOf",{value:Array.prototype.indexOf,writable:!0}),Uint8Array.prototype.slice||Object.defineProperty(Uint8Array.prototype,"slice",{value:function(A,e){return new Uint8Array(Array.prototype.slice.call(this,A,e))},writable:!0}),Uint8Array.prototype.forEach||Object.defineProperty(Uint8Array.prototype,"forEach",{value:Array.prototype.forEach,writable:!0}),a})(),typeof wt=="object"&&typeof Wt=="object"?Wt.exports=dt():typeof define=="function"&&define.amd?define([],dt):typeof wt=="object"?wt.signalR=dt():cn.signalR=dt()});var hn=ue((un,Ct)=>{"use strict";(function(r,t){if(typeof Ct=="object"&&Ct.exports)Ct.exports=t();else{let a=t();r.CryptoTickerConfig=Object.assign({},r.CryptoTickerConfig||{},a)}})(typeof self!="undefined"?self:un,function(){return{tProxyBase:"https://tproxyv8.opendle.com",fallbackPollIntervalMs:6e4,staleTickerTimeoutMs:5*60*1e3,binanceRestBaseUrl:"https://api.binance.com",binanceWsBaseUrl:"wss://stream.binance.com:9443/ws",binanceSymbolOverrides:{},bitfinexRestBaseUrl:"https://api-pub.bitfinex.com",bitfinexWsBaseUrl:"wss://api-pub.bitfinex.com/ws/2",bitfinexSymbolOverrides:{},messages:{loading:"LOADING...",stale:"STALE",noData:"NO DATA",misconfigured:"INVALID PAIR",conversionError:"CONVERT ERROR"}}})});var Ke=ue((fn,St)=>{"use strict";var yr={LIVE:"live",DETACHED:"detached",BACKUP:"backup",BROKEN:"broken"};(function(r,t){let a=typeof globalThis!="undefined"?globalThis:r,u=t();typeof St=="object"&&St.exports&&(St.exports=u),a&&(a.CryptoTickerConnectionStates=u)})(typeof self!="undefined"?self:fn,function(){return yr})});var gt=ue((pn,kt)=>{"use strict";(function(r,t){let a=typeof globalThis!="undefined"?globalThis:r,u=t();typeof kt=="object"&&kt.exports&&(kt.exports=u),a&&(a.CryptoTickerProviders=a.CryptoTickerProviders||{},a.CryptoTickerProviders.buildSubscriptionKey=u.buildSubscriptionKey)})(typeof self!="undefined"?self:pn,function(){function t(a,u,c,s){let g=a||"",S=u||"",E=c||null,R=s||null,y="";return E!==null&&R!==null&&E!==R&&(y="__"+E+"_"+R),g+"__"+S+y}return{buildSubscriptionKey:t}})});var Ye=ue((dn,Tt)=>{"use strict";(function(r,t){let a=typeof globalThis!="undefined"?globalThis:r,u=t();typeof Tt=="object"&&Tt.exports&&(Tt.exports=u),a&&(a.CryptoTickerProviders=a.CryptoTickerProviders||{},a.CryptoTickerProviders.ProviderInterface=u.ProviderInterface)})(typeof self!="undefined"?self:dn,function(){function t(){}class a{constructor(c){let s=c||{};this.baseUrl=typeof s.baseUrl=="string"?s.baseUrl:"",this.logger=typeof s.logger=="function"?s.logger:t}getId(){throw new Error("Provider must implement getId()")}subscribeTicker(c,s){throw new Error("Provider must implement subscribeTicker()")}async fetchTicker(c){throw new Error("Provider must implement fetchTicker()")}getCachedTicker(c){return null}async fetchCandles(c){throw new Error("Provider must implement fetchCandles()")}ensureConnection(){}async fetchConversionRate(c,s){return 1}}return{ProviderInterface:a}})});var Xe=ue((gn,Je)=>{"use strict";(function(r,t){let a=typeof globalThis!="undefined"?globalThis:r,u=typeof Je=="object"&&Je.exports?[gt(),Ke()]:[r==null?void 0:r.CryptoTickerProviders,r==null?void 0:r.CryptoTickerConnectionStates],c=t(u[0],u[1]);typeof Je=="object"&&Je.exports&&(Je.exports=c),a&&(a.CryptoTickerProviders=a.CryptoTickerProviders||{},a.CryptoTickerProviders.TickerSubscriptionManager=c.TickerSubscriptionManager)})(typeof self!="undefined"?self:gn,function(r,t){let a=r.buildSubscriptionKey||r,u=t||{LIVE:"live",DETACHED:"detached",BACKUP:"backup",BROKEN:"broken"},c=6e4,s=5*60*1e3;function g(){}function S(y){let h=y||{};return{onData:typeof h.onData=="function"?h.onData:null,onError:typeof h.onError=="function"?h.onError:null}}function E(y){let h=y||{},f=h.fromCurrency||null,k=h.toCurrency||null;return{exchange:h.exchange,symbol:h.symbol,fromCurrency:f,toCurrency:k}}class R{constructor(h){let f=h||{};this.logger=typeof f.logger=="function"?f.logger:g,this.fetchTickerFn=typeof f.fetchTicker=="function"?f.fetchTicker:null,this.subscribeStreamingFn=typeof f.subscribeStreaming=="function"?f.subscribeStreaming:null,this.unsubscribeStreamingFn=typeof f.unsubscribeStreaming=="function"?f.unsubscribeStreaming:null,this.ensureConnectionFn=typeof f.ensureConnection=="function"?f.ensureConnection:null,this.subscriptionKeyBuilder=typeof f.buildSubscriptionKey=="function"?f.buildSubscriptionKey:a,this.fallbackPollIntervalMs=typeof f.fallbackPollIntervalMs=="number"?f.fallbackPollIntervalMs:c,this.staleTickerTimeoutMs=typeof f.staleTickerTimeoutMs=="number"?f.staleTickerTimeoutMs:s,this.connectionStates=u,this.entries={},this.cache={}}subscribe(h,f){let k=S(f),p=this.getOrCreateEntry(h);if(p.subscribers.push(k),this.ensureConnectionFn)try{this.ensureConnectionFn()}catch(l){this.logger("TickerSubscriptionManager: ensureConnection error",l)}this.ensureStreaming(p),this.startFallbackPolling(p);let x=this;return this.fetchTickerFn&&this.fetchTickerFn(p.params).then(function(l){x.applyTickerStateFromFetch(p,l),x.cache[p.key]=l,x.notifySubscribers(p,l)}).catch(function(l){if(x.logger("TickerSubscriptionManager: fetchTicker error",l),k.onError)try{k.onError(l)}catch(d){x.logger("TickerSubscriptionManager: onError handler threw",d)}}),{key:p.key,unsubscribe:()=>{this.unsubscribe(p.key,k)}}}unsubscribe(h,f){let k=this.entries[h];if(!k)return;let p=k.subscribers.indexOf(f);p>=0&&k.subscribers.splice(p,1),k.subscribers.length===0&&(this.stopFallbackPolling(k),this.stopStreaming(k),delete this.entries[h])}getCachedTicker(h){return this.cache[h]||null}handleStreamingUpdate(h,f){let k=this.entries[h];k&&(k.lastStreamUpdate=Date.now(),this.setEntryConnectionState(k,this.connectionStates.LIVE,f),this.cache[h]=f,this.notifySubscribers(k,f))}getEntry(h){return this.entries[h]||null}handleStreamingUpdateFromParts(h,f,k,p,x){let l=this.buildKey(h,f,k,p);this.handleStreamingUpdate(l,x)}buildKey(h,f,k,p){return this.subscriptionKeyBuilder(h,f,k,p)}buildKeyFromParams(h){let f=h||{};return this.buildKey(f.exchange,f.symbol,f.fromCurrency,f.toCurrency)}forEachEntry(h){if(typeof h!="function")return;let f=Object.keys(this.entries);for(let k=0;k<f.length;k++){let p=f[k];h(this.entries[p])}}ensureStreaming(h){if(!h||h.streamingActive||!this.subscribeStreamingFn){h&&!h.streamingActive&&(h.streamingActive=!!this.subscribeStreamingFn);return}try{let f=this.subscribeStreamingFn(h);f&&typeof f.then=="function"?f.then(()=>{h.streamingActive=!0}).catch(k=>{h.streamingActive=!1,this.logger("TickerSubscriptionManager: subscribeStreaming promise rejected",k)}):f===!1?h.streamingActive=!1:h.streamingActive=!0}catch(f){h.streamingActive=!1,this.logger("TickerSubscriptionManager: subscribeStreaming error",f)}}stopStreaming(h){if(!(!h||!this.unsubscribeStreamingFn||!h.streamingActive))try{let f=this.unsubscribeStreamingFn(h);f&&typeof f.then=="function"?f.then(()=>{h.streamingActive=!1}).catch(k=>{this.logger("TickerSubscriptionManager: unsubscribeStreaming promise rejected",k)}):h.streamingActive=!1}catch(f){h.streamingActive=!1,this.logger("TickerSubscriptionManager: unsubscribeStreaming error",f)}}notifySubscribers(h,f){if(!h)return;let k=h.subscribers;for(let p=0;p<k.length;p++){let x=k[p];if(x&&x.onData)try{x.onData(f)}catch(l){this.logger("TickerSubscriptionManager: onData handler threw",l)}}}startFallbackPolling(h){if(!h||h.fallbackTimerId||!this.fetchTickerFn)return;let f=this;h.fallbackTimerId=setInterval(function(){f.pollEntryIfNeeded(h)},this.fallbackPollIntervalMs)}stopFallbackPolling(h){!h||!h.fallbackTimerId||(clearInterval(h.fallbackTimerId),h.fallbackTimerId=null)}pollEntryIfNeeded(h){if(!h||!this.fetchTickerFn||!this.shouldPollEntry(h))return;let f=this;this.fetchTickerFn(h.params).then(function(k){f.applyTickerStateFromFetch(h,k),f.cache[h.key]=k,f.notifySubscribers(h,k)}).catch(function(k){f.logger("TickerSubscriptionManager: fallback fetch error",k),f.handleFetchError(h)})}shouldPollEntry(h){if(!h)return!1;if(!h.streamingActive)return!0;let f=h.lastStreamUpdate||0;return f?Date.now()-f>this.staleTickerTimeoutMs:!0}getOrCreateEntry(h){let f=this.buildKeyFromParams(h),k=this.entries[f];return k||(k={key:f,params:E(h),subscribers:[],streamingActive:!1,lastStreamUpdate:0,fallbackTimerId:null,meta:{},connectionState:null},this.entries[f]=k),k}setEntryConnectionState(h,f,k){h&&(h.connectionState=f,k&&typeof k=="object"&&(k.connectionState=f))}applyTickerStateFromFetch(h,f){if(!h||!f)return;let k=f.connectionState||(h.streamingActive?this.connectionStates.LIVE:this.connectionStates.DETACHED);this.setEntryConnectionState(h,k,f)}handleFetchError(h){if(!h)return;this.setEntryConnectionState(h,this.connectionStates.BROKEN);let f=h.key,k=this.cache[f];if(k){k.connectionState=this.connectionStates.BROKEN,this.notifySubscribers(h,k);return}let p={changeDaily:0,changeDailyPercent:0,last:0,volume:0,high:0,low:0,pair:h.params.symbol,pairDisplay:h.params.symbol,connectionState:this.connectionStates.BROKEN};this.cache[f]=p,this.notifySubscribers(h,p)}}return{TickerSubscriptionManager:R}})});var Ze=ue((bn,Qe)=>{"use strict";(function(r,t){let a=typeof globalThis!="undefined"?globalThis:r,u=typeof Qe=="object"&&Qe.exports?[Ye(),gt(),Xe(),Ke()]:[r==null?void 0:r.CryptoTickerProviders,r==null?void 0:r.CryptoTickerProviders,r==null?void 0:r.CryptoTickerProviders,r==null?void 0:r.CryptoTickerConnectionStates],c=t(u[0],u[1],u[2],u[3]);typeof Qe=="object"&&Qe.exports&&(Qe.exports=c),a&&(a.CryptoTickerProviders=a.CryptoTickerProviders||{},a.CryptoTickerProviders.GenericProvider=c.GenericProvider)})(typeof self!="undefined"?self:bn,function(r,t,a,u){let c=r.ProviderInterface||r,s=t.buildSubscriptionKey||t,g=a.TickerSubscriptionManager||a,S=u||{LIVE:"live",DETACHED:"detached",BACKUP:"backup",BROKEN:"broken"},E="Connected",R=5e3,y="_ctBust";function h(k){if(!k||typeof k!="string")return k;try{let p=new URL(k);return p.searchParams.set(y,Date.now().toString()),p.toString()}catch{let x=k.indexOf("?")===-1?"?":"&";return k+x+y+"="+Date.now()}}class f extends c{constructor(p){super(p);let x=p||{};this.retryDelayMs=typeof x.retryDelayMs=="number"?x.retryDelayMs:R,this.connection=null,this.shouldReconnect=!0,this.connectionState="Disconnected",this.startingConnection=!1,this.normalizedBaseUrl=(this.baseUrl||"").replace(/\/$/,"");let l={logger:(...d)=>{this.logger(...d)},fetchTicker:this.rawFetchTicker.bind(this),subscribeStreaming:this.subscribeEntry.bind(this),unsubscribeStreaming:this.unsubscribeEntry.bind(this),ensureConnection:this.ensureConnection.bind(this),buildSubscriptionKey:function(d,C,I,v){return s(d,C,I,v)},fallbackPollIntervalMs:x.fallbackPollIntervalMs,staleTickerTimeoutMs:x.staleTickerTimeoutMs};this.subscriptionManager=new g(l)}getId(){return"GENERIC"}subscribeTicker(p,x){return this.subscriptionManager.subscribe(p,x)}getCachedTicker(p){return this.subscriptionManager.getCachedTicker(p)}ensureConnection(){if(!(this.connection&&(this.connectionState===E||this.startingConnection))){if(typeof signalR=="undefined"||!signalR.HubConnectionBuilder){this.logger("GenericProvider: SignalR not available, skipping WebSocket connection.");return}if(!this.connection){this.connection=new signalR.HubConnectionBuilder().withUrl(this.baseUrl+"/tickerhub").withAutomaticReconnect().configureLogging(signalR.LogLevel.Warning).build();let p=this;this.connection.on("ticker",function(x){p.handleTickerMessage(x)}),this.connection.onreconnected(function(){p.logger("GenericProvider: connection re-established, resubscribing."),p.onConnectionEstablished()}),this.connection.onclose(function(){p.connectionState="Disconnected",p.shouldReconnect&&setTimeout(function(){p.startConnection()},p.retryDelayMs)})}this.startConnection()}}startConnection(){if(!this.connection||this.startingConnection||this.connectionState===E)return;let p=this;this.startingConnection=!0,this.connection.start().then(function(){p.connectionState=E,p.startingConnection=!1,p.onConnectionEstablished()}).catch(function(x){p.connectionState="Disconnected",p.startingConnection=!1,p.logger("GenericProvider: error starting connection",x),setTimeout(function(){p.startConnection()},p.retryDelayMs)})}isConnected(){return this.connection&&this.connectionState===E}onConnectionEstablished(){let p=this;this.subscriptionManager.forEachEntry(function(x){x&&(x.streamingActive=!1,x.meta&&(x.meta.isSubscribed=!1,x.meta.pending=!0),p.subscriptionManager.ensureStreaming(x))})}subscribeEntry(p){if(!p)return!1;if(p.meta=p.meta||{},!this.connection)return this.ensureConnection(),p.meta.pending=!0,p.streamingActive=!1,!1;if(!this.isConnected())return this.startConnection(),p.meta.pending=!0,p.streamingActive=!1,!1;if(p.meta.isSubscribed)return p.meta.pending=!1,!0;p.meta.pending=!0;let x=p.params,l=this;return this.connection.invoke("Subscribe",x.exchange,x.symbol,x.fromCurrency,x.toCurrency).then(function(){return p.meta.isSubscribed=!0,p.meta.pending=!1,p.streamingActive=!0,!0}).catch(function(d){return p.meta.isSubscribed=!1,p.meta.pending=!1,p.streamingActive=!1,l.logger("GenericProvider: error invoking Subscribe",d),!1})}unsubscribeEntry(p){if(!p)return!0;if(p.meta=p.meta||{},!this.connection||!p.meta.isSubscribed)return p.meta.isSubscribed=!1,p.streamingActive=!1,!0;let x=p.params,l=this;return this.connection.invoke("Unsubscribe",x.exchange,x.symbol,x.fromCurrency,x.toCurrency).then(function(){return p.meta.isSubscribed=!1,p.streamingActive=!1,!0}).catch(function(d){return p.meta.isSubscribed=!1,p.streamingActive=!1,l.logger("GenericProvider: error invoking Unsubscribe",d),!1})}fetchTicker(p){return this.rawFetchTicker(p)}rawFetchTicker(p){let x=p.exchange||"",l=p.symbol||"",d=p.fromCurrency||"USD",C=p.toCurrency||null,I=(this.baseUrl||"").replace(/\/$/,""),v=encodeURIComponent(x),N=encodeURIComponent(l),T=I+"/api/Ticker/json/"+v+"/"+N+"?fromCurrency="+encodeURIComponent(d);C!==null&&(T+="&toCurrency="+encodeURIComponent(C));let B=this,z=this.buildProxyRequestConfig(T);return fetch(z.url,z.options).then(function(O){return O.json()}).then(function(O){let G=B.transformTickerResponse(O);return G.connectionState=S.BACKUP,G}).catch(function(O){B.logger("GenericProvider: error fetching ticker",O);let G=B.subscriptionManager.buildKey(x,l,d,C),X=B.subscriptionManager.getCachedTicker(G);if(X)return X.connectionState=X.connectionState||S.BACKUP,X;let V=B.buildEmptyTicker(l);return V.connectionState=S.BROKEN,V})}handleTickerMessage(p){if(!p)return;let x=p.provider||p.provider,l=p.symbol||p.symbol,d=p.conversionFromCurrency||p.conversionFromCurrency||null,C=p.conversionToCurrency||p.conversionToCurrency||null,I=this.subscriptionManager.buildKey(x,l,d,C),v=this.transformTickerResponse(p),N=this.subscriptionManager.getEntry(I);N&&N.meta&&(N.meta.isSubscribed=!0,N.meta.pending=!1,N.streamingActive=!0),this.subscriptionManager.handleStreamingUpdate(I,v)}async fetchCandles(p){let x=p.exchange,l=p.symbol,d=p.interval,C=typeof p.limit=="number"&&p.limit>0?p.limit:24,v=this.baseUrl.replace(/\/$/,"")+"/api/Candles/json/"+encodeURIComponent(x)+"/"+encodeURIComponent(l)+"/"+d+"?limit="+C;try{let N=this.buildProxyRequestConfig(v),T=await fetch(N.url,N.options);if(!T||!T.ok)throw new Error("GenericProvider: candles response not ok");let B=await T.json();return Array.isArray(B.candles)?B.candles:[]}catch(N){throw this.logger("GenericProvider: error fetching candles",N),N}}buildProxyRequestConfig(p,x){if(!p||typeof p!="string")return{url:p,options:x};let l=this.normalizedBaseUrl,d=p.replace(/\/$/,"");if(!l||d.indexOf(l)!==0)return{url:p,options:x};let C=Object.assign({},x||{});C.cache="no-store";let I=Object.assign({},C.headers||{});return I["cache-control"]="no-cache",I.pragma="no-cache",C.headers=I,{url:h(p),options:C}}transformTickerResponse(p){let x=p||{};return{changeDaily:x.dailyChange||0,changeDailyPercent:x.dailyChangeRelative||0,last:x.last||0,volume:x.volume||0,high:x.high24h||0,low:x.low24h||0,pair:x.symbol||x.pair||"",pairDisplay:x.symbolDisplay||x.symbol||x.pair||""}}buildEmptyTicker(p){let x=p||"";return{changeDaily:0,changeDailyPercent:0,last:0,volume:0,high:0,low:0,pair:x,pairDisplay:x,connectionState:S.BROKEN}}}return{GenericProvider:f}})});var mn=ue((yn,Et)=>{"use strict";(function(t,a){let u=a();typeof Et=="object"&&Et.exports&&(Et.exports=u),t&&typeof t=="object"&&(t.CryptoTickerDefaults=u)})(typeof self!="undefined"?self:yn,function(){function t(y){if(y===null||typeof y!="object")return y;if(Array.isArray(y))return y.map(f=>t(f));let h={};for(let f in y)Object.prototype.hasOwnProperty.call(y,f)&&(h[f]=t(y[f]));return h}function a(y){let h=y==null?void 0:y.case,f=(y==null?void 0:y.allowEmptyString)===!0,k=(y==null?void 0:y.allowNull)===!0,p=Object.prototype.hasOwnProperty.call(y||{},"trim")?!!(y!=null&&y.trim):!0,x=Array.isArray(y==null?void 0:y.allowedValues)?y==null?void 0:y.allowedValues:null;return function(d){if(d===void 0)return null;if(d===null)return k?null:"";let C=String(d);if(p&&(C=C.trim()),!C&&!f)return null;if(h==="upper"?C=C.toUpperCase():h==="lower"&&(C=C.toLowerCase()),x&&x.length>0){let I=h==="lower"?C.toLowerCase():h==="upper"?C.toUpperCase():C;return x.some(N=>h==="lower"?N.toLowerCase()===I:h==="upper"?N.toUpperCase()===I:N===I)?h==="lower"||h==="upper"?I:C:null}return C}}function u(y){let h=typeof(y==null?void 0:y.min)=="number"?y.min:null,f=typeof(y==null?void 0:y.max)=="number"?y.max:null,k=(y==null?void 0:y.integer)===!0;return function(x){if(x==null||x==="")return null;let l=typeof x=="number"?x:parseFloat(String(x));return Number.isNaN(l)?null:(k&&(l=Math.round(l)),h!==null&&l<h&&(l=h),f!==null&&l>f&&(l=f),l)}}function c(y){let h=Array.isArray(y.allowed)?y.allowed.slice(0):[],f=y.trim!==!1;return function(p){if(p==null)return null;let x=String(p);return f&&(x=x.trim()),x&&h.indexOf(x)>=0?x:null}}let s={title:{type:"string",default:"",normalize:a({allowEmptyString:!0,allowNull:!0,trim:!0})},exchange:{type:"string",default:"BINANCE",normalize:a({trim:!0,allowEmptyString:!1,case:"upper"})},pair:{type:"string",default:"BTCUSD",normalize:a({trim:!0,allowEmptyString:!1,case:"upper"})},fromCurrency:{type:"string",default:"USD",normalize:a({trim:!0,allowEmptyString:!1,case:"upper"})},currency:{type:"string",default:"",normalize:a({trim:!0,allowEmptyString:!0,case:"upper",allowNull:!0})},candlesInterval:{type:"string",default:"1h",normalize:a({trim:!0,allowEmptyString:!1})},candlesDisplayed:{type:"number",default:20,normalize:u({min:5,max:60,integer:!0})},multiplier:{type:"number",default:1,normalize:u({min:0})},digits:{type:"number",default:2,normalize:u({min:0,max:10,integer:!0})},highLowDigits:{type:"string",default:"",normalize:a({trim:!0,allowEmptyString:!0})},font:{type:"string",default:"Lato,'Roboto Condensed',Helvetica,Calibri,sans-serif",normalize:a({trim:!0,allowEmptyString:!1})},fontSizeBase:{type:"number",default:25,normalize:u({min:1,max:200,integer:!0})},fontSizePrice:{type:"number",default:35,normalize:u({min:1,max:200,integer:!0})},fontSizeHighLow:{type:"string",default:"",normalize:a({trim:!0,allowEmptyString:!0})},fontSizeChange:{type:"number",default:19,normalize:u({min:1,max:200,integer:!0})},priceFormat:{type:"string",default:"auto",normalize:function(y){let f=a({trim:!0,allowEmptyString:!1,case:"lower"})(y);return f?f==="compact"?"auto":f==="plain"?"full":f==="auto"||f==="full"?f:null:null}},thousandsSeparator:{type:"string",default:",",normalize:c({allowed:[",","."," ","'"],trim:!1})},decimalSeparator:{type:"string",default:".",normalize:c({allowed:[".",","]})},backgroundColor:{type:"string",default:"#000000",normalize:a({trim:!0,allowEmptyString:!1})},textColor:{type:"string",default:"#ffffff",normalize:a({trim:!0,allowEmptyString:!1})},displayHighLow:{type:"string",default:"on",normalize:a({trim:!0,allowEmptyString:!1,case:"lower",allowedValues:["on","off"]})},displayHighLowBar:{type:"string",default:"on",normalize:a({trim:!0,allowEmptyString:!1,case:"lower",allowedValues:["on","off"]})},displayDailyChange:{type:"string",default:"on",normalize:a({trim:!0,allowEmptyString:!1,case:"lower",allowedValues:["on","off"]})},displayConnectionStatusIcon:{type:"string",default:"OFF",normalize:a({trim:!0,allowEmptyString:!1,case:"upper",allowedValues:["OFF","TOP_RIGHT","BOTTOM_LEFT"]})},alertRule:{type:"string",default:"",normalize:a({trim:!0,allowEmptyString:!0})},backgroundColorRule:{type:"string",default:"",normalize:a({trim:!0,allowEmptyString:!0})},textColorRule:{type:"string",default:"",normalize:a({trim:!0,allowEmptyString:!0})},mode:{type:"string",default:"ticker",normalize:a({trim:!0,allowEmptyString:!1,case:"lower",allowedValues:["ticker","candles"]})}};function g(y,h,f){if(!y||typeof y!="object")return{value:h,error:null};let k=y.normalize,p=y.default;if(typeof k!="function")return{value:h===void 0?t(p):h,error:null};let x=k(h);if(x==null){let l=k(p);return{value:l==null?t(p):l,error:f?"Invalid "+y.type:null}}return{value:x,error:null}}function S(y){let h=y&&typeof y=="object"?y:{},f={},k=[];for(let p in s){if(!Object.prototype.hasOwnProperty.call(s,p))continue;let x=s[p],l=Object.prototype.hasOwnProperty.call(h,p),d=l?h[p]:void 0,C=g(x,d,l);f[p]=C.value,C.error&&k.push({key:p,message:C.error})}for(let p in h)!Object.prototype.hasOwnProperty.call(s,p)&&Object.prototype.hasOwnProperty.call(h,p)&&(f[p]=h[p]);return{settings:f,errors:k}}function E(y){return S(y).settings}let R=E(null);return{settingsSchema:s,defaultSettings:R,getDefaultSettings:function(){return t(R)},validateSettings:function(y){let h=S(y);return{settings:h.settings,errors:h.errors.slice(0)}},applyDefaults:E}})});var Pt=ue((vn,xt)=>{"use strict";(function(r,t){let a=typeof globalThis!="undefined"?globalThis:r,u=t();typeof xt=="object"&&xt.exports&&(xt.exports=u),a&&(a.CryptoTickerProviders=a.CryptoTickerProviders||{},a.CryptoTickerProviders.WebSocketConnectionPool=u.WebSocketConnectionPool)})(typeof self!="undefined"?self:vn,function(){function r(){}function t(u,c){if(!c||typeof c!="object")return u;let s=Object.keys(c);for(let g=0;g<s.length;g++){let S=s[g];u[S]=c[S]}return u}class a{constructor(c){let s=c||{};this.logger=typeof s.logger=="function"?s.logger:r,this.createWebSocket=typeof s.createWebSocket=="function"?s.createWebSocket:null,this.subscribeHandler=typeof s.subscribe=="function"?s.subscribe:null,this.unsubscribeHandler=typeof s.unsubscribe=="function"?s.unsubscribe:null,this.handleMessageFn=typeof s.handleMessage=="function"?s.handleMessage:null,this.onOpen=typeof s.onOpen=="function"?s.onOpen:null,this.onError=typeof s.onError=="function"?s.onError:null,this.onClose=typeof s.onClose=="function"?s.onClose:null,this.reconnectDelayMs=typeof s.reconnectDelayMs=="number"?s.reconnectDelayMs:5e3,this.autoCloseDelayMs=typeof s.autoCloseDelayMs=="number"?s.autoCloseDelayMs:0,this.shouldResubscribeOnReconnect=s.shouldResubscribeOnReconnect!==!1,this.symbolEntries={},this.ws=null,this.wsClosedByUser=!1,this.reconnectTimer=null,this.closeTimer=null,this.isConnecting=!1}subscribe(c,s){let g=typeof c=="string"?c:"";if(!g)return this.logger("WebSocketConnectionPool: subscribe called without symbol"),null;if(!this.createWebSocket)return this.logger("WebSocketConnectionPool: createWebSocket not configured"),null;let S=this.buildSubscriber(s);if(!S.onData)return this.logger("WebSocketConnectionPool: subscriber missing onData handler for",g),null;let E=this.symbolEntries[g];E||(E={symbol:g,subscribers:[],subscribed:!1,subscriptionRequested:!1,meta:{}},this.symbolEntries[g]=E),E.subscribers.push(S),this.clearCloseTimer(),this.ensureConnection(),this.isSocketOpen()&&!E.subscribed&&!E.subscriptionRequested&&this.requestSubscribe(E);let R=this;return{symbol:g,unsubscribe:function(){R.removeSubscriber(g,S)},updateMetadata:function(y){R.updateSymbolMetadata(g,y)},getMetadata:function(){let y=R.symbolEntries[g];return y?y.meta:null}}}removeSubscriber(c,s){let g=this.symbolEntries[c];if(!g)return;let S=g.subscribers.indexOf(s);if(S>=0&&g.subscribers.splice(S,1),!(g.subscribers.length>0)){if(this.isSocketOpen()&&this.unsubscribeHandler&&(g.subscribed||g.subscriptionRequested))try{this.unsubscribeHandler(this.ws,c,g.meta)}catch(E){this.logger("WebSocketConnectionPool: unsubscribe handler error",E)}delete this.symbolEntries[c],this.maybeCloseConnection()}}ensureConnection(){if(this.ws||this.isConnecting)return;let c=null;try{c=this.createWebSocket()}catch(s){this.logger("WebSocketConnectionPool: failed to create WebSocket",s);return}if(!c){this.logger("WebSocketConnectionPool: createWebSocket returned falsy value"),this.scheduleReconnect();return}this.ws=c,this.wsClosedByUser=!1,this.isConnecting=!0,this.attachSocketHandlers(c)}attachSocketHandlers(c){let s=this;c.onopen=function(){if(s.isConnecting=!1,s.onOpen)try{s.onOpen(s.ws)}catch(g){s.logger("WebSocketConnectionPool: onOpen handler error",g)}s.flushPendingSubscriptions()},c.onmessage=function(g){if(s.handleMessageFn)try{s.handleMessageFn(g,s.buildMessageHelpers())}catch(S){s.logger("WebSocketConnectionPool: handleMessage error",S)}},c.onerror=function(g){if(s.onError)try{s.onError(g)}catch(S){s.logger("WebSocketConnectionPool: onError handler error",S)}},c.onclose=function(g){s.handleSocketClose(g)}}handleSocketClose(c){if(this.onClose)try{this.onClose(c)}catch(g){this.logger("WebSocketConnectionPool: onClose handler error",g)}let s=this.hasSubscribers();if(this.isConnecting=!1,this.ws=null,!this.wsClosedByUser&&s){this.resetSubscriptionState(),this.notifyAllDisconnected(),this.scheduleReconnect();return}this.wsClosedByUser=!1,this.resetSubscriptionState()}resetSubscriptionState(){let c=Object.keys(this.symbolEntries);for(let s=0;s<c.length;s++){let g=this.symbolEntries[c[s]];g.subscribed=!1,g.subscriptionRequested=!1}}scheduleReconnect(){if(this.reconnectTimer||!this.hasSubscribers())return;let c=this;this.reconnectTimer=setTimeout(function(){c.reconnectTimer=null,c.hasSubscribers()&&c.ensureConnection()},this.reconnectDelayMs)}clearReconnectTimer(){this.reconnectTimer&&(clearTimeout(this.reconnectTimer),this.reconnectTimer=null)}flushPendingSubscriptions(){let c=Object.keys(this.symbolEntries);for(let s=0;s<c.length;s++){let g=this.symbolEntries[c[s]];!g.subscribed&&!g.subscriptionRequested&&this.requestSubscribe(g)}}requestSubscribe(c){if(!(!c||!this.isSocketOpen())){if(!this.subscribeHandler){c.subscribed=!0,this.notifySubscribed(c.symbol,null);return}try{c.subscriptionRequested=!0,this.subscribeHandler(this.ws,c.symbol,c.meta)}catch(s){c.subscriptionRequested=!1,this.logger("WebSocketConnectionPool: subscribe handler error",s),this.notifySubscribeError(c.symbol,s)}}}notifySubscribed(c,s){let g=this.symbolEntries[c];if(!g)return;if(g.subscribed){s&&t(g.meta,s);return}g.subscribed=!0,g.subscriptionRequested=!1,s&&t(g.meta,s);let S=g.subscribers;for(let E=0;E<S.length;E++){let R=S[E];if(R.onSubscribed)try{R.onSubscribed(R.context)}catch(y){this.logger("WebSocketConnectionPool: onSubscribed handler error",y)}}}notifySubscribeError(c,s){let g=this.symbolEntries[c];if(!g)return;let S=g.subscribers;for(let E=0;E<S.length;E++){let R=S[E];if(R.onError)try{R.onError(s,R.context)}catch(y){this.logger("WebSocketConnectionPool: onError handler error",y)}}}notifyAllDisconnected(){let c=Object.keys(this.symbolEntries);for(let s=0;s<c.length;s++)this.notifyDisconnected(c[s])}notifyDisconnected(c){let s=this.symbolEntries[c];if(!s)return;let g=s.subscribers;for(let S=0;S<g.length;S++){let E=g[S];if(E.onDisconnected)try{E.onDisconnected(E.context)}catch(R){this.logger("WebSocketConnectionPool: onDisconnected handler error",R)}}}dispatch(c,s,g){let S=this.symbolEntries[c];if(!S)return;let E=S.subscribers;for(let R=0;R<E.length;R++){let y=E[R];if(y.onData)try{y.onData(s,g,y.context)}catch(h){this.logger("WebSocketConnectionPool: subscriber onData error",h)}}}dispatchToAll(c,s){let g=Object.keys(this.symbolEntries);for(let S=0;S<g.length;S++)this.dispatch(g[S],c,s)}markSymbolSubscribed(c,s){this.notifySubscribed(c,s)}markSymbolUnsubscribed(c){let s=this.symbolEntries[c];s&&(s.subscribed=!1,s.subscriptionRequested=!1)}updateSymbolMetadata(c,s){let g=this.symbolEntries[c];g&&t(g.meta,s)}getSymbolMetadata(c){let s=this.symbolEntries[c];return s?s.meta:null}findSymbolByMeta(c){if(typeof c!="function")return null;let s=Object.keys(this.symbolEntries);for(let g=0;g<s.length;g++){let S=this.symbolEntries[s[g]];if(c(S.meta,S.symbol))return S.symbol}return null}hasSubscribers(){let c=Object.keys(this.symbolEntries);for(let s=0;s<c.length;s++)if(this.symbolEntries[c[s]].subscribers.length>0)return!0;return!1}maybeCloseConnection(){this.hasSubscribers()||(this.autoCloseDelayMs>0?this.scheduleCloseTimer():this.closeConnection())}scheduleCloseTimer(){if(this.closeTimer)return;let c=this;this.closeTimer=setTimeout(function(){c.closeTimer=null,c.hasSubscribers()||c.closeConnection()},this.autoCloseDelayMs)}clearCloseTimer(){this.closeTimer&&(clearTimeout(this.closeTimer),this.closeTimer=null)}closeConnection(){if(this.clearReconnectTimer(),!!this.ws){this.wsClosedByUser=!0;try{this.ws.close()}catch(c){this.logger("WebSocketConnectionPool: error closing WebSocket",c)}this.ws=null}}buildSubscriber(c){let s=c||{};return{context:s.context||null,onData:typeof s.onData=="function"?s.onData:null,onError:typeof s.onError=="function"?s.onError:null,onSubscribed:typeof s.onSubscribed=="function"?s.onSubscribed:null,onDisconnected:typeof s.onDisconnected=="function"?s.onDisconnected:null}}buildMessageHelpers(){let c=this;return{dispatch:function(s,g,S){c.dispatch(s,g,S)},dispatchToAll:function(s,g){c.dispatchToAll(s,g)},markSubscribed:function(s,g){c.markSymbolSubscribed(s,g)},markUnsubscribed:function(s){c.markSymbolUnsubscribed(s)},updateMetadata:function(s,g){c.updateSymbolMetadata(s,g)},getMetadata:function(s){return c.getSymbolMetadata(s)},findSymbol:function(s){return c.findSymbolByMeta(s)},getActiveSymbols:function(){return Object.keys(c.symbolEntries)}}}isSocketOpen(){return this.ws&&this.ws.readyState===1}}return{WebSocketConnectionPool:a}})});var jt=ue((wn,et)=>{"use strict";(function(r,t){let a=typeof globalThis!="undefined"?globalThis:r,u=typeof et=="object"&&et.exports?[Ye(),Ze(),Xe(),Ke(),Pt()]:[r==null?void 0:r.CryptoTickerProviders,r==null?void 0:r.CryptoTickerProviders,r==null?void 0:r.CryptoTickerProviders,r==null?void 0:r.CryptoTickerConnectionStates,r==null?void 0:r.CryptoTickerProviders],c=t(u[0],u[1],u[2],u[3],u[4]);typeof et=="object"&&et.exports&&(et.exports=c),a&&(a.CryptoTickerProviders=a.CryptoTickerProviders||{},a.CryptoTickerProviders.BinanceProvider=c.BinanceProvider)})(typeof self!="undefined"?self:wn,function(r,t,a,u,c){let s=r.ProviderInterface||r,g=t.GenericProvider||t,S=a.TickerSubscriptionManager||a,E=u||{LIVE:"live",DETACHED:"detached",BACKUP:"backup",BROKEN:"broken"},R=c.WebSocketConnectionPool||c,y=5e3;function h(){return typeof WebSocket!="undefined"?WebSocket:typeof window!="undefined"&&window.WebSocket?window.WebSocket:typeof global!="undefined"&&global.WebSocket?global.WebSocket:null}function f(l){let d=parseFloat(l);return isNaN(d)?0:d}function k(l){return f(l)/100}function p(l){switch(l){case"MINUTES_1":return"1m";case"MINUTES_5":return"5m";case"MINUTES_15":return"15m";case"HOURS_1":return"1h";case"HOURS_6":return"6h";case"HOURS_12":return"12h";case"DAYS_1":return"1d";case"DAYS_7":return"1w";case"MONTHS_1":return"1M"}return null}class x extends s{constructor(d){super(d);let C=d||{};this.genericFallback=C.genericFallback instanceof g?C.genericFallback:new g(d),this.restBaseUrl=typeof C.binanceRestBaseUrl=="string"&&C.binanceRestBaseUrl.length>0?C.binanceRestBaseUrl:"https://api.binance.com",this.wsBaseUrl=typeof C.binanceWsBaseUrl=="string"&&C.binanceWsBaseUrl.length>0?C.binanceWsBaseUrl:"wss://stream.binance.com:9443/ws",this.symbolOverrides=C.binanceSymbolOverrides||{},this.wsReconnectDelayMs=typeof C.retryDelayMs=="number"?C.retryDelayMs:y;let I={logger:(...v)=>{this.logger(...v)},fetchTicker:this.fetchTickerDirect.bind(this),subscribeStreaming:this.subscribeStream.bind(this),unsubscribeStreaming:this.unsubscribeStream.bind(this),fallbackPollIntervalMs:C.fallbackPollIntervalMs,staleTickerTimeoutMs:C.staleTickerTimeoutMs};this.subscriptionManager=new S(I),this.wsRequestId=0,this.webSocketPool=new R({logger:(...v)=>{this.logger(...v)},reconnectDelayMs:this.wsReconnectDelayMs,createWebSocket:()=>{let v=h();if(!v)return this.logger("BinanceProvider: WebSocket not available in this environment"),null;let N=this.wsBaseUrl.replace(/\/$/,"");try{return new v(N)}catch(T){return this.logger("BinanceProvider: error creating pooled WebSocket",T),null}},subscribe:(v,N)=>{this.sendBinanceSubscription(v,N,!0)},unsubscribe:(v,N)=>{this.sendBinanceSubscription(v,N,!1)},handleMessage:(v,N)=>{this.handlePoolMessage(v,N)},onError:v=>{this.logger("BinanceProvider: pooled WebSocket error",v)},onClose:()=>{this.wsRequestId=0}})}getId(){return"BINANCE"}subscribeTicker(d,C){return this.subscriptionManager.subscribe(d,C)}getCachedTicker(d){let C=this.subscriptionManager.getCachedTicker(d);return C||(this.genericFallback&&typeof this.genericFallback.getCachedTicker=="function"?this.genericFallback.getCachedTicker(d):null)}ensureConnection(){let d=this;this.subscriptionManager.forEachEntry(function(C){d.subscriptionManager.ensureStreaming(C)})}async fetchTicker(d){try{return await this.fetchTickerDirect(d)}catch(C){if(this.logger("BinanceProvider: direct fetch failed, using fallback",C),this.genericFallback&&typeof this.genericFallback.fetchTicker=="function")return this.genericFallback.fetchTicker(d);throw C}}async fetchTickerDirect(d){let C=this.resolveSymbol(d);if(!C)throw new Error("BinanceProvider: unable to resolve symbol for "+(d.symbol||""));let I=this.buildRestUrl(C);try{let v=await fetch(I);if(!v||!v.ok)throw new Error("BinanceProvider: REST response not ok for "+C);let N=await v.json(),T=this.transformRestTicker(N,d,C);return T.connectionState=E.DETACHED,T}catch(v){if(this.logger("BinanceProvider: REST fetch error",v),this.genericFallback&&typeof this.genericFallback.fetchTicker=="function"){let N=await this.genericFallback.fetchTicker(d);return N&&typeof N=="object"&&!N.connectionState&&(N.connectionState=E.BACKUP),N}throw v}}subscribeStream(d){if(!d)return!1;let C=this.ensureEntryMeta(d);if(C.binanceSymbol=this.resolveSymbol(d.params),!C.binanceSymbol)return this.logger("BinanceProvider: cannot subscribe, unresolved symbol",d.params),!1;let I=this.webSocketPool.subscribe(C.binanceSymbol,{context:d,onData:v=>{let N=this.transformStreamTicker(v,d,C.binanceSymbol);this.subscriptionManager.handleStreamingUpdate(d.key,N)},onSubscribed:()=>{d.streamingActive=!0},onDisconnected:()=>{d.streamingActive=!1},onError:v=>{this.logger("BinanceProvider: subscription error",v)}});return I?(C.poolSubscription=I,d.streamingActive=!0,!0):(d.streamingActive=!1,!1)}unsubscribeStream(d){if(!d)return!0;let C=this.ensureEntryMeta(d);return C.poolSubscription&&typeof C.poolSubscription.unsubscribe=="function"&&C.poolSubscription.unsubscribe(),C.poolSubscription=null,d.streamingActive=!1,!0}resolveSymbol(d){if(!d)return null;let C=(d.symbol||"").toUpperCase();return C?this.symbolOverrides&&this.symbolOverrides[C]?(this.symbolOverrides[C]||"").toUpperCase():C.endsWith("USD")?C.slice(0,-3)+"USDT":C:null}buildRestUrl(d){return this.restBaseUrl.replace(/\/$/,"")+"/api/v3/ticker/24hr?symbol="+encodeURIComponent(d)}sendBinanceSubscription(d,C,I){if(!d||!C)return;let v=C.toLowerCase()+"@ticker",N={method:I?"SUBSCRIBE":"UNSUBSCRIBE",params:[v],id:this.nextWsRequestId()};try{d.send(JSON.stringify(N))}catch(T){this.logger("BinanceProvider: error sending subscription message",T)}}nextWsRequestId(){return this.wsRequestId+=1,this.wsRequestId>1e6&&(this.wsRequestId=1),this.wsRequestId}handlePoolMessage(d,C){if(!d)return;let I=d.data;if(!I)return;if(typeof I=="string")try{I=JSON.parse(I)}catch(T){this.logger("BinanceProvider: failed to parse WebSocket message",T);return}if(!I||Array.isArray(I))return;if(I.error){this.logger("BinanceProvider: WebSocket error message",I.error);return}if(typeof I.result!="undefined")return;let v=I;if(I.data&&typeof I.data=="object"&&(v=I.data),!v||typeof v!="object")return;let N=(v.s||v.symbol||"").toUpperCase();N&&(C.markSubscribed(N),C.dispatch(N,v,I))}transformRestTicker(d,C,I){let v=C&&C.symbol?C.symbol:I;return{changeDaily:f(d.priceChange),changeDailyPercent:k(d.priceChangePercent),last:f(d.lastPrice),volume:f(d.volume),high:f(d.highPrice),low:f(d.lowPrice),pair:v,pairDisplay:v}}transformStreamTicker(d,C,I){let v=C?C.params:null,N=v&&v.symbol?v.symbol:I;return{changeDaily:f(d.p||d.priceChange),changeDailyPercent:k(d.P||d.priceChangePercent),last:f(d.c||d.lastPrice),volume:f(d.v||d.volume),high:f(d.h||d.highPrice),low:f(d.l||d.lowPrice),pair:N,pairDisplay:N}}ensureEntryMeta(d){return d.meta=d.meta||{},d.meta}async fetchCandles(d){let C=this.resolveSymbol(d);if(!C)throw new Error("BinanceProvider: unable to resolve symbol for candles");let I=p(d.interval);if(!I)throw new Error("BinanceProvider: unsupported interval "+d.interval);let v=Math.min(Math.max(parseInt(d.limit,10)||24,1),1e3),T=this.restBaseUrl.replace(/\/$/,"")+"/api/v3/klines?symbol="+encodeURIComponent(C)+"&interval="+encodeURIComponent(I)+"&limit="+v;try{let B=await fetch(T);if(!B||!B.ok)throw new Error("BinanceProvider: candles response not ok");let z=await B.json();if(!Array.isArray(z))throw new Error("BinanceProvider: unexpected candles payload");return z.map(function(O){return{ts:Math.floor((O[0]||0)/1e3),open:f(O[1]),high:f(O[2]),low:f(O[3]),close:f(O[4]),volume:f(O[5]),volumeQuote:f(O[7])}})}catch(B){if(this.logger("BinanceProvider: error fetching candles",B),this.genericFallback&&typeof this.genericFallback.fetchCandles=="function")return this.genericFallback.fetchCandles(d);throw B}}}return{BinanceProvider:x}})});var zt=ue((Cn,tt)=>{"use strict";(function(r,t){let a=typeof globalThis!="undefined"?globalThis:r,u=typeof tt=="object"&&tt.exports?[Ye(),Ze(),Xe(),Ke(),Pt()]:[r==null?void 0:r.CryptoTickerProviders,r==null?void 0:r.CryptoTickerProviders,r==null?void 0:r.CryptoTickerProviders,r==null?void 0:r.CryptoTickerConnectionStates,r==null?void 0:r.CryptoTickerProviders],c=t(u[0],u[1],u[2],u[3],u[4]);typeof tt=="object"&&tt.exports&&(tt.exports=c),a&&(a.CryptoTickerProviders=a.CryptoTickerProviders||{},a.CryptoTickerProviders.BitfinexProvider=c.BitfinexProvider)})(typeof self!="undefined"?self:Cn,function(r,t,a,u,c){let s=r.ProviderInterface||r,g=t.GenericProvider||t,S=a.TickerSubscriptionManager||a,E=u||{LIVE:"live",DETACHED:"detached",BACKUP:"backup",BROKEN:"broken"},R=c.WebSocketConnectionPool||c,y=5e3;function h(){return typeof WebSocket!="undefined"?WebSocket:typeof window!="undefined"&&window.WebSocket?window.WebSocket:typeof global!="undefined"&&global.WebSocket?global.WebSocket:null}function f(x){let l=parseFloat(x);return isNaN(l)?0:l}function k(x){switch(x){case"MINUTES_1":return"1m";case"MINUTES_5":return"5m";case"MINUTES_15":return"15m";case"HOURS_1":return"1h";case"HOURS_6":return"6h";case"HOURS_12":return"12h";case"DAYS_1":return"1D";case"DAYS_7":return"1W";case"MONTHS_1":return"1M"}return null}class p extends s{constructor(l){super(l);let d=l||{};this.genericFallback=d.genericFallback instanceof g?d.genericFallback:new g(l),this.restBaseUrl=typeof d.bitfinexRestBaseUrl=="string"&&d.bitfinexRestBaseUrl.length>0?d.bitfinexRestBaseUrl:"https://api-pub.bitfinex.com",this.wsBaseUrl=typeof d.bitfinexWsBaseUrl=="string"&&d.bitfinexWsBaseUrl.length>0?d.bitfinexWsBaseUrl:"wss://api-pub.bitfinex.com/ws/2",this.symbolOverrides=d.bitfinexSymbolOverrides||{},this.wsReconnectDelayMs=typeof d.retryDelayMs=="number"?d.retryDelayMs:y;let C={logger:(...I)=>{this.logger(...I)},fetchTicker:this.fetchTickerDirect.bind(this),subscribeStreaming:this.subscribeStream.bind(this),unsubscribeStreaming:this.unsubscribeStream.bind(this),fallbackPollIntervalMs:d.fallbackPollIntervalMs,staleTickerTimeoutMs:d.staleTickerTimeoutMs};this.subscriptionManager=new S(C),this.channelIdToSymbol={},this.webSocketPool=new R({logger:(...I)=>{this.logger(...I)},reconnectDelayMs:this.wsReconnectDelayMs,createWebSocket:()=>{let I=h();if(!I)return this.logger("BitfinexProvider: WebSocket not available in this environment"),null;let v=this.wsBaseUrl.replace(/\/$/,"");try{return new I(v)}catch(N){return this.logger("BitfinexProvider: error creating pooled WebSocket",N),null}},subscribe:(I,v)=>{this.sendBitfinexSubscribe(I,v)},unsubscribe:(I,v,N)=>{this.sendBitfinexUnsubscribe(I,v,N)},handleMessage:(I,v)=>{this.handlePoolMessage(I,v)},onError:I=>{this.logger("BitfinexProvider: pooled WebSocket error",I)},onClose:()=>{this.channelIdToSymbol={}}})}getId(){return"BITFINEX"}subscribeTicker(l,d){return this.subscriptionManager.subscribe(l,d)}getCachedTicker(l){let d=this.subscriptionManager.getCachedTicker(l);return d||(this.genericFallback&&typeof this.genericFallback.getCachedTicker=="function"?this.genericFallback.getCachedTicker(l):null)}ensureConnection(){let l=this;this.subscriptionManager.forEachEntry(function(d){l.subscriptionManager.ensureStreaming(d)})}async fetchTicker(l){try{return await this.fetchTickerDirect(l)}catch(d){if(this.logger("BitfinexProvider: direct fetch failed, using fallback",d),this.genericFallback&&typeof this.genericFallback.fetchTicker=="function")return this.genericFallback.fetchTicker(l);throw d}}async fetchTickerDirect(l){let d=this.resolveSymbol(l);if(!d)throw new Error("BitfinexProvider: unable to resolve symbol for "+(l.symbol||""));let C=this.buildRestUrl(d);try{let I=await fetch(C);if(!I||!I.ok)throw new Error("BitfinexProvider: REST response not ok for "+d);let v=await I.json(),N=this.transformRestTicker(v,l,d);return N.connectionState=E.DETACHED,N}catch(I){if(this.logger("BitfinexProvider: REST fetch error",I),this.genericFallback&&typeof this.genericFallback.fetchTicker=="function"){let v=await this.genericFallback.fetchTicker(l);return v&&typeof v=="object"&&!v.connectionState&&(v.connectionState=E.BACKUP),v}throw I}}subscribeStream(l){if(!l)return!1;let d=this.ensureEntryMeta(l);if(d.bitfinexSymbol=this.resolveSymbol(l.params),!d.bitfinexSymbol)return this.logger("BitfinexProvider: cannot subscribe, unresolved symbol",l.params),!1;d.chanId=null;let C=this.webSocketPool.subscribe(d.bitfinexSymbol,{context:l,onData:I=>{let v=this.buildTickerFromArray(I,l);v&&this.subscriptionManager.handleStreamingUpdate(l.key,v)},onSubscribed:()=>{l.streamingActive=!0;let I=C.getMetadata?C.getMetadata():null;I&&I.chanId&&(d.chanId=I.chanId,this.channelIdToSymbol[d.chanId]=d.bitfinexSymbol)},onDisconnected:()=>{l.streamingActive=!1,d.chanId=null},onError:I=>{this.logger("BitfinexProvider: subscription error",I)}});return C?(d.poolSubscription=C,l.streamingActive=!0,!0):(l.streamingActive=!1,!1)}unsubscribeStream(l){if(!l)return!0;let d=this.ensureEntryMeta(l);return d.poolSubscription&&typeof d.poolSubscription.unsubscribe=="function"&&d.poolSubscription.unsubscribe(),d.poolSubscription=null,d.chanId=null,l.streamingActive=!1,!0}resolveSymbol(l){if(!l)return null;let d=(l.symbol||"").toUpperCase();if(!d)return null;if(this.symbolOverrides&&this.symbolOverrides[d])return(this.symbolOverrides[d]||"").toUpperCase();let C=d.replace(/[:/]/g,"");if(!C)return null;let I=C.toUpperCase();return"t"+(I.startsWith("T")?I.substring(1):I)}buildRestUrl(l){return this.restBaseUrl.replace(/\/$/,"")+"/v2/ticker/"+encodeURIComponent(l)}sendBitfinexSubscribe(l,d){if(!l||!d)return;let C={event:"subscribe",channel:"ticker",symbol:d};try{l.send(JSON.stringify(C))}catch(I){this.logger("BitfinexProvider: error sending subscribe",I)}}sendBitfinexUnsubscribe(l,d,C){if(!l)return;let I=C&&C.chanId;if(I)try{l.send(JSON.stringify({event:"unsubscribe",chanId:I}))}catch(v){this.logger("BitfinexProvider: error sending unsubscribe",v)}}handlePoolMessage(l,d){if(!l)return;let C=l.data;if(C){if(typeof C=="string")try{C=JSON.parse(C)}catch(I){this.logger("BitfinexProvider: failed to parse WebSocket message",I);return}if(C){if(Array.isArray(C)){this.handleBitfinexDataArray(C,d);return}C&&typeof C=="object"&&this.handleBitfinexEvent(C,d)}}}handleBitfinexEvent(l,d){if(!l||typeof l!="object")return;let C=l.event;if(C==="subscribed"&&l.channel==="ticker"){let I=typeof l.symbol=="string"?l.symbol:"";if(!I)return;let v=l.chanId;v&&(this.channelIdToSymbol[v]=I),d.markSubscribed(I,{chanId:v||null});return}if(C==="unsubscribed"){let I=l.chanId,v=null;I&&(v=this.channelIdToSymbol[I]||d.findSymbol(function(N){return N&&N.chanId===I}),delete this.channelIdToSymbol[I]),v&&(d.markUnsubscribed(v),d.updateMetadata(v,{chanId:null}));return}C==="error"&&this.logger("BitfinexProvider: subscription error",l)}handleBitfinexDataArray(l,d){if(!Array.isArray(l)||l.length<2)return;let C=l[0],I=l[1];if(I==="hb"||!Array.isArray(I))return;let v=this.channelIdToSymbol[C]||d.findSymbol(function(N){return N&&N.chanId===C});v&&d.dispatch(v,I,l)}buildTickerFromArray(l,d){if(!Array.isArray(l))return null;let C=d?d.params:null,I=C&&C.symbol?C.symbol:this.ensureEntryMeta(d).bitfinexSymbol;return{changeDaily:f(l[4]),changeDailyPercent:f(l[5]),last:f(l[6]),volume:f(l[7]),high:f(l[8]),low:f(l[9]),pair:I,pairDisplay:I}}transformRestTicker(l,d,C){if(!Array.isArray(l))throw new Error("BitfinexProvider: unexpected REST payload for "+C);let I=d&&d.symbol?d.symbol:C;return{changeDaily:f(l[4]),changeDailyPercent:f(l[5]),last:f(l[6]),volume:f(l[7]),high:f(l[8]),low:f(l[9]),pair:I,pairDisplay:I}}ensureEntryMeta(l){return l.meta=l.meta||{},l.meta}async fetchCandles(l){let d=this.resolveSymbol(l);if(!d)throw new Error("BitfinexProvider: unable to resolve symbol for candles");let C=k(l.interval);if(!C)throw new Error("BitfinexProvider: unsupported interval "+l.interval);let I=Math.min(Math.max(parseInt(l.limit,10)||24,1),1e3),N=this.restBaseUrl.replace(/\/$/,"")+"/v2/candles/trade:"+C+":"+encodeURIComponent(d)+"/hist?limit="+I;try{let T=await fetch(N);if(!T||!T.ok)throw new Error("BitfinexProvider: candles response not ok");let B=await T.json();if(!Array.isArray(B))throw new Error("BitfinexProvider: unexpected candles payload");return B.map(function(z){return{ts:Math.floor((z[0]||0)/1e3),open:f(z[1]),close:f(z[2]),high:f(z[3]),low:f(z[4]),volume:f(z[5]),volumeQuote:f(z[5])}})}catch(T){if(this.logger("BitfinexProvider: error fetching candles",T),this.genericFallback&&typeof this.genericFallback.fetchCandles=="function")return this.genericFallback.fetchCandles(l);throw T}}}return{BitfinexProvider:p}})});var Ht=ue((Sn,nt)=>{"use strict";(function(r,t){let a=typeof globalThis!="undefined"?globalThis:r,u=typeof nt=="object"&&nt.exports?[Ye(),Ze(),Xe(),gt()]:[r==null?void 0:r.CryptoTickerProviders,r==null?void 0:r.CryptoTickerProviders,r==null?void 0:r.CryptoTickerProviders,r==null?void 0:r.CryptoTickerProviders],c=t(u[0],u[1],u[2],u[3]);typeof nt=="object"&&nt.exports&&(nt.exports=c),a&&(a.CryptoTickerProviders=a.CryptoTickerProviders||{},a.CryptoTickerProviders.YFinanceProvider=c.YFinanceProvider)})(typeof self!="undefined"?self:Sn,function(r,t,a,u){let c=r.ProviderInterface||r,s=t.GenericProvider||t,g=a.TickerSubscriptionManager||a,S=u.buildSubscriptionKey||u;class E extends c{constructor(y){super(y);let h=y||{};this.genericFallback=h.genericFallback instanceof s?h.genericFallback:new s(y);let f={logger:(...k)=>{this.logger(...k)},fetchTicker:k=>this.genericFallback.fetchTicker(k),subscribeStreaming:null,unsubscribeStreaming:null,ensureConnection:null,buildSubscriptionKey:function(k,p,x,l){return S(k,p,x,l)},fallbackPollIntervalMs:h.fallbackPollIntervalMs,staleTickerTimeoutMs:h.staleTickerTimeoutMs};this.subscriptionManager=new g(f)}getId(){return"YFINANCE"}ensureConnection(){}subscribeTicker(y,h){return this.subscriptionManager.subscribe(y,h)}async fetchTicker(y){return this.genericFallback.fetchTicker(y)}async fetchCandles(y){return this.genericFallback&&typeof this.genericFallback.fetchCandles=="function"?this.genericFallback.fetchCandles(y):c.prototype.fetchCandles.call(this,y)}getCachedTicker(y){let h=this.subscriptionManager.getCachedTicker(y);return h||this.genericFallback.getCachedTicker(y)}}return{YFinanceProvider:E}})});var Tn=ue((kn,rt)=>{"use strict";(function(r,t){let a=typeof globalThis!="undefined"?globalThis:r,u=typeof rt=="object"&&rt.exports?[Ze(),jt(),zt(),Ht()]:[r==null?void 0:r.CryptoTickerProviders,r==null?void 0:r.CryptoTickerProviders,r==null?void 0:r.CryptoTickerProviders,r==null?void 0:r.CryptoTickerProviders],c=t(u[0],u[1],u[2],u[3]);typeof rt=="object"&&rt.exports&&(rt.exports=c),a&&(a.CryptoTickerProviders=a.CryptoTickerProviders||{},a.CryptoTickerProviders.ProviderRegistry=c.ProviderRegistry)})(typeof self!="undefined"?self:kn,function(r,t,a,u){let c=r.GenericProvider||r,s=t.BinanceProvider||t,g=a.BitfinexProvider||a,S=u.YFinanceProvider||u;class E{constructor(y){let h=y||{};this.logger=typeof h.logger=="function"?h.logger:function(){},this.baseUrl=h.baseUrl||"",this.providers={},this.fallbackPollIntervalMs=typeof h.fallbackPollIntervalMs=="number"?h.fallbackPollIntervalMs:void 0,this.staleTickerTimeoutMs=typeof h.staleTickerTimeoutMs=="number"?h.staleTickerTimeoutMs:void 0,this.binanceRestBaseUrl=typeof h.binanceRestBaseUrl=="string"&&h.binanceRestBaseUrl.length>0?h.binanceRestBaseUrl:"https://api.binance.com",this.binanceWsBaseUrl=typeof h.binanceWsBaseUrl=="string"&&h.binanceWsBaseUrl.length>0?h.binanceWsBaseUrl:"wss://stream.binance.com:9443/ws",this.binanceSymbolOverrides=h.binanceSymbolOverrides||{},this.bitfinexRestBaseUrl=typeof h.bitfinexRestBaseUrl=="string"&&h.bitfinexRestBaseUrl.length>0?h.bitfinexRestBaseUrl:"https://api-pub.bitfinex.com",this.bitfinexWsBaseUrl=typeof h.bitfinexWsBaseUrl=="string"&&h.bitfinexWsBaseUrl.length>0?h.bitfinexWsBaseUrl:"wss://api-pub.bitfinex.com/ws/2",this.bitfinexSymbolOverrides=h.bitfinexSymbolOverrides||{};let f={baseUrl:this.baseUrl,logger:this.logger,fallbackPollIntervalMs:this.fallbackPollIntervalMs,staleTickerTimeoutMs:this.staleTickerTimeoutMs};this.genericProvider=h.genericProvider instanceof c?h.genericProvider:new c(f),this.register(this.genericProvider),this.register(new s({baseUrl:this.baseUrl,logger:this.logger,fallbackPollIntervalMs:this.fallbackPollIntervalMs,staleTickerTimeoutMs:this.staleTickerTimeoutMs,genericFallback:this.genericProvider,binanceRestBaseUrl:this.binanceRestBaseUrl,binanceWsBaseUrl:this.binanceWsBaseUrl,binanceSymbolOverrides:this.binanceSymbolOverrides})),this.register(new g({baseUrl:this.baseUrl,logger:this.logger,fallbackPollIntervalMs:this.fallbackPollIntervalMs,staleTickerTimeoutMs:this.staleTickerTimeoutMs,genericFallback:this.genericProvider,bitfinexRestBaseUrl:this.bitfinexRestBaseUrl,bitfinexWsBaseUrl:this.bitfinexWsBaseUrl,bitfinexSymbolOverrides:this.bitfinexSymbolOverrides})),this.register(new S({baseUrl:this.baseUrl,logger:this.logger,fallbackPollIntervalMs:this.fallbackPollIntervalMs,staleTickerTimeoutMs:this.staleTickerTimeoutMs,genericFallback:this.genericProvider}))}register(y){if(!y||typeof y.getId!="function")return;let h=y.getId();h&&(this.providers[h.toUpperCase()]=y)}getProvider(y){let h=(y||"").toUpperCase();return this.providers[h]||this.genericProvider}getGenericProvider(){return this.genericProvider}ensureAllConnections(){let y=Object.keys(this.providers);for(let h=0;h<y.length;h++){let f=this.providers[y[h]];f&&typeof f.ensureConnection=="function"&&f.ensureConnection()}}}return{ProviderRegistry:E}})});var qt=ue((En,Rt)=>{"use strict";(function(r,t){let a=t();typeof Rt=="object"&&Rt.exports&&(Rt.exports=a),r&&typeof r=="object"&&(r.CryptoTickerFormatters=a)})(typeof self!="undefined"?self:En,function(){let r=["auto","full","compact","plain"],t=[{value:1e12,suffix:"T"},{value:1e9,suffix:"B"},{value:1e6,suffix:"M"},{value:1e3,suffix:"K"}],a=",",u=".";function c(S){let E=S&&typeof S.thousandsSeparator=="string"?S.thousandsSeparator:null,R=S&&typeof S.decimalSeparator=="string"?S.decimalSeparator:null,y=E&&E.length>0?E:a,h=R&&R.length>0?R:u;return{thousandsSeparator:y,decimalSeparator:h}}function s(S,E,R,y,h){let f=y||"auto",p=typeof E=="number"?E:parseInt(String(E!=null?E:""),10);(Number.isNaN(p)||p<0)&&(p=2);let x=S*(typeof R=="number"?R:1),l=Math.abs(x),d=x<0?"-":"",C=c(h),I=C.thousandsSeparator,v=C.decimalSeparator;function N(O,G){let X=Math.pow(10,G);return Math.round(O*X)/X}function T(O,G){let X=O.toFixed(z),V=X,ee="",W=X.indexOf(".");W>=0&&(V=X.slice(0,W),ee=X.slice(W+1));let H=V;return G&&I&&(H=V.replace(/\B(?=(\d{3})+(?!\d))/g,I)),ee&&z>0?H+v+ee:z>0?H+v+"0".repeat(z):H}let B="",z=Math.max(0,p);switch(f){case"full":case"plain":{let O=N(l,z);B=T(O,f==="full");break}case"auto":case"compact":default:{let O="",G=l;for(let V of t){let ee=V.suffix==="K"?V.value*100:V.value;if(l>=ee){O=V.suffix,G=l/V.value;break}}let X=N(G,z);B=T(X,!O)+O;break}}return d+B}function g(S,E,R){return R-E===0?.5:(S-E)/(R-E)}return{getRoundedValue:s,normalizeValue:g}})});var Pn=ue((Mt,xn)=>{(function(r,t){typeof Mt=="object"&&typeof xn!="undefined"?t(Mt):typeof define=="function"&&define.amd?define(["exports"],t):(r=r||self,t(r.exprEval={}))})(Mt,function(r){"use strict";var t="INUMBER",a="IOP1",u="IOP2",c="IOP3",s="IVAR",g="IVARNAME",S="IFUNCALL",E="IFUNDEF",R="IEXPR",y="IEXPREVAL",h="IMEMBER",f="IENDSTATEMENT",k="IARRAY";function p(n,i){this.type=n,this.value=i!=null?i:0}p.prototype.toString=function(){switch(this.type){case t:case a:case u:case c:case s:case g:case f:return this.value;case S:return"CALL "+this.value;case E:return"DEF "+this.value;case k:return"ARRAY "+this.value;case h:return"."+this.value;default:return"Invalid Instruction"}};function x(n){return new p(a,n)}function l(n){return new p(u,n)}function d(n){return new p(c,n)}function C(n,i,m,P,U){for(var j=[],_=[],J,re,le,ce,ge=0;ge<n.length;ge++){var Y=n[ge],pe=Y.type;if(pe===t||pe===g)Array.isArray(Y.value)?j.push.apply(j,C(Y.value.map(function(mt){return new p(t,mt)}).concat(new p(k,Y.value.length)),i,m,P,U)):j.push(Y);else if(pe===s&&U.hasOwnProperty(Y.value))Y=new p(t,U[Y.value]),j.push(Y);else if(pe===u&&j.length>1)re=j.pop(),J=j.pop(),ce=m[Y.value],Y=new p(t,ce(J.value,re.value)),j.push(Y);else if(pe===c&&j.length>2)le=j.pop(),re=j.pop(),J=j.pop(),Y.value==="?"?j.push(J.value?re.value:le.value):(ce=P[Y.value],Y=new p(t,ce(J.value,re.value,le.value)),j.push(Y));else if(pe===a&&j.length>0)J=j.pop(),ce=i[Y.value],Y=new p(t,ce(J.value)),j.push(Y);else if(pe===R){for(;j.length>0;)_.push(j.shift());_.push(new p(R,C(Y.value,i,m,P,U)))}else if(pe===h&&j.length>0)J=j.pop(),j.push(new p(t,J.value[Y.value]));else{for(;j.length>0;)_.push(j.shift());_.push(Y)}}for(;j.length>0;)_.push(j.shift());return _}function I(n,i,m){for(var P=[],U=0;U<n.length;U++){var j=n[U],_=j.type;if(_===s&&j.value===i)for(var J=0;J<m.tokens.length;J++){var re=m.tokens[J],le;re.type===a?le=x(re.value):re.type===u?le=l(re.value):re.type===c?le=d(re.value):le=new p(re.type,re.value),P.push(le)}else _===R?P.push(new p(R,I(j.value,i,m))):P.push(j)}return P}function v(n,i,m){var P=[],U,j,_,J,re,le;if(T(n))return B(n,m);for(var ce=n.length,ge=0;ge<ce;ge++){var Y=n[ge],pe=Y.type;if(pe===t||pe===g)P.push(Y.value);else if(pe===u)j=P.pop(),U=P.pop(),Y.value==="and"?P.push(U?!!v(j,i,m):!1):Y.value==="or"?P.push(U?!0:!!v(j,i,m)):Y.value==="="?(J=i.binaryOps[Y.value],P.push(J(U,v(j,i,m),m))):(J=i.binaryOps[Y.value],P.push(J(B(U,m),B(j,m))));else if(pe===c)_=P.pop(),j=P.pop(),U=P.pop(),Y.value==="?"?P.push(v(U?j:_,i,m)):(J=i.ternaryOps[Y.value],P.push(J(B(U,m),B(j,m),B(_,m))));else if(pe===s)if(Y.value in i.functions)P.push(i.functions[Y.value]);else if(Y.value in i.unaryOps&&i.parser.isOperatorEnabled(Y.value))P.push(i.unaryOps[Y.value]);else{var mt=m[Y.value];if(mt!==void 0)P.push(mt);else throw new Error("undefined variable: "+Y.value)}else if(pe===a)U=P.pop(),J=i.unaryOps[Y.value],P.push(J(B(U,m)));else if(pe===S){for(le=Y.value,re=[];le-- >0;)re.unshift(B(P.pop(),m));if(J=P.pop(),J.apply&&J.call)P.push(J.apply(void 0,re));else throw new Error(J+" is not a function")}else if(pe===E)P.push(function(){for(var cr=P.pop(),_t=[],lr=Y.value;lr-- >0;)_t.unshift(P.pop());var sn=P.pop(),$t=function(){for(var on=Object.assign({},m),vt=0,ur=_t.length;vt<ur;vt++)on[_t[vt]]=arguments[vt];return v(cr,i,on)};return Object.defineProperty($t,"name",{value:sn,writable:!1}),m[sn]=$t,$t}());else if(pe===R)P.push(N(Y,i));else if(pe===y)P.push(Y);else if(pe===h)U=P.pop(),P.push(U[Y.value]);else if(pe===f)P.pop();else if(pe===k){for(le=Y.value,re=[];le-- >0;)re.unshift(P.pop());P.push(re)}else throw new Error("invalid Expression")}if(P.length>1)throw new Error("invalid Expression (parity)");return P[0]===0?0:B(P[0],m)}function N(n,i,m){return T(n)?n:{type:y,value:function(P){return v(n.value,i,P)}}}function T(n){return n&&n.type===y}function B(n,i){return T(n)?n.value(i):n}function z(n,i){for(var m=[],P,U,j,_,J,re,le=0;le<n.length;le++){var ce=n[le],ge=ce.type;if(ge===t)typeof ce.value=="number"&&ce.value<0?m.push("("+ce.value+")"):Array.isArray(ce.value)?m.push("["+ce.value.map(O).join(", ")+"]"):m.push(O(ce.value));else if(ge===u)U=m.pop(),P=m.pop(),_=ce.value,i?_==="^"?m.push("Math.pow("+P+", "+U+")"):_==="and"?m.push("(!!"+P+" && !!"+U+")"):_==="or"?m.push("(!!"+P+" || !!"+U+")"):_==="||"?m.push("(function(a,b){ return Array.isArray(a) && Array.isArray(b) ? a.concat(b) : String(a) + String(b); }(("+P+"),("+U+")))"):_==="=="?m.push("("+P+" === "+U+")"):_==="!="?m.push("("+P+" !== "+U+")"):_==="["?m.push(P+"[("+U+") | 0]"):m.push("("+P+" "+_+" "+U+")"):_==="["?m.push(P+"["+U+"]"):m.push("("+P+" "+_+" "+U+")");else if(ge===c)if(j=m.pop(),U=m.pop(),P=m.pop(),_=ce.value,_==="?")m.push("("+P+" ? "+U+" : "+j+")");else throw new Error("invalid Expression");else if(ge===s||ge===g)m.push(ce.value);else if(ge===a)P=m.pop(),_=ce.value,_==="-"||_==="+"?m.push("("+_+P+")"):i?_==="not"?m.push("(!"+P+")"):_==="!"?m.push("fac("+P+")"):m.push(_+"("+P+")"):_==="!"?m.push("("+P+"!)"):m.push("("+_+" "+P+")");else if(ge===S){for(re=ce.value,J=[];re-- >0;)J.unshift(m.pop());_=m.pop(),m.push(_+"("+J.join(", ")+")")}else if(ge===E){for(U=m.pop(),re=ce.value,J=[];re-- >0;)J.unshift(m.pop());P=m.pop(),i?m.push("("+P+" = function("+J.join(", ")+") { return "+U+" })"):m.push("("+P+"("+J.join(", ")+") = "+U+")")}else if(ge===h)P=m.pop(),m.push(P+"."+ce.value);else if(ge===k){for(re=ce.value,J=[];re-- >0;)J.unshift(m.pop());m.push("["+J.join(", ")+"]")}else if(ge===R)m.push("("+z(ce.value,i)+")");else if(ge!==f)throw new Error("invalid Expression")}return m.length>1&&(i?m=[m.join(",")]:m=[m.join(";")]),String(m[0])}function O(n){return typeof n=="string"?JSON.stringify(n).replace(/\u2028/g,"\\u2028").replace(/\u2029/g,"\\u2029"):n}function G(n,i){for(var m=0;m<n.length;m++)if(n[m]===i)return!0;return!1}function X(n,i,m){m=m||{};for(var P=!!m.withMembers,U=null,j=0;j<n.length;j++){var _=n[j];_.type===s||_.type===g?!P&&!G(i,_.value)?i.push(_.value):(U!==null&&(G(i,U)||i.push(U)),U=_.value):_.type===h&&P&&U!==null?U+="."+_.value:_.type===R?X(_.value,i,m):U!==null&&(G(i,U)||i.push(U),U=null)}U!==null&&!G(i,U)&&i.push(U)}function V(n,i){this.tokens=n,this.parser=i,this.unaryOps=i.unaryOps,this.binaryOps=i.binaryOps,this.ternaryOps=i.ternaryOps,this.functions=i.functions}V.prototype.simplify=function(n){return n=n||{},new V(C(this.tokens,this.unaryOps,this.binaryOps,this.ternaryOps,n),this.parser)},V.prototype.substitute=function(n,i){return i instanceof V||(i=this.parser.parse(String(i))),new V(I(this.tokens,n,i),this.parser)},V.prototype.evaluate=function(n){return n=n||{},v(this.tokens,this,n)},V.prototype.toString=function(){return z(this.tokens,!1)},V.prototype.symbols=function(n){n=n||{};var i=[];return X(this.tokens,i,n),i},V.prototype.variables=function(n){n=n||{};var i=[];X(this.tokens,i,n);var m=this.functions;return i.filter(function(P){return!(P in m)})},V.prototype.toJSFunction=function(n,i){var m=this,P=new Function(n,"with(this.functions) with (this.ternaryOps) with (this.binaryOps) with (this.unaryOps) { return "+z(this.simplify(i).tokens,!0)+"; }");return function(){return P.apply(m,arguments)}};var ee="TEOF",W="TOP",H="TNUMBER",he="TSTRING",F="TPAREN",q="TBRACKET",ve="TCOMMA",Se="TNAME",ye="TSEMICOLON";function fe(n,i,m){this.type=n,this.value=i,this.index=m}fe.prototype.toString=function(){return this.type+": "+this.value};function te(n,i){this.pos=0,this.current=null,this.unaryOps=n.unaryOps,this.binaryOps=n.binaryOps,this.ternaryOps=n.ternaryOps,this.consts=n.consts,this.expression=i,this.savedPosition=0,this.savedCurrent=null,this.options=n.options,this.parser=n}te.prototype.newToken=function(n,i,m){return new fe(n,i,m!=null?m:this.pos)},te.prototype.save=function(){this.savedPosition=this.pos,this.savedCurrent=this.current},te.prototype.restore=function(){this.pos=this.savedPosition,this.current=this.savedCurrent},te.prototype.next=function(){if(this.pos>=this.expression.length)return this.newToken(ee,"EOF");if(this.isWhitespace()||this.isComment())return this.next();if(this.isRadixInteger()||this.isNumber()||this.isOperator()||this.isString()||this.isParen()||this.isBracket()||this.isComma()||this.isSemicolon()||this.isNamedOp()||this.isConst()||this.isName())return this.current;this.parseError('Unknown character "'+this.expression.charAt(this.pos)+'"')},te.prototype.isString=function(){var n=!1,i=this.pos,m=this.expression.charAt(i);if(m==="'"||m==='"')for(var P=this.expression.indexOf(m,i+1);P>=0&&this.pos<this.expression.length;){if(this.pos=P+1,this.expression.charAt(P-1)!=="\\"){var U=this.expression.substring(i+1,P);this.current=this.newToken(he,this.unescape(U),i),n=!0;break}P=this.expression.indexOf(m,P+1)}return n},te.prototype.isParen=function(){var n=this.expression.charAt(this.pos);return n==="("||n===")"?(this.current=this.newToken(F,n),this.pos++,!0):!1},te.prototype.isBracket=function(){var n=this.expression.charAt(this.pos);return(n==="["||n==="]")&&this.isOperatorEnabled("[")?(this.current=this.newToken(q,n),this.pos++,!0):!1},te.prototype.isComma=function(){var n=this.expression.charAt(this.pos);return n===","?(this.current=this.newToken(ve,","),this.pos++,!0):!1},te.prototype.isSemicolon=function(){var n=this.expression.charAt(this.pos);return n===";"?(this.current=this.newToken(ye,";"),this.pos++,!0):!1},te.prototype.isConst=function(){for(var n=this.pos,i=n;i<this.expression.length;i++){var m=this.expression.charAt(i);if(m.toUpperCase()===m.toLowerCase()&&(i===this.pos||m!=="_"&&m!=="."&&(m<"0"||m>"9")))break}if(i>n){var P=this.expression.substring(n,i);if(P in this.consts)return this.current=this.newToken(H,this.consts[P]),this.pos+=P.length,!0}return!1},te.prototype.isNamedOp=function(){for(var n=this.pos,i=n;i<this.expression.length;i++){var m=this.expression.charAt(i);if(m.toUpperCase()===m.toLowerCase()&&(i===this.pos||m!=="_"&&(m<"0"||m>"9")))break}if(i>n){var P=this.expression.substring(n,i);if(this.isOperatorEnabled(P)&&(P in this.binaryOps||P in this.unaryOps||P in this.ternaryOps))return this.current=this.newToken(W,P),this.pos+=P.length,!0}return!1},te.prototype.isName=function(){for(var n=this.pos,i=n,m=!1;i<this.expression.length;i++){var P=this.expression.charAt(i);if(P.toUpperCase()===P.toLowerCase()){if(i===this.pos&&(P==="$"||P==="_")){P==="_"&&(m=!0);continue}else if(i===this.pos||!m||P!=="_"&&(P<"0"||P>"9"))break}else m=!0}if(m){var U=this.expression.substring(n,i);return this.current=this.newToken(Se,U),this.pos+=U.length,!0}return!1},te.prototype.isWhitespace=function(){for(var n=!1,i=this.expression.charAt(this.pos);(i===" "||i==="	"||i===`
`||i==="\r")&&(n=!0,this.pos++,!(this.pos>=this.expression.length));)i=this.expression.charAt(this.pos);return n};var Ee=/^[0-9a-f]{4}$/i;te.prototype.unescape=function(n){var i=n.indexOf("\\");if(i<0)return n;for(var m=n.substring(0,i);i>=0;){var P=n.charAt(++i);switch(P){case"'":m+="'";break;case'"':m+='"';break;case"\\":m+="\\";break;case"/":m+="/";break;case"b":m+="\b";break;case"f":m+="\f";break;case"n":m+=`
`;break;case"r":m+="\r";break;case"t":m+="	";break;case"u":var U=n.substring(i+1,i+5);Ee.test(U)||this.parseError("Illegal escape sequence: \\u"+U),m+=String.fromCharCode(parseInt(U,16)),i+=4;break;default:throw this.parseError('Illegal escape sequence: "\\'+P+'"')}++i;var j=n.indexOf("\\",i);m+=n.substring(i,j<0?n.length:j),i=j}return m},te.prototype.isComment=function(){var n=this.expression.charAt(this.pos);return n==="/"&&this.expression.charAt(this.pos+1)==="*"?(this.pos=this.expression.indexOf("*/",this.pos)+2,this.pos===1&&(this.pos=this.expression.length),!0):!1},te.prototype.isRadixInteger=function(){var n=this.pos;if(n>=this.expression.length-2||this.expression.charAt(n)!=="0")return!1;++n;var i,m;if(this.expression.charAt(n)==="x")i=16,m=/^[0-9a-f]$/i,++n;else if(this.expression.charAt(n)==="b")i=2,m=/^[01]$/i,++n;else return!1;for(var P=!1,U=n;n<this.expression.length;){var j=this.expression.charAt(n);if(m.test(j))n++,P=!0;else break}return P&&(this.current=this.newToken(H,parseInt(this.expression.substring(U,n),i)),this.pos=n),P},te.prototype.isNumber=function(){for(var n=!1,i=this.pos,m=i,P=i,U=!1,j=!1,_;i<this.expression.length&&(_=this.expression.charAt(i),_>="0"&&_<="9"||!U&&_===".");)_==="."?U=!0:j=!0,i++,n=j;if(n&&(P=i),_==="e"||_==="E"){i++;for(var J=!0,re=!1;i<this.expression.length;){if(_=this.expression.charAt(i),J&&(_==="+"||_==="-"))J=!1;else if(_>="0"&&_<="9")re=!0,J=!1;else break;i++}re||(i=P)}return n?(this.current=this.newToken(H,parseFloat(this.expression.substring(m,i))),this.pos=i):this.pos=P,n},te.prototype.isOperator=function(){var n=this.pos,i=this.expression.charAt(this.pos);if(i==="+"||i==="-"||i==="*"||i==="/"||i==="%"||i==="^"||i==="?"||i===":"||i===".")this.current=this.newToken(W,i);else if(i==="\u2219"||i==="\u2022")this.current=this.newToken(W,"*");else if(i===">")this.expression.charAt(this.pos+1)==="="?(this.current=this.newToken(W,">="),this.pos++):this.current=this.newToken(W,">");else if(i==="<")this.expression.charAt(this.pos+1)==="="?(this.current=this.newToken(W,"<="),this.pos++):this.current=this.newToken(W,"<");else if(i==="|")if(this.expression.charAt(this.pos+1)==="|")this.current=this.newToken(W,"||"),this.pos++;else return!1;else if(i==="=")this.expression.charAt(this.pos+1)==="="?(this.current=this.newToken(W,"=="),this.pos++):this.current=this.newToken(W,i);else if(i==="!")this.expression.charAt(this.pos+1)==="="?(this.current=this.newToken(W,"!="),this.pos++):this.current=this.newToken(W,i);else return!1;return this.pos++,this.isOperatorEnabled(this.current.value)?!0:(this.pos=n,!1)},te.prototype.isOperatorEnabled=function(n){return this.parser.isOperatorEnabled(n)},te.prototype.getCoordinates=function(){var n=0,i,m=-1;do n++,i=this.pos-m,m=this.expression.indexOf(`
`,m+1);while(m>=0&&m<this.pos);return{line:n,column:i}},te.prototype.parseError=function(n){var i=this.getCoordinates();throw new Error("parse error ["+i.line+":"+i.column+"]: "+n)};function Q(n,i,m){this.parser=n,this.tokens=i,this.current=null,this.nextToken=null,this.next(),this.savedCurrent=null,this.savedNextToken=null,this.allowMemberAccess=m.allowMemberAccess!==!1}Q.prototype.next=function(){return this.current=this.nextToken,this.nextToken=this.tokens.next()},Q.prototype.tokenMatches=function(n,i){return typeof i=="undefined"?!0:Array.isArray(i)?G(i,n.value):typeof i=="function"?i(n):n.value===i},Q.prototype.save=function(){this.savedCurrent=this.current,this.savedNextToken=this.nextToken,this.tokens.save()},Q.prototype.restore=function(){this.tokens.restore(),this.current=this.savedCurrent,this.nextToken=this.savedNextToken},Q.prototype.accept=function(n,i){return this.nextToken.type===n&&this.tokenMatches(this.nextToken,i)?(this.next(),!0):!1},Q.prototype.expect=function(n,i){if(!this.accept(n,i)){var m=this.tokens.getCoordinates();throw new Error("parse error ["+m.line+":"+m.column+"]: Expected "+(i||n))}},Q.prototype.parseAtom=function(n){var i=this.tokens.unaryOps;function m(U){return U.value in i}if(this.accept(Se)||this.accept(W,m))n.push(new p(s,this.current.value));else if(this.accept(H))n.push(new p(t,this.current.value));else if(this.accept(he))n.push(new p(t,this.current.value));else if(this.accept(F,"("))this.parseExpression(n),this.expect(F,")");else if(this.accept(q,"["))if(this.accept(q,"]"))n.push(new p(k,0));else{var P=this.parseArrayList(n);n.push(new p(k,P))}else throw new Error("unexpected "+this.nextToken)},Q.prototype.parseExpression=function(n){var i=[];this.parseUntilEndStatement(n,i)||(this.parseVariableAssignmentExpression(i),!this.parseUntilEndStatement(n,i)&&this.pushExpression(n,i))},Q.prototype.pushExpression=function(n,i){for(var m=0,P=i.length;m<P;m++)n.push(i[m])},Q.prototype.parseUntilEndStatement=function(n,i){return this.accept(ye)?(this.nextToken&&this.nextToken.type!==ee&&!(this.nextToken.type===F&&this.nextToken.value===")")&&i.push(new p(f)),this.nextToken.type!==ee&&this.parseExpression(i),n.push(new p(R,i)),!0):!1},Q.prototype.parseArrayList=function(n){for(var i=0;!this.accept(q,"]");)for(this.parseExpression(n),++i;this.accept(ve);)this.parseExpression(n),++i;return i},Q.prototype.parseVariableAssignmentExpression=function(n){for(this.parseConditionalExpression(n);this.accept(W,"=");){var i=n.pop(),m=[],P=n.length-1;if(i.type===S){if(!this.tokens.isOperatorEnabled("()="))throw new Error("function definition is not permitted");for(var U=0,j=i.value+1;U<j;U++){var _=P-U;n[_].type===s&&(n[_]=new p(g,n[_].value))}this.parseVariableAssignmentExpression(m),n.push(new p(R,m)),n.push(new p(E,i.value));continue}if(i.type!==s&&i.type!==h)throw new Error("expected variable for assignment");this.parseVariableAssignmentExpression(m),n.push(new p(g,i.value)),n.push(new p(R,m)),n.push(l("="))}},Q.prototype.parseConditionalExpression=function(n){for(this.parseOrExpression(n);this.accept(W,"?");){var i=[],m=[];this.parseConditionalExpression(i),this.expect(W,":"),this.parseConditionalExpression(m),n.push(new p(R,i)),n.push(new p(R,m)),n.push(d("?"))}},Q.prototype.parseOrExpression=function(n){for(this.parseAndExpression(n);this.accept(W,"or");){var i=[];this.parseAndExpression(i),n.push(new p(R,i)),n.push(l("or"))}},Q.prototype.parseAndExpression=function(n){for(this.parseComparison(n);this.accept(W,"and");){var i=[];this.parseComparison(i),n.push(new p(R,i)),n.push(l("and"))}};var xe=["==","!=","<","<=",">=",">","in"];Q.prototype.parseComparison=function(n){for(this.parseAddSub(n);this.accept(W,xe);){var i=this.current;this.parseAddSub(n),n.push(l(i.value))}};var Z=["+","-","||"];Q.prototype.parseAddSub=function(n){for(this.parseTerm(n);this.accept(W,Z);){var i=this.current;this.parseTerm(n),n.push(l(i.value))}};var ne=["*","/","%"];Q.prototype.parseTerm=function(n){for(this.parseFactor(n);this.accept(W,ne);){var i=this.current;this.parseFactor(n),n.push(l(i.value))}},Q.prototype.parseFactor=function(n){var i=this.tokens.unaryOps;function m(U){return U.value in i}if(this.save(),this.accept(W,m)){if(this.current.value!=="-"&&this.current.value!=="+"){if(this.nextToken.type===F&&this.nextToken.value==="("){this.restore(),this.parseExponential(n);return}else if(this.nextToken.type===ye||this.nextToken.type===ve||this.nextToken.type===ee||this.nextToken.type===F&&this.nextToken.value===")"){this.restore(),this.parseAtom(n);return}}var P=this.current;this.parseFactor(n),n.push(x(P.value))}else this.parseExponential(n)},Q.prototype.parseExponential=function(n){for(this.parsePostfixExpression(n);this.accept(W,"^");)this.parseFactor(n),n.push(l("^"))},Q.prototype.parsePostfixExpression=function(n){for(this.parseFunctionCall(n);this.accept(W,"!");)n.push(x("!"))},Q.prototype.parseFunctionCall=function(n){var i=this.tokens.unaryOps;function m(j){return j.value in i}if(this.accept(W,m)){var P=this.current;this.parseAtom(n),n.push(x(P.value))}else for(this.parseMemberExpression(n);this.accept(F,"(");)if(this.accept(F,")"))n.push(new p(S,0));else{var U=this.parseArgumentList(n);n.push(new p(S,U))}},Q.prototype.parseArgumentList=function(n){for(var i=0;!this.accept(F,")");)for(this.parseExpression(n),++i;this.accept(ve);)this.parseExpression(n),++i;return i},Q.prototype.parseMemberExpression=function(n){for(this.parseAtom(n);this.accept(W,".")||this.accept(q,"[");){var i=this.current;if(i.value==="."){if(!this.allowMemberAccess)throw new Error('unexpected ".", member access is not permitted');this.expect(Se),n.push(new p(h,this.current.value))}else if(i.value==="["){if(!this.tokens.isOperatorEnabled("["))throw new Error('unexpected "[]", arrays are disabled');this.parseExpression(n),this.expect(q,"]"),n.push(l("["))}else throw new Error("unexpected symbol: "+i.value)}};function Ne(n,i){return Number(n)+Number(i)}function Fe(n,i){return n-i}function Be(n,i){return n*i}function Pe(n,i){return n/i}function Ue(n,i){return n%i}function Re(n,i){return Array.isArray(n)&&Array.isArray(i)?n.concat(i):""+n+i}function we(n,i){return n===i}function de(n,i){return n!==i}function pt(n,i){return n>i}function Le(n,i){return n<i}function A(n,i){return n>=i}function e(n,i){return n<=i}function o(n,i){return!!(n&&i)}function b(n,i){return!!(n||i)}function w(n,i){return G(i,n)}function M(n){return(Math.exp(n)-Math.exp(-n))/2}function D(n){return(Math.exp(n)+Math.exp(-n))/2}function $(n){return n===1/0?1:n===-1/0?-1:(Math.exp(n)-Math.exp(-n))/(Math.exp(n)+Math.exp(-n))}function L(n){return n===-1/0?n:Math.log(n+Math.sqrt(n*n+1))}function K(n){return Math.log(n+Math.sqrt(n*n-1))}function se(n){return Math.log((1+n)/(1-n))/2}function ke(n){return Math.log(n)*Math.LOG10E}function _e(n){return-n}function en(n){return!n}function yt(n){return n<0?Math.ceil(n):Math.floor(n)}function oe(n){return Math.random()*(n||1)}function ie(n){return He(n+1)}function ae(n){return isFinite(n)&&n===Math.round(n)}var Te=4.7421875,$e=[.9999999999999971,57.15623566586292,-59.59796035547549,14.136097974741746,-.4919138160976202,3399464998481189e-20,4652362892704858e-20,-9837447530487956e-20,.0001580887032249125,-.00021026444172410488,.00021743961811521265,-.0001643181065367639,8441822398385275e-20,-26190838401581408e-21,36899182659531625e-22];function He(n){var i,m;if(ae(n)){if(n<=0)return isFinite(n)?1/0:NaN;if(n>171)return 1/0;for(var P=n-2,U=n-1;P>1;)U*=P,P--;return U===0&&(U=1),U}if(n<.5)return Math.PI/(Math.sin(Math.PI*n)*He(1-n));if(n>=171.35)return 1/0;if(n>85){var j=n*n,_=j*n,J=_*n,re=J*n;return Math.sqrt(2*Math.PI/n)*Math.pow(n/Math.E,n)*(1+1/(12*n)+1/(288*j)-139/(51840*_)-571/(2488320*J)+163879/(209018880*re)+5246819/(75246796800*re*n))}--n,m=$e[0];for(var le=1;le<$e.length;++le)m+=$e[le]/(n+le);return i=n+Te+.5,Math.sqrt(2*Math.PI)*Math.pow(i,n+.5)*Math.exp(-i)*m}function qe(n){return Array.isArray(n)?n.length:String(n).length}function De(){for(var n=0,i=0,m=0;m<arguments.length;m++){var P=Math.abs(arguments[m]),U;i<P?(U=i/P,n=n*U*U+1,i=P):P>0?(U=P/i,n+=U*U):n+=P}return i===1/0?1/0:i*Math.sqrt(n)}function Ve(n,i,m){return n?i:m}function Lt(n,i){return typeof i=="undefined"||+i==0?Math.round(n):(n=+n,i=-+i,isNaN(n)||!(typeof i=="number"&&i%1===0)?NaN:(n=n.toString().split("e"),n=Math.round(+(n[0]+"e"+(n[1]?+n[1]-i:-i))),n=n.toString().split("e"),+(n[0]+"e"+(n[1]?+n[1]+i:i))))}function Ge(n,i,m){return m&&(m[n]=i),i}function Gn(n,i){return n[i|0]}function Kn(n){return arguments.length===1&&Array.isArray(n)?Math.max.apply(Math,n):Math.max.apply(Math,arguments)}function Yn(n){return arguments.length===1&&Array.isArray(n)?Math.min.apply(Math,n):Math.min.apply(Math,arguments)}function Jn(n,i){if(typeof n!="function")throw new Error("First argument to map is not a function");if(!Array.isArray(i))throw new Error("Second argument to map is not an array");return i.map(function(m,P){return n(m,P)})}function Xn(n,i,m){if(typeof n!="function")throw new Error("First argument to fold is not a function");if(!Array.isArray(m))throw new Error("Second argument to fold is not an array");return m.reduce(function(P,U,j){return n(P,U,j)},i)}function Qn(n,i){if(typeof n!="function")throw new Error("First argument to filter is not a function");if(!Array.isArray(i))throw new Error("Second argument to filter is not an array");return i.filter(function(m,P){return n(m,P)})}function Zn(n,i){if(!(Array.isArray(i)||typeof i=="string"))throw new Error("Second argument to indexOf is not a string or array");return i.indexOf(n)}function er(n,i){if(!Array.isArray(i))throw new Error("Second argument to join is not an array");return i.join(n)}function tr(n){return(n>0)-(n<0)||+n}var tn=1/3;function nr(n){return n<0?-Math.pow(-n,tn):Math.pow(n,tn)}function rr(n){return Math.exp(n)-1}function ir(n){return Math.log(1+n)}function sr(n){return Math.log(n)/Math.LN2}function We(n){this.options=n||{},this.unaryOps={sin:Math.sin,cos:Math.cos,tan:Math.tan,asin:Math.asin,acos:Math.acos,atan:Math.atan,sinh:Math.sinh||M,cosh:Math.cosh||D,tanh:Math.tanh||$,asinh:Math.asinh||L,acosh:Math.acosh||K,atanh:Math.atanh||se,sqrt:Math.sqrt,cbrt:Math.cbrt||nr,log:Math.log,log2:Math.log2||sr,ln:Math.log,lg:Math.log10||ke,log10:Math.log10||ke,expm1:Math.expm1||rr,log1p:Math.log1p||ir,abs:Math.abs,ceil:Math.ceil,floor:Math.floor,round:Math.round,trunc:Math.trunc||yt,"-":_e,"+":Number,exp:Math.exp,not:en,length:qe,"!":ie,sign:Math.sign||tr},this.binaryOps={"+":Ne,"-":Fe,"*":Be,"/":Pe,"%":Ue,"^":Math.pow,"||":Re,"==":we,"!=":de,">":pt,"<":Le,">=":A,"<=":e,and:o,or:b,in:w,"=":Ge,"[":Gn},this.ternaryOps={"?":Ve},this.functions={random:oe,fac:ie,min:Yn,max:Kn,hypot:Math.hypot||De,pyt:Math.hypot||De,pow:Math.pow,atan2:Math.atan2,if:Ve,gamma:He,roundTo:Lt,map:Jn,fold:Xn,filter:Qn,indexOf:Zn,join:er},this.consts={E:Math.E,PI:Math.PI,true:!0,false:!1}}We.prototype.parse=function(n){var i=[],m=new Q(this,new te(this,n),{allowMemberAccess:this.options.allowMemberAccess});return m.parseExpression(i),m.expect(ee,"EOF"),new V(i,this)},We.prototype.evaluate=function(n,i){return this.parse(n).evaluate(i)};var nn=new We;We.parse=function(n){return nn.parse(n)},We.evaluate=function(n,i){return nn.parse(n).evaluate(i)};var rn={"+":"add","-":"subtract","*":"multiply","/":"divide","%":"remainder","^":"power","!":"factorial","<":"comparison",">":"comparison","<=":"comparison",">=":"comparison","==":"comparison","!=":"comparison","||":"concatenate",and:"logical",or:"logical",not:"logical","?":"conditional",":":"conditional","=":"assignment","[":"array","()=":"fndef"};function or(n){return rn.hasOwnProperty(n)?rn[n]:n}We.prototype.isOperatorEnabled=function(n){var i=or(n),m=this.options.operators||{};return!(i in m)||!!m[i]};var ar={Parser:We,Expression:V};r.Expression=V,r.Parser=We,r.default=ar,Object.defineProperty(r,"__esModule",{value:!0})})});var Dt=ue((In,It)=>{"use strict";var At=class{constructor(t,a){let u=t||{},c=Array.isArray(u.allowedVariables)&&u.allowedVariables.length>0?u.allowedVariables.slice():Vt.slice();this.allowedVariables=c;let s=a||Mn();this.parser=new s({operators:{add:!0,subtract:!0,multiply:!0,divide:!0,remainder:!0,power:!1,factorial:!1,comparison:!0,logical:!0,conditional:!0,concatenate:!1,assignment:!1,array:!1,fndef:!1},allowMemberAccess:!1}),this.cache={}}validate(t){let a;try{a=this.getCacheEntry(t)}catch(u){return{ok:!1,error:u instanceof Error?u.message:"Invalid expression"}}return a?a.disallowedVariables.length>0?{ok:!1,error:"Unknown variables: "+a.disallowedVariables.join(", ")+". Allowed variables: "+this.allowedVariables.join(", ")}:{ok:!0,variables:a.variables.slice()}:{ok:!1,error:"Expression cannot be empty"}}evaluate(t,a){let u=this.getCacheEntry(t);if(!u)throw new Error("Expression cannot be empty");if(u.disallowedVariables.length>0)throw new Error("Unknown variables: "+u.disallowedVariables.join(", ")+". Allowed variables: "+this.allowedVariables.join(", "));let c={},s=a||{};for(let g of this.allowedVariables){let S=Object.prototype.hasOwnProperty.call(s,g)?s[g]:void 0;if(Vt.indexOf(g)!==-1){c[g]=ze(S);continue}typeof S=="number"?c[g]=Number.isFinite(S)?S:0:typeof S=="boolean"||typeof S=="string"?c[g]=S:S==null?c[g]=0:c[g]=S}return u.compiled.evaluate(c)}clearCache(){this.cache={}}getCacheEntry(t){let a=this.normalizeExpression(t);if(!a)return null;if(this.cache[a])return this.cache[a];let u;try{u=this.parser.parse(a)}catch(S){throw this.wrapParseError(S)}let c=u.variables({withMembers:!1})||[],s=c.filter(S=>this.allowedVariables.indexOf(S)===-1),g={expression:a,compiled:u,variables:c.slice(),disallowedVariables:s.slice()};return this.cache[a]=g,g}normalizeExpression(t){return typeof t!="string"?"":t.trim()}wrapParseError(t){let a=t&&typeof t=="object"&&t instanceof Error&&t.message?wr(t.message):"Invalid expression",u=new Error(a);return t&&typeof t=="object"&&(u.originalError=t),u}},Vt=["value","high","low","changeDaily","changeDailyPercent","volume"];function mr(r){return r?r.slice():[]}function ze(r){if(r==null)return 0;if(typeof r=="number")return Number.isFinite(r)?r:0;if(typeof r=="string"&&r.trim()!==""){let t=Number(r);if(!Number.isNaN(t)&&Number.isFinite(t))return t}return 0}function Rn(r){let t=r||{};return{value:ze(t.last),high:ze(t.high),low:ze(t.low),changeDaily:ze(t.changeDaily),changeDailyPercent:ze(t.changeDailyPercent),volume:ze(t.volume)}}function vr(r,t){let a=Rn(r);if(t&&typeof t=="object")for(let u in t)Object.prototype.hasOwnProperty.call(t,u)&&(a[u]=t[u]);return a}function wr(r){return r?r.indexOf("member access is not permitted")>=0?r+'. Remove object-style prefixes (for example use "value" instead of "values.last").':r:"Invalid expression"}function Mn(){if(typeof je=="function")try{let a=Pn();if(a&&a.Parser)return a.Parser}catch{}let r=typeof globalThis!="undefined"?globalThis:{},t=r.exprEval&&r.exprEval.Parser;if(t)return t;throw new Error("expr-eval dependency is missing")}(function(t,a){let u=Mn(),c=a(u);typeof It=="object"&&It.exports&&(It.exports=c),t&&typeof t=="object"&&(t.CryptoTickerExpressionEvaluator=c)})(typeof self!="undefined"?self:In,function(t){return{createEvaluator:a=>new At(a,t),ExpressionEvaluator:At,normalizeNumericValue:ze,buildBaseContext:Rn,buildContext:vr,allowedVariables:mr(Vt)}})});var Gt=ue((An,it)=>{"use strict";(function(r,t){let a=typeof it=="object"&&it.exports?Dt():r==null?void 0:r.CryptoTickerExpressionEvaluator,u=t(a);typeof it=="object"&&it.exports&&(it.exports=u),r&&typeof r=="object"&&(r.CryptoTickerAlertManager=u)})(typeof self!="undefined"?self:An,function(r){if(!r)throw new Error("Expression evaluator dependency is missing");let t=r,a=t.createEvaluator(),u={},c={};function s(f){return u[f]||"off"}function g(f){return c[f]!=="off"}function S(f){c[f]="off"}function E(f){c[f]="on"}function R(f){return g(f)&&s(f)==="on"}function y(f){delete u[f],delete c[f]}function h(f){let k=f.context,p=f.settings||{},x=f.values||{},l=f.backgroundColor,d=f.textColor,C=!1,I=p.alertRule;if(!I)return u[k]="off",{alertMode:C,backgroundColor:l,textColor:d};try{let v=t.buildBaseContext(x);if(a.evaluate(I,v)){if(u[k]="on",g(k)){C=!0;let T=l;l=d,d=T}}else u[k]="off",E(k)}catch(v){u[k]="error",console.error("Error evaluating alertRule",{context:k,settings:p,values:x,error:v instanceof Error?v.message:v})}return{alertMode:C,backgroundColor:l,textColor:d}}return{evaluateAlert:h,shouldDisarmOnKeyPress:R,disarmAlert:S,armAlert:E,clearContext:y,getAlertStatus:s,isAlertArmed:g}})});var Kt=ue((Dn,Ot)=>{"use strict";(function(t,a){let u=a();typeof Ot=="object"&&Ot.exports&&(Ot.exports=u),t&&typeof t=="object"&&(t.CryptoTickerState=u)})(typeof self!="undefined"?self:Dn,function(){let t={},a={},u={},c={},s={},g={};function S(O,G){t[O]={context:O,settings:G}}function E(O){return t[O]||null}function R(O){Object.keys(t).forEach(G=>{O(t[G],G)})}function y(O){delete t[O],delete g[O]}function h(O,G){O&&(a[O]=G||null)}function f(O){return O&&a[O]||null}function k(O){O&&delete a[O]}function p(O,G){O&&G&&(u[O]=G)}function x(O){return O&&u[O]||null}function l(O){O&&(delete u[O],delete g[O])}function d(O){return c[O]||(c[O]={}),c[O]}function C(O,G){c[O]=G}function I(O){return s[O]}function v(O,G){s[O]=G}function N(){Object.keys(t).forEach(O=>{delete t[O]}),Object.keys(a).forEach(O=>{let G=a[O];if(G&&typeof G.unsubscribe=="function")try{G.unsubscribe()}catch{}delete a[O]}),Object.keys(u).forEach(O=>{delete u[O]}),Object.keys(c).forEach(O=>{delete c[O]}),Object.keys(s).forEach(O=>{delete s[O]}),Object.keys(g).forEach(O=>{delete g[O]})}function T(O,G,X){if(!O||!G)return;let V=typeof X=="number"?X:Date.now();g[O]={values:Object.assign({},G),timestamp:V}}function B(O){return O&&g[O]||null}function z(O){O&&delete g[O]}return{setContextDetails:S,getContextDetails:E,forEachContext:R,clearContextDetails:y,setSubscription:h,getSubscription:f,clearSubscription:k,setConnectionState:p,getConnectionState:x,clearConnectionState:l,getOrCreateConversionRateEntry:d,setConversionRateEntry:C,getCandlesCacheEntry:I,setCandlesCacheEntry:v,resetAllState:N,setLastGoodTicker:T,getLastGoodTicker:B,clearLastGoodTicker:z}})});var Nn=ue((On,st)=>{"use strict";(function(r,t){let a=typeof globalThis!="undefined"?globalThis:r,u=typeof st=="object"&&st.exports?Kt():r==null?void 0:r.CryptoTickerState,c=t(u,a);typeof st=="object"&&st.exports&&(st.exports=c),r&&typeof r=="object"&&(r.CryptoTickerSettingsManager=c)})(typeof self!="undefined"?self:On,function(t,a){function u(f){if(typeof je=="function")try{return je(f)}catch{return null}return null}function c(){return a&&typeof a.CryptoTickerDefaults!="undefined"?a.CryptoTickerDefaults:u("./default-settings")}let s=c();function g(){if(!s)throw new Error("Default settings module is not available");return s}function S(f){let k=g();return typeof k.applyDefaults=="function"?k.applyDefaults(f):k.defaultSettings?Object.assign({},k.defaultSettings,f||{}):Object.assign({},f||{})}function E(){let f=g();return typeof f.getDefaultSettings=="function"?f.getDefaultSettings():f.defaultSettings?JSON.parse(JSON.stringify(f.defaultSettings)):{}}let R=E();function y(f){let k=f.context,p=f.settings,x=f.updateSubscription,l=S(p);return t.setContextDetails(k,l),typeof x=="function"&&x(l),l}let h=s&&s.settingsSchema?s.settingsSchema:null;return{applyDefaultSettings:S,getDefaultSettingsSnapshot:E,defaultSettings:R,settingsSchema:h,refreshSettings:y}})});var Un=ue((qr,Nt)=>{"use strict";var Cr={TIMESTAMP_SECONDS_THRESHOLD:9999999999,DEFAULT_PRICE_BAR_POSITION:.5};(function(t,a){let u=a();if(typeof Nt=="object"&&Nt.exports)Nt.exports=u;else{let c=t.CryptoTickerConstants||{};t.CryptoTickerConstants=Object.assign({},c,u)}})(typeof globalThis!="undefined"?globalThis:self,function(){return Cr})});var Bn=ue((Fn,Ut)=>{"use strict";(function(r,t){let a=t();typeof Ut=="object"&&Ut.exports&&(Ut.exports=a),r&&typeof r=="object"&&(r.CryptoTickerConnectionStatusIcons=a)})(typeof self!="undefined"?self:Fn,function(){function t(){return{LIVE:"live",DETACHED:"detached",BACKUP:"backup",BROKEN:"broken"}}function a(c){if(!c||typeof c!="object")return t();let s=t(),g={};for(let S in s){if(!Object.prototype.hasOwnProperty.call(s,S))continue;let E=s[S],R=c[S];g[S]=typeof R=="string"&&R?R:E}return g}function u(c){let s=c.canvasContext,g=c.canvas,S=c.state,E=c.color,R=c.sizeMultiplier,y=c.position,h=c.connectionStates;if(!g||!s||!S)return;let f=a(h),k=(y||"OFF").toUpperCase();if(k==="OFF")return;let p=String(S).toLowerCase(),x=typeof R=="number"&&Number.isFinite(R)&&R>0?R:1,l=20*x,d=4*x,C=g.width-l-d,I=d;k==="BOTTOM_LEFT"&&(C=d,I=g.height-l-d),s.save(),s.translate(C,I),s.lineWidth=Math.max(1.5*x,1),s.strokeStyle=E,s.fillStyle=E;function v(N){if(!(!Array.isArray(N)||N.length===0)){s.beginPath();for(let T=0;T<N.length;T++){let B=N[T],z=B[0]*l,O=B[1]*l;T===0?s.moveTo(z,O):s.lineTo(z,O)}s.closePath(),s.fill()}}p===f.LIVE?v([[.7545784909869392,0],[.18263591551829597,.5685964091677761],[.3947756629367107,.5685964091677761],[.23171302126434715,1],[.8173281041988991,.43136761054941897],[.6051523764976793,.43136761054941897]]):p===f.DETACHED?(v([[0,.45],[.4,.45],[.4,.6],[0,.6]]),v([[.6,.45],[1,.45],[1,.6],[.6,.6]])):p===f.BACKUP?(v([[0,.3],[.4,.3],[.4,.38],[0,.38]]),v([[.6,.3],[1,.3],[1,.38],[.6,.38]]),v([[0,.62],[.4,.62],[.4,.7],[0,.7]]),v([[.6,.62],[1,.62],[1,.7],[.6,.7]])):p===f.BROKEN&&(s.save(),s.fillStyle="#ff0000",s.beginPath(),s.moveTo(l*.46,l*.32),s.lineTo(l*.42,l*.38),s.lineTo(l*.46,l*.44),s.lineTo(l*.41,l*.5),s.lineTo(l*.43,l*.88),s.lineTo(l*.3,l*.73),s.lineTo(l*.18,l*.62),s.bezierCurveTo(l*.08,l*.52,l*.08,l*.38,l*.15,l*.28),s.bezierCurveTo(l*.25,l*.16,l*.4,l*.2,l*.46,l*.32),s.closePath(),s.fill(),s.beginPath(),s.moveTo(l*.54,l*.28),s.lineTo(l*.58,l*.34),s.lineTo(l*.54,l*.4),s.lineTo(l*.59,l*.46),s.lineTo(l*.57,l*.84),s.lineTo(l*.7,l*.69),s.lineTo(l*.82,l*.58),s.bezierCurveTo(l*.92,l*.48,l*.92,l*.34,l*.85,l*.24),s.bezierCurveTo(l*.75,l*.12,l*.6,l*.16,l*.54,l*.28),s.closePath(),s.fill(),s.restore()),s.restore()}return{renderConnectionStatusIcon:u}})});var _n=ue((Ln,ot)=>{"use strict";(function(r,t){let a=typeof ot=="object"&&ot.exports?[Gt(),qt(),Dt(),Un(),Bn()]:[r==null?void 0:r.CryptoTickerAlertManager,r==null?void 0:r.CryptoTickerFormatters,r==null?void 0:r.CryptoTickerExpressionEvaluator,r==null?void 0:r.CryptoTickerConstants,r==null?void 0:r.CryptoTickerConnectionStatusIcons],u=t(a[0],a[1],a[2],a[3],a[4]);typeof ot=="object"&&ot.exports&&(ot.exports=u),r&&typeof r=="object"&&(r.CryptoTickerCanvasRenderer=u)})(typeof self!="undefined"?self:Ln,function(r,t,a,u,c){if(!r)throw new Error("Alert manager dependency is missing");if(!t)throw new Error("Formatters dependency is missing");if(!a)throw new Error("Expression evaluator dependency is missing");let s=u||{},g=typeof s.TIMESTAMP_SECONDS_THRESHOLD=="number"?s.TIMESTAMP_SECONDS_THRESHOLD:9999999999,S=typeof s.DEFAULT_PRICE_BAR_POSITION=="number"?s.DEFAULT_PRICE_BAR_POSITION:.5;function E(){let v=a.allowedVariables.slice(0),N=["alert","backgroundColor","textColor","defaultBackgroundColor","defaultTextColor"];for(let T=0;T<N.length;T++)v.indexOf(N[T])===-1&&v.push(N[T]);return a.createEvaluator({allowedVariables:v})}let R=E(),y=c&&typeof c=="object"?c:null,h=y&&typeof y.renderConnectionStatusIcon=="function"?y.renderConnectionStatusIcon:function(){};function f(v,N){return Math.max(v/144,N/144)}function k(v){let N=parseInt(v.candlesDisplayed);return isNaN(N)?20:Math.min(60,Math.max(5,N))}function p(v,N,T,B,z){let O=Math.sqrt(.75*Math.pow(B,2));v.beginPath(),v.moveTo(N-B/2,T-O/3),v.lineTo(N+B/2,T-O/3),v.lineTo(N,T+O*2/3),v.fillStyle=z,v.fill()}function x(v,N,T,B){if(!N&&N!==0)return[""];let z=String(N).split(/\r?\n/),O=[];function G(X){let V=X.split(""),ee=[],W="";for(let H=0;H<V.length;H++){let he=W+V[H];v.measureText(he).width>T&&W?(ee.push(W),W=V[H]):W=he}return W&&ee.push(W),ee}v.font=B;for(let X=0;X<z.length;X++){let V=z[X];if(!V||V.trim()===""){O.push("");continue}let ee=V.trim().split(/\s+/),W=ee.shift()||"";for(;ee.length>0;){let H=ee.shift(),he=W?W+" "+H:H;if(v.measureText(he).width<=T){W=he;continue}if(W&&O.push(W),v.measureText(H).width<=T)W=H;else{let F=G(H);for(let q=0;q<F.length-1;q++)O.push(F[q]);W=F.length>0?F[F.length-1]:""}}W&&O.push(W)}return O.length===0&&O.push(""),O}function l(v){if(v==null)return null;let N=typeof v=="number"?v:parseFloat(v);if(!Number.isFinite(N))return null;let T=N>g?N:N*1e3,B=new Date(T);if(isNaN(B.getTime()))return null;try{return B.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}catch{return B.toISOString()}}function d(v){let N=v.canvas,T=v.canvasContext,B=v.message,z=v.backgroundColor||"#000000",O=v.textColor||"#ffffff",G=v.font||"Lato",X=v.fontSize,V=v.connectionStates,ee=v.connectionState,W=(v.displayConnectionStatusIcon||"OFF").toUpperCase(),H=N.width,he=N.height,F=f(H,he),q=12*F,ve=X?X*F:Math.max(22*F,14),Se="bold "+ve+"px "+G,ye=ve*1.25;T.clearRect(0,0,H,he),T.fillStyle=z,T.fillRect(0,0,H,he);let fe=H-q*2,te=x(T,B,fe,Se),Ee=he-q*2;W!=="OFF"&&V&&(Ee-=28*F);let Q=ye*te.length,xe=q+(Ee-Q)/2+ye/2;xe<q+ye/2&&(xe=q+ye/2),T.fillStyle=O,T.textAlign="center",T.textBaseline="middle",T.font=Se;for(let Z=0;Z<te.length;Z++){let ne=te[Z];ne&&T.fillText(ne,H/2,xe+Z*ye)}W!=="OFF"&&V&&h({canvas:N,canvasContext:T,state:ee,color:O,sizeMultiplier:F,position:W,connectionStates:V})}function C(v){let N=v.canvas,T=v.canvasContext,B=v.settings||{},z=v.values||{},O=v.context,G=v.connectionStates,X=v.connectionState,V=v.dataState||"live",ee=v.infoMessage||"",W=v.lastValidTimestamp||z.lastUpdated||null,H=N.width,he=N.height,F=f(H,he),q=10*F,ve=B.pair,Se=B.title||z.pairDisplay||z.pair||ve||"",ye=B.multiplier||1,fe=B.priceFormat||"compact";function te(oe,ie){let ae=parseFloat(oe);return isNaN(ae)||ae<=0?ie:ae}function Ee(oe,ie){let ae=parseInt(oe,10);return isNaN(ae)||ae<0?ie:ae}let Q=Ee(B.digits,2),xe=Ee(B.highLowDigits,Q),Z=te(B.fontSizeBase,25),ne=te(B.fontSizePrice,Z*35/25),Ne=te(B.fontSizeHighLow,Z),Fe=te(B.fontSizeChange,Z*19/25);function Be(oe,ie){return typeof oe=="string"&&oe.length>0?oe:ie}let Pe={thousandsSeparator:Be(B.thousandsSeparator,","),decimalSeparator:Be(B.decimalSeparator,".")},Ue=B.backgroundColor||"#000000",Re=B.textColor||"#ffffff",we=Ue,de=Re,pt=X||z.connectionState||null,Le=typeof z.last=="number"&&Number.isFinite(z.last)?z.last:null,A=typeof z.high=="number"&&Number.isFinite(z.high)?z.high:null,e=typeof z.low=="number"&&Number.isFinite(z.low)?z.low:null,o=typeof z.changeDailyPercent=="number"&&Number.isFinite(z.changeDailyPercent)?z.changeDailyPercent:null,b=o!==null?o*100:null,w=typeof V=="string"?V.toLowerCase():"live",M=w==="stale"?"#f6a623":w==="missing"?"#d9534f":null,D=r.evaluateAlert({context:O,settings:B,values:z,backgroundColor:we,textColor:de}),$=D.alertMode;we=D.backgroundColor,de=D.textColor;let L=a.buildContext(z,{alert:$,backgroundColor:we,textColor:de,defaultBackgroundColor:Ue,defaultTextColor:Re});if(B.backgroundColorRule)try{let oe=R.evaluate(B.backgroundColorRule,L),ie=String(oe||"").trim();ie&&(we=ie,L.backgroundColor=we)}catch(oe){console.error("Error evaluating backgroundColorRule",{context:O,expression:B.backgroundColorRule,values:z,error:oe instanceof Error?oe.message:oe})}if(B.textColorRule)try{L.textColor=de;let oe=R.evaluate(B.textColorRule,L),ie=String(oe||"").trim();ie&&(de=ie,L.textColor=de)}catch(oe){console.error("Error evaluating textColorRule",{context:O,expression:B.textColorRule,values:z,error:oe instanceof Error?oe.message:oe})}T.clearRect(0,0,H,he),T.fillStyle=we,T.fillRect(0,0,H,he);let K=B.font||"Lato",se=Z*F+"px "+K;T.font=se,T.fillStyle=de,T.textAlign="left",T.textBaseline="alphabetic";let ke=25*F,_e=q;if(M){let oe=5*F,ie=q+oe,ae=ke-Z*F*.4;T.beginPath(),T.fillStyle=M,T.arc(ie,ae,oe,0,Math.PI*2),T.fill(),T.fillStyle=de,_e+=oe*2+6*F}if(Se&&T.fillText(Se,_e,ke),w==="stale"){let oe=ee?ee.toUpperCase():"STALE",ie=l(W),ae=ie?oe+" \u2022 "+ie:oe,Te=Math.max(14,Z*.6)*F;T.font=Te+"px "+K,T.fillStyle=M||de,T.fillText(ae,_e,ke+Te+4*F),T.font=se,T.fillStyle=de}if(w!=="missing"){let oe=Le!==null?t.getRoundedValue(Le,Q,ye,fe,Pe):"--";if(T.font="bold "+ne*F+"px "+K,T.fillStyle=de,T.textAlign="left",T.fillText(oe,q,60*F),B.displayHighLow!=="off"){T.font=Ne*F+"px "+K,T.fillStyle=de,T.textAlign="left";let ie=e!==null?t.getRoundedValue(e,xe,ye,fe,Pe):"--";T.fillText(ie,q,90*F),T.textAlign="right";let ae=A!==null?t.getRoundedValue(A,xe,ye,fe,Pe):"--";T.fillText(ae,H-q,135*F)}if(B.displayDailyChange!=="off"&&b!==null){let ie=T.fillStyle,ae=2;Math.abs(b)>=100?ae=0:Math.abs(b)>=10&&(ae=1);let Te=t.getRoundedValue(b,ae,1,"plain",Pe);b>0?(Te="+"+Te,T.fillStyle="green"):b<0?T.fillStyle="red":T.fillStyle=ie,T.font=Fe*F+"px "+K,T.textAlign="right",T.fillText(Te,H-q,90*F),T.fillStyle=ie}if(B.displayHighLowBar!=="off"&&A!==null&&e!==null&&Le!==null){let ie=104*F,ae=5*F,Te=6*F,$e=A-e,He=$e>0?Math.min(Math.max((Le-e)/$e,0),1):S,qe=H-ae*2,De=ae+Math.round(qe*He),Ve=12*F;T.beginPath(),T.moveTo(ae,ie),T.lineTo(De,ie),T.lineWidth=Te,T.strokeStyle="green",T.stroke(),T.beginPath(),T.moveTo(De,ie),T.lineTo(H-ae,ie),T.lineWidth=Te,T.strokeStyle="red",T.stroke(),p(T,De,ie,Ve,de)}}else{let oe=ee?ee.toUpperCase():"NO DATA",ie=Math.max(26,Z)*F,ae="bold "+ie+"px "+K;T.font=ae,T.fillStyle=M||de;let Te=T.textAlign,$e=T.textBaseline;T.textAlign="center",T.textBaseline="middle";let He=H-q*2,qe=x(T,oe,He,ae),De=ie*1.1,Ve=De*qe.length,Lt=(he-Ve)/2+De/2;for(let Ge=0;Ge<qe.length;Ge++)T.fillText(qe[Ge],H/2,Lt+Ge*De);T.textAlign=Te,T.textBaseline=$e,T.font=se,T.fillStyle=de}let yt=(B.displayConnectionStatusIcon||"OFF").toUpperCase();yt!=="OFF"&&h({canvas:N,canvasContext:T,state:pt,color:de,sizeMultiplier:F,position:yt,connectionStates:G})}function I(v){let N=v.canvas,T=v.canvasContext,B=v.settings||{},z=v.candlesNormalized||[],O=v.connectionStates,G=v.connectionState,X=N.width,V=N.height,ee=f(X,V),W=10*ee,H=(B.displayConnectionStatusIcon||"OFF").toUpperCase(),he=G||null,F=B.backgroundColor||"#000000",q=B.textColor||"#ffffff",ve=z.slice(-k(B)),Se=ve.length,ye=X-2*W,fe=V-2*W,te=Se>0?ye/Se:ye,Ee=Math.max(2*ee,te*.15),Q=Math.max(4*ee,te*.6);T.clearRect(0,0,X,V),T.fillStyle=F,T.fillRect(0,0,X,V);let xe=B.font||"Lato";T.font=15*ee+"px "+xe,T.fillStyle=q;let Z=B.candlesInterval||"1h";T.textAlign="right",T.fillText(Z,X-10*ee,V-5*ee),ve.forEach(function(ne){let Ne=Math.round(W+Math.round(ne.timePercent*ye)),Fe=Math.round(W+fe-ne.highPercent*fe),Be=Math.round(W+fe-ne.lowPercent*fe);T.beginPath(),T.moveTo(Ne,Fe),T.lineTo(Ne,Be),T.lineWidth=Ee,T.strokeStyle=ne.closePercent>ne.openPercent?"#1c9900":"#a10",T.stroke();let Pe=Math.round(W+fe-ne.openPercent*fe),Ue=Math.round(W+fe-ne.closePercent*fe),Re=Math.min(Pe,Ue),we=Math.max(Pe,Ue);T.beginPath(),T.rect(Math.round(Ne-Q/2),Re,Math.round(Q),Math.max(1,we-Re)),T.fillStyle=ne.closePercent>ne.openPercent?"#1c9900":"#a10",T.fill()}),H!=="OFF"&&h({canvas:N,canvasContext:T,state:he,color:q,sizeMultiplier:ee,position:H,connectionStates:O})}return{getCanvasSizeMultiplier:f,getCandlesDisplayCount:k,renderConnectionStatusIcon:h,renderTickerCanvas:C,renderCandlesCanvas:I,renderMessageCanvas:d}})});var Vn=ue((Vr,Zt)=>{"use strict";var Hn={tProxyBase:"https://tproxyv8.opendle.com",fallbackPollIntervalMs:6e4,staleTickerTimeoutMs:36e4,messages:{loading:"LOADING...",stale:"STALE",noData:"NO DATA",misconfigured:"INVALID PAIR",conversionError:"CONVERSION ERROR"}};function Oe(r){if(typeof je=="function")try{return je(r)}catch{return null}return null}function Sr(){return typeof CryptoTickerConfig!="undefined"?CryptoTickerConfig:null}function at(r){if(typeof r=="string"){let t=r.trim();return t.length===0?null:t.toUpperCase()}return r==null?null:String(r).trim().toUpperCase()||null}var kr=Oe("./config"),Tr=Oe("./constants"),Er=Sr(),Ae=Object.assign({},Hn,kr||{},Er||{}),$n=Tr||(typeof CryptoTickerConstants!="undefined"?CryptoTickerConstants:null)||{},xr=typeof $n.TIMESTAMP_SECONDS_THRESHOLD=="number"?$n.TIMESTAMP_SECONDS_THRESHOLD:9999999999,bt=Ae.tProxyBase,Wn=typeof bt=="string"?bt.replace(/\/$/,""):"",jn="_ctBust",Pr=Hn.messages,Me=Object.assign({},Pr,Ae&&Ae.messages||{});function Rr(r){if(!r||typeof r!="string")return r;try{let t=new URL(r);return t.searchParams.set(jn,Date.now().toString()),t.toString()}catch{let a=r.indexOf("?")===-1?"?":"&";return r+a+jn+"="+Date.now()}}function zn(r,t){if(!r||typeof r!="string")return{url:r,options:t};let a=r.replace(/\/$/,"");if(!Wn||a.indexOf(Wn)!==0)return{url:r,options:t};let u=Object.assign({},t||{});u.cache="no-store";let c=Object.assign({},u.headers||{});return c["cache-control"]="no-cache",c.pragma="no-cache",u.headers=c,{url:Rr(r),options:u}}var Yt=Oe("./providers/subscription-key"),ht=typeof CryptoTickerProviders!="undefined"?CryptoTickerProviders:null,Mr=Yt&&Yt.buildSubscriptionKey?Yt.buildSubscriptionKey:ht&&typeof ht.buildSubscriptionKey=="function"?ht.buildSubscriptionKey:function(r,t,a,u){let c=r||"",s=t||"",g=a||null,S=u||null,E="";return g!==null&&S!==null&&g!==S&&(E="__"+g+"_"+S),c+"__"+s+E},Ir=Oe("./providers/connection-states"),Ie=Ir||(typeof CryptoTickerConnectionStates!="undefined"?CryptoTickerConnectionStates:{LIVE:"live",DETACHED:"detached",BACKUP:"backup",BROKEN:"broken"}),Ar=Oe("./canvas-renderer"),Dr=Oe("./alert-manager"),Or=Oe("./formatters"),Nr=Oe("./ticker-state"),Ur=Oe("./settings-manager"),lt=Ar||(typeof CryptoTickerCanvasRenderer!="undefined"?CryptoTickerCanvasRenderer:null),Xt=Dr||(typeof CryptoTickerAlertManager!="undefined"?CryptoTickerAlertManager:null),Qt=Or||(typeof CryptoTickerFormatters!="undefined"?CryptoTickerFormatters:null),Ce=Nr||(typeof CryptoTickerState!="undefined"?CryptoTickerState:null),ft=Ur||(typeof CryptoTickerSettingsManager!="undefined"?CryptoTickerSettingsManager:null);if(!lt||!Xt||!Qt||!Ce||!ft)throw new Error("CryptoTicker dependencies are not available");var qn=!1,ut=null,ct,Ft,Fr=!1,Br=60*60*1e3,Jt=null,Bt=ft.applyDefaultSettings,Lr=ft.defaultSettings,_r=ft.getDefaultSettingsSnapshot,$r=ft.settingsSchema,me={type:"com.courcelle.cryptoticker.ticker",log:function(...r){qn&&console.log(...r)},setContextConnectionState:function(r,t){Ce.setConnectionState(r,t)},getContextConnectionState:function(r){return Ce.getConnectionState(r)},clearContextConnectionState:function(r){Ce.clearConnectionState(r)},getProviderRegistry:function(){if(!Jt){let r=Oe("./providers/provider-registry"),t=r&&r.ProviderRegistry?r.ProviderRegistry:ht&&ht.ProviderRegistry?ht.ProviderRegistry:null;if(!t)throw new Error("ProviderRegistry is not available");Jt=new t({baseUrl:bt,logger:(...a)=>{this.log(...a)},fallbackPollIntervalMs:Ae.fallbackPollIntervalMs,staleTickerTimeoutMs:Ae.staleTickerTimeoutMs,binanceRestBaseUrl:Ae.binanceRestBaseUrl,binanceWsBaseUrl:Ae.binanceWsBaseUrl,binanceSymbolOverrides:Ae.binanceSymbolOverrides,bitfinexRestBaseUrl:Ae.bitfinexRestBaseUrl,bitfinexWsBaseUrl:Ae.bitfinexWsBaseUrl,bitfinexSymbolOverrides:Ae.bitfinexSymbolOverrides})}return Jt},websocketSend:function(r){ut&&ut.send(r)},onKeyDown:async function(r,t,a,u){switch(t.mode){case"candles":t.mode="ticker";break;case"ticker":default:Xt.shouldDisarmOnKeyPress(r)?Xt.disarmAlert(r):t.mode="candles";break}this.websocketSend(JSON.stringify({event:"setSettings",context:r,payload:t})),this.refreshTimer(r,t)},onKeyUp:function(r,t,a,u){},onWillAppear:async function(r,t,a){this.initCanvas(),this.refreshTimer(r,t)},refreshTimers:async function(){Ce.forEachContext(r=>{this.refreshTimer(r.context,r.settings)})},refreshTimer:async function(r,t){let a=this.refreshSettings(r,t);this.updateTicker(r,a)},connect:function(){let r=this.getProviderRegistry();r&&typeof r.ensureAllConnections=="function"&&r.ensureAllConnections()},updateSubscription:function(r,t){let a=t.exchange,u=t.pair,c=this.resolveConversionCurrencies(t.fromCurrency,t.currency),s=this.getSubscriptionContextKey(a,u,c.from,null),g=Ce.getSubscription(r);if(g&&g.key===s)return g;if(g&&typeof g.unsubscribe=="function"){try{g.unsubscribe()}catch(h){this.log("Error unsubscribing from provider",h)}Ce.clearSubscription(r),this.clearContextConnectionState(r)}let E=this.getProviderRegistry().getProvider(a),R={exchange:a,symbol:u,fromCurrency:c.from,toCurrency:null},y=this;try{let h=E.subscribeTicker(R,{onData:async function(f){let k=Ce.getContextDetails(r);if(k){y.setContextConnectionState(k.context,f&&f.connectionState);try{let p=await y.convertTickerValues(f,k.settings&&k.settings.fromCurrency,k.settings&&k.settings.currency);await y.updateCanvas(k.context,k.settings,p)}catch(p){y.log("Error updating canvas from subscription",p)}}},onError:function(f){y.log("Provider subscription error",f),y.setContextConnectionState(r,Ie.BROKEN)}});return Ce.setSubscription(r,{key:s,unsubscribe:h&&typeof h.unsubscribe=="function"?h.unsubscribe:function(){},providerId:E.getId?E.getId():null}),Ce.getSubscription(r)}catch(h){this.log("Error subscribing to provider",h)}return null},refreshSettings:function(r,t){return ft.refreshSettings({context:r,settings:t,updateSubscription:a=>{this.updateSubscription(r,a)}})},getSubscriptionContextKey:function(r,t,a,u){return Mr(r,t,a,u)},resolveConversionCurrencies:function(r,t){let a=at(r)||"USD",u=at(t);return!u||u===a?{from:a,to:null}:{from:a,to:u}},getConversionRate:async function(r,t){let a=at(r),u=at(t);if(!a||!u||a===u)return 1;let c=a+"_"+u,s=Date.now(),g=Ce.getOrCreateConversionRateEntry(c);if(typeof g.rate=="number"&&g.rate>0&&g.fetchedAt&&s-g.fetchedAt<Br)return g.rate;if(g.promise)try{return await g.promise}catch(h){this.log("Conversion rate promise failed",h)}let S=typeof fetch=="function"?fetch:null;if(!S)return typeof g.rate=="number"&&g.rate>0?g.rate:1;let E=(bt||"").replace(/\/$/,"");if(!E)return typeof g.rate=="number"&&g.rate>0?g.rate:1;let R=E+"/api/ticker/json/currency/"+encodeURIComponent(a)+"/"+encodeURIComponent(u),y=this;g.promise=async function(){try{let h=zn(R),f=await S(h.url,h.options);if(!f||!f.ok)throw new Error("Conversion rate response not ok");let k=await f.json(),p=k&&k.rate!==void 0?parseFloat(k.rate):NaN;if(!p||!isFinite(p)||p<=0)throw new Error("Invalid conversion rate");return g.rate=p,g.fetchedAt=Date.now(),p}catch(h){throw y.log("Error fetching conversion rate",h),h}finally{delete g.promise}}();try{return await g.promise}catch{return typeof g.rate=="number"&&g.rate>0?g.rate:1}},convertTickerValues:async function(r,t,a){if(!r)return r;let u=this.resolveConversionCurrencies(t,a);if(!u.to)return r;let c=at(r.conversionToCurrency),s=at(r.conversionFromCurrency);if(c===u.to&&s===u.from)return r;let g=null;try{g=await this.getConversionRate(u.from,u.to)}catch(S){return this.log("Conversion rate error",S),this.createConversionErrorValues(r)}return!g||!isFinite(g)||g<=0?this.createConversionErrorValues(r):this.applyTickerConversion(r,g,u.from,u.to)},createConversionErrorValues:function(r){let t=Object.assign({},r),a=["last","high","low","open","close","changeDaily","changeDailyPercent","volume"];for(let u=0;u<a.length;u++){let c=a[u];Object.prototype.hasOwnProperty.call(t,c)&&delete t[c]}return t.conversionRate=null,t.conversionError=!0,t},applyTickerConversion:function(r,t,a,u){if(!r||typeof r!="object")return r;let c=Object.assign({},r),s=["last","high","low","open","close","changeDaily"];for(let g=0;g<s.length;g++){let S=s[g];if(!Object.prototype.hasOwnProperty.call(r,S))continue;let E=r[S],R=typeof E=="number"?E:parseFloat(E);isNaN(R)||(c[S]=R*t)}return c.conversionRate=t,c.conversionFromCurrency=a,c.conversionToCurrency=u,c},applyCandlesConversion:function(r,t){return!Array.isArray(r)||!t||!isFinite(t)||t<=0?r:r.map(function(a){if(!a||typeof a!="object")return a;let u=Object.assign({},a),c=["open","close","high","low"];for(let s=0;s<c.length;s++){let g=c[s];if(!Object.prototype.hasOwnProperty.call(a,g))continue;let S=a[g],E=typeof S=="number"?S:parseFloat(S);isNaN(E)||(u[g]=E*t)}if(Object.prototype.hasOwnProperty.call(a,"volumeQuote")){let s=a.volumeQuote,g=typeof s=="number"?s:parseFloat(s);isNaN(g)||(u.volumeQuote=g*t)}return u})},updateTicker:async function(r,t){let a=t.pair,u=await this.getTickerValue(a,t.currency,t.exchange,t.fromCurrency);this.setContextConnectionState(r,u&&u.connectionState),this.updateCanvas(r,t,u)},initCanvas:function(){ct=document.getElementById("ticker"),Ft=ct.getContext("2d")},updateCanvas:async function(r,t,a){this.log("updateCanvas",r,t,a);let u=a&&a.connectionState||this.getContextConnectionState(r);switch(t.mode){case"candles":{let c=await this.getCandles(t);this.updateCanvasCandles(r,t,c,u);break}case"ticker":default:this.updateCanvasTicker(r,t,a,u);break}},sanitizeTickerValues:function(r){if(!r||typeof r!="object")return{values:{},hasAny:!1,hasCritical:!1,timestamp:null};let t=Object.assign({},r);function a(S,E,R){if(typeof S=="number"&&Number.isFinite(S))return R?Math.round(S):S;if(typeof S=="string"){let y=S.trim();if(y){let h=R?parseInt(y,10):parseFloat(y);if(!isNaN(h)&&Number.isFinite(h))return R?Math.round(h):h}}return E}let u=a(r.last,null,!1);u===null?delete t.last:t.last=u;let c={high:null,low:null,volume:0,changeDaily:0,changeDailyPercent:0};Object.keys(c).forEach(S=>{let E=c[S],R=a(r[S],E,!1);R==null||!Number.isFinite(R)?delete t[S]:R===E&&r[S]===void 0?E===null?delete t[S]:t[S]=E:t[S]=R});let s=["lastUpdated","timestamp","time","updatedAt"],g=null;for(let S=0;S<s.length;S++){let E=s[S];if(!Object.prototype.hasOwnProperty.call(r,E))continue;let y=a(r[E],null,!0);if(y!=null){let h=y>xr?y:y*1e3;g=h,t.lastUpdated=h;break}}return typeof t.pairDisplay!="string"&&delete t.pairDisplay,{values:t,hasAny:Object.keys(r).length>0,hasCritical:u!==null,timestamp:g}},buildTickerRenderContext:function(r,t,a,u){let c=this.sanitizeTickerValues(a),s=c.values,g=Date.now(),S="missing",E=null,R=null,y=s,h=null,f=u||s.connectionState||null,k=Ce.getLastGoodTicker(r),p=f===Ie.BROKEN,l=[Ie.LIVE,Ie.BACKUP,Ie.DETACHED].indexOf(f)!==-1,d=c.hasCritical&&Number.isFinite(s.last)&&s.last===0&&(!Number.isFinite(s.high)||s.high===0)&&(!Number.isFinite(s.low)||s.low===0)&&(!Number.isFinite(s.volume)||s.volume===0)&&c.timestamp===null,C=c.hasCritical&&(!l||p)&&d;if(!!s.conversionError){S="missing",y=Object.assign({},s);let v=t.title||s.pairDisplay||s.pair||t.pair||"";return!y.pairDisplay&&v&&(y.pairDisplay=v),E=Me.conversionError||"CONVERSION ERROR",h="conversion_error",{values:y,dataState:S,infoMessage:E,lastValidTimestamp:R,degradedReason:h}}if(c.hasCritical&&!p&&!C){let v=c.timestamp||g;s.lastUpdated=v,Ce.setLastGoodTicker(r,s,v),R=v,S="live",y=Object.assign({},s)}else if(k&&k.values&&typeof k.values=="object"&&Number.isFinite(k.values.last))S="stale",y=Object.assign({},k.values),R=k.timestamp,y.lastUpdated||(y.lastUpdated=k.timestamp),E=Me.stale,h=c.hasAny?"partial":"missing";else{S="missing",y=Object.assign({},s);let v=t.title||s.pairDisplay||s.pair||t.pair||"";!y.pairDisplay&&v&&(y.pairDisplay=v),C||p?(E=Me.misconfigured||Me.noData,h="misconfigured"):(E=Me.loading,h=c.hasAny?"partial":"none")}return!E&&S==="missing"&&(E=p?Me.misconfigured||Me.noData:Me.loading),!E&&S==="live"&&p&&(E=Me.misconfigured||Me.noData),!E&&S==="stale"&&!Me.stale&&(E="STALE"),{values:y,dataState:S,infoMessage:E,lastValidTimestamp:R,degradedReason:h}},displayMessage:function(r,t,a){this.initCanvas();let u=a||{},c=Bt(u.settings||{}),s=u.backgroundColor||c.backgroundColor||"#000000",g=u.textColor||c.textColor||"#ffffff",S=u.font||c.font||"Lato",E=u.fontSize||null,R=u.connectionState||null,y=u.displayConnectionStatusIcon||c.displayConnectionStatusIcon||"OFF";R&&this.setContextConnectionState(r,R),lt.renderMessageCanvas({canvas:ct,canvasContext:Ft,message:t,backgroundColor:s,textColor:g,font:S,fontSize:E,connectionStates:Ie,connectionState:R||this.getContextConnectionState(r),displayConnectionStatusIcon:y}),this.sendCanvas(r)},getCanvasSizeMultiplier:function(r,t){return lt.getCanvasSizeMultiplier(r,t)},getCandlesDisplayCount:function(r){return lt.getCandlesDisplayCount(r)},updateCanvasTicker:function(r,t,a,u){this.log("updateCanvasTicker",r,t,a);let c=this.buildTickerRenderContext(r,t,a,u);lt.renderTickerCanvas({canvas:ct,canvasContext:Ft,settings:t,values:c.values,context:r,connectionStates:Ie,connectionState:u||a&&a.connectionState||null,dataState:c.dataState,infoMessage:c.infoMessage,lastValidTimestamp:c.lastValidTimestamp,degradedReason:c.degradedReason}),this.sendCanvas(r)},updateCanvasCandles:function(r,t,a,u){this.log("updateCanvasCandles",r,t,a),lt.renderCandlesCanvas({canvas:ct,canvasContext:Ft,settings:t,candlesNormalized:a,connectionStates:Ie,connectionState:u||this.getContextConnectionState(r)}),this.sendCanvas(r)},sendCanvas:function(r){var t={event:"setImage",context:r,payload:{image:ct.toDataURL(),target:DestinationEnum.HARDWARE_AND_SOFTWARE}};this.websocketSend(JSON.stringify(t))},getRoundedValue:function(r,t,a,u){return Qt.getRoundedValue(r,t,a,u)},getTickerValue:async function(r,t,a,u){let s=this.getProviderRegistry().getProvider(a),g=this.resolveConversionCurrencies(u,t),S={exchange:a,symbol:r,fromCurrency:g.from,toCurrency:null};try{let E=await s.fetchTicker(S),y=await this.convertTickerValues(E,g.from,g.to)||E;return y&&typeof y=="object"&&!y.connectionState&&(y.connectionState=Ie.DETACHED),y}catch(E){this.log("Error fetching ticker",E);let R=this.getSubscriptionContextKey(a,r,g.from,null);if(s&&typeof s.getCachedTicker=="function"){let y=s.getCachedTicker(R);if(y){let f=await this.convertTickerValues(y,g.from,g.to)||y;return f&&!f.connectionState&&(f.connectionState=Ie.BACKUP),f}}return{changeDaily:0,changeDailyPercent:0,last:0,volume:0,high:0,low:0,pair:r,pairDisplay:r,connectionState:Ie.BROKEN}}},getCandles:async function(r){this.log("getCandles");let t=r.exchange,a=r.pair,u=this.convertCandlesInterval(r.candlesInterval||"1h"),c=this.getCandlesDisplayCount(r),s=this.resolveConversionCurrencies(r.fromCurrency,r.currency),g=s.to||s.from||"",S=t+"_"+a+"_"+u+"_"+c+"_"+g,E=Ce.getCandlesCacheEntry(S);E||(E={},Ce.setCandlesCacheEntry(S,E));let R=new Date().getTime(),y="time",h="candles";if(E[y]&&E[y]>R-60*1e3)return E[h];let f={exchange:t,symbol:a,interval:u,limit:24},k=null;try{let d=this.getProviderRegistry(),C=d.getProvider(t);if(C&&typeof C.fetchCandles=="function"&&(k=await C.fetchCandles(f)),Array.isArray(k)||(k=null),k===null){let I=d.getGenericProvider();I&&typeof I.fetchCandles=="function"&&(k=await I.fetchCandles(f),Array.isArray(k)||(k=null))}}catch(d){this.log("Error fetching provider candles",d),k=null}if(k===null)try{let d=bt+"/api/Candles/json/"+t+"/"+a+"/"+u+"?limit=24",C=zn(d),v=await(await fetch(C.url,C.options)).json();v&&Array.isArray(v.candles)&&(k=v.candles)}catch(d){this.log("Error fetching candles from proxy",d)}if(!Array.isArray(k))return E[h]||[];let p=this.prepareCandlesForDisplay(k,c),x=p;if(s.to)try{let d=await this.getConversionRate(s.from,s.to);d&&isFinite(d)&&d>0&&(x=this.applyCandlesConversion(p,d))}catch(d){this.log("Conversion rate error for candles",d)}let l=this.getCandlesNormalized(x);return E[y]=R,E[h]=l,E[h]},convertCandlesInterval:function(r){switch(r){case"1m":return"MINUTES_1";case"5m":return"MINUTES_5";case"15m":return"MINUTES_15";case"1h":return"HOURS_1";case"6h":return"HOURS_6";case"12h":return"HOURS_12";case"1D":return"DAYS_1";case"7D":return"DAYS_7";case"1M":return"MONTHS_1"}return r},prepareCandlesForDisplay:function(r,t){if(!Array.isArray(r)||r.length===0)return[];let a=r.map(function(u){if(!u)return null;let c=u.ts;if(typeof c!="number"){let s=u.openTime;if(s){let g=Date.parse(s);isNaN(g)||(c=Math.floor(g/1e3))}}return typeof c!="number"||isNaN(c)?null:{candle:u,ts:c}}).filter(function(u){return u!==null}).sort(function(u,c){return u.ts-c.ts}).map(function(u){return u.candle.ts===u.ts?u.candle:Object.assign({},u.candle,{ts:u.ts})});return typeof t=="number"&&t>0&&a.length>t?a.slice(-t):a},getCandlesNormalized:function(r){let t=Number.POSITIVE_INFINITY,a=0,u=Number.POSITIVE_INFINITY,c=0,s=Number.POSITIVE_INFINITY,g=0;(r||[]).forEach(function(R){s=Math.min(s,R.ts),g=Math.max(g,R.ts),t=Math.min(t,R.open),t=Math.min(t,R.close),t=Math.min(t,R.high),t=Math.min(t,R.low),a=Math.max(a,R.open),a=Math.max(a,R.close),a=Math.max(a,R.high),a=Math.max(a,R.low),u=Math.min(u,R.volumeQuote),c=Math.max(c,R.volumeQuote)});let S=this,E=[];return(r||[]).forEach(function(R){E.push({timePercent:S.normalizeValue(R.ts,s,g),openPercent:S.normalizeValue(R.open,t,a),closePercent:S.normalizeValue(R.close,t,a),highPercent:S.normalizeValue(R.high,t,a),lowPercent:S.normalizeValue(R.low,t,a),volumePercent:S.normalizeValue(R.volumeQuote,u,c)})}),this.log("getCandlesNormalized",E),E},normalizeValue:function(r,t,a){return Qt.normalizeValue(r,t,a)}};me.defaultSettings=Lr;me.applyDefaultSettings=Bt;me.getDefaultSettings=function(){return _r()};me.settingsSchema=$r;function Wr(r,t,a,u,c){ut=new WebSocket("ws://127.0.0.1:"+r);function s(g){var S={event:a,uuid:g};me.websocketSend(JSON.stringify(S))}ut.onopen=function(){s(t)},ut.onmessage=async function(g){var S=JSON.parse(g.data);let E=S.event,R=S.context,y=S.payload||{},h=y.settings;!h&&E==="sendToPlugin"&&(h=y);let f=h,k=y.coordinates,p=y.userDesiredState;["deviceDidConnect","titleParametersDidChange"].indexOf(E)>=0||(f!=null&&(f=Bt(f)),E=="keyDown"?await me.onKeyDown(R,f,k,p):E=="keyUp"?await me.onKeyUp(R,f,k,p):E=="willAppear"?await me.onWillAppear(R,f,k):f!=null&&(me.refreshSettings(R,f),me.refreshTimer(R,f)))},ut.onclose=function(){},setInterval(async function(){await me.refreshTimers()},3e5)}if(Fr){qn=!0,me.connect();let r=Bt({digits:0,pair:"LTCUSD",mode:"ticker"}),t="test",a={column:1,row:1},u=null;setTimeout(function(){me.onWillAppear(t,r,a),setInterval(async function(){await me.onKeyDown(t,r,a,u),await me.onKeyUp(t,r,a,u)},5e3)},1e3)}typeof Zt!="undefined"&&(Zt.exports=me);typeof window!="undefined"&&(window.connectElgatoStreamDeckSocket=Wr)});var Kr=be(ln()),Yr=be(hn()),Jr=be(Ke()),Xr=be(gt()),Qr=be(Ye()),Zr=be(Xe()),ei=be(Ze()),ti=be(mn()),ni=be(Pt()),ri=be(jt()),ii=be(zt()),si=be(Ht()),oi=be(Tn()),ai=be(qt()),ci=be(Dt()),li=be(Gt()),ui=be(Kt()),hi=be(Nn()),fi=be(_n()),pi=be(Vn());})();
